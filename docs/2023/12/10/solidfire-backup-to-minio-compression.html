<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.3 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>NetApp SolidFire backup to S3 and MinIO compression savings | Acting Technologist</title>
<meta name="description" content="Can MinIO compression save space more than native SolidFire compression in backup to S3">


  <meta name="author" content="scaleoutSean">
  
  <meta property="article:author" content="scaleoutSean">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Acting Technologist">
<meta property="og:title" content="NetApp SolidFire backup to S3 and MinIO compression savings">
<meta property="og:url" content="https://scaleoutsean.github.io/2023/12/10/solidfire-backup-to-minio-compression.html">


  <meta property="og:description" content="Can MinIO compression save space more than native SolidFire compression in backup to S3">





  <meta name="twitter:site" content="@scaleoutSean">
  <meta name="twitter:title" content="NetApp SolidFire backup to S3 and MinIO compression savings">
  <meta name="twitter:description" content="Can MinIO compression save space more than native SolidFire compression in backup to S3">
  <meta name="twitter:url" content="https://scaleoutsean.github.io/2023/12/10/solidfire-backup-to-minio-compression.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2023-12-10T00:00:00+08:00">






<link rel="canonical" href="https://scaleoutsean.github.io/2023/12/10/solidfire-backup-to-minio-compression.html">







  <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />


  <meta name="msvalidate.01" content="7cf5b7d96a77410a8ad035f764dc81b3">





<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Acting Technologist Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic" rel="stylesheet" type="text/css">


  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/scaleoutsean-acting-technologist.png" alt="Acting Technologist"></a>
        
        <a class="site-title" href="/">
          Acting Technologist
          <span class="site-subtitle">human action through technology</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/archive/"
                
                
              >Archive</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/projects.html"
                
                
              >Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="NetApp SolidFire backup to S3 and MinIO compression savings">
    <meta itemprop="description" content="We compare native SolidFire compression in backup to S3 vs MinIO compression">
    <meta itemprop="datePublished" content="2023-12-10T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://scaleoutsean.github.io/2023/12/10/solidfire-backup-to-minio-compression.html" itemprop="url">NetApp SolidFire backup to S3 and MinIO compression savings
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-12-10T00:00:00+08:00">2023-12-10 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#solidfire-backup-to-s3">SolidFire backup to S3</a></li>
  <li><a href="#minio-compression">MinIO compression</a></li>
  <li><a href="#results">Results</a></li>
  <li><a href="#conclusions">Conclusions</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>I'm not sure if I used these volumes in <a href="/2023/09/02/solidfire-test-volumes.html">this post</a> (also related to SolidFire backup/restore to/from S3) or in the <a href="/2023/09/03/solidbackup-with-kopia.html">Kopia post</a>. Probably the latter, as the sizes match.</p>

<p>Anyway, I got 'em, there's 10 of 'em, each 66.67% full and 1GiB in size. So I just used these.</p>

<p><img src="/assets/images/solidfire-backup-to-minio-compression-00-volumes.png" alt="" /></p>

<p>This storage account has no other volumes, and its efficiency can be seen here. We're going to benefit from compression at the source <em>or</em> destination, but S3 bucket will not benefit from deduplication at destination.</p>

<p><img src="/assets/images/solidfire-backup-to-minio-compression-01-data-efficiency.png" alt="" /></p>

<p>We don't know how much of this deduplication reported by SolidFire is "within" each volume, and how much among them, but savings "within" a volume may result in a smaller size after compression vs. just compression. Theoretically, there could be 100 MiB of duplicate data within 667 MiB of data in the volume for an example. But we don't know and can't tell.</p>

<p>In any case, 1.38x on 667 MiB means 483.33 MiB per volume (on average) and minus possibly another 40 MiB or so (1.11x) from deduplication ("on average").</p>

<h2 id="solidfire-backup-to-s3">SolidFire backup to S3</h2>

<p>As explained in the many posts related to SolidFire's "backup to S3" feature, SolidFire can use the native and uncompressed format.</p>

<ul>
  <li>Uncompressed - as-is, basically this just pipes 4MiB chunks in ~2MiB requests (dd if=/dev/disk of=/bucket/segment bs=2m count2) of the volume to S3.</li>
  <li>Native - this includes SolidFire efficiency. I'm not sure if it includes both compression and dedupe <em>within</em> the volume, or just compression</li>
</ul>

<p>This is how these backups look like ("uncompressed" example).</p>

<p><img src="/assets/images/solidfire-backup-to-minio-compression-03-uncompressed-backup.png" alt="" /></p>

<h2 id="minio-compression">MinIO compression</h2>

<p>MinIO's compression is Snappy aka S2. By default it's off. If enabled, it compresses known non-compressed formats like text or JSON.</p>

<p>The problems (for SolidFire backup to S3) with this are:</p>

<ul>
  <li>SolidFire uncompressed backup format use a weird numeric extension, and</li>
  <li>Both compressed and native use the same numeric extension</li>
</ul>

<p><img src="/assets/images/solidfire-backup-to-minio-compression-02-document-extension.png" alt="" /></p>

<p>So you can't even whitelist uncompressed chunks - you have to whitelist all such extensions, and then MinIO compresses all matching objects (including both native-compressed and uncompressed chunks). That's bad because you have to either pick one of these (native or uncompressed) for all backups, or waste CPU compressing some native backups (which were already compressed at source) as well as uncompressed.</p>

<p>But if you add extensions such as ".1024" to the whitelist of what to compress and use "uncompressed" in SolidFire, maybe that's all you need.</p>

<p>The other bad thing is I had issues with SolidFire backup to MinIO not working properly even with SolidFire 12.5 and latest MinIO. I had thought SolidFire 12.5 had a patch that works around non-S3 standard MinIO behavior included, but maybe I misremember. In any case, this ought to work with SolidFire 12.7, so let's assume there's no problem.</p>

<p>As I still wanted to compare MinIO's compression with SolidFire's "native" but couldn't backup to MinIO, I instead backed up SolidFire (uncompressed) to another S3 destination, and from there I copied backup data to a MinIO bucket with compression enabled.</p>

<h2 id="results">Results</h2>

<ul>
  <li>Source: Ten 66.67%-full 1GiB volumes (6.67 GiB)</li>
  <li>Uncompressed SolidFire backup to generic S3 (no compression on target) - 10 GiB (even 3.33 GiB of Thin Provisioned 0's were backed up!!!)</li>
  <li>Uncompressed SolidFire backup to MinIO with compression - 5.1 GB (<code class="language-plaintext highlighter-rouge">df /mnt/data</code> of MinIO disk)</li>
  <li>Native SolidFire backup to MinIO without compression - 4.9 GiB (<code class="language-plaintext highlighter-rouge">df /mnt/data</code> of MinIO disk)</li>
</ul>

<h2 id="conclusions">Conclusions</h2>

<p>Uncompressed SolidFire backups waste even its Thin Provisioning savings as gigabytes of 0s from SolidFire volumes are dumped to S3. It is very important to use discard or fstrim the SolidFire volumes (on the iSCSI clients) before backup to S3 - <em>especially</em> so if you use uncompressed backup (when we want MinIO to compress this unallocated capacity to 0).</p>

<p>Uncompressed SolidFire backups to MinIO with compression enabled save 49% of S3 capacity (vs. 33% on of "live" SolidFire volumes, which presumably use light compression to provide low I/O latency).</p>

<p>Native SolidFire backups to MinIO without compression enabled saved 51% (for this particular data type).</p>

<p>I didn't expect that a native SolidFire backup can save that much. I did this on Demo VM and I hope there's no difference vs. appliances or SolidFire SDS.</p>

<p>Using uncompressed SolidFire backups with MinIO compression is a good idea when:</p>

<ul>
  <li>You want backups that can be restored to any volumes disks. You could read all the 4MiB chunks and use <code class="language-plaintext highlighter-rouge">dd</code> to restore them to a generic disk device</li>
  <li>You backup often and want to save SolidFire CPU. MinIO's S2 can compress at 1 GB/s, so MinIO compression is very inexpensive to enable for SolidFire backups</li>
</ul>

<p>You have to be careful with those object extensions, because enabling MinIO compression for virtually all objects would increase CPU consumption on MinIO cluster. Perhaps it's a good approach to backup several volumes and see if extensions are always the same, and if so whitelist only those for MinIO compression.</p>

<p>As that file extension may very well be the same for native and uncompressed SolidFire objects, I'd stick with one approach for all volumes backed up to MinIO.</p>

<p>If you use a "wildcard approach" (add a bunch of extensions to MinIO's "compress these" list), then MinIO will compress everything whch may or may not be what you want.</p>

<ul>
  <li>If the MinIO cluster is used for slow workloads, it would waste CPU on compressing compressed data, but this may not matter to you</li>
  <li>You could set up a dedicated MinIO cluster just for SolidFire backup (e.g. a MinIO VM attached to E-Series), which would eliminate those concerns. One such MinIO VM can deliver 1GB/s (<a href="/2023/09/03/minio-erasure-coding-and-netapp-e-series.html#minio-without-ec">and 4 can deliver 5 GB/s</a>) which is enough even for large SolidFire clusters</li>
</ul>

<p>I have not measured "ingress" bandwidth taken by uncompressed SolidFire backups on MinIO system but I assume wire traffic is the same as "native" backup and MinIO's disk IO (with compression enabled) is the same as well, because empty blocks sent by SolidFire get compressed to almost nothing. So, the cost of not compressing backups on SolidFire and compressing them on MinIO should be very low and affordable.</p>

<p>Said differently, I would assume that in most cases a 1TB volume that's 60% full and can be compressed down to 500 GB before being shipped to S3 would take around 550 GB to transfer uncompressed. You could test this in your environment, but to me spending an extra 10% in in backup bandwidth on LAN is a good tradeoff for offloading all that CPU utilization from SolidFire.</p>

<p>Native SolidFire compression saves more than MinIO compression, presumably because SolidFire saves something on deduplication within volumes, but MinIO compresses and has no deduplication so anything outside the compression "window" used by S3 does not result in savings.</p>

<p>Another idea that could be considered is MinIO on a filesystem with deduplication enabled, but for that we usually need all flash storage. It's still cheaper and good enough to use NL-SAS on something like E-Series with NL-SAS and DDP for that. I've written several posts on MinIO on E-Series, but <a href="/2022/04/03/restic-server-netapp-eseries.html">this one</a> talks a bit about dealing with ransomware risks on E-Series as backup storage.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/backup" class="page__taxonomy-item p-category" rel="tag">backup</a><span class="sep">, </span>
    
      <a href="/tags/compression" class="page__taxonomy-item p-category" rel="tag">compression</a><span class="sep">, </span>
    
      <a href="/tags/data-protection" class="page__taxonomy-item p-category" rel="tag">data protection</a><span class="sep">, </span>
    
      <a href="/tags/minio" class="page__taxonomy-item p-category" rel="tag">minio</a><span class="sep">, </span>
    
      <a href="/tags/netapp" class="page__taxonomy-item p-category" rel="tag">netapp</a><span class="sep">, </span>
    
      <a href="/tags/restore" class="page__taxonomy-item p-category" rel="tag">restore</a><span class="sep">, </span>
    
      <a href="/tags/solidfire" class="page__taxonomy-item p-category" rel="tag">solidfire</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/solidfire" class="page__taxonomy-item p-category" rel="tag">solidfire</a><span class="sep">, </span>
    
      <a href="/categories/storage" class="page__taxonomy-item p-category" rel="tag">storage</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2023-12-10T00:00:00+08:00">2023-12-10 00:00</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?via=scaleoutSean&text=NetApp+SolidFire+backup+to+S3+and+MinIO+compression+savings%20https%3A%2F%2Fscaleoutsean.github.io%2F2023%2F12%2F10%2Fsolidfire-backup-to-minio-compression.html" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://scaleoutsean.github.io/2023/12/10/solidfire-backup-to-minio-compression.html" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

</section>


      
  <nav class="pagination">
    
      <a href="/2023/12/07/solidfire-rbac-for-json-rpc-api.html" class="pagination--pager" title="RBAC and delegation for SolidFire JSON-RPC API with Lua">Previous</a>
    
    
      <a href="/2023/12/12/solidfire-unmap-hyper-v.html" class="pagination--pager" title="UNMAP/TRIM Hyper-V volumes backed by NetApp SolidFire">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/12/17/eseries-santricity-resource-provisioned-vols-groups-pools.html" rel="permalink">Resource Provisioning on E-Series SANtricity
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-12-17T00:00:00+08:00">2025-12-17 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">About resource provsioned volumes and groups/pools
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/12/05/eseries-santricity-lockout.html" rel="permalink">E-Series SANtricity Web UI lockout
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-12-05T00:00:00+08:00">2025-12-05 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">How to use (or not) lockout feature in E-Series SANtricity
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/10/15/mcp-tapout.html" rel="permalink">TAPOUT - MCP server for ONTAP to E-Series migration
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-10-15T00:00:00+08:00">2025-10-15 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Migrate to NetApp E-Series arrays with MCP
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/10/10/post-quantum-crypto-proxy-for-solidfire-eseries-api.html" rel="permalink">Post-Quantum API proxy for E-Series and SolidFire
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-10-10T00:00:00+08:00">2025-10-10 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Enterprise-grade PQC TLS encryption for E-Series and SolidFire API endpoints
</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2020-2025 scaleoutSean.github.io | <a href="https://scaleoutsean.github.io">Acting Technologist</a> | Terms: <a href="https://creativecommons.org/licenses/by/4.0/deed.en" target="_blank">CC BY 4.0</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
