<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.3 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>StorageGRID and Elasticsearches | Acting Technologist</title>
<meta name="description" content="Various searches for StorageGRID data available in Elasticsearch">


  <meta name="author" content="scaleoutSean">
  
  <meta property="article:author" content="scaleoutSean">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Acting Technologist">
<meta property="og:title" content="StorageGRID and Elasticsearches">
<meta property="og:url" content="https://scaleoutsean.github.io/2023/07/20/storagegrid-and-elaticsearches.html">


  <meta property="og:description" content="Various searches for StorageGRID data available in Elasticsearch">





  <meta name="twitter:site" content="@scaleoutSean">
  <meta name="twitter:title" content="StorageGRID and Elasticsearches">
  <meta name="twitter:description" content="Various searches for StorageGRID data available in Elasticsearch">
  <meta name="twitter:url" content="https://scaleoutsean.github.io/2023/07/20/storagegrid-and-elaticsearches.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2023-07-20T00:00:00+08:00">






<link rel="canonical" href="https://scaleoutsean.github.io/2023/07/20/storagegrid-and-elaticsearches.html">







  <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />


  <meta name="msvalidate.01" content="7cf5b7d96a77410a8ad035f764dc81b3">





<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Acting Technologist Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic" rel="stylesheet" type="text/css">


  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/scaleoutsean-acting-technologist.png" alt="Acting Technologist"></a>
        
        <a class="site-title" href="/">
          Acting Technologist
          <span class="site-subtitle">human action through technology</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/archive/"
                
                
              >Archive</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/projects/"
                
                
              >Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="StorageGRID and Elasticsearches">
    <meta itemprop="description" content="Why "Elasticsearches"?">
    <meta itemprop="datePublished" content="2023-07-20T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://scaleoutsean.github.io/2023/07/20/storagegrid-and-elaticsearches.html" itemprop="url">StorageGRID and Elasticsearches
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-07-20T00:00:00+08:00">2023-07-20 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h2 id="why-elasticsearches">Why "Elasticsearches"?</h2>

<p>Because there's more than one. And people often don't even know enough to be confused.</p>

<h2 id="wait-what">Wait, what?</h2>

<p>There are two things you can currently (NetApp StorageGRID 11.7) do with Elasticsearch more or less "out of the box":</p>

<ul>
  <li>Log forwarding</li>
  <li>Search</li>
</ul>

<p>There's are also things Elasticsearch can do with StorageGRID out of the box, but this post is not about <a href="/2023/11/30/elasticsearch-ilm-netapp-eseries.html">that</a>:</p>

<ul>
  <li>Snapshots</li>
  <li>ILM</li>
</ul>

<h2 id="log-forwarding">Log forwarding</h2>

<p>This is often referred to as "audit log forwarding" (which is wrong), even by people who should know better.</p>

<p>First, there are three log types that can be changed to a non-default setting.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-syslog-01.png" alt="Log types that can be forwarded" /></p>

<p>One could, for example, send only Security events to an external syslog server. Most people don't do that. As shown in the screenshot, most people need to archive and search their audit log. So the other types can be left as-is (Admin &amp; Local nodes), which is what you see in the screenshot.</p>

<p>Those who forward more than one need to figure out which lines come from which log type, and process them accordingly. So it's also a bit more difficult to forward more than just archive log.</p>

<p>Second, how does that work with Elasticsearch? It doesn't.</p>

<p>As the name says, we need just a standards-compliant syslog-compatible destination. What standards?</p>

<p>Well, some of them syslog RFCs. The docs should say which one(s), but <a href="https://docs.netapp.com/us-en/storagegrid-117/monitor/considerations-for-external-syslog-server.html">they don't</a>.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-syslog-02.png" alt="External syslog destination" /></p>

<p>In any case, there's no Elasticsearch involved here. Logs could be forwarded to rsyslog or syslog-ng or Logstash or some other program.</p>

<p>As we change the defaults, we do it for audit logs only, and leave the rest unchanged.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-syslog-03.png" alt="Change defaults only for Audit log" /></p>

<p>From there (syslog forwarder) we can send data to Elasticsearch, or process it first, and then send to Elasticsearch.</p>

<p>In versions prior to 11.5 I used a Python script (<a href="/2021/10/20/sgac-storagegrid-audit-log-converter-v0.2.1.html">SGAC</a>) to convert audit.log to JSON-LD and ingress it to Elasticsearch with Logstash, but now - since logs can be forwarded to a syslog-compatible destination - one can do such things on the fly.</p>

<p>The NetApp Web site has a service configuration script that can be used for that with Logstash 7 and 8.</p>

<p>Finally, once audit log data is ingested and indexed in Elasticsearch, you can easily search all audit log events, create reports, and more.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-syslog-04.png" alt="Indexed audit log" /></p>

<p>One example of "and more" would be to trigger alerts when the number of DEL or GET events becomes unusual as that may be a sign of an attack.</p>

<h2 id="search">Search</h2>

<p>StorageGRID search is a platform service. The grid (cluster) admin optionally enables it for each tenants. Tenant admins with Platform Services enabled can create a platform service endpoint (one or more) and then - for the search type of service - may configure selected buckets to work with those endpoints.</p>

<p>Here we see an API endpoint for Search.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-search-01.png" alt="Endpoint uses Elasticsearch API" /></p>

<p>This obviously uses the Elasticsearch (or Opensearch versions compatible with Elasticsearch) API and isn't related to syslog.</p>

<p>In fact, in API endpoint settings we can see that StorageGRID authenticates against Elasticsearch API (normally on port 9200).</p>

<p><img src="/assets/images/storagegrid-elasticsearch-search-02.png" alt="API authentication" /></p>

<p>Once this API connection is in place, search is enabled by tenant admin on the bucket level, by defining rules and endpoints that rules should use.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-search-021.png" alt="Bucket configuration" /></p>

<p>XML configuration file is cut off in the screenshot, but the StorageGRID documentation has a complete example.</p>

<p>Main takeaways:</p>

<ul>
  <li>One can have multiple rules of what to make searchable per each bucket</li>
  <li>Each rule may use a different search endpoint defined for the tenant</li>
  <li>The easiest way is to have one rule that sends all bucket changes to the same Search endpoint (one bucket, one search index)</li>
</ul>

<p>This makes it possible to set one rule for s3://teambucket/groupa/*.json and send object changes to one instance of Elasticsearch, and have a different rule for s3://teambucket/groupb and use another Elasticsearch instance or index for it.</p>

<p>The number of documents in Elasticsearch index corresponds to the number of current objects in the bucket. A deleted object results in one less item in Elasticsearch bucket index. Five documents in the index mean there's five documents in the bucket.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-search-03.png" alt="Search in Kibana" /></p>

<p>Notice that there's no "last modified" in system metadata. As of StorageGRID 11.7, if you need to search based on last modified dates, make sure you append that date to object metadata client-side when you PUT it to StorageGRID.</p>

<p>In general, system metadata are fixed and set by StorageGRID while tags can be set by the user, which is why this "workaround" is possible.</p>

<h2 id="search-vs-audit-log-index">Search vs. audit log index</h2>

<p>Audit log indexes are additive - they grow all the time. We also want to delete audit log indexes (as they age beyond our required retention limit, for example).</p>

<p>Search index can also shrink, as explained above, and we normally want to have just one per bucket.</p>

<p>Therefore an audit log may look similar to what we have in this screenshot - one index per day, with thousands or maybe even millions of documents (records) in each - while a search log may be just one per bucket, and smaller (thousands or tens of thousands of documents).</p>

<p><img src="/assets/images/storagegrid-elasticsearch-01.png" alt="Search and audit log index" /></p>

<p>But different setups are definitively possible and even realistic.</p>

<p>For example, as explained in Search section, you may want to have multiple search indexes for a single bucket, either in one Elasticsearch cluster, or even in different Elasticsearch clusters.</p>

<p>Likewise, if you work on short-term projects, audit log index could be just one, and backed up once the project is completed.</p>

<h2 id="demo">Demo</h2>

<p>Just to give you an idea of where's what in the UI and how it "feels" like, here's a short demo video.</p>

<ul>
  <li><a href="https://rumble.com/v30x1ak-use-elasticsearch-to-store-netapp-storagegrid-audit-log-and-build-search-in.html">StorageGRID 11.7 with Elasticsearch 8.7: audit logs and object search</a> - 6m19s</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>StorageGRID logs can be forwarded and indexed anywhere. The main requirement is that the first recipient is a syslog-compatible server. Logs are normally kept on StorageGRID cluster, but all can be forwarded externally. Normally just one (audit log) is.</p>

<p>Search platform service uses the Elasticsearch API.</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/elasticsearch" class="page__taxonomy-item p-category" rel="tag">elasticsearch</a><span class="sep">, </span>
    
      <a href="/tags/elk" class="page__taxonomy-item p-category" rel="tag">elk</a><span class="sep">, </span>
    
      <a href="/tags/logstash" class="page__taxonomy-item p-category" rel="tag">logstash</a><span class="sep">, </span>
    
      <a href="/tags/netapp" class="page__taxonomy-item p-category" rel="tag">netapp</a><span class="sep">, </span>
    
      <a href="/tags/s3" class="page__taxonomy-item p-category" rel="tag">s3</a><span class="sep">, </span>
    
      <a href="/tags/search" class="page__taxonomy-item p-category" rel="tag">search</a><span class="sep">, </span>
    
      <a href="/tags/storagegrid" class="page__taxonomy-item p-category" rel="tag">storagegrid</a><span class="sep">, </span>
    
      <a href="/tags/syslog" class="page__taxonomy-item p-category" rel="tag">syslog</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/analytics" class="page__taxonomy-item p-category" rel="tag">analytics</a><span class="sep">, </span>
    
      <a href="/categories/storage" class="page__taxonomy-item p-category" rel="tag">storage</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2023-07-20T00:00:00+08:00">2023-07-20 00:00</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?via=scaleoutSean&text=StorageGRID+and+Elasticsearches%20https%3A%2F%2Fscaleoutsean.github.io%2F2023%2F07%2F20%2Fstoragegrid-and-elaticsearches.html" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://scaleoutsean.github.io/2023/07/20/storagegrid-and-elaticsearches.html" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

</section>


      
  <nav class="pagination">
    
      <a href="/2023/06/14/versity-s3-posix-gateway.html" class="pagination--pager" title="Versity S3 Gateway">Previous</a>
    
    
      <a href="/2023/07/21/storagegrid-comparison-between-versioning-and-worm.html" class="pagination--pager" title="Comparison between S3 object versioning and WORM with NetApp StorageGRID">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/11/epa-4-beta.html" rel="permalink">E-Series Performance Analyzer (EPA) v4 beta
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-11T00:00:00+08:00">2025-08-11 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Introduction
  EPA 4
  EPA Collector-specific
  Details related to storage requirements
  What's next

</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/11/bing-index-issue.html" rel="permalink">Got binged in July 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-11T00:00:00+08:00">2025-08-11 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I don't track users (see Privacy page), don't have ads and don't care about "likes" or "followers", but generally I want my content to be in search engine in...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/07/30/solidfire-windows-admin-center-extension.html" rel="permalink">SolidFire Extension for Windows Admin Center 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-07-30T00:00:00+08:00">2025-07-30 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          19 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Introduction
  Walk-through
  And now…
  Conclusion
  Appendix A: demo
    
      Animated GIF (no playback control)
      Video demo with voice-over
    ...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/07/26/solidfire-windows-admin-center-gateway.html" rel="permalink">SolidFire Gateway for Windows Admin Center 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-07-26T00:00:00+08:00">2025-07-26 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Introduction
  What it is
  What it does
  IIS Setup
  Why this matters
  What about it?
  Conclusion

</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2020-2025 scaleoutSean.github.io | <a href="https://scaleoutsean.github.io">Acting Technologist</a> | Terms: <a href="https://creativecommons.org/licenses/by/4.0/deed.en" target="_blank">CC BY 4.0</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
