<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            StorageGRID and Elasticsearches | Acting Technologist
      
    </title>
    <meta name="description" content="
     Various searches for StorageGRID data available in Elasticsearch
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>StorageGRID and Elasticsearches | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="StorageGRID and Elasticsearches" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en" />
<meta name="description" content="Various searches for StorageGRID data available in Elasticsearch" />
<meta property="og:description" content="Various searches for StorageGRID data available in Elasticsearch" />
<link rel="canonical" href="https://scaleoutsean.github.io/2023/07/20/storagegrid-and-elaticsearches.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2023/07/20/storagegrid-and-elaticsearches.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-07-20T00:00:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2023/07/20/storagegrid-and-elaticsearches.html"},"author":{"@type":"Person","name":"scaleoutSean"},"description":"Various searches for StorageGRID data available in Elasticsearch","@type":"BlogPosting","url":"https://scaleoutsean.github.io/2023/07/20/storagegrid-and-elaticsearches.html","headline":"StorageGRID and Elasticsearches","dateModified":"2023-07-20T00:00:00+08:00","datePublished":"2023-07-20T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">StorageGRID and Elasticsearches</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>20 Jul 2023</span> - <i class="far fa-clock"></i> 


  
  
    5 minute read
  

    </span>
  </div>
  
        <h2 id="why-elasticsearches">Why “Elasticsearches”?</h2>

<p>Because there’s more than one. And people often don’t even know enough to be confused.</p>

<h2 id="wait-what">Wait, what?</h2>

<p>There are two things you can currently (NetApp StorageGRID 11.7) do with Elasticsearch more or less “out of the box”:</p>

<ul>
  <li>Log forwarding</li>
  <li>Search</li>
</ul>

<p>There’s are also things Elasticsearch can do with StorageGRID out of the box, but this post is not about <a href="/2023/11/30/elasticsearch-ilm-netapp-eseries.html">that</a>:</p>

<ul>
  <li>Snapshots</li>
  <li>ILM</li>
</ul>

<h2 id="log-forwarding">Log forwarding</h2>

<p>This is often referred to as “audit log forwarding” (which is wrong), even by people who should know better.</p>

<p>First, there are three log types that can be changed to a non-default setting.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-syslog-01.png" alt="Log types that can be forwarded" /></p>

<p>One could, for example, send only Security events to an external syslog server. Most people don’t do that. As shown in the screenshot, most people need to archive and search their audit log. So the other types can be left as-is (Admin &amp; Local nodes), which is what you see in the screenshot.</p>

<p>Those who forward more than one need to figure out which lines come from which log type, and process them accordingly. So it’s also a bit more difficult to forward more than just archive log.</p>

<p>Second, how does that work with Elasticsearch? It doesn’t.</p>

<p>As the name says, we need just a standards-compliant syslog-compatible destination. What standards?</p>

<p>Well, some of them syslog RFCs. The docs should say which one(s), but <a href="https://docs.netapp.com/us-en/storagegrid-117/monitor/considerations-for-external-syslog-server.html">they don’t</a>.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-syslog-02.png" alt="External syslog destination" /></p>

<p>In any case, there’s no Elasticsearch involved here. Logs could be forwarded to rsyslog or syslog-ng or Logstash or some other program.</p>

<p>As we change the defaults, we do it for audit logs only, and leave the rest unchanged.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-syslog-03.png" alt="Change defaults only for Audit log" /></p>

<p>From there (syslog forwarder) we can send data to Elasticsearch, or process it first, and then send to Elasticsearch.</p>

<p>In versions prior to 11.5 I used a Python script (<a href="/2021/10/20/sgac-storagegrid-audit-log-converter-v0.2.1.html">SGAC</a>) to convert audit.log to JSON-LD and ingress it to Elasticsearch with Logstash, but now - since logs can be forwarded to a syslog-compatible destination - one can do such things on the fly.</p>

<p>The NetApp Web site has a service configuration script that can be used for that with Logstash 7 and 8.</p>

<p>Finally, once audit log data is ingested and indexed in Elasticsearch, you can easily search all audit log events, create reports, and more.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-syslog-04.png" alt="Indexed audit log" /></p>

<p>One example of “and more” would be to trigger alerts when the number of DEL or GET events becomes unusual as that may be a sign of an attack.</p>

<h2 id="search">Search</h2>

<p>StorageGRID search is a platform service. The grid (cluster) admin optionally enables it for each tenants. Tenant admins with Platform Services enabled can create a platform service endpoint (one or more) and then - for the search type of service - may configure selected buckets to work with those endpoints.</p>

<p>Here we see an API endpoint for Search.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-search-01.png" alt="Endpoint uses Elasticsearch API" /></p>

<p>This obviously uses the Elasticsearch (or Opensearch versions compatible with Elasticsearch) API and isn’t related to syslog.</p>

<p>In fact, in API endpoint settings we can see that StorageGRID authenticates against Elasticsearch API (normally on port 9200).</p>

<p><img src="/assets/images/storagegrid-elasticsearch-search-02.png" alt="API authentication" /></p>

<p>Once this API connection is in place, search is enabled by tenant admin on the bucket level, by defining rules and endpoints that rules should use.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-search-021.png" alt="Bucket configuration" /></p>

<p>XML configuration file is cut off in the screenshot, but the StorageGRID documentation has a complete example.</p>

<p>Main takeaways:</p>

<ul>
  <li>One can have multiple rules of what to make searchable per each bucket</li>
  <li>Each rule may use a different search endpoint defined for the tenant</li>
  <li>The easiest way is to have one rule that sends all bucket changes to the same Search endpoint (one bucket, one search index)</li>
</ul>

<p>This makes it possible to set one rule for s3://teambucket/groupa/*.json and send object changes to one instance of Elasticsearch, and have a different rule for s3://teambucket/groupb and use another Elasticsearch instance or index for it.</p>

<p>The number of documents in Elasticsearch index corresponds to the number of current objects in the bucket. A deleted object results in one less item in Elasticsearch bucket index. Five documents in the index mean there’s five documents in the bucket.</p>

<p><img src="/assets/images/storagegrid-elasticsearch-search-03.png" alt="Search in Kibana" /></p>

<p>Notice that there’s no “last modified” in system metadata. As of StorageGRID 11.7, if you need to search based on last modified dates, make sure you append that date to object metadata client-side when you PUT it to StorageGRID.</p>

<p>In general, system metadata are fixed and set by StorageGRID while tags can be set by the user, which is why this “workaround” is possible.</p>

<h2 id="search-vs-audit-log-index">Search vs. audit log index</h2>

<p>Audit log indexes are additive - they grow all the time. We also want to delete audit log indexes (as they age beyond our required retention limit, for example).</p>

<p>Search index can also shrink, as explained above, and we normally want to have just one per bucket.</p>

<p>Therefore an audit log may look similar to what we have in this screenshot - one index per day, with thousands or maybe even millions of documents (records) in each - while a search log may be just one per bucket, and smaller (thousands or tens of thousands of documents).</p>

<p><img src="/assets/images/storagegrid-elasticsearch-01.png" alt="Search and audit log index" /></p>

<p>But different setups are definitively possible and even realistic.</p>

<p>For example, as explained in Search section, you may want to have multiple search indexes for a single bucket, either in one Elasticsearch cluster, or even in different Elasticsearch clusters.</p>

<p>Likewise, if you work on short-term projects, audit log index could be just one, and backed up once the project is completed.</p>

<h2 id="demo">Demo</h2>

<p>Just to give you an idea of where’s what in the UI and how it “feels” like, here’s a short demo video.</p>

<ul>
  <li><a href="https://rumble.com/v30x1ak-use-elasticsearch-to-store-netapp-storagegrid-audit-log-and-build-search-in.html">StorageGRID 11.7 with Elasticsearch 8.7: audit logs and object search</a> - 6m19s</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>StorageGRID logs can be forwarded and indexed anywhere. The main requirement is that the first recipient is a syslog-compatible server. Logs are normally kept on StorageGRID cluster, but all can be forwarded externally. Normally just one (audit log) is.</p>

<p>Search platform service uses the Elasticsearch API.</p>


      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
      &nbsp; 
    
      <a href="
      /categories/#analytics">analytics</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2025/07/23/s3-vector-search-02-diy.html">S3 GO NATS!</a></li>
      
        <li><a href="/2023/11/30/elasticsearch-ilm-netapp-eseries.html">Snapshots and ILM with Elasticsearch 8</a></li>
      
        <li><a href="/2021/10/20/sgac-storagegrid-audit-log-converter-v0.2.1.html">SGAC v0.2.1</a></li>
      
        <li><a href="/2023/08/01/fscrawler-filesystem-analytics-elasticsearch.html">FSCrawler for basic filesystem analytics in Elasticsearch</a></li>
      
        <li><a href="/2025/07/18/s3-vector-search-01-analysis.html">S3 vector search - DIY vs AWS S3 Vectors</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2025-07-24 10:27 </p>
    <p>Copyright © 2025 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
