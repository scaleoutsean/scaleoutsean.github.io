<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.3 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Microsoft SQL Server data virtualization PolyBase with S3 Object Stores | Acting Technologist</title>
<meta name="description" content="Use SQL Server to access structured data on a nearby or remote S3-compatible Object Store">


  <meta name="author" content="scaleoutSean">
  
  <meta property="article:author" content="scaleoutSean">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Acting Technologist">
<meta property="og:title" content="Microsoft SQL Server data virtualization PolyBase with S3 Object Stores">
<meta property="og:url" content="https://scaleoutsean.github.io/2023/08/28/sql-server-polybase-s3.html">


  <meta property="og:description" content="Use SQL Server to access structured data on a nearby or remote S3-compatible Object Store">





  <meta name="twitter:site" content="@scaleoutSean">
  <meta name="twitter:title" content="Microsoft SQL Server data virtualization PolyBase with S3 Object Stores">
  <meta name="twitter:description" content="Use SQL Server to access structured data on a nearby or remote S3-compatible Object Store">
  <meta name="twitter:url" content="https://scaleoutsean.github.io/2023/08/28/sql-server-polybase-s3.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2023-08-28T00:00:00+08:00">






<link rel="canonical" href="https://scaleoutsean.github.io/2023/08/28/sql-server-polybase-s3.html">







  <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />


  <meta name="msvalidate.01" content="7cf5b7d96a77410a8ad035f764dc81b3">





<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Acting Technologist Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic" rel="stylesheet" type="text/css">


  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/scaleoutsean-acting-technologist.png" alt="Acting Technologist"></a>
        
        <a class="site-title" href="/">
          Acting Technologist
          <span class="site-subtitle">human action through technology</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/archive/"
                
                
              >Archive</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/projects/"
                
                
              >Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Microsoft SQL Server data virtualization PolyBase with S3 Object Stores">
    <meta itemprop="description" content="  What, why and how          HTTP      Access from SQL Server      Where does Docker come in      Other S3 clients      Backup use case        Compatibility  Conclusion">
    <meta itemprop="datePublished" content="2023-08-28T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://scaleoutsean.github.io/2023/08/28/sql-server-polybase-s3.html" itemprop="url">Microsoft SQL Server data virtualization PolyBase with S3 Object Stores
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-08-28T00:00:00+08:00">2023-08-28 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <ul>
  <li><a href="#what-why-and-how">What, why and how</a>
    <ul>
      <li><a href="#http">HTTP</a></li>
      <li><a href="#access-from-sql-server">Access from SQL Server</a></li>
      <li><a href="#where-does-docker-come-in">Where does Docker come in</a></li>
      <li><a href="#other-s3-clients">Other S3 clients</a></li>
      <li><a href="#backup-use-case">Backup use case</a></li>
    </ul>
  </li>
  <li><a href="#compatibility">Compatibility</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<h2 id="what-why-and-how">What, why and how</h2>

<p>PolyBase is a data virtualization feature in Microsoft SQL Server and Azure Synapse Analytics. What does it do?</p>

<blockquote>
  <p>PolyBase enables your SQL Server instance to query data with T-SQL directly from SQL Server, Oracle, Teradata, MongoDB, Hadoop clusters, Cosmos DB, and S3-compatible object storage without separately installing client connection software.</p>
</blockquote>

<p>As you can see S3 isn't the only protocol, but it's a popular and growing one.</p>

<p><a href="https://learn.microsoft.com/en-us/sql/relational-databases/polybase/polybase-versioned-feature-summary?view=sql-server-ver16">This page</a> contains the details of which SQL Server features work with which version, but S3 OPENROWSET and EXTERNAL TABLES can be used to query data files in S3-compatible object storage.</p>

<p>If this sounds like <a href="/2022/03/04/storagegrid-s3-select.html">S3 Select</a>, that's about right. Instead of using an S3 client, we use SQL (which in turn uses its built-in S3 client).</p>

<p>Why would we use that rather than copy data to a network share and used external tables on NAS? Because that doesn't help us more - we need to have a network share, copy the (file), and ultimately get the same outcome. Not to mention that sometimes we need only a subset of original data, so why not access it remotely, avoid copying, use superior (HTTPS) security, and fetch only what we need?</p>

<p>How to use it with cloud-based S3 storage is already well documented. What about on-premises S3 object stores and hybrid cloud deployments?</p>

<p>It's very similar:</p>

<ul>
  <li>to access your on-premises S3 bucket, you need FQDN for your API endpoint, TLS to protect data, and inbound firewall access</li>
  <li>internal (LAN, VPN) access is similar, except that connections can be based on internal DNS</li>
</ul>

<p><img src="/assets/images/sql-server-polybase-s3-hybrid-cloud.png" alt="SQL Server with PolyBase on S3 Compatible Storage" /></p>

<p>MS SQL Server uses <code class="language-plaintext highlighter-rouge">WinHttp</code> (Microsoft Windows HTTP Services) to communicate with HTTP(S) (including S3 endpoints), so the base on which it's built is rock solid.</p>

<h3 id="http">HTTP</h3>

<p>Why does the LAN example have http? Because SQL Server isn't the only client that needs to access S3 data:</p>

<ul>
  <li>there may be other S3 clients, some of which have no ability to use HTTPS</li>
  <li>there may be other S3 clients which cannot use custom TLS certificates so HTTPS isn't an option</li>
  <li>there may be environments which don't have ADS or other CA on all locations (even if the HQs have it, some remote site may not)</li>
  <li>maybe MS SQL Server will allow HTTP (maybe it allows it now, I haven't tested, but the documentation seems to imply only HTTPS is supported) one day</li>
</ul>

<p>The first three scenarios are often seen in environments with embedded systems, especially manufacturing and IoT.</p>

<p>Since those clients often have the option to use NFS v3 or SMB 2.0, using HTTP to PUT data can actually be comparatively more secure for both the client and the data.</p>

<p>Either way, data flows in from IoT, logging clients or other systems, and lands on S3.</p>

<h3 id="access-from-sql-server">Access from SQL Server</h3>

<p>Then it can be converted, cleansed, and enriched if need be. "Finalized" data can be moved to a different bucket for SQL Server access.</p>

<p>Finally, SQL Server can use <code class="language-plaintext highlighter-rouge">OPENROWSET</code> or name external tables to perform analytics or ingest that data to other tables or databases.</p>

<p>SQL Server currently supports CSV and Parquet files. This is how querying <code class="language-plaintext highlighter-rouge">OPENROWSET</code> looks like:</p>

<p><img src="/assets/images/sql-server-polybase-s3-csv-s3-select.png" alt="SQL Server query of CSV and Parquet files over S3" /></p>

<p>Using <code class="language-plaintext highlighter-rouge">EXTERNAL TABLES</code> is similar. In both cases, we need to first define S3 credentials (this is database-scoped) and data source inside of database. At that point OPENROWSET can work. EXTERNAL TABLES require or or two additional steps clearly explained in the MS SQL documentation. Read about configuring SQL Server for PolyBase on S3 <a href="https://learn.microsoft.com/en-us/sql/relational-databases/polybase/polybase-configure-s3-compatible?view=sql-server-ver16">here</a>.</p>

<h3 id="where-does-docker-come-in">Where does Docker come in</h3>

<p>It doesn't. I did these demos using SQL Server for Linux (preview for Ubuntu 22.04), i.e. no Docker.</p>

<p>But the same SQL Server can run on Docker CE or Kubernetes. I tried the Docker version and it works fine.</p>

<p>In my opinion SQL Server is easier to manage on Linux than on Windows, so I recommend containerized SQL Server to folks who don't need features that depend on Windows, and have some basic Linux skills.</p>

<p>Authentication is still a big challenge for Linux - Windows has a big advantage in this area.</p>

<h3 id="other-s3-clients">Other S3 clients</h3>

<p>Do not miss the detail that once data is on S3 accessible to SQL Server, you can <em>still</em> access it with S3 Select, Python or whatever other methods you prefer.</p>

<p>We wouldn't want to edit data that's actively also used by SQL Server, especially not EXTERNAL TABLES, but concurrent read-only access is fine.</p>

<p>Some examples of how that could work may be viewed <a href="https://rumble.com/v32foe0-simple-multi-site-or-hybrid-cloud-workflow-for-s3-analytics-with-ontap-s3.html">here</a>.</p>

<p>Unlike some of the other PolyBase options, S3 is one those that are easy to maintain and (license-wise) free to access which is a big factor in TCO.</p>

<h3 id="backup-use-case">Backup use case</h3>

<p>Unrelated to PolyBase: since S3 client is in SQL Server, there's no reason to not be able to backup to, and restore from, S3.</p>

<p>In this example I backup master database to S3 bucket located on-premises (that is, it backs up to an FQDN S3 location on the Internet).</p>

<p><img src="/assets/images/sql-server-backup-to-s3.png" alt="SQL Server backup to S3" /></p>

<p>Backups can be mirrored to multiple S3 buckets, giving you the ability to make a local and remote backup to S3 at the same time. There are options to enable compression and other features not seen in the screenshot.</p>

<h2 id="compatibility">Compatibility</h2>

<p>Microsoft doesn't seem to have a strict S3 compatibility list for PolyBase, but they list some S3 storage providers <a href="https://learn.microsoft.com/en-us/sql/relational-databases/backup-restore/sql-server-backup-and-restore-with-s3-compatible-object-storage?view=sql-server-ver16#providers-of-s3-compatible-object-storage">here</a>.</p>

<p>I haven't looked at what S3 API methods PolyBase uses, but they seems generic and simple. Both S3 servers from NetApp should work (StorageGRID, ONTAP S3), as should MinIO backed by E-Series.</p>

<p><a href="https://www.netapp.com/blog/microsoft-sql-server-big-data-clusters-with-storagegrid/">This post</a> on PolyBase with <code class="language-plaintext highlighter-rouge">s3a</code> and HDFS does not apply to this use case - it's "HDFS over S3", not PolyBase with native S3.</p>

<p>For large scale and multi-site I'd consider StorageGRID, for small-to-medium scale with easy setup and management I'd consider NetApp.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In its core PolyBase is similar to S3 Select. High-end analytics software such as Snowflake (see <a href="https://docs.snowflake.com/en/user-guide/data-load-s3-config-storage-integration">Configuring a Snowflake Storage Integration to Access Amazon S3</a>) use this for data loading, and SQL Server can do it, too.</p>

<p>To its advantage, SQL Server has:</p>

<ul>
  <li>huge installed base</li>
  <li>customers with existing SQL Server skills</li>
  <li>ability to deploy on-premises or in the cloud</li>
  <li>compared to simpler approaches  such as S3 Select, SQL Server has excellent security-related features and is more appropriate for sensitive data</li>
</ul>

<p>Regarding this last point: access that needs to be audited can benefit from a thicker stack such as SQL Server. While read-only access to S3 prevents tampering, leaks, data theft and access auditing are still something that many users need to do, either at the firewall and S3 object store level, or at the client (SQL Server, for example). SQL Server can do it all: AD integration, RBAC, auditing and more.</p>

<p>The ability to backup to S3 makes it easy to use the same or different S3 storage for on-site or off-site backup.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/backup" class="page__taxonomy-item p-category" rel="tag">backup</a><span class="sep">, </span>
    
      <a href="/tags/ontap-s3" class="page__taxonomy-item p-category" rel="tag">ontap s3</a><span class="sep">, </span>
    
      <a href="/tags/parquet" class="page__taxonomy-item p-category" rel="tag">parquet</a><span class="sep">, </span>
    
      <a href="/tags/polybase" class="page__taxonomy-item p-category" rel="tag">polybase</a><span class="sep">, </span>
    
      <a href="/tags/s3" class="page__taxonomy-item p-category" rel="tag">s3</a><span class="sep">, </span>
    
      <a href="/tags/sql-server" class="page__taxonomy-item p-category" rel="tag">sql server</a><span class="sep">, </span>
    
      <a href="/tags/storagegrid" class="page__taxonomy-item p-category" rel="tag">storagegrid</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/analytics" class="page__taxonomy-item p-category" rel="tag">analytics</a><span class="sep">, </span>
    
      <a href="/categories/storage" class="page__taxonomy-item p-category" rel="tag">storage</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2023-08-28T00:00:00+08:00">2023-08-28 00:00</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?via=scaleoutSean&text=Microsoft+SQL+Server+data+virtualization+PolyBase+with+S3+Object+Stores%20https%3A%2F%2Fscaleoutsean.github.io%2F2023%2F08%2F28%2Fsql-server-polybase-s3.html" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://scaleoutsean.github.io/2023/08/28/sql-server-polybase-s3.html" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

</section>


      
  <nav class="pagination">
    
      <a href="/2023/08/26/solidfire-backup-to-ontap-s3.html" class="pagination--pager" title="SolidFire backup-to-S3 using ONTAP S3 destination">Previous</a>
    
    
      <a href="/2023/08/29/introduction-to-memphis-message-broker.html" class="pagination--pager" title="Storage considerations for Memphis message broker">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/11/epa-4-beta.html" rel="permalink">E-Series Performance Analyzer (EPA) v4 beta
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-11T00:00:00+08:00">2025-08-11 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Introduction
  EPA 4
  EPA Collector-specific
  Details related to storage requirements
  What's next

</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/11/bing-index-issue.html" rel="permalink">Got binged in July 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-11T00:00:00+08:00">2025-08-11 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I don't track users (see Privacy page), don't have ads and don't care about "likes" or "followers", but generally I want my content to be in search engine in...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/07/30/solidfire-windows-admin-center-extension.html" rel="permalink">SolidFire Extension for Windows Admin Center 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-07-30T00:00:00+08:00">2025-07-30 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          19 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Introduction
  Walk-through
  And now…
  Conclusion
  Appendix A: demo
    
      Animated GIF (no playback control)
      Video demo with voice-over
    ...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/07/26/solidfire-windows-admin-center-gateway.html" rel="permalink">SolidFire Gateway for Windows Admin Center 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-07-26T00:00:00+08:00">2025-07-26 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Introduction
  What it is
  What it does
  IIS Setup
  Why this matters
  What about it?
  Conclusion

</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2020-2025 scaleoutSean.github.io | <a href="https://scaleoutsean.github.io">Acting Technologist</a> | Terms: <a href="https://creativecommons.org/licenses/by/4.0/deed.en" target="_blank">CC BY 4.0</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
