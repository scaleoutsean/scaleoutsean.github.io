<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            What's new in NetApp Trident v23.07 | Acting Technologist
      
    </title>
    <meta name="description" content="
     What's new in NetApp Trident v23.07
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>What’s new in NetApp Trident v23.07 | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="What’s new in NetApp Trident v23.07" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en" />
<meta name="description" content="What’s new in NetApp Trident v23.07" />
<meta property="og:description" content="What’s new in NetApp Trident v23.07" />
<link rel="canonical" href="https://scaleoutsean.github.io/2023/08/02/netapp-trident-v2307.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2023/08/02/netapp-trident-v2307.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-02T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"What’s new in NetApp Trident v23.07","dateModified":"2023-08-02T00:00:00+08:00","datePublished":"2023-08-02T00:00:00+08:00","url":"https://scaleoutsean.github.io/2023/08/02/netapp-trident-v2307.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2023/08/02/netapp-trident-v2307.html"},"description":"What’s new in NetApp Trident v23.07","author":{"@type":"Person","name":"scaleoutSean"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">What's new in NetApp Trident v23.07</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>02 Aug 2023</span> - <i class="far fa-clock"></i> 


  
  
    8 minute read
  

    </span>
  </div>
  
        <h2 id="introduction">Introduction</h2>

<p>Trident v23.07 hasn’t been officially released or announced, but the code seems finalized.</p>

<p>Rather than wait for the official announcement and republish some of its highlights, I’ll simply comment on the details I find noteworthy.</p>

<p>Notably, while I use Trident, I don’t deep dive into it with ONTAP backends. It’s mostly just to satisfy my PVC requests.</p>

<p>So, while there are more new fixes and enhancements than my highlights give on, my post is short because many are not noteworthy to me personally.</p>

<p>Let’s see, then!</p>

<h2 id="new">New</h2>

<ul>
  <li>Tech preview support for NVMe over TCP for the ONTAP-SAN driver</li>
</ul>

<p>This is surely going to be welcome by users who want to get that last bit of performance from their TCP/IP SAN. It may help with random IO workloads.</p>

<p>I’d test NVMe/TCP but I doubt my home NICs and networks can support it and in any case, any differences vs. iSCSI would be likely invisible. But if you’re interested in general requirements for networks, see <a href="https://www.cisco.com/c/en/us/products/collateral/switches/nexus-9000-series-switches/white-paper-c11-743772.html">this</a> Cisco white paper.</p>

<h2 id="deprecations">Deprecations</h2>

<ul>
  <li>Removed support for pre-CSI volumes and storage classes</li>
</ul>

<p>“Pre-CSI” Trident was used years ago, and unless you stood up your Kubernetes more than 3-4 years ago, it’s unlikely you have these. If you have a very old cluster and Kubernetes, you may want to check before upgrading.</p>

<ul>
  <li>Updated minimum supported Kubernetes to 1.22</li>
</ul>

<p>This is easy to check. Don’t upgrade Trident if your Kubernetes version is &gt; 1.22.</p>

<ul>
  <li>Removed support for v1beta1 snapshots</li>
</ul>

<p>This may affect much more people than pre-CSI volumes. If you deployed Trident snapshots 2-3 years ago, maybe you’re using v1beta1 snapshots so better check (by using “describe” on snapshot SCs or checking from dashboard). You may have additional dependencies (e.g. old Kasten K10), which would require several updates to get end-to-end snapshots work again.</p>

<h2 id="arm64-is-still-not-easier">ARM64 is still not easier</h2>

<p>This isn’t related to official notes, but I’ll use this opportunity to comment on Trident on ARM64.</p>

<p>I used to maintain an <a href="https://github.com/scaleoutsean/trident/">ARM64-focused fork of Trident</a> with the purpose to eliminate the hassle of building and deploying Trident on ARM64 nodes.</p>

<p>I stopped doing it after NetApp Trident v23.04 came out because ARM64 has become officially supported in that release.</p>

<p>What I didn’t know - because I use Trident mostly with SolidFire, and had no reason to upgrade Trident to v23.04 - that this stuff is still difficult!</p>

<h3 id="build">Build</h3>

<p>Yesterday I spent <em>hours</em> trying to build and deploy Trident v23.07 on ARM64. It was harder than ever!</p>

<p>The experience seems to be the same or worse than before (v23.01 and earlier). There have been improvements in:</p>

<ul>
  <li>the Makefile (supposedly it’s been improved; in my experience it works worse than before)</li>
  <li>the two Dockerfile’s ($ARCH is passed on to Docker and the right multi-arch distroless base image is automatically loaded based on that variable - no need to patch the Dockerfile’s)</li>
  <li>the deployment and daemonset YAML files (these files contain lists with arch choices that consist of ARM64 and AMD64)</li>
  <li>trident-autosupport container has an <a href="https://hub.docker.com/r/netapp/trident-autosupport/tags">ARM64</a> build since v23.04 (good for those who use ASUP)</li>
</ul>

<p>But, the process of building and deploying seems harder than v23.01 or my ARM64-focused fork.</p>

<p>For example, “make all” defaults to pushing images to registry even though the default is “load” (i.e. don’t “push”). If you aren’t building on a system which can push, that means build process breaks after the first image is built and fails to be uploaded (i.e. Trident Operator won’t be built). This also happens when <code class="language-plaintext highlighter-rouge">BUILDX_OUTPUT</code> is set in shell - the setting simply doesn’t work. A workaround would be to set a temporary local registry (or login to Docker Hub despite not wanting to push your builds there, and delete them afterwards), but why?</p>

<p>Similarly, PLATFORMS variable supposedly allows us to set only a subset of all platforms available (Win, Lin, OS X), but PLATFORMS=”linux/arm64” won’t work because it seems linux/amd64 is required.</p>

<p>Honestly, it’s easier to just build ARM64 images manually from the Dockerfile’s: if I build tridentctl and other key binaries with simple commands (see BUILD.md) such as “go build -o tridentctl ./cli”, then I can build Trident images from the two Dockerfile’s and move on to installing Trident with tridentctl. No need to fight the Makefile!</p>

<p>After several hours, I gave up on the included Makefile. I did manage to build ARM64 containers on my Linux x86_64 system, but just one image (Trident, without Trident Operator), and in the process I was also getting errors related to Darwin OS and whatnot, so I wasn’t sure if that Trident container image was going to work well.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/linux/amd64/tridentctl
bin/linux/amd64/trident_orchestrator
bin/linux/amd64/chwrap
bin/linux/arm64/tridentctl
bin/linux/arm64/trident_orchestrator
bin/linux/arm64/chwrap
Successfully packaged chart and saved it to: /go/src/github.com/netapp/trident/trident-operator-23.07.0-custom.tgz
<span class="nb">cp</span>: cannot <span class="nb">stat</span> <span class="s1">'bin/darwin/amd64/tridentctl'</span>: No such file or directory
make: <span class="o">[</span>Makefile:381: installer] Error 1 <span class="o">(</span>ignored<span class="o">)</span>
WARNING: Using default BuildKit config <span class="k">in</span> /home/sean/.docker/buildx/buildkitd.default.toml
ERROR: invalid duplicate endpoint unix:///var/run/docker.sock
make: <span class="o">[</span>Makefile:324: images] Error 1 <span class="o">(</span>ignored<span class="o">)</span>
...
</code></pre></div></div>

<p>Then I used a cloud-based Debian 11 (Bullseye) ARM64 instance. I still saw Makefile-related errors similar to what I saw on x86_64, but at least this was on native ARM64 so I downloaded, signed and posted these images to Docker Hub.</p>

<ul>
  <li><a href="https://hub.docker.com/layers/scaleoutsean/trident-arm64/v23.07/images/sha256-1a24f4719413b622e1fd07e3b948977ee00ec0ba3293b141d9a6c726f6e4f59d?context=explore">Trident</a></li>
  <li><a href="https://hub.docker.com/layers/scaleoutsean/trident-operator/23.07.0-custom/images/sha256-dba3c2e79570ba4b7eb9f708e2d157e491e7f79904a6ace5f74a4f682ac65d3c?context=explore">Trident Operator</a> - I think I have no use for this container because I deploy with tridentctl</li>
</ul>

<p>They work for me, but it was a very trial-and-error work and I didn’t take any notes when building:</p>
<ul>
  <li>Building natively on a small Pi-like ARM64 at home: complete fail, suspected Go bug or something else that consumes all resources</li>
  <li>Building for ARM64 on a x86_64 system with Docker: works for Trident (not repeatable for Trident Operator), but with Makefile-related errors</li>
  <li>Building natively in the cloud (Debian 11 on GCP’s ARM64 servers with Docker): same as on x86_64 - some Makefile-related errors could be fixed by editing Makefile, but others remained. I wasn’t possible to repeatably build Trident Operator (I didn’t take notes, so maybe wasn’t consistently repeating build steps)</li>
</ul>

<p>My K8s on ARM64 environment now:</p>

<ul>
  <li>K3S on Debian 11.7 (Bullseye)</li>
  <li>Trident v23.07 with SolidFire iSCSI and ONTAP NFS backends</li>
</ul>

<p><img src="/assets/images/netapp-trident-v2307-arm64.png" alt="Trident v23.07 on ARM64" /></p>

<h2 id="deploy">Deploy</h2>

<p>While deploying with tridentctl (which should be easy to build, use “go build -o tridentctl ./cli”), I had this transient Trident pod appear and get stuck trying to download ARM64 container from docker.io/netapp (which of course can’t work since NetApp hasn’t yet published images for v23.07). That’d make “trident install -n trident” hang for minutes, and ultimately timeout (fail).</p>

<p>I’ve no idea what that was about - I couldn’t find any documentation on that transient pod and I also couldn’t find where to set its container image location.</p>

<p>After five-six attempts to edit that pod while Trident install was stuck/waiting for REST service to come up, and change its container image location to docker.io/scaleoutsean/trident-arm64:v23.07, one of the installation attempts finally worked. As edited the pod and it successfully retried with a working image link, the transient pod did its thing and disappeared. I was left with three running pods in Trident namespace as in that screenshot above.</p>

<p>This failure in “transient pod” will presumably go away for users (if only for those who don’t use private repos) once multi-architecture images for v23.07 are released, but that won’t fix the documentation. If you can’t specify that this transient pod downloads a local image, real-time editing will be required even after v23.07 has been released.</p>

<p>Anyway, this is what I ended up with:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>kubectl get pods <span class="nt">-n</span> trident
NAME                                 READY   STATUS    RESTARTS      AGE
trident-operator-595855b959-xthdq    1/1     Running   0             19h
trident-controller-6cf64dc9f-dzz9b   6/6     Running   1             19h
trident-node-linux-czln6             2/2     Running   0             19h

<span class="nb">sudo</span> ./trident-v23.07/bin/linux/arm64/tridentctl <span class="nt">-n</span> trident version
+---------------------------------------------------------+---------------------------------------------------------+
|                     SERVER VERSION                      |                     CLIENT VERSION                      |
+---------------------------------------------------------+---------------------------------------------------------+
| 23.07.0-custom+e2344922b27d1aec8c2574153962ef7ea49e390d | 23.07.0-custom+e2344922b27d1aec8c2574153962ef7ea49e390d |
+---------------------------------------------------------+---------------------------------------------------------+
</code></pre></div></div>

<p>Later on I deployed PostgreSQL using a Trident/SolidFire SC and didn’t notice any issues, so it appears it works.</p>

<p>I haven’t tried to restart… Who knows if it will fall apart next time I reboot. Update: it came back… Fortunately Trident appears to work okay.</p>

<p><img src="/assets/images/netapp-trident-v2307-arm64-transient-pod-error.png" alt="Transient pod fails after restart" /></p>

<h3 id="other-attempts-to-deploy">Other attempts to deploy</h3>

<p>As I failed many times using tridentctl, I tried to use Trident Operator. Either I couldn’t understand the instructions or the instructions are bad (or maybe the code/containers were?). After 30-45 minutes, I gave up (but I built and uploaded a Trident Operator image to Docker Hub on that occasion).</p>

<p>I also tried Helm and couldn’t even attempt to use the Trident chart. It appears the chart URL in the documentation (v23.04) is invalid and I couldn’t even try to do something with the chart file. I was thinking about creating my own site for the chart, but it was just too much work. Then I went back to using tridentctl which - after 10-15 attempts - worked when one of the attempts to edit image URL in that “transient” running pod worked.</p>

<p>I wish these steps worked better as I have no desire to deal with this in the future, or maintain a fork.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Trident improvements are steady and new features (NVMe over TCP) are being added every release.</p>

<p>Some of the improvements also improve the products and services that make use of Trident (Astra Control, mostly), but almost all of them stand to benefit generic Kubernetes users of ONTAP storage systems on premises or in the cloud.</p>

<p>Trident on ARM64 has been officially supported since v23.04, but it still doesn’t appear well-documented or well-tested.</p>

<p>The complete change log for Trident v23.07 can be found <a href="https://github.com/NetApp/trident/blob/stable/v23.07/CHANGELOG.md">here</a>. The full list of commits in v23.07 may be viewed <a href="https://github.com/NetApp/trident/commits/stable/v23.07">here</a>.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
      &nbsp; 
    
      <a href="
      /categories/#kubernetes">kubernetes</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2021/02/24/netapp-trident-on-arm64.html">NetApp Trident v21.01.1 on Linux/ARM64 with SolidFire iSCSI storage</a></li>
      
        <li><a href="/2021/03/27/photon-ontap-on-arm64-iot-edge.html">Experimenting with Edge-to-DC integrations with Photon IoT and ONTAP</a></li>
      
        <li><a href="/2022/09/25/unofficial-netapp-trident-for-arm64.html">NetApp Trident v22.07.0 for ARM64</a></li>
      
        <li><a href="/2021/02/20/trident-csi-ontap-management-isolation.html">Limit CSI provisioner's blast radius for automatically provisioned ONTAP storage</a></li>
      
        <li><a href="/2024/03/21/netapp-trident-v2402-arm64.html">Quickly install NetApp Trident v24.02 on ARM64 Kubernetes</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-07-02 14:52 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
