<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Stand-alone and Consistency Group snapshots on NetApp E-Series | Acting Technologist
      
    </title>
    <meta name="description" content="
     Understand and use SANtricity snapshots of both stand-alone and snapshot consistency group volume members
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Stand-alone and Consistency Group snapshots on NetApp E-Series | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Stand-alone and Consistency Group snapshots on NetApp E-Series" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en" />
<meta name="description" content="Understand and use SANtricity snapshots of both stand-alone and snapshot consistency group volume members" />
<meta property="og:description" content="Understand and use SANtricity snapshots of both stand-alone and snapshot consistency group volume members" />
<link rel="canonical" href="https://scaleoutsean.github.io/2023/10/05/snapshots-and-consistency-groups-with-netapp-e-series.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2023/10/05/snapshots-and-consistency-groups-with-netapp-e-series.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-10-05T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Stand-alone and Consistency Group snapshots on NetApp E-Series","dateModified":"2023-10-05T00:00:00+08:00","datePublished":"2023-10-05T00:00:00+08:00","author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2023/10/05/snapshots-and-consistency-groups-with-netapp-e-series.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2023/10/05/snapshots-and-consistency-groups-with-netapp-e-series.html"},"description":"Understand and use SANtricity snapshots of both stand-alone and snapshot consistency group volume members","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Stand-alone and Consistency Group snapshots on NetApp E-Series</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>05 Oct 2023</span> - <i class="far fa-clock"></i> 


  
  
    29 minute read
  

    </span>
  </div>
  
        <ul>
  <li><a href="#how-does-it-work">How does it work?</a></li>
  <li><a href="#limits">Limits</a></li>
  <li><a href="#thin-or-thick">Thin or thick?</a></li>
  <li><a href="#how-much-to-reserve-for-santricity-snapshots">How much to reserve for SANtricity snapshots?</a></li>
  <li><a href="#what-can-we-do-with-santricity-snapshots-and-clones">What can we do with SANtricity snapshots and clones</a>
    <ul>
      <li><a href="#use-case-1-plain-old-snapshots">Use case 1: plain old snapshots</a></li>
      <li><a href="#use-case-2-snapshots-with-anti-ransomware-characteristics">Use case 2: snapshots with anti-ransomware characteristics</a></li>
      <li><a href="#use-case-3-devtest-and-backup-offload">Use case 3: Dev/Test and backup offload</a></li>
    </ul>
  </li>
  <li><a href="#managing-reserved-capacity">Managing reserved capacity</a></li>
  <li><a href="#consistency-groups-and-data-consistency">Consistency groups and data consistency</a></li>
  <li><a href="#other-confusing-details">Other confusing details</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#appendix-a---santricity-snapshot-consistency-groups-cg">Appendix A - SANtricity Snapshot Consistency Groups (CG)</a></li>
  <li><a href="#appendix-b---snapshots">Appendix B - Snapshots</a>
    <ul>
      <li><a href="#stand-alone-volume-snapshot">Stand-alone volume snapshot</a></li>
      <li><a href="#consistency-group-snapshot">Consistency Group snapshot</a></li>
      <li><a href="#rollback-recovery">Rollback (recovery)</a></li>
    </ul>
  </li>
  <li><a href="#appendix-c---repository-utilization">Appendix C - Repository utilization</a></li>
  <li><a href="#appendix-d---snapshot-schedule">Appendix D - Snapshot schedule</a></li>
  <li><a href="#appendix-e---cg-rollback-from-snapshot-with-minio-single-node-multi-drive">Appendix E - CG rollback from snapshot with MinIO Single-Node Multi-Drive</a></li>
</ul>

<h2 id="how-does-it-work">How does it work?</h2>

<p>Something like this:</p>

<ul>
  <li>No additional license is required</li>
  <li>SANtricity calls snapshots “snapshot images” (a non-writeable Point-in-Time storage object)</li>
  <li>SANtricity calls clones “snapshot volumes” (a read-only or read-write copy volume created from snapshot image(s)). The name is confusing, but I guess the idea is to permanently distinguish clones - always tied to a base volume - from regular volumes. Some other arrays can break the connection with Base Volume, but SANtricity cannot.</li>
  <li>Copy-on-write snapshot capacity isn’t taken from some shared free space. It is deducted and fully allocated in the form of “repo” volumes from spare storage capacity when the first snapshot on the volume is created</li>
  <li>Before a volume runs out of reserve capacity, an alert is generated. Admin can choose to add extra capacity or can configure the snapshot group (i.e. per-volume snapshot setting) to automatically purge the oldest snapshot so that a new snapshots can be taken; another choice is to reject writes to the base volume, to keep existing snapshots valid and prevent them from being rotated out.</li>
</ul>

<h2 id="limits">Limits</h2>

<p>From the <a href="https://www.netapp.com/media/17120-tr4724.pdf">NetApp TR-4724</a>, page 40:</p>

<ul>
  <li>Consistency groups (CGs): 64 volumes per group, 32 CGs per system</li>
  <li>Snapshot groups (SGs): 4 SGs per volume, 1024 SGs per system</li>
  <li>Snapshots: 32 per SG, 128 per volume, 2048 per system</li>
  <li>Clones: 4 per volume, 1024 per system</li>
</ul>

<h2 id="thin-or-thick">Thin or thick?</h2>

<p>Snapshots consume space from Reserved Capacity which is thick.</p>

<p>If you have a 100 GiB volume and reserve 20% for snapshots, 20G will be thick-reserved; a thick 20 GiB “repo” volume will be created and that capacity “gone”.</p>

<p>This volume may have just 3 snapshots that consume 4 GiB of capacity (12 GiB total), but that’d only mean the reserve has 8 GiB of unallocated reserve capacity - it won’t make those “unused” 8 GiB available for any other purposes.</p>

<p>Writeable clones are the same.</p>

<p>So, repo capacity occupied by snapshots and clones is “thick”, even if it’s not fully used.</p>

<p>When base and snapshot or clone do not differ, almost no reserve capacity is used, so read-only clones and snapshots that don’t differ from base volume consume almost no additional capacity.</p>

<h2 id="how-much-to-reserve-for-santricity-snapshots">How much to reserve for SANtricity snapshots?</h2>

<p><a href="https://docs.netapp.com/us-en/e-series-santricity/sm-mirroring/why-would-i-change-this-percentage.html">That depends</a>, but the default is 40%.</p>

<p>Maybe you assume daily change is 2% and you want keep 21 days of changes: 42%.</p>

<p>Or maybe your differential backups grow by 2 GiB per day, and you want to keep around 15 days, so 30-40% could be enough.</p>

<p>If you’ve created a pair of 100 GiB volumes and, while taking the first snapshot on each, set snapshot reserve to 35%, now 2 * (100 GiB + 35%) is allocated on your pool or volume group (including the base volumes).</p>

<p>It’s confusing, in the SANtricity Web UI, that individual clones and snapshots aren’t visible under All Capacity, although they do consume capacity. You need to look them up under Reserved Capacity (because that’s the capacity they consume).</p>

<p>But clicking around makes it hard to get the full picture at any point in time, so I strongly recommend building your own dashboard or CLI reporting utility to be able to figure this out. Consider this:</p>

<p><img src="/assets/images/eseries-snapshots-23-snapshot-reserved-capacity-by-snapshot.png" alt="" /></p>

<p>What are we looking at?</p>

<p>It’s hard to tell for sure, but it seems this is 16 GiB of (snapshot) reserve capacity in two “reserved” volumes reserved for the snapshot group garbage_SG_01 dedicated to the volume “garbage”.</p>

<h2 id="what-can-we-do-with-santricity-snapshots-and-clones">What can we do with SANtricity snapshots and clones</h2>

<p>Since the API is available and easy to use, it is easy to augment host-side backup scripts with hardware snapshots (application-consistent snapshots), schedule hardware snapshots without the client’s awareness (crash-consistent snapshots), or create Dev/Test workflows (snapshot, clone, mount).</p>

<h3 id="use-case-1-plain-old-snapshots">Use case 1: plain old snapshots</h3>

<p>This is about using SANtricity snapshots just you would use any other storage snapshot: stop or suspend IO, create a snapshot.</p>

<p>A more conservative variant: use crontab or other scheduler to stop service at midnight, flush pending IO, take a snapshot, start service again, and notify via Slack.</p>

<p>Other times you may suspend the application or freeze filesystem activity. Do whatever the application requires, just insert a call to SANtricity “create snapshot” to take a snapshot between stop/quiesce/freeze and thaw.</p>

<p>Snapshot Consistency Groups work the same way. As an example, a PostgreSQL DB may live on two volumes, data and log. Create a CG and snap both at the same time.</p>

<p>If we have the luxury, we want to use different RAID levels for data and logs. That means either R6 and R1 (<a href="/2022/09/12/new-ddp-and-e-series-santricity-web-restful-api.html">both on the same DDP</a>) or separate R5 and R1 Volume Groups.</p>

<p>We plan to keep data on a RAID 5 volume group, and logs on RAID 1. Create these volume groups and volumes.</p>

<p><img src="/assets/images/eseries-snapshots-01-initial.png" alt="" /></p>

<p>With multiple volumes, we may want to create a consistency group to be able to snapshot them together at the same time.</p>

<p><img src="/assets/images/eseries-snapshots-02-create-consistency-group.png" alt="" /></p>

<p>The second step here is to reserve capacity for snapshots.</p>

<p>I ship PostsgreSQL logs to another site and make daily backups to S3, so all I want from SANtricity is to keep 8 recent snapshots taken at a rate of 1 every hour.</p>

<p>I estimate that to be less than 10% of data size, but I’ll reserve 15%.</p>

<p><img src="/assets/images/eseries-snapshots-03-reserve-snapshot-capacity-for-consistency-group.png" alt="" /></p>

<p>Reserving extra reserve capacity isn’t wrong, but it’s “thick-reserved” and may waste capacity. Reservation capacity can be increased later (see about capacity management, below), so there’s a way to fix that if you undershoot.</p>

<p>In Step 3, if I don’t want to take care of snapshot deletion, I can set snapshots to rotate after 8 have been taken, so that when the 9th is taken, the oldest is immediately deleted. If you want to script snapshot deletion, you can disable automated snapshot deletion and create own script for that.</p>

<p>At the same time, if I run out of reserved snapshot capacity (15% of each volume’s size), I want my production volumes to become read-only rather than continue without periodic snapshots.</p>

<p><img src="/assets/images/eseries-snapshots-04-snapshot-settings-for-consistency-group.png" alt="" /></p>

<p>If you want to schedule snapshots, see Appendix D.</p>

<p>And now snapshots for the group can be created at the same time. You can still take snapshots of individual volumes, too.</p>

<p><img src="/assets/images/eseries-snapshots-05-snapshot-individual-vs-consistency-group.png" alt="" /></p>

<p>Here’s an example of a CG snapshot taken that way.</p>

<p><img src="/assets/images/eseries-snapshots-06-snapshot-consistency-group-members.png" alt="" /></p>

<h3 id="use-case-2-snapshots-with-anti-ransomware-characteristics">Use case 2: snapshots with anti-ransomware characteristics</h3>

<p>I wrote about it in <a href="/2022/04/03/restic-server-netapp-eseries.html">this post on using E-Series array for DIY backups with Restic</a>.</p>

<p>The idea is:</p>

<ul>
  <li>Do not store credentials on the client (even if it’s accessible and can be executed by only a system administrator)</li>
  <li>Configure E-Series snapshots to be “hard” to delete, and finally…</li>
  <li>Buy enough time make a copy of volume data elsewhere because a snapshot is not a backup</li>
</ul>

<p>The first objective is to execute snapshots on schedule (defined on the array) or “out-of-band” from a trusted server. Schedule-driven snapshots are safe as long as array is not compromised. If SAML is enabled, the CLI, SDK, REST API are all disabled (see <a href="https://www.netapp.com/media/19404-tr-4853.pdf">TR-4853</a> for more). Once a schedule is set and SAML enabled, no one can remotely override it or remove it.</p>

<p>If you want to use the API, then setup a server with tight security and use it to run scripts against E-Series clients (to freeze and thaw applications) and storage arrays (to take snapshots). For additional security we can insert an API proxy with additional authentication and authorization between your management server and E-Series API endpoint.</p>

<p>How do we configure snapshots to be “hard” to delete? See Step 3 in snapshot workflow above, or consider this list:</p>

<ul>
  <li>Uncheck “Enable automatic deletion of snapshots when X snapshots have been created”
    <ul>
      <li>This is recommended in the case you continue using the API, as the attacker could keep taking snapshots to rotate yours out</li>
      <li>This is not recommended if you use SAML and snapshots are taken only manually or on fixed schedule defined locally in the Web UI</li>
    </ul>
  </li>
  <li>Unselect “Purge oldest snapshot image (recommended)” and instead select “Reject writes to base volume (keep snapshot images valid)”
    <ul>
      <li>This removes the risk of snapshot images being purged as the attacker overwrites empty space while snapshots are being taken. This may be okay if snapshots be shipped off-site or a copy made to S3 with Object Lock</li>
      <li>This increases the risk of your volume becoming read-only, but there’s an alert for low reserved capacity (Web UI, email, SNMP, syslog). This may increase your need to manually prune snapshots if there’s no API access, but if snapshots are taken daily, it can be a once-a-week activity that takes 2  minutes to execute.</li>
    </ul>
  </li>
</ul>

<p>This doesn’t quite give you immutable snapshots, but if you enable SAML and create a snapshot schedule, it’s pretty safe. You don’t need them to be there forever, you just need them to be there long enough to be backed up to S3 with Object Lock or WORM (append-only) ALCs.</p>

<h3 id="use-case-3-devtest-and-backup-offload">Use case 3: Dev/Test and backup offload</h3>

<p>“Create snapshot volumes” aka clones is what we can do once we have a snapshot.</p>

<p>A common scenario is to create or re-create (update) clones created from snapshots.</p>

<p>If our Dev/Test hosts are fixed, we can refresh their copy of production data daily by recreating the same snapshot volume from a newer snapshot or on-the-fly (on-demand). The difference is if the production application is running, an on-the-fly snapshot creates a crash-consistent temporary snapshot and (from it) a clone volume, whereas your scheduled and orchestrated snapshots may be application consistent as explained earlier.</p>

<p>Either way, with the API enabled we’d really have just 3-4 curl commands to run in this entire workflow (assuming hosts can be defined beforehand in the Web UI, and fixed).</p>

<p>To recap, a common workflow for this would be:</p>

<ul>
  <li>Create on-demand or scheduled snapshot image</li>
  <li>Create clone from snapshot image (or on-the-fly/on-demand) and present clone LUNs to Dev/Test hosts</li>
  <li>Rescan storage controllers, mount clone volume(s) and start using clone data (r/w clones need some reserved capacity, r/o clones do not)</li>
  <li>Optionally, to refresh data using  stop Dev/Tev workload, <em>disable</em> a clone in SANtricity, <em>recreate</em> it from a newer (or on-demand) snapshot (this will refresh the clone and automatically enable it)</li>
</ul>

<p>In some clusters you may not be able to access cloned volumes in read-only fashion because volume IDs may collide with existing (production) volume IDs. vSphere commonly requires either a separate cluster, or resignaturing the clone volume (which requires read-write access to the LUN). This isn’t E-Series-specific.</p>

<p>You can also deploy a backup utility on your Dev/Test client and run scheduled backup jobs to S3. See <a href="/2023/09/03/solidbackup-with-kopia.html">this example with Kopia</a> and the Restic post. Not many people know that, but SANtricity had a software utility like that called <a href="https://www.netapp.com/media/16957-sb-3994.pdf">NetApp SANtricity Cloud Connector</a> integrated with SANtricity. Creating your own wouldn’t be easier, but it wouldn’t be hard either - it’s just a matter of scheduling backup-to-S3 to not run while clone volumes are being refreshed.</p>

<p>Let’s see how SANtricity clones (aka “Snapshot volumes”) work.</p>

<p>In Snapshot Images create a snapshot or two if you don’t have any, and then change to Snapshot Volumes.</p>

<p>Click Create, obviously.</p>

<p><img src="/assets/images/eseries-snapshots-08-create-clones.png" alt="" /></p>

<p>Pick an object (that is snapshot) to use for the clone.</p>

<p><img src="/assets/images/eseries-snapshots-09-create-clone-from-snapshot.png" alt="" /></p>

<p>In the first step of volume clone wizard, pick some or all volumes from the CG snapshot.</p>

<p><img src="/assets/images/eseries-snapshots-10-create-clone-from-snapshot-image-review-snapshot-members.png" alt="" /></p>

<p>If you don’t have any hosts ready yet, you can assign them later.</p>

<p>Read/write creates a write-able clone which also need some reserved space.</p>

<p>A read-only clone doesn’t need any reserved space (obviously, you won’t be able to write to a clone that’s read-only and some OS won’t even let you mount them).</p>

<p><img src="/assets/images/eseries-snapshots-11-create-clone-from-snapshot-image-pick-rw-or-ro.png" alt="" /></p>

<p>If you don’t want to write to a volume but need it to be read-write so that they can be mounted, you can reserve a tiny capacity for the clone, say 1% of volume size.</p>

<p><img src="/assets/images/eseries-snapshots-12-create-clone-from-snapshot-image-pick-reservation-for-clone.png" alt="" /></p>

<p>Set a fullness alert level.</p>

<p><img src="/assets/images/eseries-snapshots-13-create-clone-from-snapshot-image-pick-name-and-alert-level.png" alt="" /></p>

<p>And that’s it!</p>

<p><img src="/assets/images/eseries-snapshots-14-create-clone-from-snapshot-image-finalized.png" alt="" /></p>

<p>When you want to refresh a clone, stop using clone volumes on clients, and re-create the clone from the same source (by taking a temporary on-demand snapshot) or from any existing snapshot.</p>

<p><img src="/assets/images/eseries-snapshots-18-clone-from-existing-snapshot-image-or-temp-on-demand-snapshot.png" alt="" /></p>

<p>Then you can resume using the volume.</p>

<p>If you refresh your DevTest environment daily, you probably refresh from the latest snapshot which should be easy to automate (reverse-order a list all snapshots, pick the first one and use it to recreate the clone volume).</p>

<h2 id="managing-reserved-capacity">Managing reserved capacity</h2>

<p>Snapshot reserve holds thick-provisioned snapshot reserve capacity for the base volume. This capacity is provisioned when the first snapshot for the base volume is created, or more correctly when the first Snapshot or Clone Group is created. That then creates a snapshot volume, but even after a snapshot or clone is deleted, the group (and repo volume) will remain.</p>

<p>We can view this in Volumes &amp; Pools &gt; Reserved Capacity tab.</p>

<p><img src="/assets/images/eseries-snapshots-16-snapshot-group.png" alt="" /></p>

<p>Here’s an example of 140 GiB in reserved capacity - where you see “Snapshot Group” that’s a snapshot group, while s”Snapshot Volume” is a clone group.</p>

<p><img src="/assets/images/eseries-snapshots-19-reserved-capacity-total-and-available.png" alt="" /></p>

<p>Why “group”?</p>

<p>I think it’s called that way because it’s a collection of repo volumes, although it doesn’t seem that way at first sight - usually there’s just one repo volume in a “group”.</p>

<p>Not going with the suggested reservation percentage can yield considerable capacity savings. Instead of going from 140 to 180 GiB, the next clone made reserved capacity jump to 148 GiB. (You can also see a “repo” volume here.)</p>

<p><img src="/assets/images/eseries-snapshots-20-reserved-capacity-savings.png" alt="" /></p>

<p>If you move to the main/default “All Capacity” tab, you won’t see any clone volumes (isn’t that weird?), but you’ll see how much capacity the snapshots and clones take up: the 100 GiB pgdata volume occupies 240 GiB because 140 GiB (two screenshots ago, above) is allocated as Reserve Capacity!</p>

<p><img src="/assets/images/eseries-snapshots-21-total-capacity-consumption.png" alt="" /></p>

<p>If you undershoot in terms of reserve capacity, you can increase it. In Reserved Capacity tab, select clone, click on Increase Capacity, and add it as necessary.</p>

<p><img src="/assets/images/eseries-snapshots-22-increase-clone-reserved-capacity.png" alt="" /></p>

<p>“Decrease” works the same way, but you need to delete snapshots or clones that may be using those repo volumes.</p>

<p>Even as all snapshots are deleted (see that 0?), the Snapshot Group created to hold them will persist. That’s usually fine, as we already configured it the way we want (in terms of reservation, etc.) and may take another snapshot soon.</p>

<p><img src="/assets/images/eseries-snapshots-28-empty-snapshot-group.png" alt="" /></p>

<p>But if you delete all snapshots from a large Snapshot Group, TBs of capacity may remain stranded.</p>

<p>In that case remember to delete the group itself in order to release the space. That can be done from the API or Web UI using the same Reserved Capacity tab.</p>

<h2 id="consistency-groups-and-data-consistency">Consistency groups and data consistency</h2>

<p>There are multiple layers to consider:</p>

<ul>
  <li>Application</li>
  <li>OS and filesystem</li>
  <li>Volumes (in a consistency group)</li>
</ul>

<p>What SANtricity Snapshot Consistency Group does is guarantees that all member volumes are snapshot at the same point-in-time.</p>

<p>To avoid corruption, filesystem needs to be able to recover from crashes (i.e. snapshots) which is what most journal-based filesystems do. And the OS must send IOs in the same order.</p>

<p>If, following a snapshot rollback, filesystem can be mounted, the next step is to start the application. Mosts applications have their own logs that they use for recovery.</p>

<p>So, the point is Consistency Groups can’t guarantee any application can recover under any circumstances. Sometimes, some applications won’t be.</p>

<p>One way OS can improve its and filesystems’s odds of survival is to freeze or quiesce IO, but that doesn’t guarantee the application “checkpoint” will be able to return to that point in time. But the filesystem may.</p>

<p>Even when filesystems are concerned, we need to remember that OS freezes volumes one by one, so 8 volumes may be quiesced within 1 millisecond, which can be dangerous when data is striped across them (and it often is striped, rather than concatenated).</p>

<p>If the host has a volume manager (such as LVM) that can freeze volumes host-side, then the task of SANtricity is easier because the responsibility of freezing IO at the same time for the entire LVM is on LVM itself - it’s not us writing a script that loops over 12 volumes running the freeze command.</p>

<p>Even if there’s a volume manager that can concurrently suspend IO across multiple volumes, that still doesn’t guarantee that the application will be able to recover. It’s likely it will, but cannot be guaranteed.</p>

<p>Long story short:</p>

<ul>
  <li>To quiesce multiple volumes, it is suggested to use a volume manager to do it</li>
  <li>Even better, stop the application, quiesce the volumes, take a CG snapshot, and start the application again - for most applications this requires 10-30 seconds of downtime which can be scheduled once a day</li>
</ul>

<p>If you also take CG snapshots without any “cooperation” from the host, that’s fine - most filesystems and applications will recover just fine (RTFM and test it to make sure), but I would try to make sure at least one daily CG snapshot is taken when the application is not running and pending write buffer has been flushed to disk.</p>

<h2 id="other-confusing-details">Other confusing details</h2>

<p>In reality, “snapshot” and “clone” data is stored in stand-alone “differential volumes” (repos) which contain segments that differ between the base volume and snapshot or clone volume called <code class="language-plaintext highlighter-rouge">repo_*</code>.</p>

<p>For some reason, repo_* volumes don’t appear on the Volumes page. Instead, they appear on Volume Groups and Pools (!) page as if they somehow comprise a big pool or group (they don’t; each is a stand-alone thing).</p>

<p><img src="/assets/images/eseries-snapshots-27-reserved-capacity-detail.png" alt="" /></p>

<p>Furthermore, each snapshot or writeable clone group can have multiple volumes (<code class="language-plaintext highlighter-rouge">repo_*</code>), which happens when the user increases size of reserved capacity for a snapshot group.</p>

<p>These repo volumes belonging to the same group (Snapshot or Clone) seem to be concatenated, so that differential snapshot segments can span multiple repo volumes.</p>

<p>They cannot be removed as long as there’s a snapshot or clone that uses volumes. But, it is possible to delete the base volume and leave an <a href="https://docs.netapp.com/us-en/e-series-santricity/sm-storage/how-reserved-capacity-works.html#orphaned-reserved-capacity-volumes">“orphaned” repo volume</a>: thankfully “Reclaim unused capacity” exists to reclaim this stranded capacity.</p>

<p>It is also possible to delete a snapshot and leave the clone (snapshot volume that relied on that snapshot) in Disabled state. I don’t know why that is allowed, but it is.</p>

<p>It appears possible to use a different volume group or DDP to store snapshot reserve volume (as long as there’s enough capacity on it). While this is convenient, it can be dangerous: say you park your clone data on a group normally controlled by another admin; they could delete their volumes and, seeing that it’s void of their volumes, the group or pool and with it your data.</p>

<p>Another odd thing which I discovered is that a range of volume names is reserved: you can’t directly create <code class="language-plaintext highlighter-rouge">repo_0000</code> to <code class="language-plaintext highlighter-rouge">repo_9999</code>, as those are reserved for reserved capacity volumes. (You can indirectly create them by creating read-write clones, of course). I don’t see that documented in the product documentation; users who end up failing to create conflicting names and have automation unexpectedly fail would not be amused.</p>

<p>Last but not least, snapshots can’t be deleted out of order! Old school, yes. You have to delete them in ascending order by time created.</p>

<h2 id="conclusion">Conclusion</h2>

<p>The E-Series API and CLI are easy to use, but it’s can be a bit hard to figure out how it all fits together.</p>

<p>The system-managed repo_ volumes are also used in asynchronous replication which we haven’t even discussed in this post.</p>

<p>Appendices below contain some examples of snapshot and Consistency Group-related API methods, to give you an idea of how you may get started.</p>

<p>Nowadays many workloads run in containers and VMs, so it’s not necessary to frequently clone E-Series volumes: you can use a <a href="/2022/12/09/directpv-topolvm-csi-lvm-das-k8s-with-eseries.html">CSI driver</a> to snapshot and/or backup your volumes, and vSphere snapshots to backup VMs on VMFS.</p>

<p>But, storage snapshots and/or clones are still required for protection from human error, for application-integrated backups, and especially so in bare metal server environments and sometimes can augment CSI and application snapshots. For example:</p>
<ul>
  <li>Snapshot Consistency Groups lets you take a snapshot of multiple, independent NOSQL volumes at once, either independently of workload, or integrated with application, or as part of a restart cycle</li>
  <li>Snapshot Consistency Groups lets you snapshot filesystems and applications that span multiple volumes</li>
  <li>Snapshots can be used with Kubernetes and clones can be integrated with backup utilities to increase your chances against ransomware attacks</li>
</ul>

<p>Because snapshots and clones reserve space and take it away from the capacity that can be used for regular volumes, it is important to:</p>
<ul>
  <li>Not go with the defaults and select a low-reserve percentage for snapshots and clones that do not need it</li>
  <li><a href="/2023/10/12/snapshot-clone-repository-monitoring-in-eseries.html">Properly monitor array and repository capacity</a> to avoid surprises. I recently also wrote about <a href="/2023/09/17/netapp-e-series-snmp-trap-notifications.html">E-Series monitoring with SNMP</a>.</li>
</ul>

<p>While hot snapshots combined with host-side quiesce will work as well as they do anywhere else, for multiple volumes it’s recommended to take cold CG snapshots (on idle and flushed volumes), or app- and volume-manager-assisted hot CG snapshot (where application and/or volume manager flush and freeze volumes before CG snapshot is taken on E-Series).</p>

<h2 id="appendix-a---santricity-snapshot-consistency-groups-cg">Appendix A - SANtricity Snapshot Consistency Groups (CG)</h2>

<p>To create a snapshot, you need to create a new consistency group.</p>

<pre><code class="language-raw">curl -X POST "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/consistency-groups" -H  "accept: application/json" -H  "Content-Type: application/json" -d "{  \"name\": \"sean\",  \"fullWarnThresholdPercent\": 90,  \"autoDeleteThreshold\": 4,  \"repositoryFullPolicy\": \"purgepit\",  \"rollbackPriority\": \"medium\"}"
</code></pre>

<p>Request:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sean"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fullWarnThresholdPercent"</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span><span class="w">
  </span><span class="nl">"autoDeleteThreshold"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
  </span><span class="nl">"repositoryFullPolicy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"purgepit"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"rollbackPriority"</span><span class="p">:</span><span class="w"> </span><span class="s2">"medium"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Volumes can be added to a CG one by one or in a batch:</p>

<ul>
  <li>Individually: <code class="language-plaintext highlighter-rouge">/storage-systems/{system-id}/consistency-groups/{cg-id}/member-volumes</code></li>
  <li>In a batch: <code class="language-plaintext highlighter-rouge">/storage-systems/{system-id}/consistency-groups/{cg-id}/member-volumes/batch</code></li>
</ul>

<p>Get consistency group(s) from the same system:</p>

<pre><code class="language-raw">curl -X GET "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/consistency-groups" -H  "accept: application/json"
</code></pre>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"cgRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343300000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CG_PG1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repFullPolicy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"failbasewrites"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fullWarnThreshold"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w">
    </span><span class="nl">"autoDeleteLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rollbackPriority"</span><span class="p">:</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uniqueSequenceNumber"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">1</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"creationPendingStatus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unknown"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CG_PG1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343300000000000000"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>Get consistency group volume members. That CG ID comes from the response just above.</p>

<pre><code class="language-raw">curl -X GET "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/consistency-groups/3233343536373839303132343300000000000000/member-volumes" -H  "accept: application/json"
</code></pre>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"consistencyGroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343300000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volumeId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132333800000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volumeWwn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132333700000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVolumeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pg1wal"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"clusterSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalRepositoryVolumes"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalRepositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1610612736"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"usedRepositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fullWarnThreshold"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalSnapshotImages"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalSnapshotVolumes"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"autoDeleteSnapshots"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"autoDeleteLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitGroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353200000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryVolume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353000000000000000"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"consistencyGroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343300000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volumeId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343100000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volumeWwn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343000000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVolumeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pg1data"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"clusterSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalRepositoryVolumes"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalRepositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"16106127360"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"usedRepositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fullWarnThreshold"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalSnapshotImages"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalSnapshotVolumes"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"autoDeleteSnapshots"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"autoDeleteLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitGroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353500000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryVolume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353300000000000000"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>Get volume reference details of an individual CG member volume. CG and Volume ID are obtained from the JSONs above.</p>

<pre><code class="language-raw">curl -X GET "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/consistency-groups/3233343536373839303132343300000000000000/member-volumes/3233343536373839303132333800000000000000" -H  "accept: application/json"
</code></pre>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"consistencyGroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343300000000000000"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"volumeId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132333800000000000000"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"volumeWwn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132333700000000000000"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"baseVolumeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pg1wal"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"clusterSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w">
  </span><span class="nl">"totalRepositoryVolumes"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"totalRepositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1610612736"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"usedRepositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fullWarnThreshold"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w">
  </span><span class="nl">"totalSnapshotImages"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"totalSnapshotVolumes"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"autoDeleteSnapshots"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"autoDeleteLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
  </span><span class="nl">"pitGroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353200000000000000"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"repositoryVolume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353000000000000000"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="appendix-b---snapshots">Appendix B - Snapshots</h2>

<h3 id="stand-alone-volume-snapshot">Stand-alone volume snapshot</h3>

<p>Get list of snapshot images.</p>

<pre><code class="language-raw">curl -X GET "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/snapshot-images" -H  "accept: application/json"
</code></pre>

<p>This response is deliberately long to illustrate a point: one of the snapshots is tied to a volume that’s a CG member, <em>but</em> it was taken as stand-alone. Therefore it has consistencyGroupId=null.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"pitRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132383200000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitGroupRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353200000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"creationMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1696332850"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitSequenceNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optimal"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"activeCOW"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"isRollbackSource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"209715200"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryCapacityUtilization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132333800000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"consistencyGroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343300000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132383200000000000000"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"pitRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132383100000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitGroupRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132383000000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"creationMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1696332717"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitSequenceNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optimal"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"activeCOW"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"isRollbackSource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"209715200"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryCapacityUtilization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132333800000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"consistencyGroupId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132383100000000000000"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"pitRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132383300000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitGroupRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353500000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"creationMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1696332850"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitSequenceNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optimal"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"activeCOW"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"isRollbackSource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"209715200"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryCapacityUtilization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343100000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"consistencyGroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343300000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132383300000000000000"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>Get list of “snapshot volumes” (i.e. clones).</p>

<pre><code class="language-raw">curl -X GET "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/snapshot-volumes" -H  "accept: application/json"
</code></pre>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"viewRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363000000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"worldWideName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363100000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132333500000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"basePIT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353800000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"boundToPIT"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"accessMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"readWrite"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pg_SV_0003"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optimal"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"currentManager"</span><span class="p">:</span><span class="w"> </span><span class="s2">"070000000000000000000002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredManager"</span><span class="p">:</span><span class="w"> </span><span class="s2">"070000000000000000000002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryVolume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363500000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fullWarnThreshold"</span><span class="p">:</span><span class="w"> </span><span class="mi">75</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1696347108"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewSequenceNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"perms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"mapToLUN"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"snapShot"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"reconfigure"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"mirrorPrimary"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"mirrorSecondary"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"copySource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"copyTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"readable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"writable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"rollback"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"mirrorSync"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"newImage"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"allowDVE"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"allowDSS"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"concatVolumeMember"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"flashReadCache"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"asyncMirrorPrimary"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"asyncMirrorSecondary"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"pitGroup"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"cacheParametersChangeable"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"allowThinManualExpansion"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"allowThinGrowthParametersChange"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"allowImportTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"volumeHandle"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
    </span><span class="nl">"clusterSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"maxRepositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"unusableRepositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"membership"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"viewType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"individual"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"cgViewRef"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"mgmtClientAttribute"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"offline"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"extendedUniqueIdentifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volumeFull"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42949672960"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVolumeCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"107374182400"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalSizeInBytes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"209715200"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"consistencyGroupId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volumeCopyTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"cloneCopy"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volumeCopySource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitBaseVolume"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"asyncMirrorTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"asyncMirrorSource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"protectionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"type1Protection"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"remoteMirrorSource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"remoteMirrorTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pitView"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"wwn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363100000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"listOfMappings"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"mapped"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"currentControllerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"070000000000000000000002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredControllerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"070000000000000000000002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"onlineVolumeCopy"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pg_SV_0003"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363000000000000000"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"viewRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363700000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"worldWideName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363800000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132333500000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"basePIT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353900000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"boundToPIT"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"accessMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"readOnly"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pg_SV_0004"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optimal"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"currentManager"</span><span class="p">:</span><span class="w"> </span><span class="s2">"070000000000000000000002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredManager"</span><span class="p">:</span><span class="w"> </span><span class="s2">"070000000000000000000002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryVolume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000000000000000000000000000000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fullWarnThreshold"</span><span class="p">:</span><span class="w"> </span><span class="mi">75</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1696347199"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewSequenceNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"perms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"mapToLUN"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"snapShot"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"reconfigure"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"mirrorPrimary"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"mirrorSecondary"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"copySource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"copyTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"readable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"writable"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"rollback"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"mirrorSync"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"newImage"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"allowDVE"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"allowDSS"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"concatVolumeMember"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"flashReadCache"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"asyncMirrorPrimary"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"asyncMirrorSecondary"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"pitGroup"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"cacheParametersChangeable"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"allowThinManualExpansion"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"allowThinGrowthParametersChange"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"allowImportTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"volumeHandle"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
    </span><span class="nl">"clusterSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"maxRepositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"unusableRepositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"membership"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"viewType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"individual"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"cgViewRef"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"mgmtClientAttribute"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"offline"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"extendedUniqueIdentifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volumeFull"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVolumeCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"107374182400"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalSizeInBytes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"209715200"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"consistencyGroupId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volumeCopyTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"cloneCopy"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volumeCopySource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitBaseVolume"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"asyncMirrorTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"asyncMirrorSource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"protectionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"type1Protection"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"remoteMirrorSource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"remoteMirrorTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pitView"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"wwn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363800000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"listOfMappings"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"mapped"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"currentControllerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"070000000000000000000002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredControllerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"070000000000000000000002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"onlineVolumeCopy"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pg_SV_0004"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363700000000000000"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>The second item, pg_SV_0004, is a read-only clone: accessMode=readOnly, repositoryCapacity=0, and perms.writable=false.</p>

<p>View repository utilization by a clone (“snapshot volume”): get <code class="language-plaintext highlighter-rouge">id</code> from <code class="language-plaintext highlighter-rouge">GET snapshot-volumes</code> and query its repository utilization like so:</p>

<pre><code class="language-raw">curl -X GET "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/snapshot-volumes/3233343536373839303132363000000000000000/repository-utilization" -H  "accept: application/json"
</code></pre>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"viewBytesUsed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11166914969"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"viewBytesAvailable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"31782757991"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"viewRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363000000000000000"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Without any specific clone ID in mind, we could query repository utilization for all clones.</p>

<pre><code class="language-raw">curl -X GET "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/snapshot-volumes/repository-utilization" -H  "accept: application/json"
</code></pre>

<p>There’s a full example further below.</p>

<h3 id="consistency-group-snapshot">Consistency Group snapshot</h3>

<p>This is straightforward and requires just the CG ID to create it.</p>

<pre><code class="language-raw">curl -X POST "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/consistency-groups/3233343536373839303132343300000000000000/snapshots" -H  "accept: application/json" -d ""
</code></pre>

<p>Get CG snapshot number aka “sequenceNumber” in Swagger I used was 1 (at the end of URL).</p>

<p>There are no numbers in the Web UI, we just “know” it’s the first i.e. oldest. It seems in the API that is <code class="language-plaintext highlighter-rouge">pitSequenceNumber</code>.</p>

<p>The other two inputs are System ID and CG ID.</p>

<pre><code class="language-raw">curl -X GET "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/consistency-groups/3233343536373839303132343300000000000000/snapshots/1" -H  "accept: application/json"
</code></pre>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"pitRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353600000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitGroupRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353200000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"creationMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1696331249"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitSequenceNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optimal"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"activeCOW"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"isRollbackSource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"209715200"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryCapacityUtilization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132333800000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"consistencyGroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343300000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353600000000000000"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"pitRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353700000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitGroupRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353500000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"creationMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1696331249"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitSequenceNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optimal"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"activeCOW"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"isRollbackSource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pitCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"209715200"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"repositoryCapacityUtilization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseVol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343100000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"consistencyGroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132343300000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132353700000000000000"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">

</span></code></pre></div></div>

<h3 id="rollback-recovery">Rollback (recovery)</h3>

<p>We need:</p>

<ul>
  <li>SystemID</li>
  <li>VolumeID or CG ID (if there’s a CG that we want to roll back)</li>
  <li>Snapshot ID (1, 2, etc.) - to restore the latest, get all snapshots and pick the first from a list of snapshots descending-sorted by datetime or pitSequenceNumber</li>
</ul>

<p>On the clients, if the source volume(s) is/are in use, stop the application and unmount the filesystem(s).</p>

<p>Restore snapshot 2 for CG 2A000000600A098000F6371400872B1E651CDD1B:</p>

<pre><code class="language-raw">curl -X POST "https://127.0.0.1:8443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/consistency-groups/2A000000600A098000F6371400872B1E651CDD1B/snapshots/2/rollback" -H  "accept: application/json" -d ""
</code></pre>

<p>Response: if rollback successfully starts, you’ll get a <code class="language-plaintext highlighter-rouge">204</code> (Rollback Started).</p>

<p>This should take a short time, but you can time it once or twice to estimate how much to wait, if at all, before you can mount volumes and start using them again.</p>

<h2 id="appendix-c---repository-utilization">Appendix C - Repository utilization</h2>

<p>Repository is a global pool which stores snapshot-related data objects.</p>

<pre><code class="language-raw">curl -X GET "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/snapshot-volumes/repository-utilization" -H  "accept: application/json"
</code></pre>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"viewBytesUsed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7301444403"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewBytesAvailable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"35648228557"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363000000000000000"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"viewBytesUsed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewBytesAvailable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363700000000000000"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"viewBytesUsed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6871947673"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewBytesAvailable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1717986919"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303134363100000000000000"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"viewBytesUsed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4552665333"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewBytesAvailable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4037269259"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"viewRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132363900000000000000"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Notice a clone volume that uses 0 bytes. That’s a read-only clone.</p>

<p>We want to check this from time to time in order to avoid getting “low reserve capacity” alerts or worse.</p>

<h2 id="appendix-d---snapshot-schedule">Appendix D - Snapshot schedule</h2>

<p>If you automate provisioning or run DevOps workflows, you may want to create schedules via the API.</p>

<p>The easiest way to do it is first create it manually.</p>

<p><img src="/assets/images/eseries-snapshots-15-create-snapshot-schedule.png" alt="" /></p>

<p>Then see what it looks like in the JSON format.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -X GET "https://127.0.0.1:48443/devmgr/v2/storage-systems/7F0000011E1E1E1E1E1E1E1E1E1E1E1E/snapshot-schedules" -H  "accept: application/json"
</code></pre></div></div>

<p>Response with a schedule that runs Mon-Fri with 4 snapshots per day (one every 6 hours). They’re scheduled to start Oct 03, 2023, 12:00AM (GMT) and have no end date. There can be only one schedule per volume or CG.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"schedRef"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303133303100000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"scheduleStatus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newcgpit"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"targetObject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303132383800000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"schedule"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"calendar"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"scheduleMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"weekly"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"daily"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"weekly"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"daysOfWeek"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"monday"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"tuesday"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"wednesday"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"thursday"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"friday"</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nl">"dailySchedule"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"timeOfDay"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"everyNMinutes"</span><span class="p">:</span><span class="w"> </span><span class="mi">360</span><span class="p">,</span><span class="w">
            </span><span class="nl">"timesPerDay"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"monthlyByDate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"monthlyByDay"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"startDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1696291200"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"recurrence"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"recurrenceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unlimited"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"recurrenceCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"recurrenceEndDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"timezone"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"tzLabel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Etc/GMT"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"tzOffset"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"dstStart"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nl">"clockMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unknown"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"month"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nl">"dayOfMonth"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nl">"dayOfWeek"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"dstEnd"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nl">"clockMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unknown"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"month"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nl">"dayOfMonth"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nl">"dayOfWeek"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"dstAdjust"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"creationTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1696334181"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lastRunTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"nextRunTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1696348800"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"stopTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3233343536373839303133303100000000000000"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h2 id="appendix-e---cg-rollback-from-snapshot-with-minio-single-node-multi-drive">Appendix E - CG rollback from snapshot with MinIO Single-Node Multi-Drive</h2>

<p>This walk-through shows a single MinIO server with multiple E-Series volumes, aka SNMD.</p>

<p>The same would apply to multi-node multi-drive. I’ve blogged about MinIO with E-Series several times, so you can see some of those other posts if you’re interested.</p>

<p>I have 8 LUNs presented to a MinIO server, so my CG has 8 members. I set the limit of snapshots to 4 as I don’t need/want more and don’t want to reserve a lot of capacity for this.</p>

<p><img src="/assets/images/eseries-snapshots-24-minio-cg.png" alt="" /></p>

<p>Stop MinIO, flush IO, create a CG snapshot, start MinIO. This takes just several seconds.</p>

<p><img src="/assets/images/eseries-snapshots-25-minio-cg-snapshot.png" alt="" /></p>

<p>To rollback, the same as earlier, I stop MinIO, unmount the 8 disks and rollback in SANtricity. If the amount of data to roll back was in TBs I could have increased the priority to High or more.</p>

<p><img src="/assets/images/eseries-snapshots-25-minio-cg-rollback.png" alt="" /></p>

<p>Depending on the amount of data, this can take between 1s and many seconds.</p>

<p><img src="/assets/images/eseries-snapshots-26-minio-cg-rollback.png" alt="" /></p>

<p>Remount the volumes, start MinIO.</p>

<p><em>If</em> you nicely shut down MinIO and flushed pending writes, there will be no filesystem “fsck”-style recovery (automatic or manual) required, and no lost objects from MinIO perspective either.</p>

<p>On the other hand, <em>if</em> everything was running and clients were uploading objects when the CG snapshot was taken:</p>

<ul>
  <li>Filesystem would likely have to do some recovery and drop the most recent not fully committed filesystem transactions</li>
  <li>MinIO’s erasure coding <a href="/2023/09/03/minio-erasure-coding-and-netapp-e-series.html">chunks objects across all volumes</a> and would likely lose some objects too (despite EC, as all volumes could potentially lose some transactions - even with EC 6+2, if 3 volumes roll back some filesystem transactions, then MinIO could lose some objects).</li>
</ul>

<p>As MinIO with E-Series can upload <a href="/2022/10/21/minio-performance-netapp-e-series.html">hundreds of objects per second</a>, and OS write buffer is flushed periodically, hundreds of objects could be lost [1].</p>

<p>Generic S3 vendor’s recommendation is to not make backups: replicate objects to another S3 and you’ll be fine! But I know people sometimes need to backup S3 volumes.</p>

<p>Or, if you follow that S3 vendor advice, you can use CG with the replica S3 server: maybe you have a cluster of MinIO servers on Production site, but just one MinIO server connected to E-Series on DR site. If you stop S3 service at the DR site, flush IO, and create a CG snapshot, you can have a perfectly consistent multi-volume snapshot with less than 20 seconds of non-production downtime.</p>

<p>–</p>

<p>[1] Losing 500 of the most recently uploaded objects in some generic Web application isn’t a big deal, as long as PBs of existing S3 data is properly preserved. Secondly, consider the difference between thees two snapshots:</p>
<ul>
  <li>Completely consistent, taken at 1:03 pm</li>
  <li>Crash-consistent, taken at 1:05 pm</li>
</ul>

<p>The former is theoretically “better”, but the latter is more complete and in some cases users want the latter. If you want to avoid the risk of filesystem corruption, it’s better to use the former. If every minute of lost data costs millions, maybe you want the latter (assuming you know filesystem and application recoverability from crash-consistent snapshots is decent).</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
      &nbsp; 
    
      <a href="
      /categories/#automation">automation</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2023/10/29/consistency-group-monitoring-in-eseries.html">Monitor Snapshot Consistency Groups of NetApp E-Series SANtricity OS</a></li>
      
        <li><a href="/2022/12/07/eseries-password-change-powershell.html">PowerShell password change script for local user account on E-Series SANtricity OS</a></li>
      
        <li><a href="/2022/09/12/new-ddp-and-e-series-santricity-web-restful-api.html">New Dynamic Disk Pool configuration and E-Series SANtricity</a></li>
      
        <li><a href="/2023/04/01/using-solidfire-snapshot-attributes.html">Using snapshot attributes in SolidFire</a></li>
      
        <li><a href="/2023/08/30/monitoring-solidfire-clone-and-backup-jobs.html">Use SolidFire API to monitor clone and backup jobs for profit and pleasure</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-05-20 15:31 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
