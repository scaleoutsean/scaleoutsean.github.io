<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Like Flask, but with PowerShell | Acting Technologist
      
    </title>
    <meta name="description" content="
     Use PowerShell like Flask
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Like Flask, but with PowerShell | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Like Flask, but with PowerShell" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en" />
<meta name="description" content="Use PowerShell like Flask" />
<meta property="og:description" content="Use PowerShell like Flask" />
<link rel="canonical" href="https://scaleoutsean.github.io/2023/01/17/automation-with-powershell-server.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2023/01/17/automation-with-powershell-server.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-01-17T00:00:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2023/01/17/automation-with-powershell-server.html"},"author":{"@type":"Person","name":"scaleoutSean"},"description":"Use PowerShell like Flask","@type":"BlogPosting","url":"https://scaleoutsean.github.io/2023/01/17/automation-with-powershell-server.html","headline":"Like Flask, but with PowerShell","dateModified":"2023-01-17T00:00:00+08:00","datePublished":"2023-01-17T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Like Flask, but with PowerShell</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>17 Jan 2023</span> - <i class="far fa-clock"></i> 


  
  
    7 minute read
  

    </span>
  </div>
  
        <ul>
  <li><a href="#powershell-still-rocks">PowerShell (still) rocks</a></li>
  <li><a href="#powershell-based-services">PowerShell-based services</a></li>
  <li><a href="#some-ideas-and-use-cases">Some ideas and use cases</a>
    <ul>
      <li><a href="#de-skill-kubernetes-operations">De-skill Kubernetes operations</a></li>
      <li><a href="#provide-rbac-to-powershell-automation">Provide RBAC to PowerShell automation</a></li>
      <li><a href="#improve-logging-and-monitoring">Improve logging and monitoring</a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<h2 id="powershell-still-rocks">PowerShell (still) rocks</h2>

<p>I haven’t written (and won’t write) a “2022 in review” kind of post, but I did think about it.</p>

<p>One of the topics I wanted to write about is PowerShell.</p>

<p>Every year I’m consistently shocked how people don’t use PowerShell. 2022 was <a href="https://survey.stackoverflow.co/2022/#technology-most-loved-dreaded-and-wanted">no exception</a>.</p>

<p>At the same time this is a good example of why you should never fully rely on surveys and polls. As they say: trust, but verify.</p>

<p>I verified it years ago, and found that I shouldn’t trust the majority. What helped me is the best storage I’ve worked with - SolidFire - has great PowerShell integration. PowerShell is great!</p>

<p>What prompted me to write about this today is I recently played with PowerShell-based Web and API service.</p>

<h2 id="powershell-based-services">PowerShell-based services</h2>

<p>Services allow us to serve Web content, but also RESTful or JSON-RPC APIs. Of course, I’m talking about PowerShell-powered Web services.</p>

<p>Yeah, yeah, I hear you - you can do that in Flask in five minutes. So can I.</p>

<p>But with PowerShell we can do it more “natively” on Windows, and we can do it quite well on Linux as well.</p>

<p>This isn’t to say Flask or Python suck, but that in some cases PowerShell based dynamic Web or API is just as good, and sometimes can be better.</p>

<p>To clarify: the client can be a Python app, PowerShell script, Go program (API) or any Web browser (Web apps).</p>

<p>It is only the API/Web site that runs PowerShell.</p>

<p>The advantages are if you like PowerShell you can build server-side apps, and the same PowerShell scripts that you could run locally may be able to run on the server - it’s a bit like server-rendered JavaScript, just with PowerShell.</p>

<p>PowerShell Web/API services also remind me a little of Jupyter. The Jupyter home page says “Think HTML and CSS for interactive computing on the web”, after all. I built a .NET-based Jupyter notebook demo in early 2022, so I’m not making random comparisons here!</p>

<h2 id="some-ideas-and-use-cases">Some ideas and use cases</h2>

<p>I haven’t created any toy applications yet - so far I’ve been only exploring. Below are my early thoughts and ideas.</p>

<h3 id="de-skill-kubernetes-operations">De-skill Kubernetes operations</h3>

<p>Back in 2021 I created (but never published - most Kubernetes users don’t feel comfortable straying away from distribution-provided management tools) a PowerShell module that simplified Kubernetes storage failover, so I thought about building a Web UI or API for that.</p>

<p>In this very basic example the PowerShell API server returns information about Kubelet and SolidFire version.</p>

<p><img src="/assets/images/powershell-api-server.png" alt="PowerShell RESTful API&quot;" /></p>

<p>It’s pretty incredible, but this is all it took to return that SolidFire version information:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$sf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Connect-SFCluster</span><span class="w"> </span><span class="nx">192.168.105.32</span><span class="w"> </span><span class="nt">-Username</span><span class="w"> </span><span class="nx">monitor</span><span class="w"> </span><span class="nt">-Password</span><span class="w"> </span><span class="o">*****</span><span class="p">)</span><span class="o">.</span><span class="nf">VersionApiNumber</span><span class="w">
</span><span class="nx">Write-PodeJsonResponse</span><span class="w"> </span><span class="nt">-Value</span><span class="w"> </span><span class="p">@{</span><span class="w"> </span><span class="s1">'kubelet'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$kubelet</span><span class="p">;</span><span class="w"> </span><span class="s1">'solidfire'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$sf</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>I’d need to load those PowerShell modules for Trident and storage failover and create a few Web page with two big buttons (“PROD” and “DR”) to make Kubernetes storage failover work across sites. (You can see in that Kubernetes storage failover post and demo videos, storage failover took 10 seconds and failback less than a minute.)</p>

<h3 id="provide-rbac-to-powershell-automation">Provide RBAC to PowerShell automation</h3>

<p>Another use case is to enrich existing APIs. For example, SolidFire never built a good RBAC.</p>

<p>If you don’t expose your SolidFire API to the Internet (and most people don’t), it’s easy to use PowerShell to build an API proxy server to enrich back-end API and provide RBAC that allows application users to directly manage volumes that belong to them.</p>

<p>What could that possibly be, when everything is managed by vCenter plugin or Kubernetes? Volume backup to S3, for example.</p>

<p>Or storage QoS modifications: let’s assume your team’s budget is 100K IOPS, and as person of charge of storage I don’t care how you distribute them. I watch your aggregate IOPS in Elasticsearch, and alert when a team is over 100K across all volumes.</p>

<p>I still need to trust that you won’t do 200K, but that can be fixed quickly and I can disable users who consistently make mistakes.</p>

<p>Last year I created an example of RBAC for SolidFire with Ansible. If you’re not a fan of Ansible, you could do the same with PowerShell.</p>

<p>Here’s an example I was playing with yesterday:</p>

<ul>
  <li>PowerShell API server accepts whitelisted SolidFire API calls. That could be backup to S3, cloning or even something that I have in server-side scripts that the SolidFire API does not have.</li>
  <li>My simple API client is Postman, and from there I issue PUT requests to PowerShell server (which happens to run on Linux, by the way)</li>
  <li>On the server, I perform simple transformations, run some tasks, and send a response to the client</li>
</ul>

<p>Postman request (this is SolidFire’s CreateVolume API):</p>

<p><img src="/assets/images/powershell-web-api-server.png" alt="PowerShell JSON-RPC API" /></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">52</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CreateVolume"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"accountID"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"totalSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">2000000000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"enable512e"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"qos"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"minIOPS"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
      </span><span class="nl">"maxIOPS"</span><span class="p">:</span><span class="w"> </span><span class="mi">1500</span><span class="p">,</span><span class="w">
      </span><span class="nl">"burstIOPS"</span><span class="p">:</span><span class="w"> </span><span class="mi">1505</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>PowerShell server’s response doesn’t pass it on to SolidFire (I didn’t get that far) but does something with it locally and returns a JSON response to Postman:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$WebEvent</span><span class="o">.</span><span class="nf">Data</span><span class="w">
</span><span class="nv">$name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">$WebEvent</span><span class="o">.</span><span class="nf">Data</span><span class="o">.</span><span class="nf">params</span><span class="o">.</span><span class="nf">name</span><span class="w">
</span><span class="nv">$size</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">$WebEvent</span><span class="o">.</span><span class="nf">Data</span><span class="o">.</span><span class="nf">params</span><span class="o">.</span><span class="nf">totalSize</span><span class="w">
</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Size value in XML:"</span><span class="p">,</span><span class="w"> </span><span class="nv">$request</span><span class="o">.</span><span class="nf">params</span><span class="o">.</span><span class="nf">totalSize</span><span class="w">
</span><span class="nx">Write-PodeJsonResponse</span><span class="w"> </span><span class="nt">-Value</span><span class="w"> </span><span class="p">@{</span><span class="w">
    </span><span class="nx">guruSez</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yo man this crazy"</span><span class="w">
    </span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$request</span><span class="err">.</span><span class="nx">method</span><span class="w">
    </span><span class="nx">volumeName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$name</span><span class="w">
    </span><span class="nx">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$size</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Because authentication and authorization can be easily added to the server, we can whitelist certain operations for certain user accounts on the PowerShell server.</p>

<p>Apart from exposing this to application oweners through a simple Web (or API), another use case is building a UI or API for existing PowerShell scripts used by administrators. Same scripts, but in the Web UI. And some charts, reports and output can be exposed in read-only manner to application owners without having to:</p>

<ul>
  <li>build complicated apps,</li>
  <li>allow direct access to SolidFire API endpoint,</li>
  <li>load more data to Splunk when it has no long term value</li>
</ul>

<h3 id="improve-logging-and-monitoring">Improve logging and monitoring</h3>

<p>Logging and monitoring is another interesting use case.</p>

<p>I sometimes write simple scripts to automate repetitive operations.</p>

<p>They’re usually hacky - no error handling, no logging, no monitoring. Because let’s be real - it’s not easy to do that right in Bash, and it’s not much easier in Python either.</p>

<p>PowerShell not only makes it easy to create reasonably “professional” scripts, but with a small amount of effort those scripts can be converted to a PowerShell Web app or API without introducing another language (JavaScript).</p>

<p>We can easily show logs in the Web page or console. This example shows how PowerShell server logs just one selected value (the size of CreateVolume request from the larger screenshot above). In the use case with storage QoS quota, we could show the total IOPS granted to an account, either in the API server log or in a Web page report served by the same server.</p>

<p>PowerShell JSON-RPC API log</p>

<p><img src="/assets/images/powershell-api-server-log.png" alt="PowerShell JSON-RPC API log" /></p>

<p>Maybe you think that’s trivial. Yes, it’s not rocket science, but how many people actually create those trivial scripts and applications?</p>

<p>There aren’t many out there and even when they’re available, relatively few users create and use Bash or Python scripts in production. I know Ansible and have written playbooks for personal use, but apart from one apt-get playbook which I use on a regular basis, I can’t say I’m a big fan of writing, using or maintaining Ansible.</p>

<h2 id="conclusion">Conclusion</h2>

<p>PowerShell is (still) great and getting better even though most technical people don’t realize that.</p>

<p>Personally I don’t have much need for PowerShell-based home API services, so I may or may not prototype PowerShell APIs without real-life opportunities that need it.</p>

<p>But I will migrate some of my crappiest Bash scripts to PowerShell and send output (log) to centralized logging service (Elasticsearch, for example) - that’s what I could use at home, and that’s what some customers I know may want to do for their PowerShell scripts.</p>


      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#automation">automation</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2021/02/05/get-solidfire-volume-efficiency-with-powershell.html">Use SolidFire PowerShell Tools to find low efficiency volumes</a></li>
      
        <li><a href="/2023/07/31/solidfire-web-management-api-behind-proxy.html">SolidFire management Web site and API endpoint behind a proxy</a></li>
      
        <li><a href="/2023/04/01/using-solidfire-snapshot-attributes.html">Using snapshot attributes in SolidFire</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2025-06-07 17:27 </p>
    <p>Copyright © 2025 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
