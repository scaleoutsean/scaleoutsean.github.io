<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Use cases for AWS mountpoint-s3 with NetApp E-Series and SolidFire | Acting Technologist
      
    </title>
    <meta name="description" content="
     Some use cases for AWS mountpoint-s3 with NetApp E-Series and SolidFire
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Use cases for AWS mountpoint-s3 with NetApp E-Series and SolidFire | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Use cases for AWS mountpoint-s3 with NetApp E-Series and SolidFire" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en" />
<meta name="description" content="Some use cases for AWS mountpoint-s3 with NetApp E-Series and SolidFire" />
<meta property="og:description" content="Some use cases for AWS mountpoint-s3 with NetApp E-Series and SolidFire" />
<link rel="canonical" href="https://scaleoutsean.github.io/2023/03/16/aws-mountpoint-s3-eseries-solidfire.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2023/03/16/aws-mountpoint-s3-eseries-solidfire.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-16T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Use cases for AWS mountpoint-s3 with NetApp E-Series and SolidFire","dateModified":"2023-03-16T00:00:00+08:00","datePublished":"2023-03-16T00:00:00+08:00","url":"https://scaleoutsean.github.io/2023/03/16/aws-mountpoint-s3-eseries-solidfire.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2023/03/16/aws-mountpoint-s3-eseries-solidfire.html"},"description":"Some use cases for AWS mountpoint-s3 with NetApp E-Series and SolidFire","author":{"@type":"Person","name":"scaleoutSean"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Use cases for AWS mountpoint-s3 with NetApp E-Series and SolidFire</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>16 Mar 2023</span> - <i class="far fa-clock"></i> 


  
  
    5 minute read
  

    </span>
  </div>
  
        <ul>
  <li><a href="#aws-mountpoint-s3">AWS mountpoint-s3</a></li>
  <li><a href="#deploy">Deploy</a></li>
  <li><a href="#use-cases-for-e-series-and-solidfire">Use cases for E-Series and SolidFire</a>
    <ul>
      <li><a href="#s3-bucket-as-backup-mountpoint">S3 bucket as backup mountpoint</a>
        <ul>
          <li><a href="#sub-bucket-allocation">Sub-bucket allocation</a></li>
          <li><a href="#mountpoint-s3-vs-application-native-backup-to-s3">mountpoint-s3 vs application-native backup to S3</a></li>
        </ul>
      </li>
      <li><a href="#e-series-as-s3-storage">E-Series as S3 storage</a></li>
      <li><a href="#data-sharing-with-single-host-filesystem">Data sharing with single-host filesystem</a></li>
      <li><a href="#analytics">Analytics</a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<h2 id="aws-mountpoint-s3">AWS mountpoint-s3</h2>

<p><a href="https://github.com/awslabs/mountpoint-s3">AWS mountpoint-s3</a> lets us mount S3 bucket or its path to a Linux mount point, while supporting a subset of POSIX.</p>

<p>The idea (I guess) is to support sequential IO to eliminate the challenges, excessive chatter and small IO that occurs when a more complete POSIX support is possible and used with small files (or generic workloads).</p>

<p>Currently even plain writes aren’t supported but they will be soon, so I write this post as if writes and reads were both supported.</p>

<h2 id="deploy">Deploy</h2>

<p>Follow instructions from the README.md and deploy.</p>

<p>Once mountpoint-s3 is up and running, client(s) running mounpoint-S3 can read S3 bucket data at high speed. Soon writes will be possible as well.</p>

<p><img src="/assets/images/aws-mountpoint-s3-01-working.png" alt="AWS mountpoint-S3 on Rocky Linux 8" /></p>

<p>What can we do with this?</p>

<h2 id="use-cases-for-e-series-and-solidfire">Use cases for E-Series and SolidFire</h2>

<p>NetApp StorageGRID is NetApp’s main S3 solution, but ONTAP supports it as well. These could be backing object stores for mountpoint-s3, but this post isn’t about that - it’s about use cases for mountpoint-s3 with E-Series and SolidFire.</p>

<p>Here are some use cases I have in mind for mountpoint-s3.</p>

<h3 id="s3-bucket-as-backup-mountpoint">S3 bucket as backup mountpoint</h3>

<p>First, we’d create a bucket and apply desired ACLs. For example, we could only allow write and list operations to specific set of S3 keys, so that the user posting data cannot delete it. Restores would be done by a different account (or the same, but it’d require read permissions as well).</p>

<p>On SolidFire client we mount S3 just like in that screenshot above, and now we can dump backups to /mnt/backup.</p>

<p>Because mountpoint-s3 is supposed to excel and such workloads (sequential writes), we should be able to backup much faster - possibly at several GB/s - than by using SolidFire’s “Backup to S3” API.</p>

<p>If we assume that QoS on the SolidFire volume would be adjusted just in time before scheduled backup, and be left in place for its duration, we could read at 500 MB/s and it’d take less than 9 hours to backup a 16 TB database. Not too bad!</p>

<p>In fact we’d need that much time only the first time around, or maybe once a week, while the rest could be incremental, executed every 15 minutes (log archiving for PostgreSQL, for example).</p>

<p>Another, useful distinction compared to SolidFire’s “Backup to S3” feature is that “Backup to S3” uses SolidFire’s management network (as observed <a href="/2021/05/19/solidfire-exporter-monitor-solidfire-network-interfaces-with-prometheus-and-grafana.html">here</a>), which can be a problem due to policies and/or network layout. Mountpoint-s3, on the other hand, connects to S3 bucket based on Linux client’s routing table which is much more flexible.</p>

<p>We should also recall that SolidFire’s “Backup to S3” backs up (and can restore) only an entire SolidFire volume, whereas application-based backup/restore works with application data.</p>

<h4 id="sub-bucket-allocation">Sub-bucket allocation</h4>

<p>On S3, we can allocate one bucket per VM (or workload) or per user. But it can be more granular.</p>

<p>If ACLs are set to protect paths to each workload, so that credentials1 can access only backup-bucket/vm1, it’s not necessary to provision too many buckets.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>backup-bucket/vm1
backup-bucket/vm2
</code></pre></div></div>

<p>But one has to watch out for typos and mistakes when creating ACLs.</p>

<h4 id="mountpoint-s3-vs-application-native-backup-to-s3">mountpoint-s3 vs application-native backup to S3</h4>

<p>If our application can backup to S3, we can eliminate the overhead of mountpoint-s3 and backup/restore directly to/from S3.</p>

<p>But not all applications can do that. It is also simpler to dump DB or tar a directory to /mnt/backup than install and update S3 CLI, especially since mountpoint-s3 can be managed by root, while backup/restore to a mountpoint-s3 path can be performed by a non-root user who doesn’t need to have access to S3 credentials.</p>

<h3 id="e-series-as-s3-storage">E-Series as S3 storage</h3>

<p>From <a href="/2022/10/21/minio-performance-netapp-e-series.html">this simple test</a> I did with MinIO on E-Series EF570 I know a single VM instance of MinIO can write at multiple GB/s, so it’s a very affordable way to create a backup repo using NL-SAS storage (using E2800, for example) and a VM.</p>

<h3 id="data-sharing-with-single-host-filesystem">Data sharing with single-host filesystem</h3>

<p>This is a bit speculative (mountpoint-s3 is in alpha), but I expect it to work.</p>

<p>With several Linux VMs or containers connected to E-Series, as data is ingested to multiple Linux hosts with ext4 or XFS, it can be moved to mountpoint-s3 and become visible to external S3 clients.</p>

<p>Since no modifications to files are allowed via mountpoint-s3, users can analyze S3 data by reading data directly from S3 (without using mountpoint-s3).</p>

<p>Using the same approach, any S3 client can be configured to synchronize or replicate data from this bucket to other locations.</p>

<p>One example of such a use case is AI in hybrid cloud environments. We may create <a href="/2024/01/10/ai-deep-learning-pytorch-checkpointing-eseries.html">checkpoints</a> on-premises and read them from any location from which we want to continue computation.</p>

<h3 id="analytics">Analytics</h3>

<p>Mountpoint-s3 read performance can be over 5 GB/s.</p>

<p>Individual SolidFire volumes can provide read performance up to few hundred MB/s (which is why my earlier estimate for taking a backup of a 16 TB volume is (16000 GB / 0.5 GB) seconds). Short of applying tricks (such as using LVM), certain read analytics can be sped up by 10x by moving data to S3 mountpoint and analyzing it that way.</p>

<p>We could access S3 data at a local filesystem mountpoint, but if our application can work with S3, we could read it directly without mountpoint S3 (see <a href="/2022/03/10/s3-select-vs-remote-csv-over-fuse.html">this</a> example). We could also read it from multiple hosts at once, scaling performance on the client side.</p>

<p>E-Series has a much faster single volume performance compared to SolidFire, so this approach would be less interesting, but there are still scenarios in which we’d use the same approach. Mostly it’s related to the ability to access S3 bucket natively from multiple S3 clients at the same time, eliminating the need to configure other ways of multi-client data sharing such as NFS.</p>

<h2 id="conclusion">Conclusion</h2>

<p>AWS mountpoint-s3 makes it easier to make indirect use S3 for special sequential workloads.</p>

<p>Mounting S3 buckets as local devices isn’t new, but mountpoint-s3 is focused on specific workloads (sequential write-once, read-many) and should be less buggy and perform better than general approaches.</p>

<p>Application-integrated backup utilities and log archiving, as well as various analytics tools look like interesting use cases for mountpoint-s3.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#kubernetes">kubernetes</a>
      &nbsp; 
    
      <a href="
      /categories/#storage">storage</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2023/02/25/elasticsearch-eseries-performance.html">Elasticsearch performance with E-Series</a></li>
      
        <li><a href="/2023/02/10/backup-epa-data-on-kubernetes.html">Backup and restore E-Series Performance Analyzer with Kasten K10</a></li>
      
        <li><a href="/2023/02/09/veeam-eseries-nfs-storage-provider.html">Store Kasten backups on NetApp E-Series</a></li>
      
        <li><a href="/2023/02/12/backup-restore-kubevirt-vms-with-solidfire-kasten-kubernetes.html">KubeVirt backup, restore with NetApp SolidFire & Kasten K10</a></li>
      
        <li><a href="/2023/02/27/group-multi-volume-backup-solidfire-kubernetes-trident.html">Protect multi-volume Kubernetes applications with NetApp Trident and SolidFire</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-05-31 19:45 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
