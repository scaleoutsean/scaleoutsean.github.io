<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Event monitoring with SNMP trap notifications from NetApp E-Series arrays | Acting Technologist
      
    </title>
    <meta name="description" content="
     Deep dive on SNMP traps from NetApp E-Series systems and other event monitoring methods
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Event monitoring with SNMP trap notifications from NetApp E-Series arrays | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Event monitoring with SNMP trap notifications from NetApp E-Series arrays" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en" />
<meta name="description" content="Deep dive on SNMP traps from NetApp E-Series systems and other event monitoring methods" />
<meta property="og:description" content="Deep dive on SNMP traps from NetApp E-Series systems and other event monitoring methods" />
<link rel="canonical" href="https://scaleoutsean.github.io/2023/09/17/netapp-e-series-snmp-trap-notifications.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2023/09/17/netapp-e-series-snmp-trap-notifications.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-09-17T00:00:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2023/09/17/netapp-e-series-snmp-trap-notifications.html"},"author":{"@type":"Person","name":"scaleoutSean"},"description":"Deep dive on SNMP traps from NetApp E-Series systems and other event monitoring methods","@type":"BlogPosting","url":"https://scaleoutsean.github.io/2023/09/17/netapp-e-series-snmp-trap-notifications.html","headline":"Event monitoring with SNMP trap notifications from NetApp E-Series arrays","dateModified":"2023-09-17T00:00:00+08:00","datePublished":"2023-09-17T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Event monitoring with SNMP trap notifications from NetApp E-Series arrays</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>17 Sep 2023</span> - <i class="far fa-clock"></i> 


  
  
    20 minute read
  

    </span>
  </div>
  
        <ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#configure-snmp-trap-destination-in-santricity-os">Configure SNMP trap destination in SANtricity OS</a></li>
  <li><a href="#get-e-series-mib-files-and-oid">Get E-Series MIB files and OID</a></li>
  <li><a href="#santricity-snmp-walk">SANtricity SNMP walk</a></li>
  <li><a href="#santricity-snmp-traps-and-trap-examples">SANtricity SNMP traps and trap examples</a>
    <ul>
      <li><a href="#e-series-specific-sm10-r3-mib-and-es-netapp">E-Series-specific SM10-R3-MIB and ES-NETAPP</a></li>
      <li><a href="#generic">Generic</a></li>
    </ul>
  </li>
  <li><a href="#other-approaches-to-delivering-notifications-to-snmp-trap-destinations">Other approaches to delivering notifications to SNMP trap destinations</a></li>
  <li><a href="#forwarding-notifications-to-other-snmp-and-non-snmp-destinations">Forwarding notifications to other SNMP and non-SNMP destinations</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#appendix-a---e-series-mel-codes-aka-storage-system-event-types">Appendix A - E-Series MEL Codes aka Storage System Event Types</a></li>
  <li><a href="#appendix-b---need-attention-situation-example">Appendix B - Need Attention situation example</a></li>
  <li><a href="#appendix-c---trap-handling-script-example">Appendix C - Trap handling script example</a></li>
  <li><a href="#appendix-d---centreon-with-e-series">Appendix D - Centreon with E-Series</a></li>
</ul>

<p><strong>NOTE</strong>: Fake “security researchers”, please be noted that credentials and/or passwords in this post are not real.</p>

<h2 id="introduction">Introduction</h2>

<p>One would think that after a decade or two on market, there would be at least one good page with detailed, practical information on this topic.</p>

<p>In fact, today ChatGPT 4 should be perfectly capable of writing a high-quality technical blog post about this, with configuration examples, commands and whatnot.</p>

<p>Right? Wrong.</p>

<p>Anyway, let’s focus on our topic.</p>

<h2 id="configure-snmp-trap-destination-in-santricity-os">Configure SNMP trap destination in SANtricity OS</h2>

<p>Configure an SNMP trap destination and test it. I’m using SNMP v2, so I have no need to authenticate.</p>

<p><img src="/assets/images/eseries-snmpdtrap-01-test-trap.png" alt="Configure SNMP trap recipient" /></p>

<p>Destinations should have a functioning SNMP trap service that listens for incoming traps and isn’t blocked by firewall rules.</p>

<p>In cases like these, always make sure receiving service is working correctly <em>without</em> E-Series.</p>

<p>Here’s how the alert is looks like in the now-latest SANtricity v11.80:</p>

<p><img src="/assets/images/eseries-snmpdtrap-02-tail-log.png" alt="Test result" /></p>

<p>It’s a generic trap that only shows that E-Series can send traps to your trap destination. Remember to open firewall to E-Series’ IP address.</p>

<p>We need to find more about how SANtricity SNMP traps look like.</p>

<h2 id="get-e-series-mib-files-and-oid">Get E-Series MIB files and OID</h2>

<p>Only one MIB file has to be downloaded.</p>

<ul>
  <li>NetApp E-Series MIBs:
    <ul>
      <li><strong>SM10-R3-MIB</strong>: this SM10-R3-MIB is already included in Linux MIB collections</li>
      <li><strong>ES-NETAPP</strong>: this one you download from SANtricity OS download page. There are several versions of the file</li>
    </ul>
  </li>
  <li>NetApp E-Series OID: <strong><code class="language-plaintext highlighter-rouge">1.3.6.1.4.1.789.1123.1</code></strong> which translates to <strong><code class="language-plaintext highlighter-rouge">.iso.org.dod.internet.private.enterprises.netapp.eSeriesStorageSystem</code></strong></li>
</ul>

<p>You don’t need to “get” OID as such, but you need it to make sure OID translation works which also indicates MIBs can be loaded.</p>

<p>Why are there two MIBs? Who the heck knows. My take:</p>

<ul>
  <li>Generic SM10-R3-MIB - 1.3.6.1.4.1.789.1123.1.500.0 - SM10R3 base MIB</li>
  <li>Array-specific ES-NETAPP MIB - 1.3.6.1.4.1.789.1123.1.[1,2] - MIB specific to storage manager (1) and storage server (2)</li>
</ul>

<p>The next question is…</p>

<h2 id="santricity-snmp-walk">SANtricity SNMP walk</h2>

<p>What can I get by querying E-Series SNMP?</p>

<p>Almost nothing.</p>

<p>If SANtricity’s SNMP service is enabled and reachable, you’d at most get something like this (example for EF-Series EF-570):</p>

<pre><code class="language-raw">enterprises.789.1123.2.500.1.1.0 = STRING: "R25U14E5700"
enterprises.789.1123.2.500.1.2.0 = STRING: "600a098000f63714000000005eaabbccc"
enterprises.789.1123.2.500.1.3.0 = STRING: "122222A66666   "
enterprises.789.1123.2.500.1.4.0 = STRING: "NETAPP  "
enterprises.789.1123.2.500.1.5.0 = STRING: "INF-01-00       "
enterprises.789.1123.2.500.1.6.0 = STRING: "5700"
enterprises.789.1123.2.500.1.7.0 = INTEGER: 0
</code></pre>

<p>That’s a “storageServer” object. It gives us the basic details of the array: system name (R25U14E5700), WWID, chassis serial number, vendor, product (INF-01-00; you may have seen this in Linux multipath configuration files), model (5700; EF-570 which I used here is an all-flash version of E-5700).</p>

<ul>
  <li><strong>ssStorageArrayName</strong> (500.1.1.0) - storage array name for the reporting device</li>
  <li><strong>ssStorageArrayWWID</strong> (500.1.2.0) - world wide identifier (WWID) for the reporting device</li>
  <li><strong>ssChassisSerialNumber</strong> (500.1.3.0) - Storage Array Chassis Serial Number for the reporting device</li>
  <li><strong>ssVendorID</strong> (500.1.4.0) - vendor identifier</li>
  <li><strong>ssProductID</strong> (500.1.5.0) - product identifier</li>
  <li><strong>ssModelName</strong> (500.1.6.0) - vendor defined model</li>
  <li><strong>ssStorageArrayNeedsAttention</strong> (500.1.7.0) - summary of the operational status of the reporting device (0 - Optimal, 1 - Needs Attention)</li>
</ul>

<p>So this is not <em>entirely</em> useless - it can be used to create hardware inventory lists and such, and parts of it are included in traps. Also, notice the last <code class="language-plaintext highlighter-rouge">0</code> in the output above: that means current status is optimal, so that’s a very minimalist way to find out if an array needs attention.</p>

<p>Some of these variables will appear in traps as well. You can override some of them with custom strings in “Configure SNMP MIB Variables” (right-most button in the blue tab of the second screenshot above), as per the SANtricity documentation.</p>

<p>Here’s what can be changed:</p>

<p><img src="/assets/images/eseries-snmpdtrap-03-customize-snmp-vars.png" alt="" /></p>

<p>And here’s where it’s done in SANtricity 11.80: Support &gt; Support Resources &gt; Storage Array Profile.</p>

<p><img src="/assets/images/eseries-snmpdtrap-04-customize-snmp-menu.png" alt="" /></p>

<p>What else is out there if we can’t use SNMP walk?</p>

<ul>
  <li>Syslog forwarding (plus some DIY parsing): last tab in top row of the first screenshot is where we can configure Syslog (forwarding). The challenge here is figuring out what strings there may be in logs, and how to set rules that let us act on the important ones and ignore everything else. I haven’t looked into this yet (and by “this” I mean checking whether events can be easily extracted from syslog so that we can easily put that information to use)</li>
  <li>SANtricity API - see <a href="/2022/12/13/eseries-santricity-mel-forwarding.html">this article about MEL</a> alerts. This is more straightforward. I’ve also found <a href="https://github.com/centreon/centreon-plugins/blob/develop/src/storage/netapp/santricity/restapi/mode/hardware.pm">this</a> Perl (!) plugin that uses the SANtricity API to check E-Series hardware (see examples in Appendix D). It can be modified to send information to other event monitoring systems and works out of the box for Icinga and Nagios. Finally, there’s a Prometheus Exporter for SANtricity (see this blog’s archive) that requires SANtricity Web Services Proxy so it may not be acceptable to some and covers only performance metrics (not events).</li>
</ul>

<p>Next, let’s take a look at E-Series’ SNMP traps.</p>

<h2 id="santricity-snmp-traps-and-trap-examples">SANtricity SNMP traps and trap examples</h2>

<p>I am not sure as I haven’t seen enough SNMP trap daemon logs, but it appears these uptime entries are always included in all notifications. Annoying.</p>

<pre><code class="language-raw">DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (87851800) 10 days
</code></pre>

<h3 id="e-series-specific-sm10-r3-mib-and-es-netapp">E-Series-specific SM10-R3-MIB and ES-NETAPP</h3>

<p>The deviceErrorCode SM10-R3-MIB should be the same as the MEL event number (see the MEL article above or the official docs and KB).</p>

<pre><code class="language-raw">deviceErrorCode OBJECT-TYPE
    SYNTAX DisplayString (SIZE (0..19))
    MAX-ACCESS read-only
    STATUS current
    DESCRIPTION
        "The error code as reported by the device or host."
        ::= { infoEntry 5 }
</code></pre>

<p>SM10-R3-MIB traps themselves contain that code. MEL event number (deviceErrorCode) should be contained in storageArrayCritical (1.3.6.1.4.1.789.1123.1.500.0.2) notification:</p>

<pre><code class="language-raw">storageArrayCritical NOTIFICATION-TYPE
    OBJECTS { 
               deviceHostIPType, 
               deviceHostIPAddr, 
               deviceHostName, 
               deviceUserLabel, 
               deviceErrorCode, 
               eventTime, 
               trapDescription, 
               componentType, 
               componentLocation 
            }
    STATUS current
    DESCRIPTION
        "This trap indicates an event where user-interaction is required immediately.
        Some example events are component failures or critical errors."
        ::= { sm10R3TrapBase 2 }
</code></pre>

<p>The second MIB is ES-NETAPP MIB. ES-NETAPP-06-MIB is the MIB file I used for EF-570. Other arrays may have other MIBs.</p>

<p>One of its interesting variables is ssStorageArrayNeedsAttention:</p>

<pre><code class="language-raw">ssStorageArrayNeedsAttention OBJECT-TYPE
    SYNTAX Integer32
    MAX-ACCESS read-only
    STATUS current
    DESCRIPTION
        "Summary of the operational status of the reporting device. (0 - Optimal, 1 - Needs Attention)"
        ::= { ss01R1InfoBase 7 }
</code></pre>

<p>Among notifications, ssStorageArrayAlert is interesting.</p>

<pre><code class="language-raw">ssStorageArrayAlert NOTIFICATION-TYPE
    OBJECTS {
                ssNetworkNodeName,
                ssStorageArrayName,
                ssEventType,
                ssEventTime,
                ssEventDescription,
                ssEventComponentType,
                ssEventComponentLocation,
                ssEventPriority,
                ssStorageArrayWWID,
                ssChassisSerialNumber
            }
    STATUS current
    DESCRIPTION
	    "The reporting device has detected a failure and immediate user-interaction is required."
        ::= { ss01R1TrapBase 2 }
</code></pre>

<p>I didn’t have physical access to E-Series so I had to do various things in the UI in an attempt to get some alerts sent my way.</p>

<p>Placing a controller offline results in Critical severity (SNMPv2-SMI::enterprises.789.1123.2.500.2.7), so that is something we could filter and alert on if that’s a match (“Critical”, maybe “Warning” or what have you), raise an alert and send email notifications.</p>

<p>We can see the second line is storageArrayCritical (SNMPv2-SMI::enterprises.789.1123.1.500.0.2) explained above for SM10-R3-MIB. That’s followed by the first three items from storage server object (500.1.[1-3]).</p>

<pre><code class="language-raw">SNMPv2-MIB::snmpTrapOID.0 = OID: 
SNMPv2-SMI::enterprises.789.1123.2.500.0.2
SNMPv2-SMI::enterprises.789.1123.2.500.1.1 = STRING: "R25U14E5700"
SNMPv2-SMI::enterprises.789.1123.2.500.1.2 = STRING: "600a098000f63714000000005eaabbccc"
SNMPv2-SMI::enterprises.789.1123.2.500.1.3 = STRING: "122222A66666   "
SNMPv2-SMI::enterprises.789.1123.2.500.2.1 = STRING: "5005"   
SNMPv2-SMI::enterprises.789.1123.2.500.2.2 = STRING: "09/16/2023 15:09:56"
SNMPv2-SMI::enterprises.789.1123.2.500.2.3 = STRING: "Place controller offline"
SNMPv2-SMI::enterprises.789.1123.2.500.2.4 = STRING: "wan0"
SNMPv2-SMI::enterprises.789.1123.2.500.2.5 = STRING: "Controller"
SNMPv2-SMI::enterprises.789.1123.2.500.2.6 = STRING: "Not Available"
SNMPv2-SMI::enterprises.789.1123.2.500.2.7 = STRING: "Critical"
</code></pre>

<p>The last seven (enterprises.789.1123.2.500.2.[1-7]) entries:</p>

<ul>
  <li><strong>ssEventType</strong> (.500.2.1) - enumerated value corresponding to the error detected by the reporting device. As you recall from earlier in this post, this corresponds to MEL code</li>
  <li><strong>ssEventTime</strong> (.500.2.2) - the date-time string (MM/DD/YYYY HH:MM:SS) at which the error event occurred on the reporting device</li>
  <li><strong>ssEventDescription</strong> (.500.2.3) - string describing the nature of the error that occurred on the reporting device</li>
  <li><strong>ssNetworkNodeName</strong> (.500.2.4) - the network name of the reporting device</li>
  <li><strong>ssEventComponentType</strong> (.500.2.5) - string identifying the type of component that the reporting device detected as failed; based on a MEL catalogue, I think this may include Controller, Volume, Battery Pack, Cache Backup Device, Consistency Group, Consistency Group Snapshot Volume, Snapshot Image, etc.)</li>
  <li><strong>ssEventComponentLocation</strong> (.500.2.6) - string identifying the physical location of the failed component detected by the reporting device</li>
  <li><strong>ssEventPriority</strong> (.500.2.7) - string identifying the priority of the error that occurred on the reporting device</li>
</ul>

<p>Original entries weren’t sorted and formatted, by the way. The log entry looked more like that screenshot with a test trap.</p>

<p>In summary, if you can’t implement some fine-grained rules, simply create alerts on enterprises.789.1123.2.500.2.7=”Critical”.</p>

<p>As a more educated version of that, pull cables, controllers, and disks (one thing at a time, with 2 min in between each action!) before entering production to find out what other logs that generates, and refine your approach.</p>

<p>“Needs attention” is <strong>cleared</strong> (enterprises.789.1123.2.500.1.7=<strong>0</strong>) if the condition that caused it is resolved. “Needs Attention” trap isn’t a MEL code, but it’s sent as a trap on both “set” and “clear”.</p>

<h3 id="generic">Generic</h3>

<p>Generic events don’t contain the E-Series OID, but may still be useful. Controller coming online:</p>

<pre><code class="language-raw">DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (2333100) 6:28:51.00
SNMPv2-MIB::snmpTrapOID.0 = OID: IF-MIB::linkUp
</code></pre>

<p>(The DISMAN-EVENT-MIB thing appears everywhere like that. Very annoying!)</p>

<h2 id="other-approaches-to-delivering-notifications-to-snmp-trap-destinations">Other approaches to delivering notifications to SNMP trap destinations</h2>

<p>Assuming you have a way to figure out when to send an SNMP trap notification (such as, checking for MEL events using the SANtricity REST API), you could automate checks for that condition, and send notifications to your SNMP destination when needed.</p>

<p>This example is based on the <a href="https://pysnmp.readthedocs.io/en/latest/quick-start.html">PySNMP</a> documentation. I’d like to get the critical notification and E-Series array name included.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">sendNotification</span><span class="p">(</span>
    <span class="nc">SnmpEngine</span><span class="p">(),</span>
    <span class="nc">CommunityData</span><span class="p">(</span><span class="sh">'</span><span class="s">public</span><span class="sh">'</span><span class="p">,</span> <span class="n">mpModel</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="nc">UdpTransportTarget</span><span class="p">((</span><span class="sh">'</span><span class="s">ops.datafabric.lan</span><span class="sh">'</span><span class="p">,</span> <span class="mi">162</span><span class="p">)),</span>
    <span class="nc">ContextData</span><span class="p">(),</span>
    <span class="sh">'</span><span class="s">trap</span><span class="sh">'</span><span class="p">,</span>
    <span class="nc">NotificationType</span><span class="p">(</span>
        <span class="nc">ObjectIdentity</span><span class="p">(</span><span class="sh">'</span><span class="s">1.3.6.1.4.1.789.1123.1.500.0.2</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">SNMPv2-SMI::NOTIFICATION-TYPE</span><span class="sh">'</span><span class="p">)</span>
    <span class="p">).</span><span class="nf">addVarBinds</span><span class="p">(</span>
        <span class="p">(</span><span class="sh">'</span><span class="s">1.3.6.1.4.1.789.1123.1.500.2.7</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">SNMPv2-SMI::enterprises.789.1123.2.500.1.1</span><span class="sh">'</span><span class="p">)</span>
    <span class="p">).</span><span class="nf">loadMibs</span><span class="p">(</span>
        <span class="sh">'</span><span class="s">ES-NETAPP-06-MIB</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">SM10-R3-MIB</span><span class="sh">'</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>I haven’t tested this and I don’t know if it works. But you don’t have to use this, even CLI commands <a href="https://stackoverflow.com/questions/37119903/send-a-notification-trap-snmp-with-snmptrap-command-linux#37139670">can work</a>.</p>

<p>Why use such an approach when SNMP traps work? Some users already use the SANtricity API for performance monitoring, workflows and more, and for them it may be easier to query the API and send SNMP notifications from existing application.</p>

<h2 id="forwarding-notifications-to-other-snmp-and-non-snmp-destinations">Forwarding notifications to other SNMP and non-SNMP destinations</h2>

<p>Sometimes you receive SNMP traps, but also need these notifications elsewhere.</p>

<p>SNMP trap daemon can have a trap handling script set in snmptrapd.conf itself:</p>

<pre><code class="language-raw">traphandle OID|default PROGRAM [ARGS ...]
</code></pre>

<p>Normally this OID would be a NOTIFICATION-TYPE object such as storageArrayCritical (1.3.6.1.4.1.789.1123.1.500.0.2), but can be another OID (full or with a wild-card which replaces multiple <code class="language-plaintext highlighter-rouge">traphandle</code> rows), or simply the string <code class="language-plaintext highlighter-rouge">default</code>. Example:</p>

<pre><code class="language-raw">traphandle SNMPv2-SMI::enterprises.789.1123.2.500.0.2 /usr/local/bin/slack_notify.sh
</code></pre>

<p>When this SNMP trap is received, that trap handle will run the script with the following arguments:</p>

<ul>
  <li>Hostname (from which it was received)</li>
  <li>IP (address from which the trap was received)</li>
  <li>Variables (content) which is a space-delimited pair or set of pairs: <code class="language-plaintext highlighter-rouge">${OID} ${VALUE}</code></li>
</ul>

<p>The script can notify a Slack or do something else. From Net-SNMP documentation:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/bash</span>

<span class="nb">read </span>host
<span class="nb">read </span>ip
<span class="nv">vars</span><span class="o">=</span>

<span class="k">while </span><span class="nb">read </span>oid val
<span class="k">do
  if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$vars</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">""</span> <span class="o">]</span>
  <span class="k">then
    </span><span class="nv">vars</span><span class="o">=</span><span class="s2">"</span><span class="nv">$oid</span><span class="s2"> = </span><span class="nv">$val</span><span class="s2">"</span>
  <span class="k">else
    </span><span class="nv">vars</span><span class="o">=</span><span class="s2">"</span><span class="nv">$vars</span><span class="s2">, </span><span class="nv">$oid</span><span class="s2"> = </span><span class="nv">$val</span><span class="s2">"</span>
  <span class="k">fi
done

</span><span class="nb">echo trap</span>: <span class="nv">$1</span> <span class="nv">$host</span> <span class="nv">$ip</span> <span class="nv">$vars</span>

<span class="c"># As we've seen above (screenshot #2), trap formatting is messy,</span>
<span class="c">#   so you may want to use some preprocessing </span>
<span class="c">#   before you send that content someplace else:</span>
<span class="c"># python3 /scripts/snmp_critical_alert_notify.py $vars</span>
</code></pre></div></div>

<p>In addition to handling with trap handles, we can forward specific OIDs to another destination. This works the same way as trap handlers, except there’s no script.</p>

<pre><code class="language-raw">forward OID|default DESTINATION
</code></pre>

<p>(See the Net-SNMP documentation for the details on destination format.)</p>

<p>We can use <code class="language-plaintext highlighter-rouge">traphandle</code> script(s) to send an email or message, and <code class="language-plaintext highlighter-rouge">forward</code> processors to forward matching OID(s) to another destination for final processing.</p>

<h2 id="conclusion">Conclusion</h2>

<p>A lightweight approach with SNMP but without traps would be to use SNMP walk and check if enterprises.789.1123.2.500.1.7.0=1 (“Needs Attention”), and then check another place (SANtricity Web UI, Syslog, etc.) which contains necessary details.</p>

<p>E-Series’ SNMP trap features are more useful than SNMP queries. Because traps are meant for event notifications, they can’t be used for performance monitoring (at least that is a <a href="/2022/10/26/eseries-performance-analyzer-e-series.html">solved problem</a>).</p>

<p>Once the first trap recipient receives notifications, they can process them and forward the OID to another destination or destinations. Fancy rules could act if several OID values (such as ssEventPriority and ssEventComponentType) match certain criteria to perform targeted alerting and notifications (example: ssEventPriority=’Critical’ AND ssEventComponentType=’Drive’ could be used to send emails to your supplier).</p>

<p>The final trap recipient can use critical severity as the sole condition that <a href="/2021/07/19/solidfire-mib-snmp-monitoring.html#snmp-traps-cluster-fault-trap-and-cluster-resolved-fault-trap-examples">raises an alert</a> in their monitoring system. The idea is to have one “catch-all” rule is to not miss any critical events due to complex matching rules. Or maybe start simple and gradually build more sophisticated rules.</p>

<p>If you don’t use SNMP, you can use the SANtricity API as explained above, or try to use an existing plugin or integration to create your own SNMP or other notifier.</p>

<h2 id="appendix-a---e-series-mel-codes-aka-storage-system-event-types">Appendix A - E-Series MEL Codes aka Storage System Event Types</h2>

<p>As mentioned several times by now, ssEventType (enterprises.789.1123.2.500.2.1) corresponds to MEL types.</p>

<p>The “good” news is all these are “Critical”, which means you don’t have to think what to do when an event is not Critical.</p>

<p>The bad news is Event Category values range from Failure over Error to Notification. But you’ll be relieved to know you probably don’t need to worry about that. <code class="language-plaintext highlighter-rouge">MEL_EV_PI_ANALYSIS_LOCKDOWN_MODE_ENTERED</code>, for example, is logged when the controller has been rebooted into Analysis Lockdown Mode because the controller has detected excessive Data Assurance errors. It has the Event Category of “Notification” (0x4), but I’m pretty sure no administrator would just let this be. (As an aside: <a href="https://kb.netapp.com/onprem/E-Series/Management_Apps/What_is_the_Major_Event_Log">this KB</a> (NetApp support account required) makes some distinctions around ASUP, etc., if you’re interested, but for on-prem notifications we may not care.)</p>

<p>So…. you’ll probably want to ignore Event Category and alert on any and all enterprises.789.1123.2.500.2.7=”Critical” that you get, and ask someone to take a look at the box.</p>

<p>Especially since some of these events may change, new may be added, some may be removed. But “Critical” should always remain.</p>

<p>This below is the code name followed by its hex ID. In earlier text I mentioned how I brought a controller offline. The array had <code class="language-plaintext highlighter-rouge">SNMPv2-SMI::enterprises.789.1123.2.500.2.1 = STRING: "5005"</code> which is <code class="language-plaintext highlighter-rouge">MEL_EV_SYMBOL_CONT_FAIL</code> and (as the name suggests) activates upon controller failure (<code class="language-plaintext highlighter-rouge">setControllerToFailed_1</code>). Its hex ID is <code class="language-plaintext highlighter-rouge">5005</code> which is the string value we received in SNMP trap notification.</p>

<pre><code class="language-raw">MEL_EV_ACS_ERROR - 0x2602 
MEL_EV_ARMV_MIRROR_FAILED - 0x7C06 
MEL_EV_ARVM_AMG_INTERNAL_SUSPENSION - 0x7C02 
MEL_EV_ARVM_AMG_RECOVERY_POINT_LOST - 0x7C04 
MEL_EV_ARVM_AMG_ROLE_CHANGE_PAUSED - 0x7C37 
MEL_EV_ARVM_AMG_ROLE_CONFLICT - 0x7C03 
MEL_EV_ARVM_AMG_SEC_MEM_REP_FULL - 0x7C09 
MEL_EV_ARVM_AMG_SYNC_PAUSED_ALT_STATE - 0x7C34 
MEL_EV_BACKUP_COMPONENT_STATUS_UNKNOWN - 0x7506 
MEL_EV_BASE_CONTROLLER_DIAGNOSTIC_FAILED - 0x5100 
MEL_EV_BATTERY_EXPIRED - 0x7308 
MEL_EV_BATTERY_MISSING - 0x7306 
MEL_EV_BBU_OVERHEATED - 0x7300 
MEL_EV_BYPASS_GENERIC - 0x2823 
MEL_EV_CACHE_BACKUP_DEVICE_FAILED - 0x7500 
MEL_EV_CACHE_BACKUP_DEV_WRITE_PROTECTED - 0x7501 
MEL_EV_CACHE_BACKUP_INSUFFICIENT_CAPACITY - 0x211F 
MEL_EV_CACHE_BACKUP_PROTECTION_ERROR - 0x2125 
MEL_EV_CACHE_BATTERY_FAILURE - 0x210C 
MEL_EV_CACHE_BATTERY_WARN - 0x2113 
MEL_EV_CACHE_DATA_LOSS - 0x210E 
MEL_EV_CACHE_MEM_DIAG_FAIL - 0x2110 
MEL_EV_CACHE_NOT_FLUSHED_ON_ONLY_CTLR - 0x2131 
MEL_EV_CCM_HW_MISMATCH - 0x2109 
MEL_EV_CFG_DRIVE_FAILURE - 0x226C 
MEL_EV_CFG_DRV_TO_SMALL - 0x2249 
MEL_EV_CFG_NTP_RES - 0x2287 
MEL_EV_CFG_NTP_SERVICE_UNAVAIL - 0x2289 
MEL_EV_CFG_NTP_UNREACH - 0x2288 
MEL_EV_CFG_READ_FAIL - 0x2251 
MEL_EV_CFG_WRONG_DRIVE_TYPE - 0x2262 
MEL_EV_CONT_ID_MISMATCH - 0x2833 
MEL_EV_CONT_ID_READ_FAILURE - 0x2855 
MEL_EV_CONT_REDUNDANCY_LOSS - 0x2829 
MEL_EV_CONTROLLER - 0x2500 
MEL_EV_CONT_SUBMODEL_MISMATCH - 0x2841 
MEL_EV_COPY_THEN_FAIL_NO_SPARE - 0x227C 
MEL_EV_DATA_ALTERED_TO_CORRECT_REDUN_MISMATCH - 0x2048 
MEL_EV_DATABASE_RECOVERY_MODE_ACTIVE - 0x6109 
MEL_EV_DATA_PARITY_MISMATCH - 0x200A 
MEL_EV_DBM_CONFIG_DB_FULL - 0x6101 
MEL_EV_DBM_HCK_ALTCTL_NOT_FUNC - 0x6107 
MEL_EV_DDC_AVAILABLE_CRITICAL - 0x6900 
MEL_EV_DEDICATED_MIRROR_CHANNEL_FAILED - 0x2124 
MEL_EV_DEGRADE_CHANNEL - 0x1209 
MEL_EV_DEVICE_FAIL - 0x222D 
MEL_EV_DFC_ALT_LOOP_DIAG_FAIL - 0x150E 
MEL_EV_DFC_CHANNEL_FAILOVER - 0x1513 
MEL_EV_DFC_CHANNEL_MISWIRE - 0x150F 
MEL_EV_DFC_CTL_MISWIRE - 0x151E 
MEL_EV_DFC_ESM_MISWIRE - 0x1510 
MEL_EV_DFC_FIBRE_TRUNK_MISWIRE - 0x1525 
MEL_EV_DFC_HW_FAILED_CHANNEL - 0x1515 
MEL_EV_DFC_LSD_FAILURE - 0x151A 
MEL_EV_DFC_MIXED_LOOP_TECHNOLOGY_MISWIRE - 0x1522 
MEL_EV_DFC_TRUNK_INCOMPATIBLE_ESM - 0x1524 
MEL_EV_DIAG_CONFIG_ERR - 0x5616 
MEL_EV_DIAG_CONFIG_ERR_ALT - 0x5617 
MEL_EV_DIAG_READ_FAILURE - 0x560D 
MEL_EV_DIAG_READ_FAILURE_ALT - 0x560E 
MEL_EV_DIAG_WRITE_FAILURE - 0x560F 
MEL_EV_DIAG_WRITE_FAILURE_ALT - 0x5610 
MEL_EV_DIFFERENT_DATA_RETURNED_ON_RETRY - 0x2047 
MEL_EV_DIRECTORY_SERV_CONFIG_ERROR - 0x9204
MEL_EV_DISCRETE_LINE_FAIL - 0x2836 
MEL_EV_DISK_POOL_CAPACITY_DEPLETED - 0x3809 
MEL_EV_DISK_POOL_CORRUPTED_DB_RECORD - 0x380D 
MEL_EV_DISK_POOL_INSUFFICIENT_MEMORY - 0x380C 
MEL_EV_DISK_POOL_REC_RDRVCNT_BEL_THRSHLD - 0x3803 
MEL_EV_DISK_POOL_UTILIZATION_CRITICAL - 0x3805 
MEL_EV_DISK_POOL_UTILIZATION_WARNING - 0x3804 
MEL_EV_DRAWER_DEGRADED - 0x285F 
MEL_EV_DRAWER_FAILED - 0x2856 
MEL_EV_DRAWER_INVALID - 0x2861 
MEL_EV_DRAWER_OPEN - 0x2857 
MEL_EV_DRAWER_REMOVED - 0x2862 
MEL_EV_DRIVE_FAIL_READ_ERROR_SCAN_CYCLE - 0x203B 
MEL_EV_DRIVE_IN_VG_OR_HOT_SPARE_REMOVED - 0x226D 
MEL_EV_DRIVE_PFA - 0x1010 
MEL_EV_DRIVE_PFA2 - 0x2285 
MEL_EV_DRIVE_REDUNDANCY_LOSS - 0x282D 
MEL_EV_DRIVE_TRAY_LOCKOUT - 0x2832 
MEL_EV_DRIVE_TRAYS_NOT_GROUPED_TOGETHER - 0x2835 
MEL_EV_DRIVE_UNSUP_INTERPOSER_FW_VER - 0x2276 
MEL_EV_DRIVE_UNSUPPORTED_CAPACITY - 0x2271 
MEL_EV_DRV_FORMAT_FAILED - 0x224B 
MEL_EV_DRV_NO_RESPONSE - 0x224D 
MEL_EV_DSAS_BK_END_HBA_MISWIRE - 0x1702 
MEL_EV_DSAS_ESM_MISWIRE - 0x1704 
MEL_EV_DSAS_EXP_PORT_DEV_MISWIRE - 0x170A 
MEL_EV_DSAS_TOPOLOGY_MISWIRE - 0x1700 
MEL_EV_DSAS_WPORT_DEG_TO_FAIL - 0x1707 
MEL_EV_DSAS_WPORT_DEG_TO_FAIL_CTLR - 0x1710 
MEL_EV_DSAS_WPORT_OPT_TO_DEG - 0x1706 
MEL_EV_DSAS_WPORT_OPT_TO_DEG_CTLR - 0x170F 
MEL_EV_ENCL_FAIL - 0x280D 
MEL_EV_ENCL_ID_CONFLICT - 0x2816 
MEL_EV_ESM_DRIVE_BYPASS - 0x2854 
MEL_EV_ESM_TYPE_MISMATCH - 0x2849 
MEL_EV_ESM_VERSION_MISMATCH - 0x281E 
MEL_EV_EXCESSIVE_REBOOTS_DETECTED - 0x1403 
MEL_EV_EXPANSION_TRAY_THERMAL_SHUTDOWN - 0x285D 
MEL_EV_FACTORY_DEFAULT_MISMATCH - 0x2852 
MEL_EV_FAILED_HOST_INTERFACE_CARD - 0x1904 
MEL_EV_FAIL_VDSK_DELAYED - 0x2252 
MEL_EV_FBM_BUNDLE_VIOLATION - 0x7001 
MEL_EV_FC_HOST_SFP_FAILED - 0x120D 
MEL_EV_FC_LINK_ERROR_THRESHOLD_CRITICAL - 0x1207 
MEL_EV_FC_SFP_FAILED - 0x120A 
MEL_EV_FC_SPEED_NEG_FAILURE - 0x1208 
MEL_EV_FDE_LOCK_KEY_NEEDED - 0x226B 
MEL_EV_FLASH_CACHE_FAILED_CACHE_SIZE_MISMATCH - 0x3604 
MEL_EV_FLASH_CACHE_NON_OPTIMAL_DRIVES - 0x3605 
MEL_EV_HIC_CONFIGURATION_OOC - 0x1908 
MEL_EV_HOST_REDUNDANCY_LOST - 0x9102 
MEL_EV_HOST_SFP_FAILED - 0x2863 
MEL_EV_HOST_SFP_UNSUPPORTED - 0x2864 
MEL_EV_HOT_SPARE_IN_USE - 0x2273 
MEL_EV_ICC_REMOVED - 0x2838 
MEL_EV_ICM_ENTERING_INVALID_SYSTEM_CONFIG - 0x2900 
MEL_EV_INACTIVE_HOST_PORT_REGISTERED - 0x5224 
MEL_EV_INACTIVE_INITIATOR_REGISTERED - 0x5225 
MEL_EV_INCOMPAT_DRIVE_INVALID_CONFIG - 0x2267 
MEL_EV_INCOMPATIBLE_ALIGNMENT_FOR_EMULATION_DRIVE - 0x2278 
MEL_EV_INCOMPLETE_CACHE_BACKUP - 0x2126 
MEL_EV_INSUFFICIENT_LEARNED_CAPACITY - 0x7301 
MEL_EV_INSUFFICIENT_MEMORY_FOR_CACHE_SIZE - 0x2120 
MEL_EV_INVALID_ENCLOSURE_SETTING - 0x284F 
MEL_EV_IOC_CONTROLLER_FAILURE - 0x5101 
MEL_EV_IOC_FAILURE - 0x5102 
MEL_EV_ISCSI_FAILED_HOST_CARD - 0x180A 
MEL_EV_ISOLATION_REDUN_MISMATCH - 0x2046 
MEL_EV_LINE_FAILED - 0x280B 
MEL_EV_LINE_MISSING - 0x280A 
MEL_EV_LINK_SPEED_SWITCH_CHANGE - 0x284B 
MEL_EV_LOCK_KEY_VALID_ATTEMPTS_EXCEEDED - 0x506D 
MEL_EV_LOSS_EXT_REDUNDANCY - 0x171A 
MEL_EV_LUN_DOWN - 0x2250 
MEL_EV_MIRROR_DUAL_PRIMARY - 0x6400 
MEL_EV_MIRROR_DUAL_SECONDARY - 0x6401 
MEL_EV_MIRROR_UNSYNCHRONIZED - 0x6402 
MEL_EV_MISCORRECTED_DATA - 0x202E 
MEL_EV_MISSING_DRIVE_LOCKDOWN - 0x1907 
MEL_EV_MIXED_DRIVE_TYPES_NOT_ALLOWED - 0x2830 
MEL_EV_MULTIPATH_CONFIG_ERROR - 0x9103 
MEL_EV_MULTIPLE_MISMATCHED_KEY_IDS - 0x2705 
MEL_EV_OCB_SETTING_CONFLICT - 0x211B 
MEL_EV_ON_BATTERY - 0x2801 
MEL_EV_PERSIST_MPE - 0x2604 
MEL_EV_PI_ANALYSIS_LOCKDOWN_MODE_ENTERED - 0x206A 
MEL_EV_PI_DRIVE_LOCKED_OUT - 0x1020 
MEL_EV_PI_SERVICE_MODE_ENTERED - 0x2069 
MEL_EV_PITGROUP_FAILED - 0x7803 
MEL_EV_PITGROUP_REPOSITORY_FULL - 0x7802 
MEL_EV_PIT_PURGED - 0x7807 
MEL_EV_PIT_ROLLBACK_PAUSED - 0x7800 
MEL_EV_POWER_SUPPLY_FAIL - 0x283B 
MEL_EV_RCB_CACHE_DATA_LOSS - 0x212E 
MEL_EV_RECON_DRV_FAILED - 0x224E 
MEL_EV_RECONFIGURATION_FAILED - 0x2266 
MEL_EV_REDUNDANT_PS_REQUIRED - 0x284E 
MEL_EV_REDUN_GROUP_NOT_CONSISTENT - 0x2045 
MEL_EV_RMTVOL_LINK_DOWN - 0x6503 
MEL_EV_RMTVOL_WWN_CHANGE_FAILED - 0x6505 
MEL_EV_RVM_WRITE_MODE_INCONSISTENT - 0x6411 
MEL_EV_SAFE_EVAL_EXPIRATION_IMMINENT - 0x5409 
MEL_EV_SAFE_MISMATCHED_GK_DEP - 0x5405 
MEL_EV_SAFE_MISMATCHED_MDT_DEP - 0x5406 
MEL_EV_SAFE_NON_COMPLIANCE - 0x5402 
MEL_EV_SAFE_TIER_NON_COMPLIANCE - 0x5403 
MEL_EV_SAS_BACKEND_DISCOVERY_ERROR - 0x165A 
MEL_EV_SAS_FRNT_END_MISWIRE - 0x1650 
MEL_EV_SAS_HOST_WIDE_PORT_DEGRADED - 0x1654 
MEL_EV_SAS_PARTNER_INITIATOR_OVERFLOW - 0x1652 
MEL_EV_SAS_PHY_DISABLED_BYPASSED_DRIVE - 0x5104 
MEL_EV_SAS_PHY_DISABLED_BYPASSED_PORT - 0x5103 
MEL_EV_SAS_PHY_DISABLED_LOCAL_WIDE_PORT - 0x5105 
MEL_EV_SAS_PHY_DISABLED_SHARED_WIDE_PORT - 0x5106 
MEL_EV_SBB_MISMATCHED_ENCL_EEPROM_CONTENTS - 0x2303 
MEL_EV_SBB_TWO_WIRE_INTERFACE_BUS_FAILURE - 0x2304 
MEL_EV_SBB_VALIDATION_FAIL_FOR_POWER_SUPPLY - 0x2302 
MEL_EV_SBB_VPD_EEPROM_CORRUPTION - 0x2305 
MEL_EV_SCT_COMMAND_UNSUPPORTED - 0x7D00 
MEL_EV_SECURITY_AUDIT_LOG_FULL - 0x9200 
MEL_EV_SOD_FDE_INCONSISTENT_ARRAY_LOCK_KEY - 0x2607 
MEL_EV_SPM_INVALID_DEFAULT_OS_INDEX_DETECTED - 0x5223 
MEL_EV_SPM_INVALID_HOST_OS_INDEX_DETECTED - 0x5222 
MEL_EV_SPRI_ACTIVATED - 0x6800 
MEL_EV_SPRI_WRONG_PASSWORD - 0x6801 
MEL_EV_SSD_AT_END_OF_LIFE - 0x226E 
MEL_EV_SYMBOL_AUTH_FAIL_CONT_LOCKOUT - 0x5038 
MEL_EV_SYMBOL_CONT_FAIL - 0x5005 
MEL_EV_SYMBOL_CONT_SERVICE_MODE - 0x5040 
MEL_EV_SYNTH_DRIVE_PFA - 0x101E 
MEL_EV_TEMP_SENSOR_FAIL - 0x281C 
MEL_EV_TEMP_SENSOR_MISSING - 0x281D 
MEL_EV_TEMP_SENSOR_WARNING - 0x281B 
MEL_EV_TPV_REPOSITORY_FAILED - 0x7B02 
MEL_EV_TPV_REPOSITORY_FULL - 0x7B01 
MEL_EV_TRAY_REDUNDANCY_LOSS - 0x282B 
MEL_EV_UNCERTIFIED_DRIVE - 0x2260 
MEL_EV_UNCERTIFIED_ESM - 0x2831 
MEL_EV_UNSUPPORTED_CACHE_SIZE - 0x211E 
MEL_EV_UNSUPPORTED_LHA_SATA_ESM - 0x282F 
MEL_EV_UPS_BATTERY_2MIN - 0x2803 
MEL_EV_USM_BAD_LBA_DETECTED - 0x6700 
MEL_EV_USM_DATABASE_FULL - 0x6703 
MEL_EV_VIEW_REPOSITORY_FAILED - 0x7806 
MEL_EV_VIEW_REPOSITORY_FULL - 0x7805 
MEL_EV_VOLCOPY_FAILED - 0x6600 
MEL_EV_VOLUME_GROUP_INCOMPLETE - 0x2275 
MEL_EV_VOLUME_GROUP_MISSING - 0x2274 
MEL_EV_VOL_XFER_ALERT - 0x4011 
MEL_EV_WB_CACHING_FORCIBLY_DISABLED - 0x212B 
MEL_EV_WRONG_SECTOR_SIZE - 0x224A 
</code></pre>

<h2 id="appendix-b---need-attention-situation-example">Appendix B - Need Attention situation example</h2>

<p>To test traps, simulate a failure and tail SNMP trap daemon log.</p>

<p><img src="/assets/images/eseries-snmpdtrap-05-snmpwalk-disabled-controller.png" alt="" /></p>

<p>You should see a trap come in (we have been notified that a controller was placed in service mode).</p>

<p>At the bottom of this screenshot we can see how SNMP walk can be executed periodically to create basic alerts:</p>

<ul>
  <li>If enterprises.789.1123.2.500.1.7.0 is <em>NOT</em> 0, alert via custom script</li>
  <li>Else, sleep 60 seconds and check again</li>
</ul>

<p>In this situation it equals 1 because I disabled a controller, which means the array “Needs Attention”.</p>

<p>SNMP walk command example for each copy-and-paste (replace 1.1.1.1 with own E-Series controller address):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>snmpwalk <span class="nt">-v</span> 2c <span class="nt">-c</span> public <span class="nt">-Os</span> 1.1.1.1 enterprises.789.1123.2.500.1.7.0
enterprises.789.1123.2.500.1.7.0 <span class="o">=</span> INTEGER: 1
</code></pre></div></div>

<h2 id="appendix-c---trap-handling-script-example">Appendix C - Trap handling script example</h2>

<p>There’s nothing new here, it’s all from Net-SNMP docs, but if “execute” is allowed in snmptrapd.conf, traphandle set (see the bottom of the screenshot) and the script ready to run (top), it will work. You will notice compared to the shell script given above, this one sends the contents to /tmp/trap-notify.log, which is done to make it easier to check.</p>

<p><img src="/assets/images/eseries-snmpdtrap-06-trap-handling-script.png" alt="" /></p>

<p>You may also notice (in snmptrapd documentation) that there’s an option to save traphandle-processed data to snmptrapd log or not. Sometimes people don’t want to save data to log for security, sometimes for other reasons.</p>

<p>Reload and restart snmptrapd service before you test.</p>

<p>It seems the MEL error code ((0x1707) seen here stands for MEL_EV_DSAS_WPORT_DEG_TO_FAIL, which isn’t unexpected considering that a controller has been disabled.</p>

<h2 id="appendix-d---centreon-with-e-series">Appendix D - Centreon with E-Series</h2>

<p><strong>NOTE</strong>: change the IP to the IP of your SANtricity controller. Also note that if controller is down, you may not be able to query it. You can query both controllers, or set alert to go off when no response is received at all. It is strongly recommended to use proper TLS certificates.</p>

<p>The first example is using Centreon SNMP plugin from Github. Get the repo and get to the src directory. Assuming you have Perl and other dependencies, you can use this command with the right the hostname (E-Series controller IP) to check if storage “Needs Attention”:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>perl ./centreon_plugins.pl <span class="nt">--plugin</span><span class="o">=</span>apps::protocols::snmp::plugin <span class="se">\</span>
  <span class="nt">--mode</span><span class="o">=</span>numeric-value <span class="se">\</span>
  <span class="nt">--oid</span><span class="o">=</span><span class="s1">'.1.3.6.1.4.1.789.1123.2.500.1.7.0'</span> <span class="se">\</span>
  <span class="nt">--hostname</span><span class="o">=</span>1.1.1.1 <span class="nt">--snmp-version</span><span class="o">=</span>2c <span class="nt">--snmp-community</span><span class="o">=</span>public
OK: current value is 0 | <span class="s1">'value'</span><span class="o">=</span>0<span class="p">;;;;</span>

</code></pre></div></div>

<p>It’s <code class="language-plaintext highlighter-rouge">0</code>, so it does not, at the moment. <code class="language-plaintext highlighter-rouge">OK</code> doesn’t mean the array is OK, it means “run completed without errors”.</p>

<p>“<code class="language-plaintext highlighter-rouge">OK: current value is 1</code>” really means “Crap - this is NOT good - current value is 1”.</p>

<p>The second example uses the SANtricity API. As mentioned earlier, this project has a checker for the SANtricity API (not SANtricity Web Services Proxy) which can be used like this (there are other modes, this is just hardware checks):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>perl ./centreon_plugins.pl <span class="se">\</span>
  <span class="nt">--plugin</span><span class="o">=</span>storage::netapp::santricity::restapi::plugin <span class="se">\</span>
  <span class="nt">--mode</span><span class="o">=</span>hardware  <span class="se">\</span>
  <span class="nt">--hostname</span> 1.1.1.1 <span class="se">\</span>
  <span class="nt">--proto</span><span class="o">=</span>https <span class="nt">--port</span><span class="o">=</span>8443 <span class="se">\</span>
  <span class="nt">--api-username</span> admin <span class="nt">--api-password</span> istrator <span class="se">\</span>
  <span class="nt">--ssl-opt</span><span class="o">=</span><span class="s2">"SSL_verify_mode =&gt; SSL_VERIFY_NONE"</span>

OK: All 49 components are ok 
<span class="o">[</span>2/2 batteries, 2/2 boards, 6/6 cbd, 2/2 ctrl,
24/24 drive, 4/4 fans, 2/2 psu, 1/1 storages, 6/6 thsensor].
...
</code></pre></div></div>

<p>Now that we know this works as seen on TV, you just need to deploy Centreon and make it work.</p>

<p>That’s not necessarily easy, but the good news is they also sell support and services, so if you can’t figure it out, they’ll be happy to help.</p>

<p>As mentioned earlier these plugins can be used with any systems that support Nagios-style plugins, but if you want proper support Centreon may be the best choice.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2023/11/04/eseries-perf-analyzer-epa-330.html">E-Series Perf Analyzer (EPA) v3.3.0</a></li>
      
        <li><a href="/2023/02/25/elasticsearch-eseries-performance.html">Elasticsearch performance with E-Series</a></li>
      
        <li><a href="/2023/02/18/epa-eseries-monitor-sensors-psu-power-consumption.html">Gather and visualize E-Series temperature and power consumption metrics with EPA</a></li>
      
        <li><a href="/2023/10/29/consistency-group-monitoring-in-eseries.html">Monitor Snapshot Consistency Groups of NetApp E-Series SANtricity OS</a></li>
      
        <li><a href="/2023/10/12/snapshot-clone-repository-monitoring-in-eseries.html">Monitor snapshot and clone repositories of NetApp E-Series SANtricity OS</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2025-07-09 01:54 </p>
    <p>Copyright © 2025 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
