<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Firemox - an anti-plugin for Proxmox PVE with NetApp SolidFire | Acting Technologist
      
    </title>
    <meta name="description" content="
     It works, kind of
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Firemox - an anti-plugin for Proxmox PVE with NetApp SolidFire | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Firemox - an anti-plugin for Proxmox PVE with NetApp SolidFire" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="It works, kind of" />
<meta property="og:description" content="It works, kind of" />
<link rel="canonical" href="https://scaleoutsean.github.io/2025/07/07/firemox.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2025/07/07/firemox.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:image" content="https://scaleoutsean.github.io/assets/images/firemox-04-utilities.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-07-07T00:00:00+08:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"scaleoutSean"},"description":"It works, kind of","@type":"BlogPosting","headline":"Firemox - an anti-plugin for Proxmox PVE with NetApp SolidFire","dateModified":"2025-07-07T00:00:00+08:00","datePublished":"2025-07-07T00:00:00+08:00","image":"https://scaleoutsean.github.io/assets/images/firemox-04-utilities.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2025/07/07/firemox.html"},"url":"https://scaleoutsean.github.io/2025/07/07/firemox.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Firemox - an anti-plugin for Proxmox PVE with NetApp SolidFire</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>07 Jul 2025</span> - <i class="far fa-clock"></i> 


  
  
    11 minute read
  

    </span>
  </div>
  
        <ul>
  <li><a href="#background">Background</a></li>
  <li><a href="#firemox">Firemox</a></li>
  <li><a href="#what-it-does-and-doesnt">What it does, and doesn’t</a>
    <ul>
      <li><a href="#stopping-scope-creep">(Stopping) scope creep</a></li>
    </ul>
  </li>
  <li><a href="#known-issues-and-limitations">Known issues and limitations</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#demo-and-source-code">Demo and source code</a></li>
  <li><a href="#appendix-a-feature-creep-continues-20250709">Appendix A: Feature creep continues (2025/07/09)</a></li>
</ul>

<h2 id="background">Background</h2>

<p>In <a href="/2025/06/24/initial-exploration-solidfire-proxmox-plugin.html">“Do we need a NetApp SolidFire plugin for Proxmox”</a> in looked into storage plugins for Proxmox and explained why I didn’t like the idea of using the PVE way.</p>

<p>It’s taken me since then - approximately three weekends and two weeks of evenings - to get somewhere with a different approach - an external “management client” for NetApp SolidFire and Proxmox PVE.</p>

<p>Why I like this approach:</p>

<ul>
  <li>PowerShell (and APIs): I wrote it in PowerShell and avoided the use of Perl and PVE CLI</li>
  <li>Versatility: the same approach - and code - ought to work well with some other “alternative” virtualization platforms</li>
  <li>Simplicity: No need to have a tool that runs <em>inside</em> of Proxmox PVE and risks getting broken every time Promox is updated or reinstalled</li>
</ul>

<p>I need to clean up the code, fix some bugs, write some documentation, but I don’t plan to change it much so I thought to post a bit about it now. (<strong>Edit:</strong> the code has been posted to Github (2025/07/13).)</p>

<h2 id="firemox">Firemox</h2>

<p>“Firemox” reminds me of Firefox: it works, but has its fair share of annoyances.</p>

<p>So I picked Firemox over other alternatives. (Of course, there <em>is</em> a Firemox project… It’s a game. I don’t care.)</p>

<p>Unlike Firefox, Firemox does not spy on its users and is probably more secure in many ways. One dependency, zero junk. More about it in the README once I get it on Github.</p>

<h2 id="what-it-does-and-doesnt">What it does, and doesn’t</h2>

<p>Essentially, it helps SolidFire users get here:</p>

<p><img src="/assets/images/firemox-01-vg-on-iscsi.png" alt="Consistent storage object naming" /></p>

<p>What does that mean?</p>

<ul>
  <li>Your SolidFire iSCSI devices are used by PVE as iSCSI pools (LUNs registered in PVE)</li>
  <li>In PVE it creates LVM - one LVM VG per each iSCSI storage “pool” (single-disk LVM/VG, basically, which is like a Datastore on single-LUN VMFS in vCenter)</li>
  <li>You get <em>effortless</em> naming consistency in the process (<code class="language-plaintext highlighter-rouge">&lt;pve-dc&gt;-&lt;solidfire-clustername&gt;-&lt;000&gt;</code>, prefixed with <code class="language-plaintext highlighter-rouge">vg-</code> and <code class="language-plaintext highlighter-rouge">lvm-</code> when appropriate)</li>
  <li>You can put it together and tear it apart, VG by VG, LVM by LVM, and storage pool by storage pool</li>
  <li>It’s not slow and it’s easy to add or change features</li>
</ul>

<p>To paraphrase that ad for compliance software, it’s a storage plugin that doesn’t suck… much.</p>

<p>Another - from the Firemox side - look at that end-to-end consistency:</p>

<p><img src="/assets/images/firemox-02-pve-solidfire-map.png" alt="End-to-end consistency" /></p>

<p>Or another, with a view of all SolidFire-related storage pools broken down by iSCSI and iSCSI-backed LVM pools.</p>

<p><img src="/assets/images/firemox-03-storage-objects.png" alt="iSCSI pools and LVM configuration" /></p>

<p>And yes, it is possible to have 4 iSCSI pools and just 1 LVM (on one of the 4), which is why the first view has a different purpose: it lets us see which VG and LVM configuration maps to which LUN, whereas the iSCSI/LVM screenshot with 3 iSCSI and 2 LVM pools would tell us one 1 iSCSI pool is “unused” in PVE. That pool wouldn’t appear in the other screenshot.</p>

<p>All this frees you from having two browser windows or two tabs when you need to make storage-related changes. I hate the part where, when adding iSCSI and LVM pools - I have to copy-paste (because I always make typos) SolidFire volume names (for PVE iSCSI pools)and PVE iSCSI pool names (for PVE LVM).</p>

<h3 id="stopping-scope-creep">(Stopping) scope creep</h3>

<p>As I’ve started, I just wanted two basic features (present and un-present LUNs), then three and so on. This (possibly) explains the messy way I coded it - the lack of planning is obvious (and that’s why cleaning it up will take days).</p>

<p>But having an external “not plugin” allowed me to do whatever I wanted.</p>

<p>Aside from “config” steps (where I configure SolidFire storage account, QoS, volumes and PVE iSCSI client), this is the main part of it where PVE-related stuff is exposed.</p>

<p><img src="/assets/images/firemox-04-utilities.png" alt="Firemox utilities" /></p>

<ul>
  <li>View SolidFire LUNs exposed to PVE cluster</li>
  <li>View PVE VGs that use SolidFire iSCSI pools</li>
  <li>Create PVE iSCSI and LVM storage backed by SolidFire</li>
  <li>Get a resource mapping (PVE&lt;-&gt;SolidFire) and network configuration</li>
  <li>Remove PVE VGs and iSCSI pools (SolidFire volumes can be removed in another area of Firemox)</li>
</ul>

<p>What I decided to <em>not</em> develop was the functionality related to Promox storage QoS or, more precisely, integration of that with SolidFire’s storage QoS. Actually, some of it is already in the Firemox code, but I decided to not finish it because it’s really not my business. If PVE doesn’t expose its QoS settings in an easy-to-use way, why should <em>I</em> go out of my way to deal with that?</p>

<p>From a user’s perspective, it’d be nice if we could - similarly to how SolidFire and VMware storage policies work - automatically re-type QoS of my storage volumes depending on how individual VMs and containers were configured. Okay, that <em>can</em> be done, but…</p>

<p>But why do it when my array makes it easy (it’s in Firemox) to retype a volume, while PVE has absolutely no tools or APIs for that? There’s almost nothing! We’re’ supposed to extract PVE QoS as variously-delimited (not even consistent) lines of text from different (VMs vs LXC) API calls.</p>

<p>I know how to add up the various storage QoS settings from VMs and LXC containers and it works, but really - we should let Proxmox figure it out on their end and write a proper API first, then I’ll think about using that. (Or not, since by then SolidFire will enter end-of-support.)</p>

<p><img src="/assets/images/firemox-04-pve-api.png" alt="PVE - pick your delimiter adventure" /></p>

<p>Currently we can retype SolidFire volumes from Firemox (turn the dial “up” or “down”) which is the same users can do with SolidFire plugin for vCenter (and that still remains elusive to Trident users - I <a href="/2024/06/19/trident-policy-sucker-for-solidfire-backends.html">would have taken care of that</a> for SolidFire if I knew anyone who needed it, but I never did.)</p>

<p>Another part that I’d like to have, but decided to <em>not</em> add, was a storage efficiency-related report. I’d like to have it in the same CLI, but really - anyone who needs that information should use <a href="/2025/06/18/sfc-2-dot-1.html">SFC</a> or a similar approach to gather both PVE and SolidFire metrics in a place that can be used to properly visualize these things.</p>

<h2 id="known-issues-and-limitations">Known issues and limitations</h2>

<p>The gray question mark issue is when you add a storage resource (such as LVM configuration on shared iSCSI storage) to a PVE cluster and, while the shared storage resource appears on all cluster members, on some nodes there’s a small gray question mark next to that resource.</p>

<p>I’ve seen this on the Internet with PVE and other shared storage, and I’ve seen it on PVE with SolidFire as well. Rescanning storage doesn’t help, but a rolling-reboot of other nodes (the one used to add storage doesn’t have that issue) does.</p>

<p>It’s not a huge issue for non-mission critical environments, especially since (unlike VMFS) in PVE one host uses one LVM which has one VG, but PVE should fix that. But it may be Corosync- (or whatever) related, and they’ll probably just wait until others fix their own code. (Otherwise, if they wanted to fix it, they would have fixed it by now.)</p>

<p>Rolling-reboot affects running VMs and CTs so those have to be live- (or cold-, if live doesn’t work) migrated before a rolling reboot of PVE hosts. To minimize that, we can add two or more iSCSI pools and LVMs at a time, I guess, since SolidFire by default creates thin volumes - it doesn’t cost us anything.</p>

<p>Other than that, I suppose I didn’t use PVE long enough to find more problems. At the same time I don’t expect that there would be “SolidFire-only” problems.</p>

<p>Regarding limitations, I haven’t noticed anything SolidFire-specific. It’s like any other shared iSCSI storage one would use with PVE.</p>

<p>One thing regarding PVE API access is each node has a cluster API endpoint, but switching between them is an excercise for the user. Or maybe one could install a reverse HTTPS proxy service to take care of that. Out of the box, though, if you’re connected to cluster API on node1 and that node goes down, you’d have to retry on another node. I haven’t implemented these multi-node retries; it’s not hard, but PVE should take care of this on their side and secondly, if a PVE node is rebooting or down, it’s better to fix the problem first and only then fool around with shared storage configuration (it <em>can</em> work, but it’s just better to wait a minute and then continue.)</p>

<h2 id="conclusion">Conclusion</h2>

<p>I think I’ve done just enough to make Firemox desirable in a a NetApp SolidFire and Proxmox PVE my home lab. I believe it’s good enough for that.</p>

<p>Yes, I too can “write a shorter PVE-based Bash script that work faster”, but that’s just the PVE part. You’d still need a way to communicate with the SolidFire API, so… Would you call the SolidFire API from Python that would be called from Bash?</p>

<p>I’m convinced a CLI like this is a better way to manage PVE with SolidFire for home labs and small users. It’s PowerShell 7, API-only, and it works on Windows, OS X and Linux and the UI is rich enough to not be too “Spartan”.</p>

<p>Halfway through I thought about rewriting in Python (maybe with a Web UI) because I ran into some console bugs I couldn’t find a way to solve. I decided to persist and keep it as a client and I think it paid back.</p>

<p>Now that this is almost done, maybe we should do a similar one for <a href="/2024/02/28/incus-zfs-netapp-eseries.html">LXC or Incus with E-Series</a>?</p>

<h2 id="demo-and-source-code">Demo and source code</h2>

<ul>
  <li><a href="https://rumble.com/v6vu287-firemox-cli-client-for-promox-pve-with-netapp-solidfire.html">Quick demo of Firemox</a> - 6m48s</li>
  <li><a href="https://github.com/scaleoutsean/firemox">Firemox</a></li>
</ul>

<h2 id="appendix-a-feature-creep-continues-20250709">Appendix A: Feature creep continues (2025/07/09)</h2>

<p>After posting the above, I saw some people asking about snapshots.</p>

<p>So I’ve added snapshots today. To be exact: I’ve added the ability to add and remove PVE-exposed SolidFire volumes to any existing (SolidFire) snapshot schedule.</p>

<p>The way it works - as you might imagine - is Firemox lists snapshot schedules and PVE-exposed volumes, and the user picks one of the former and one or more of the latter. When removing, the user views the former and removes one or more of the latter (volume IDs, that is).</p>

<p>I don’t like the idea, by the way. If you’re in a CLI client like Firemox, you probably don’t quite know what’s where in terms of VMs and CTs, unless you’re a well-organized person. So the ability to add or remove volumes from snapshot schedules is unlikely to help.</p>

<p>I deliberately did not add an option to restore a snapshot, because that could be potentially destructive to VMs and CTs on volumes where snapshots are recovered. I think enough users would make a mistake or typo in that situation. If something is screwed up to the extent that you need to restore a snapshot, you’d better check the situation in PVE and SolidFire UI and while there, perform all the actions in those two browser tabs is what I think is a good approach. I may be wrong, of course.</p>

<p>I think a better way would be a separate snapshotter service unrelated to Firemox, which would work along the line of my old <a href="https://github.com/scaleoutsean/solidbackup">Solidbackup</a> script, where there’s a service that lets you configure volumes that need to be protected and the service takes care of snapshots and other things (such as backup to S3). I may revisit this idea if I encounter anyone who actually needs that stuff.</p>

<p>For PVE I’d slightly change the approach and start with VMs and CTs, rather than SolidFire volumes, because I now can use VI’s API. Each VM/CT can tell me what volumes are used, and then hardware snapshots can be created without the user knowing where’s what. Or I would only create a lookup script that takes a list of VM and CT IDs and spits out a list of volume IDs that can be fed to a snapshot schedule, which would eliminate the need to add/remove volumes in Firemox.</p>

<p>But even in that case, one would also have to figure out how to create clones from snapshots and mount them for recovery of individual CTs, QCOW disk files and whatnot. I also know it may be easier to examine how Proxmox Backup could be used than reinvent the wheel. I haven’t had time to do that.</p>

<p>For now, at least basic snapshots can be created while restores may be destructive. In the worst case (if you need to restore but just one VM or CT) it would be possible to clone a LUN for a PVE VM (with a different tenant ID), import the LUN there and scp the file(s) across.</p>


      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#automation">automation</a>
      &nbsp; 
    
      <a href="
      /categories/#solidfire">solidfire</a>
      &nbsp; 
    
      <a href="
      /categories/#virtualization">virtualization</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2025/06/24/initial-exploration-solidfire-proxmox-plugin.html">Do we need a NetApp SolidFire plugin for Proxmox</a></li>
      
        <li><a href="/2022/04/05/proxmox-solidfire.html">Consume SolidFire storage from Proxmox hosts</a></li>
      
        <li><a href="/2024/02/11/add-solidfire-storage-from-kvm.html">Add NetApp SolidFire iSCSI storage to KVM</a></li>
      
        <li><a href="/2024/02/07/migrate-netapp-hci-from-vmware.html">How to change NetApp HCI from VMware to alternatives</a></li>
      
        <li><a href="/2025/06/29/solidfire-with-powershell-7.html">Connecting to SolidFire from PowerShell 7.5</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2025-07-30 18:35 </p>
    <p>Copyright © 2025 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
