<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            InfluxDB 3 Core Alpha available for testing | Acting Technologist
      
    </title>
    <meta name="description" content="
     InfluxDB 3 Core is out for early testing
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>InfluxDB 3 Core Alpha available for testing | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="InfluxDB 3 Core Alpha available for testing" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="InfluxDB 3 Core is out for early testing" />
<meta property="og:description" content="InfluxDB 3 Core is out for early testing" />
<link rel="canonical" href="https://scaleoutsean.github.io/2025/01/24/influxdb-3-core-alpha.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2025/01/24/influxdb-3-core-alpha.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-24T00:00:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2025/01/24/influxdb-3-core-alpha.html"},"author":{"@type":"Person","name":"scaleoutSean"},"description":"InfluxDB 3 Core is out for early testing","@type":"BlogPosting","url":"https://scaleoutsean.github.io/2025/01/24/influxdb-3-core-alpha.html","headline":"InfluxDB 3 Core Alpha available for testing","dateModified":"2025-01-24T00:00:00+08:00","datePublished":"2025-01-24T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">InfluxDB 3 Core Alpha available for testing</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>24 Jan 2025</span> - <i class="far fa-clock"></i> 


  
  
    13 minute read
  

    </span>
  </div>
  
        <ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#whats-backwards-compatible-and-whats-not-in-influxdb-3">What’s backwards compatible and what’s not in InfluxDB 3</a></li>
  <li><a href="#evaluate-with-e-series-performance-analyzer">Evaluate with E-Series Performance Analyzer</a></li>
  <li><a href="#other-details">Other details</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#appendix-a---example">Appendix A - Example</a></li>
  <li><a href="#update-202504">Update (2025/04)</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>When I forked E-Series Performance Analyzer (EPA), I didn’t want to waste time on InfluxDB 2 because that would also require a rework of front-end (Grafana dashboards) and I had a strong dislike for FluxQL.</p>

<p>Then when I rewrote SolidFire Collector (SFC) <a href="/2024/05/03/netapp-solidfire-collector-next.html">I noted I’d pick InfluxDB v1 so that SFC and EPA use the same back-end DB</a>.</p>

<p>The idea behind it all was that <strong>when</strong> InfluxDB 3 comes out - considering the intent to retain compatibility with version 1 - it shouldn’t be hard to upgrade and it’d be possible to completely avoid Flux.</p>

<p>That day <a href="https://www.influxdata.com/blog/influxdb3-open-source-public-alpha/">has come</a>.</p>

<h2 id="whats-backwards-compatible-and-whats-not-in-influxdb-3">What’s backwards compatible and what’s not in InfluxDB 3</h2>

<p>What’s compatible:</p>

<blockquote>
  <p>Support for InfluxDB 1.x and 2.x write APIs</p>
</blockquote>

<blockquote>
  <p>InfluxDB Line Protocol support</p>
</blockquote>

<blockquote>
  <p>InfluxQL query support (and the v1 query API)</p>
</blockquote>

<p>What won’t work is the addition of new tag columns after a table is created.</p>

<p>I don’t remember if EPA or SFC add new tag columns, but we’ll find out as we go.</p>

<h2 id="evaluate-with-e-series-performance-analyzer">Evaluate with E-Series Performance Analyzer</h2>

<p>Currently, InfluxDB 3 Core alpha version may be downloaded and installed to Docker or natively on OS. Choosing the latter is easier if we want to inspect data and just avoid hassle until we know more about it.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-O</span> https://www.influxdata.com/d/install_influxdb3.sh <span class="o">&amp;&amp;</span> sh install_influxdb3.sh
</code></pre></div></div>

<p>Create a database:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>influxdb3 create database epa
Database <span class="s2">"epa"</span> created successfully

<span class="nv">$ </span>influxdb3 show databases
+---------------+
| iox::database |
+---------------+
| epa           |
+---------------+

<span class="nv">$ </span><span class="nb">export </span><span class="nv">INFLUXDB3_DATABASE_NAME</span><span class="o">=</span><span class="s2">"epa"</span>
</code></pre></div></div>

<p>Now we’re set to use the new DB and can write to <code class="language-plaintext highlighter-rouge">epa</code>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>influxdb3 write <span class="nt">-h</span>
Perform a <span class="nb">set </span>of writes to a running InfluxDB 3 Core server

Usage: influxdb3 write <span class="o">[</span>OPTIONS] <span class="nt">--database</span> &lt;DATABASE_NAME&gt; <span class="nt">--file</span> &lt;FILE_PATH&gt;

Options:
  <span class="nt">-H</span>, <span class="nt">--host</span> &lt;HOST_URL&gt;           The host URL of the running InfluxDB 3 Core server <span class="o">[</span><span class="nb">env</span>: <span class="nv">INFLUXDB3_HOST_URL</span><span class="o">=]</span> <span class="o">[</span>default: http://127.0.0.1:8181]
  <span class="nt">-d</span>, <span class="nt">--database</span> &lt;DATABASE_NAME&gt;  The name of the database to operate on <span class="o">[</span><span class="nb">env</span>: <span class="nv">INFLUXDB3_DATABASE_NAME</span><span class="o">=]</span>
      <span class="nt">--token</span> &lt;AUTH_TOKEN&gt;        The token <span class="k">for </span>authentication with the InfluxDB 3 Core server <span class="o">[</span><span class="nb">env</span>: <span class="nv">INFLUXDB3_AUTH_TOKEN</span><span class="o">=]</span>
  <span class="nt">-f</span>, <span class="nt">--file</span> &lt;FILE_PATH&gt;          File path to load the write data from
      <span class="nt">--accept-partial</span>            Flag to request the server accept partial writes
  <span class="nt">-h</span>, <span class="nt">--help</span>                      Print <span class="nb">help </span>information
</code></pre></div></div>

<p>At this point I’m stuck because I don’t have any sample EPA or SFC data that I could send!</p>

<p>I’d have to get access to E-Series or SolidFire to give EPA or SFC a try. I’ll update this post if/when I manage to get that done. (Done - see Appendix.)</p>

<p>We need to test (and maybe modify) just two things:</p>

<ul>
  <li>if EPA and SFC add tags after database has been created and if yes, modify the code to avoid that</li>
  <li>if the Grafana dashboards from EPA have to be modified (probably not, since InfluxQL is mentioned as supported). SFC v2 does not have Grafana dashboards, but I do have all the <a href="https://github.com/scaleoutsean/sfc/blob/master/docs/dashboards.md">InfluxQL queries</a> documented, so we can go down that list and try if all queries work as they work with InfluxDB 1.</li>
</ul>

<h2 id="other-details">Other details</h2>

<p>I haven’t written much about the great new features in InfluxDB 3 since for EPA and SFC users moving to version 3 is not a question of better features but of security requirements.</p>

<p>InfluxDB 3 Core looks very promising, though, I’ve been keeping an eye on it for well over a year and tried using even their public pre-alpha builds.</p>

<p>You may read the official announcement and details <a href="https://www.influxdata.com/blog/influxdb3-open-source-public-alpha/">here</a>.</p>

<p>Since I’m already on this topic, I can’t resist:</p>

<ul>
  <li>version 3 will be able to store data on S3 in the fashion similar to other modern time series databases</li>
  <li>SolidFire Collector, specifically, does not implement any sort of data pruning (why, that’s explained in SFC-related posts), but works around that with smarter (and selective) data collection compared to EPA. But S3 completely solves that now, and you can retain like a maniac</li>
  <li>E-Series Performance Analyzer could also collect more data if data management was easier. With InfluxDB 3 and S3 tiering, it is, so maybe users with thousands of disks (HPC, etc.) would collect more detailed metrics and use them for predictive analytics</li>
</ul>

<p><em>If</em> I get to updating SFC or EPA, I may include a MinIO container so that S3 is included by default and users can start with S3 right away and switch to other S3 if they want. That way SolidFire (i.e. SFC) users will have the option to not hoard metrics data on SolidFire volumes as long as they redirect InfluxDB data store to another S3 rather than MinIO on SolidFire block devices. Built-in S3 back-end in EPA should be valuable to E-Series users with all-flash storage as well.</p>

<h2 id="conclusion">Conclusion</h2>

<p>The decisions to skip version 2 and (for SFC) migrate to InfluxDB 1 were very good.</p>

<p>SFC doesn’t even use any any Python libraries for InfluxDB 1 - all documents are composed “by hand” before being sent to InfluxDB. That was done on purpose so that I don’t have another outdated dependency (in Python library for InfluxDB 1).</p>

<p>Now we can reap rewards by skipping InfluxDB 2 and Flux (yaeah!) while most others are stuck on v2 and have to rewrite queries and re-create dashboards (notice there’s <em>no query support for Flux</em> in InfluxDB 3)!. (You can <a href="https://docs.influxdata.com/influxdb/cloud/reference/syntax/flux/flux-vs-influxql/">read about Flux vs InfluxQL here</a>).</p>

<p>EPA and SFC users may be able to switch to InfluxDB 3 early because EPA and SFC are almost trivial workloads and backward compatibility has been preserved. InfluxDB 3 could be ready for casual production with EPA or SFC in just 2-3 months.</p>

<h2 id="appendix-a---example">Appendix A - Example</h2>

<p>So, I didn’t get access to anything, but I did find some old JSON files from E-Series API, and then I used the EPA collector code to remind myself what the heck I’m supposed to do…</p>

<p>First - continuing from <code class="language-plaintext highlighter-rouge">show databases</code> above - you can export main key variables to save typing time. Note the API token is the other API token, not the first one that InfluxDB spits out when started.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">INFLUXDB3_DATABASE_NAME</span><span class="o">=</span><span class="s1">'epa'</span>
<span class="nb">export </span><span class="nv">INFLUXDB3_HOST_URL</span><span class="o">=</span>http://127.0.0.1:8181
<span class="nb">export </span><span class="nv">INFLUXDB3_AUTH_TOKEN</span><span class="o">=</span>apiv3_OvwR_DVe6P_j-pH8azw6PzTxpn5aYsLK8J4_cKammUrjO4ENGzAEAsBRdJnewMs-mN4RdL7k9A2ap9jSQXmGzQ
</code></pre></div></div>

<p>Then there are problems, such as, the “simple” getting started guide quickly gets you in trouble, because InfluxDB 3 defaults to http (as you can see from the link above), but its new Python library does not.</p>

<p>To work around that you’d have to restart InfluxDB with them “advanced options”. And there’s dozens of them.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>influxdb3 serve <span class="nt">-h</span> | <span class="nb">grep</span> <span class="s1">'      --'</span> | <span class="nb">wc</span> <span class="nt">-l</span>
64
</code></pre></div></div>

<p>Hard pass!</p>

<p>Next, since their <a href="https://github.com/InfluxCommunity/influxdb3-python">Python thing</a> can’t work with HTTP, I had to use a two-step workaround:</p>
<ul>
  <li>Convert data to InfluxDB <a href="https://docs.influxdata.com/influxdb3/core/reference/syntax/line-protocol/">line protocol</a></li>
  <li>Post that stuff to InfluxDB HTTP endpoint (using <code class="language-plaintext highlighter-rouge">curl -X POST</code> or equivalent)</li>
</ul>

<p>That is <em>exactly</em> how I do it in SFC, so no change for me!</p>

<p>Let’s see an example with that E-Series API response. You can see a power consumption response for the EF-Series EF570 model here.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"returnCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"energyStarData"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"totalPower"</span><span class="p">:</span><span class="w"> </span><span class="mi">412</span><span class="p">,</span><span class="w">
    </span><span class="nl">"numberOfTrays"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"trayPower"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"trayID"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"numberOfPowerSupplies"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nl">"inputPower"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="mi">203</span><span class="p">,</span><span class="w">
          </span><span class="mi">209</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>As an aside, I’ve never implemented parsing for multiple trays (which EF570 I used didn’t have) because I’m not sure if trayIDs beyond 0 have the same output format. So I’m still curious about it. For that reason, I spiced this up a bit by imagining how response for multiple trays might look like:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"returnCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"energyStarData"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"totalPower"</span><span class="p">:</span><span class="w"> </span><span class="mi">1112</span><span class="p">,</span><span class="w">
    </span><span class="nl">"numberOfTrays"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"trayPower"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"trayID"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"numberOfPowerSupplies"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nl">"inputPower"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="mi">203</span><span class="p">,</span><span class="w">
          </span><span class="mi">209</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
     </span><span class="p">{</span><span class="w">
        </span><span class="nl">"trayID"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"numberOfPowerSupplies"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nl">"inputPower"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="mi">175</span><span class="p">,</span><span class="w">
          </span><span class="mi">175</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
     </span><span class="p">{</span><span class="w">
        </span><span class="nl">"trayID"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"numberOfPowerSupplies"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nl">"inputPower"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="mi">180</span><span class="p">,</span><span class="w">
          </span><span class="mi">170</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">      
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This could very well be “fake news”, but let’s say that’s how a hybrid EF300 with two 60-drive enclosures might respond.</p>

<p>Notice that (emulated) <code class="language-plaintext highlighter-rouge">energyStarData.totalPower</code> is now 1112, not the same as trayID 0. Currently in EPA I don’t separately report <code class="language-plaintext highlighter-rouge">trayID.inputPower</code> because with 1 tray that’s always the same as totalPower. But for this imaginary response, that’s a sum of all trays’ power supplies.</p>

<p>All rightie! Now we put this in <strong>one line</strong> using InfluxDB’s line protocol. Data values start with tray_id_0_power which is prefixed by the space character.</p>

<p>Here I’ve inserted extra line breaks for easier viewing:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>power,sys_id<span class="o">=</span>array_blah,sys_name<span class="o">=</span>wwn_something 
    <span class="nv">tray_id_0_power</span><span class="o">=</span>412,
    <span class="nv">tray_id_1_power</span><span class="o">=</span>350,
    <span class="nv">tray_id_2_power</span><span class="o">=</span>350,
    <span class="nv">total_system_power</span><span class="o">=</span>1112
</code></pre></div></div>

<p>With that:</p>

<ul>
  <li>I can save that to a temp file (server_data.txt) and send it using <code class="language-plaintext highlighter-rouge">influxdb3 write</code>, or</li>
  <li>I can use <code class="language-plaintext highlighter-rouge">curl</code> or Python requests to send it on-the-fly</li>
</ul>

<p>InfluxDB 3 binary (which is a server/client all-in-one) can write from file, so that would look like this (–database is optional since I have it in ENV):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>influxdb3 write <span class="nt">--database</span><span class="o">=</span>epa <span class="nt">--file</span><span class="o">=</span>server_data.txt
success
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>influxdb3 query <span class="nt">--database</span><span class="o">=</span>epa <span class="s2">"SELECT * FROM power"</span>
+------------+---------------+-------------------------------+--------------------+-----------------+-----------------+-----------------+
| sys_id     | sys_name      | <span class="nb">time</span>                          | total_system_power | tray_id_0_power | tray_id_1_power | tray_id_2_power |
+------------+---------------+-------------------------------+--------------------+-----------------+-----------------+-----------------+
| array_blah | wwn_something | 2025-01-24T17:41:02.042586723 | 1112.0             | 412.0           | 350.0           | 350.0           |
+------------+---------------+-------------------------------+--------------------+-----------------+-----------------+-----------------+
</code></pre></div></div>

<p>We can do that ourselves with <code class="language-plaintext highlighter-rouge">curl</code> or Python <code class="language-plaintext highlighter-rouge">requests</code> and it’s the same way it’s done in SFC (EPA uses Python Influx v1 library, that’s how it was when I forked it).</p>

<p>From TFM:</p>

<blockquote>
  <p>InfluxDB 3 Core provides the /write and /api/v2/write endpoints for backward compatibility with clients that can write data to previous versions of InfluxDB.</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-v</span> <span class="nt">-XPOST</span> <span class="s2">"localhost:8181/api/v3/write_lp?db=epa&amp;precision=auto&amp;accept_partial=false"</span> <span class="se">\</span>
    <span class="nt">--data-raw</span> <span class="s2">"power,sys_id=array_blah,sys_name=wwn_something tray_id_0_power=390,tray_id_1_power=300,tray_id_2_power=300,total_system_power=990"</span> <span class="se">\</span>
    <span class="nt">--Header</span> <span class="s2">"Authorization: Bearer apiv3_OvwR_DVe6P_j-pH8azw6PzTxpn5aYsLK8J4_cKammUrjO4ENGzAEAsBRdJnewMs-mN4RdL7k9A2ap9jSQXmGzQ"</span>
</code></pre></div></div>

<p>This header thing is a token you get when you start InfluxDB 3 Core. I assume there’s a way to generate multiple tokens for multiple users, but I don’t care about this because in my EPA and SFC approach it’s “one array, one database” specifically to avoid having to deal with user management.</p>

<p>If you consolidate databases in one InfluxDB server, please read the InfluxDB docs and modify the code that affects DB instantiation (or remove it and handle instantiation, user and token management externally).</p>

<p>The second point is notice that I used <code class="language-plaintext highlighter-rouge">precision=auto</code>, because <code class="language-plaintext highlighter-rouge">influx3db</code> used <code class="language-plaintext highlighter-rouge">auto</code> as well. But EPA uses second-level precision - there’s nothing to gain from timestamping like this is a space-ship.</p>

<p>After that, we see two records in the table named “power”:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>influxdb3 query <span class="nt">--database</span><span class="o">=</span>epa <span class="s2">"SELECT * FROM power"</span>
+------------+---------------+-------------------------------+--------------------+-----------------+-----------------+-----------------+
| sys_id     | sys_name      | <span class="nb">time</span>                          | total_system_power | tray_id_0_power | tray_id_1_power | tray_id_2_power |
+------------+---------------+-------------------------------+--------------------+-----------------+-----------------+-----------------+
| array_blah | wwn_something | 2025-01-24T18:11:04.150552050 | 990.0              | 390.0           | 300.0           | 300.0           |
| array_blah | wwn_something | 2025-01-24T17:41:02.042586723 | 1112.0             | 412.0           | 350.0           | 350.0           |
+------------+---------------+-------------------------------+--------------------+-----------------+-----------------+-----------------+
</code></pre></div></div>

<p>My conclusion is InfluxDB 3 Core meets my technical expectations (which is, I don’t have to do almost anything to use it, coming from InfluxDB v1).</p>

<p>Stil, the two code bases need changes:</p>

<ul>
  <li>EPA:
    <ul>
      <li>Database initialization section where DB is created</li>
      <li>All inserts may need adjustments (if there are tags and variables with identical keys, for example)</li>
      <li>The included Grafana dashboards may need small documentation changes</li>
      <li>Docker Compose and other templates need updating</li>
    </ul>
  </li>
  <li>SFC:
    <ul>
      <li>Same as EPA. While there are no Grafana dashboards, there are detailed query examples as mentioned above</li>
    </ul>
  </li>
  <li>Extra MinIO container and basic documentation for convenient tiering to S3 from Day 1</li>
</ul>

<h2 id="update-202504">Update (2025/04)</h2>

<p>InfluxDB 3 OSS has been released and now we can start looking into modifying E-Series Performance Analyzer and SolidFire Collector for it…</p>

<p>In line with SFC’s approach to security, I think TLS by default should be the only option. InfluxDB 3.0 Core added certificate related arguments, so we can try that out.</p>

<p>Here’s how I start InfluxDB 3.0 with a valid, CA-issued certificate (the CA certificate is in OS truststore and this is not a dockerized instance).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/sean/.influxdb/influxdb3 serve 
  <span class="nt">--node-id</span><span class="o">=</span><span class="s1">'writer0'</span> <span class="se">\</span>
  <span class="nt">--http-bind</span><span class="o">=</span><span class="s1">'s146:8181'</span> <span class="se">\</span>
  <span class="nt">--object-store</span> file <span class="nt">--data-dir</span> /home/sean/.influxdb/data <span class="se">\</span>
  <span class="nt">--tls-cert</span> /home/sean/.influxdb/certs/server.crt <span class="nt">--tls-key</span> /home/sean/.influxdb/certs/server.key
</code></pre></div></div>

<p>(In EPA and SFC I would use S3 and not filesystem to store InfluxDB data.)</p>

<p>I didn’t disable authorization, so I need a bearer token and then I can access the server securely without any issues (“SSL certificate verify ok.`”).</p>

<p>It’s a bit silly that there’s just one port (same as in previous versions) so when one accessess service at 8181, it’s anyone’s guess what the protocol may be (HTTP or HTTPS). I’ve submitted an <a href="https://github.com/influxdata/influxdb/issues/26263">enhancement request</a> about that, although I doubt it will be accepted. Anyway, let’s move on…</p>

<pre><code class="language-raw">$ curl  -v https://s146:8181/health \
  --Header "Authorization: Bearer apiv3_OvwR_DVe6P_j-pH8azw6PzTxpn5aYsLK8J4_cKammUrjO4ENGzAEAsBRdJnewMs-mN4RdL7k9A2ap9jSQXmGzQ"

* Host s146:8181 was resolved.
* IPv6: (none)
* IPv4: 192.168.1.146
*   Trying 192.168.1.146:8181...
* Connected to s146 (192.168.1.146) port 8181
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
*  CAfile: /etc/ssl/certs/ca-certificates.crt
*  CApath: /etc/ssl/certs
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
* TLSv1.3 (IN), TLS handshake, Certificate (11):
* TLSv1.3 (IN), TLS handshake, CERT verify (15):
* TLSv1.3 (IN), TLS handshake, Finished (20):
* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.3 (OUT), TLS handshake, Finished (20):
* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 / X25519 / id-ecPublicKey
* ALPN: server accepted h2
* Server certificate:
*  subject: CN=s146.datafabric.lan
*  start date: Apr 14 09:39:56 2025 GMT
*  expire date: Jul 13 09:40:56 2025 GMT
*  subjectAltName: host "s146" matched cert's "s146"
*  issuer: O=DataFabric; CN=DataFabric Intermediate CA
*  SSL certificate verify ok.
*   Certificate level 0: Public key type EC/prime256v1 (256/128 Bits/secBits), signed using ecdsa-with-SHA256
*   Certificate level 1: Public key type EC/prime256v1 (256/128 Bits/secBits), signed using ecdsa-with-SHA256
*   Certificate level 2: Public key type EC/prime256v1 (256/128 Bits/secBits), signed using ecdsa-with-SHA256
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
* old SSL session ID is stale, removing
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
* old SSL session ID is stale, removing
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
* old SSL session ID is stale, removing
* using HTTP/2
* [HTTP/2] [1] OPENED stream for https://s146:8181/health
* [HTTP/2] [1] [:method: GET]
* [HTTP/2] [1] [:scheme: https]
* [HTTP/2] [1] [:authority: s146:8181]
* [HTTP/2] [1] [:path: /health]
* [HTTP/2] [1] [user-agent: curl/8.5.0]
* [HTTP/2] [1] [accept: */*]
* [HTTP/2] [1] [authorization: Bearer apiv3_OvwR_DVe6P_j-pH8azw6PzTxpn5aYsLK8J4_cKammUrjO4ENGzAEAsBRdJnewMs-mN4RdL7k9A2ap9jSQXmGzQ]
&gt; GET /health HTTP/2
&gt; Host: s146:8181
&gt; User-Agent: curl/8.5.0
&gt; Accept: */*
&gt; Authorization: Bearer apiv3_OvwR_DVe6P_j-pH8azw6PzTxpn5aYsLK8J4_cKammUrjO4ENGzAEAsBRdJnewMs-mN4RdL7k9A2ap9jSQXmGzQ
&gt; 
&lt; HTTP/2 401 
&lt; date: Wed, 16 Apr 2025 04:10:44 GMT
&lt; 
* Connection #0 to host s146 left intact
</code></pre>

<p>All good, TLS 1.3 is working!</p>

<p>Or, a mix of CLI and curl commands to query an empty <code class="language-plaintext highlighter-rouge">epa</code> DB on <code class="language-plaintext highlighter-rouge">https://s146</code>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>/home/sean/.influxdb/influxdb3 create token <span class="nt">--admin</span> <span class="nt">-H</span> <span class="s2">"https://s146:8181"</span>

<span class="c"># Token: apiv3_1nSeJAtDL2Z2E7vYdIQhHckmPFIHvtWABaulZMvTVwQNuiNe8JA3Hcr-3aAVp0kndWzenDzGaWWCoOVVw52qsw</span>

<span class="nv">$ </span>/home/sean/.influxdb/influxdb3 create database epa <span class="se">\</span>
  <span class="nt">--token</span> apiv3_1nSeJAtDL2Z2E7vYdIQhHckmPFIHvtWABaulZMvTVwQNuiNe8JA3Hcr-3aAVp0kndWzenDzGaWWCoOVVw52qsw <span class="se">\</span>
  <span class="nt">-H</span> https://s146:8181/query

<span class="c"># Database "epa" created successfully</span>

<span class="nv">$ </span>curl https://s146:8181/query <span class="se">\</span>
  <span class="nt">--Header</span> <span class="s2">"Authorization: Bearer apiv3_1nSeJAtDL2Z2E7vYdIQhHckmPFIHvtWABaulZMvTVwQNuiNe8JA3Hcr-3aAVp0kndWzenDzGaWWCoOVVw52qsw"</span> <span class="se">\</span>
  <span class="nt">--data-urlencode</span> <span class="s2">"db=epa"</span> <span class="nt">--data-urlencode</span> <span class="s2">"q=SELECT * FROM epa"</span>

<span class="c"># {"results":[{"statement_id":0}]}</span>
</code></pre></div></div>

<p>Now in order to get EPA and SFC to use InfluxDB 3 OSS, it just needs to be put together and packaged!</p>

<p>Which I may or may not (since I’ve never heard that anyone uses these things) do. But the source code is available and we know it won’t be hard.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
      &nbsp; 
    
      <a href="
      /categories/#monitoring">monitoring</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2023/02/18/epa-eseries-monitor-sensors-psu-power-consumption.html">Gather and visualize E-Series temperature and power consumption metrics with EPA</a></li>
      
        <li><a href="/2024/05/03/netapp-solidfire-collector-next.html">Towards next SolidFire Collector (SFC)</a></li>
      
        <li><a href="/2023/02/25/elasticsearch-eseries-performance.html">Elasticsearch performance with E-Series</a></li>
      
        <li><a href="/2023/01/14/eseries-performance-analyzer-container-orchestrator-kubernetes.html">NetApp E-Series Performance Analyzer in orchestrated container environments</a></li>
      
        <li><a href="/2023/01/08/eseries-flash-ssd-wear-level-monitoring.html">Monitor wear level of NetApp E-Series flash drives via the API and from the CLI</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2025-04-16 12:58 </p>
    <p>Copyright © 2025 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
