<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Tenant (account) attributes on NetApp SolidFire | Acting Technologist
      
    </title>
    <meta name="description" content="
     Make use of storage account attributes on NetApp SolidFire
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tenant (account) attributes on NetApp SolidFire | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Tenant (account) attributes on NetApp SolidFire" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Make use of storage account attributes on NetApp SolidFire" />
<meta property="og:description" content="Make use of storage account attributes on NetApp SolidFire" />
<link rel="canonical" href="https://scaleoutsean.github.io/2024/04/30/netapp-solidfire-account-attributes.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2024/04/30/netapp-solidfire-account-attributes.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:image" content="https://scaleoutsean.github.io/assets/images/solidfire-tenant-account-attributes-01-get-set.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-04-30T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Tenant (account) attributes on NetApp SolidFire","dateModified":"2024-04-30T00:00:00+08:00","datePublished":"2024-04-30T00:00:00+08:00","author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2024/04/30/netapp-solidfire-account-attributes.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2024/04/30/netapp-solidfire-account-attributes.html"},"image":"https://scaleoutsean.github.io/assets/images/solidfire-tenant-account-attributes-01-get-set.png","description":"Make use of storage account attributes on NetApp SolidFire","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Tenant (account) attributes on NetApp SolidFire</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>30 Apr 2024</span> - <i class="far fa-clock"></i> 


  
  
    5 minute read
  

    </span>
  </div>
  
        <h2 id="it-took-me-a-while">It took me a while</h2>

<p>It took me only 6 years to figure out that NetApp SolidFire account object has user-writable attributes.</p>

<p>Volume objects also have attributes, of course, and they’re actively used, for example by NetApp Trident, and by my Set-QoSException module.</p>

<p>In this screenshot you can see how <code class="language-plaintext highlighter-rouge">fstype = xfs</code> is being used to help us identify filesystem (which can be useful in backup and replication workflows, for example).</p>

<p><img src="/assets/images/solidfire-tenant-account-attributes-02-volume-attrs.png" alt="" /></p>

<h2 id="what-about-it">What about it</h2>

<p>Well, it’s at the very least <em>interesting</em> that the feature is available for accounts as well.</p>

<p>Just last week I blogged about “backup to S3” and we could <a href="/2024/04/24/netapp-solidfire-monitor-backup-influx-grafana-11.html#progress">observe</a> that SolidFire bulk volume jobs also have attributes, but not write-able. Unless you check - by trying to set them - you wouldn’t necessarily know they can be modified by storage administrators.</p>

<p>Also:</p>

<ul>
  <li>It’s surprising to me that no one has come up with any use cases for this</li>
  <li>It’s surprising to me that I’ve never heard of this possibility which means very few people outside of SolidFire Engineering knew about this</li>
  <li>No one has experimented or wrote about it (unsurprisingly, this one)</li>
</ul>

<p>(And all that aside, this is yet another example that it takes years to become good at something.)</p>

<p>How do account attributes look like? The same as volume attributes.</p>

<p><img src="/assets/images/solidfire-tenant-account-attributes-01-get-set.png" alt="" /></p>

<ul>
  <li>(1) - Get-SFAccount to get them, Set-SFAccoun to set them</li>
  <li>(2) - You <em>must</em> be careful when handling Get-SFAccount because Initiator and Target secret are included in response</li>
  <li>(3) - In this example I used <code class="language-plaintext highlighter-rouge">handsome=true</code></li>
</ul>

<h2 id="whats-it-good-for">What’s it good for</h2>

<p>That’s up to us.</p>

<p>Let’s say we use (multiple) Kubernetes or Docker (Compose) and deal with tenants (storage accounts) rather than particular volumes. In a vSphere environment we’d likely use one tenant (vSphere), so we wouldn’t deal with individual tenants.</p>

<p>Now in order to automate certain parts of our operations, we may be able to use account attributes rather than build a small PostgreSQL database just to store 5 KB of text.</p>

<p>Get volumes used by Account ID 1, create attributes object and stuff it into the account’s attributes.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$cg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Get-SFAccount</span><span class="w"> </span><span class="nt">-AccountID</span><span class="w"> </span><span class="nx">1</span><span class="p">)</span><span class="o">.</span><span class="nf">Volumes</span><span class="w"> </span><span class="c"># $cg = (1,2)</span><span class="w">
</span><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$backupattrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{</span><span class="s2">"s3"</span><span class="o">=</span><span class="nv">$True</span><span class="p">;</span><span class="s2">"fromSnap"</span><span class="o">=</span><span class="nv">$True</span><span class="p">;</span><span class="s2">"cg"</span><span class="o">=</span><span class="nv">$cg</span><span class="p">}</span><span class="w">
</span><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Set-SFAccount</span><span class="w"> </span><span class="nt">-AccountId</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nt">-Attributes</span><span class="w"> </span><span class="nv">$backupattrs</span><span class="w"> </span><span class="nt">-Confirm</span><span class="p">:</span><span class="nv">$False</span><span class="w">

</span><span class="n">AccountID</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="nx">1</span><span class="w">
</span><span class="n">Username</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="nx">test</span><span class="w">
</span><span class="n">Status</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="nx">active</span><span class="w">
</span><span class="n">Volumes</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span><span class="w">
</span><span class="n">Attributes</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="p">{[</span><span class="n">s3</span><span class="p">,</span><span class="w"> </span><span class="n">True</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">cg</span><span class="p">,</span><span class="w"> </span><span class="n">System.Object</span><span class="p">[]],</span><span class="w"> </span><span class="p">[</span><span class="n">fromSnap</span><span class="p">,</span><span class="w"> </span><span class="n">True</span><span class="p">]}</span><span class="w">

</span></code></pre></div></div>

<p>That’s it! Note that the value of <code class="language-plaintext highlighter-rouge">attributes['cg']</code> is an object itself (a list, in this case).</p>

<p>Now when we run our weekly scheduled backup, rather than backing up all accounts’ data, we can easily find out which accounts want to backup to S3 (<code class="language-plaintext highlighter-rouge">s3 = True</code>) and if I should backup all their accounts or just a Consistency Group. Here CG is (1, 2) which tells me to backup volume IDs 1 &amp; 2.</p>

<p>FromSnap=True tells me to use the latest snapshot I can find, rather than rely on ad-hoc snapshots. This is useful if snapshots are taken in a consistent manner (which is the case of Group Snapshots).</p>

<p>That’s enough to schedule backup-to-S3 jobs when I loop through Account ID 1:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">foreach</span><span class="w"> 
   </span><span class="p">(</span><span class="nv">$vol</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="p">(</span><span class="n">Get-SFAccount</span><span class="w"> </span><span class="nt">-AccountID</span><span class="w"> </span><span class="nx">1</span><span class="p">)</span><span class="o">.</span><span class="nf">Attributes</span><span class="o">.</span><span class="nf">cg</span><span class="p">)</span><span class="w"> 
   </span><span class="p">{</span><span class="w"> </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Backup Volume ID </span><span class="nv">$vol</span><span class="s2"> to S3"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">Backup</span><span class="w"> </span><span class="nx">Volume</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">S3</span><span class="w">
</span><span class="n">Backup</span><span class="w"> </span><span class="nx">Volume</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="nx">2</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">S3</span><span class="w">
</span></code></pre></div></div>

<p>Account ID 1 could even tell me which S3 to backup data to; assuming my backup script had access to a vault, “s3dest=us-east-1” would tell me to backup there, and “dest=(site1,site2)” would tell me to backup twice, once to each site.</p>

<p>Given a simple <a href="/2022/02/14/middle-class-rbac-solidfire-ansible.html">Ansible script or Web UI with RBAC</a>, tenants could update all these details and I wouldn’t need to be in the loop - I’d just send my logs to Elasticsearch or other place for them to observe my work.</p>

<p>Other use cases may be related to disaster recovery and business continuity - anything where a few bytes of settings can replace the cost and complexity of a full-fledged management system.</p>

<h2 id="why-not-use-proper-database">Why not use “proper” database</h2>

<p>What <em>is</em> a proper database?</p>

<p>In <a href="/2024/04/24/netapp-solidfire-monitor-backup-influx-grafana-11.html">this post on using InfluxDB</a> hosted in public cloud I mentioned the possibility of using it as the single source of truth for which volumes are backed up when and where.</p>

<p>That will work, and even with multiple SolidFire clusters (PROD &amp; DR, for example) we’d have a database in the third location, so we’d be able to look up key details when automating recovery from backup or disaster.</p>

<p>But there’s a cost associated with managing databases. Even InfluxDB OSS needs to be hosted, secured, backed up, etc. You also need a front-end, security, auditing, etc. and you may already have solved all of that for SolidFire.</p>

<p>SolidFire’s volume and account attributes aren’t “databases”, but they are “micro database tables” and doing one IO per minute (which would be extremely frequent, as far as updates to attributes are concerned) is definitively not going to overwhelm the SolidFire API.</p>

<p>A proper database, sure, but it’d better be worth $10-$20 K/year!</p>

<p>If you need just basic info and don’t want to manage it separately from storage, volume and account attributes may be enough.</p>

<h2 id="account-attributes-in-json">Account attributes in JSON</h2>

<p>If you’re used to JSON, here’s how $backupattrs above look like in JSON:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"s3"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cg"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="mi">2</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"fromSnap"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>You can create them by hand, in any CLI or in static Web pages with JavaScript support. If working in the CLI this “backup-attrs-JSON” aka <code class="language-plaintext highlighter-rouge">$baj</code> is converted to PowerShell like so.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$backupattrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">$baj</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertFrom-Json</span><span class="p">)</span><span class="w">

  </span><span class="n">s3</span><span class="w"> </span><span class="nx">cg</span><span class="w">     </span><span class="nx">fromSnap</span><span class="w">
  </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="w">     </span><span class="o">--------</span><span class="w">
</span><span class="n">True</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span><span class="w">     </span><span class="n">True</span><span class="w">
</span></code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>SolidFire’s account attributes give us another option for enhancing storage DR, BC and data protection management workflows with minimal effort and without any additional cost.</p>

<p>Volume attributes - as one might imagine - can store volume- and application-related (i.e. data-related) metadata. We could even store last successful backup time in volume attributes and use that in monitoring and reporting.</p>

<p>Account attributes help us address other use cases, where we’re concerned with tenant-related storage services, preferences and options. A static Web site with preferences can give users a way to generate attributes and use Ansible or PowerShell or Python CLI to apply them (or have the SolidFire admin apply them for them).</p>

<p>Both can be nicely automated and are very easy to manage.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
      &nbsp; 
    
      <a href="
      /categories/#automation">automation</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2024/05/04/netapp-solidfire-with-async-http.html">Access NetApp SolidFire API with Async IO</a></li>
      
        <li><a href="/2024/06/19/trident-policy-sucker-for-solidfire-backends.html">Trident QoS policy sucker for SolidFire backend</a></li>
      
        <li><a href="/2024/06/16/snapshot-schedules-in-solidfire.html">Snapshots and snapshot schedules in NetApp SolidFire</a></li>
      
        <li><a href="/2022/09/12/new-ddp-and-e-series-santricity-web-restful-api.html">New Dynamic Disk Pool configuration and E-Series SANtricity</a></li>
      
        <li><a href="/2024/06/15/sfc-adds-volume-replication-monitoring.html">SFC v2 adds volume replication monitoring</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-08-28 17:50 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
