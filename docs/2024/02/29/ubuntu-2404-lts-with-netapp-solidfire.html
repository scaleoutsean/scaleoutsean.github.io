<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            ZFS with NetApp E-Series | Acting Technologist
      
    </title>
    <meta name="description" content="
     Practical use of NetApp-E-Series-backed ZFS from Incus/LXD
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>ZFS with NetApp E-Series | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="ZFS with NetApp E-Series" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Practical use of NetApp-E-Series-backed ZFS from Incus/LXD" />
<meta property="og:description" content="Practical use of NetApp-E-Series-backed ZFS from Incus/LXD" />
<link rel="canonical" href="https://scaleoutsean.github.io/2024/02/29/ubuntu-2404-lts-with-netapp-solidfire.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2024/02/29/ubuntu-2404-lts-with-netapp-solidfire.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:image" content="https://scaleoutsean.github.io/assets/images/ubuntu-2404-lts-with-netapp-solidfire.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-02-29T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"ZFS with NetApp E-Series","dateModified":"2024-02-29T00:00:00+08:00","datePublished":"2024-02-29T00:00:00+08:00","image":"https://scaleoutsean.github.io/assets/images/ubuntu-2404-lts-with-netapp-solidfire.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2024/02/29/ubuntu-2404-lts-with-netapp-solidfire.html"},"author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2024/02/29/ubuntu-2404-lts-with-netapp-solidfire.html","description":"Practical use of NetApp-E-Series-backed ZFS from Incus/LXD","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">ZFS with NetApp E-Series</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>29 Feb 2024</span> - <i class="far fa-clock"></i> 


  
  
    3 minute read
  

    </span>
  </div>
  
        <ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#create-discover-login">Create, discover, login</a></li>
  <li><a href="#efficiency---zfs-on-solifire-vs-solidfire">Efficiency - ZFS on SoliFire vs SolidFire</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<p><strong>NOTE</strong>: accounts and passwords from this post are given as examples and not used in production.</p>

<h2 id="introduction">Introduction</h2>

<p>Ubuntu 24.04 LTS is now in beta and I tried using it with SolidFire demo VM 12.5.0.897.</p>

<p>It’s expected to work, and it works, with NetApp SolidFire 12.</p>

<p>In the process I also tried ZFS with compression enabled to compare it with SolidFire’s native compression and deduplication savings.</p>

<h2 id="create-discover-login">Create, discover, login</h2>

<p>I created a tenant account on SolidFire (using the credentials below) and two volumes. The second one was larger (4GB) and had a 4kB block size, just to try the both.</p>

<p><img src="/assets/images/ubuntu-2404-lts-with-netapp-solidfire-volumes.png" alt="SolidFire volumes" /></p>

<p>Then changed the following lines in /etc/iscsi/iscsid.conf.</p>

<pre><code class="language-raw">node.startup = automatic
node.session.auth.authmethod = CHAP
node.session.auth.chap_algs = MD5
node.session.auth.username = u2404lts
node.session.auth.password = testtesttest
discovery.sendtargets.auth.authmethod = CHAP
discovery.sendtargets.auth.username = u2404lts
discovery.sendtargets.auth.password = testtesttest
</code></pre>

<p>MD5 is the default, but I list it as modified because I tried SHA3-256 which didn’t work. Later I checked and remembered that SHA3-256 was added in <a href="https://docs.netapp.com/us-en/element-software/concepts/concept_rn_whats_new_element.html#secure-chap-algorithms">SolidFire 12.7</a> and because SolidFire demo VM 12.7 wasn’t released, that’s why I don’t have the latest version. So, if you’re on 12.7 you may elect to choose another supported algorithm.</p>

<p>Install Open iSCSI initiator packages and their dependencies, enable open-iscsi service:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> open-iscsi sg3-utils multipath-tools scsitools
<span class="nb">sudo </span>service open-iscsi start
</code></pre></div></div>

<p>Discover and login:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>iscsiadm <span class="nt">-m</span> discovery <span class="nt">--op</span><span class="o">=</span>new <span class="nt">--op</span><span class="o">=</span>del <span class="nt">--type</span> sendtargets <span class="nt">--portal</span> 192.168.1.32
<span class="nb">sudo </span>iscsiadm <span class="nt">--mode</span> node <span class="nt">--loginall</span><span class="o">=</span>all
</code></pre></div></div>

<h2 id="efficiency---zfs-on-solifire-vs-solidfire">Efficiency - ZFS on SoliFire vs SolidFire</h2>

<p>For shits &amp; giggles I created two zpools, one on each volume.</p>

<p><img src="/assets/images/ubuntu-2404-lts-with-netapp-solidfire-pools.png" alt="zpools on SolidFire" /></p>

<p>I disabled compression on the first volume and enabled zstd compression on the second volume (which isn’t something I’d recommend - see the <a href="/2022/04/05/proxmox-solidfire.html">Proxmox post</a>) just to see how it fares against SolidFire’s built-in LZ4.</p>

<p>The way SolidFire works is it first compresses 4kB chunks using LZ4 and then deduplicates them. Deduplication wasn’t enabled here (see my post on the improved <a href="/2024/02/26/zfs-deduplication-netapp-eseries.html">ZFS deduplication</a> here), and I wouldn’t enable it on SolidFire anyway (see the Proxmox post). But if you do, I’d stick to default LZ4 compression.</p>

<p>ZFS also first compresses, so there’s some chance that using LZ4 on ZFS may result in some dedupe between ZFS and non-ZFS filesystems. Using other compression algorithms, probably not. Result with a highly compressible log file:</p>

<ul>
  <li>syslog file on non-compressed ZFS wasn’t compressed; on SolidFire this volume’s efficiency was</li>
  <li>syslog file on ZSTD-compressed ZFS was compressed 7.16x; on SolidFire this volume’s efficiency was</li>
</ul>

<p>As highlighted in the Proxmox post, the same (or similar) syslog file on multiple volumes would still be compressed and deduplicated by SolidFire, but blocks from zpools would not be deduplicated across multiple zpools which I suspect would mean in the end SolidFire would still get a better efficiency ratio. On the other hand, you may gain 2x-4x performance on those volumes, if you’re willing to trade global storage efficiency for lower iSCSI IOPS and/or bandwidth utilization as data coming in is already compressed.</p>

<h2 id="conclusion">Conclusion</h2>

<p>There’s nothing special to note about this, everything works the same way as with 22.04 LTS and 20.04 LTS.</p>

<p>In some cases opportunistically enabling ZFS compression may help you get extra performance and/or lower latency on non-precompressed data, especially if you are willing to trade global SolidFire efficiency for that.</p>

<p><img src="/assets/images/ubuntu-2404-lts-with-netapp-solidfire.png" alt="" /></p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
       
    
  </span>
</div>
    

    
      <div class="related" data-pagefind-ignore>

    <h4>Possibly related - use live search at the top to find other content</h4>
    
    
    
    
    
    
    
        
        
    
        
    
        
    
      
    
        
        
    
        
    
        
          <div class = "related-posts">
          <h5><a href="/2024/02/28/incus-zfs-netapp-eseries.html">• ZFS with NetApp E-Series</a></h5>
          </div>
          
          
        
    
      
    
        
        
    
        
    
        
          <div class = "related-posts">
          <h5><a href="/2024/02/26/zfs-deduplication-netapp-eseries.html">• ZFS deduplication with NetApp E-Series</a></h5>
          </div>
          
          
        
    
      
    
        
        
    
        
    
        
          <div class = "related-posts">
          <h5><a href="/2024/02/23/storagegrid-notifications-kafka.html">• Kafka notifications in NetApp StorageGRID 11.8</a></h5>
          </div>
          
          
        
    
      
    
        
        
    
        
    
        
          <div class = "related-posts">
          <h5><a href="/2024/02/22/storagegrid-delete-old-object-versions.html">• Delete old object versions on NetApp StorageGRID</a></h5>
          </div>
          
          
        
    
      
    
        
        
    
        
    
        
    
      
    
        
        
    
        
    
        
          <div class = "related-posts">
          <h5><a href="/2024/02/15/storagegrid-on-vmware.html">• NetApp StorageGRID on VMware</a></h5>
          </div>
          
          
            
    
    </div>

    

    
  </div><footer class= "footer">
    <p>2024-02-29 13:17 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
