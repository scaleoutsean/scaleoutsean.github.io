<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Extract SolidFire volume attributes created by Trident or other apps | Acting Technologist
      
    </title>
    <meta name="description" content="
     Extract and use SolidFire volume attributes
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Extract SolidFire volume attributes created by Trident or other apps | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Extract SolidFire volume attributes created by Trident or other apps" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Extract and use SolidFire volume attributes" />
<meta property="og:description" content="Extract and use SolidFire volume attributes" />
<link rel="canonical" href="https://scaleoutsean.github.io/2024/07/02/solidfire-volume-attributes-from-trident-and-other-apps.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2024/07/02/solidfire-volume-attributes-from-trident-and-other-apps.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:image" content="https://scaleoutsean.github.io/assets/images/solidfire-volume-trident-and-other-attributes.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-02T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Extract SolidFire volume attributes created by Trident or other apps","dateModified":"2024-07-02T00:00:00+08:00","datePublished":"2024-07-02T00:00:00+08:00","author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2024/07/02/solidfire-volume-attributes-from-trident-and-other-apps.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2024/07/02/solidfire-volume-attributes-from-trident-and-other-apps.html"},"image":"https://scaleoutsean.github.io/assets/images/solidfire-volume-trident-and-other-attributes.png","description":"Extract and use SolidFire volume attributes","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Extract SolidFire volume attributes created by Trident or other apps</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>02 Jul 2024</span> - <i class="far fa-clock"></i> 


  
  
    4 minute read
  

    </span>
  </div>
  
        <p>This series of posts has several parts:</p>

<ul>
  <li>Part 1 - <a href="/2024/06/01/pvc-volume-relationships-in-solidfire-trident-part-1.html">Kubernetes, Trident and SolidFire configuration visibility</a></li>
  <li>Part 2 - <a href="/2024/06/03/pvc-volume-relationships-in-solidfire-trident-part-2.html">Kubernetes, Trident and SolidFire configuration - part 2</a></li>
  <li><strong>Part 3</strong> - this post</li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>Part 1 explained the background of volume attribute values in SolidFire and why that information may be valuable in automation.</p>

<p>Among the applications you may have heard of currently only Trident CSI - maybe Veeam B&amp;R, although I am not sure about the latter - store values there.</p>

<p>ONTAP recently gained the ability to store volume “labels” and since Trident CSI v24.06 Trident can make use of that feature, but SolidFire has had that for many years and Trident has used volume attributes on SolidFire forever (I don’t remember any version of Trident CSI that did not use SolidFire volume attributes.)</p>

<p>As a reminder, you can see an example of Trident volume attributes here:</p>

<p><img src="/assets/images/solidfire-volume-trident-and-other-attributes.png" alt="" /></p>

<p>This post talks about getting that data out and using it.</p>

<h2 id="how-trident-creates-solidfire-volume-attributes">How Trident creates SolidFire volume attributes</h2>

<p>It’s automatic. Create a PVC or import a volume, and Trident will store its metadata in its attributes.</p>

<p>In this case I have the PVC “first” in the namespace “test”:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get pvc <span class="nt">-n</span> <span class="nb">test
</span>NAME    STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
first   Bound    pvc-28c3a08c-e8d5-44d1-8482-1c610d217e7d   2Gi        RWO            bronze         &lt;<span class="nb">unset</span><span class="o">&gt;</span>                 20m
</code></pre></div></div>

<h2 id="whats-in-volume-attributes">What’s in volume attributes</h2>

<p>As a reminder, you may store arbitrary values as long as it fits in and doesn’t conflict with keys used by another application.</p>

<p>This is an example of what Trident v24.06 stored in a volume I created while writing this post:</p>

<pre><code class="language-raw">{ 
    'docker-name': 'pvc-28c3a08c-e8d5-44d1-8482-1c610d217e7d', 
    'fstype': 'xfs', 
    'provisioning': '', 
    'trident': '{"version":"24.06.0","backendUUID":"65c2b43a-5e1e-489f-aa40-3e1d190ad3b9","platform":"kubernetes","platformVersion":"v1.29.6+k3s1","plugin":"solidfire-san"}'
}
</code></pre>

<p>The Trident key contains a JSON document which has Trident version, Trident backend UUID, platform (Kubernetes, I suppose Docker is also possible), platform version (Kubernetes v1.29) and the type of Trident backend (SolidFire SAN).</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"24.06.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"backendUUID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"65c2b43a-5e1e-489f-aa40-3e1d190ad3b9"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"platform"</span><span class="p">:</span><span class="s2">"kubernetes"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"platformVersion"</span><span class="p">:</span><span class="s2">"v1.29.6+k3s1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"plugin"</span><span class="p">:</span><span class="s2">"solidfire-san"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Backend UUID and PVC come from backend registration with Trident and Kubernetes:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~<span class="nv">$ </span>tridentctl get backend <span class="nt">-n</span> trident
+--------------------------+----------------+--------------------------------------+--------+------------+---------+
|           NAME           | STORAGE DRIVER |                 UUID                 | STATE  | USER-STATE | VOLUMES |
+--------------------------+----------------+--------------------------------------+--------+------------+---------+
| solidfire_192.168.105.34 | solidfire-san  | 65c2b43a-5e1e-489f-aa40-3e1d190ad3b9 | online | normal     |       1 |
+--------------------------+----------------+--------------------------------------+--------+------------+---------+

~<span class="nv">$ </span>kubectl get pv <span class="nt">-n</span> <span class="nb">test
</span>NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM        STORAGECLASS
pvc-28c3a08c-e8d5-44d1-8482-1c610d217e7d   2Gi        RWO            Delete           Bound    <span class="nb">test</span>/first   bronze  
</code></pre></div></div>

<p>This image is from Part 1 and I’m showing it again to remind that <code class="language-plaintext highlighter-rouge">docker-name</code> may or may not be the same as <code class="language-plaintext highlighter-rouge">internalName</code>.</p>

<p><img src="/assets/images/kubernetes_to_trident_to_solidfire.png" alt="" /></p>

<h2 id="how-to-use-volume-attributes">How to use volume attributes</h2>

<p>The image above is output of a <a href="/2024/06/01/pvc-volume-relationships-in-solidfire-trident-part-1.html#appendix-a---tridentctl-output-for-volumes-and-backends">a script</a> that maps Kubernetes PVC information to Trident and SolidFire.</p>

<p>With that we technically don’t need additional information to be able to recover PVC to PV mapping even on a replicated SolidFire cluster, but having volume attributes helps us monitor changes over time and create point-in-time reports before or after upgrades.</p>

<p>For example, we may want to check how many volumes have been created with particular version of Kubernetes or Trident, perform “by filesystem” (XFS, ext3, ext4) accounting of PVs, make sure which volume on one SolidFire cluster is replicated to which volume on another, even if their names differ across clusters (which they usually will) or when the Kubernetes name (PVC name) is different from the “internal” (actual volume name on SolidFire).</p>

<h2 id="getting-solidfire-volume-attributes">Getting SolidFire volume attributes</h2>

<p>Here’s an example of getting volume attributes from a list of volumes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lv</span><span class="p">:</span>
<span class="p">...</span>   <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">'attributes'</span><span class="p">]</span><span class="o">!=</span> <span class="p">{}:</span>
<span class="p">...</span>     <span class="k">print</span><span class="p">(</span><span class="s">"Volume attributes:"</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s">'attributes'</span><span class="p">])</span>
<span class="p">...</span>     <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s">'attributes'</span><span class="p">]:</span>
<span class="p">...</span>       <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s">'trident'</span><span class="p">:</span>
<span class="p">...</span>         <span class="k">print</span><span class="p">(</span><span class="s">"Trident key:"</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<span class="p">...</span>         <span class="k">print</span><span class="p">(</span><span class="s">"All Trident values:"</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s">'attributes'</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
<span class="p">...</span>         <span class="n">tv</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">'attributes'</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
<span class="p">...</span>         <span class="k">for</span> <span class="n">tk</span> <span class="ow">in</span> <span class="n">tv</span><span class="p">:</span>
<span class="p">...</span>           <span class="k">print</span><span class="p">(</span><span class="s">"Trident key:"</span><span class="p">,</span> <span class="n">tk</span><span class="p">)</span>
<span class="p">...</span>           <span class="k">print</span><span class="p">(</span><span class="s">"Trident value:"</span><span class="p">,</span> <span class="n">tv</span><span class="p">[</span><span class="n">tk</span><span class="p">])</span>
<span class="p">...</span>       <span class="k">else</span><span class="p">:</span>
<span class="p">...</span>         <span class="k">print</span><span class="p">(</span><span class="s">"Other key:"</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<span class="p">...</span>         <span class="k">print</span><span class="p">(</span><span class="s">"Other value:"</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s">'attributes'</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
<span class="p">...</span> 
<span class="n">Volume</span> <span class="n">attributes</span><span class="p">:</span> <span class="p">{</span><span class="s">'docker-name'</span><span class="p">:</span> <span class="s">'pvc-28c3a08c-e8d5-44d1-8482-1c610d217e7d'</span><span class="p">,</span> <span class="s">'fstype'</span><span class="p">:</span> <span class="s">'xfs'</span><span class="p">,</span> <span class="s">'provisioning'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span> <span class="s">'trident'</span><span class="p">:</span> <span class="s">'{"version":"24.06.0","backendUUID":"65c2b43a-5e1e-489f-aa40-3e1d190ad3b9","platform":"kubernetes","platformVersion":"v1.29.6+k3s1","plugin":"solidfire-san"}'</span><span class="p">}</span>
<span class="n">Other</span> <span class="n">key</span><span class="p">:</span> <span class="n">docker</span><span class="o">-</span><span class="n">name</span>
<span class="n">Other</span> <span class="n">value</span><span class="p">:</span> <span class="n">pvc</span><span class="o">-</span><span class="mi">28</span><span class="n">c3a08c</span><span class="o">-</span><span class="n">e8d5</span><span class="o">-</span><span class="mi">44</span><span class="n">d1</span><span class="o">-</span><span class="mi">8482</span><span class="o">-</span><span class="mi">1</span><span class="n">c610d217e7d</span>
<span class="n">Other</span> <span class="n">key</span><span class="p">:</span> <span class="n">fstype</span>
<span class="n">Other</span> <span class="n">value</span><span class="p">:</span> <span class="n">xfs</span>
<span class="n">Other</span> <span class="n">key</span><span class="p">:</span> <span class="n">provisioning</span>
<span class="n">Other</span> <span class="n">value</span><span class="p">:</span> 
<span class="n">Trident</span> <span class="n">key</span><span class="p">:</span> <span class="n">trident</span>
<span class="n">All</span> <span class="n">Trident</span> <span class="n">values</span><span class="p">:</span> <span class="p">{</span><span class="s">"version"</span><span class="p">:</span><span class="s">"24.06.0"</span><span class="p">,</span><span class="s">"backendUUID"</span><span class="p">:</span><span class="s">"65c2b43a-5e1e-489f-aa40-3e1d190ad3b9"</span><span class="p">,</span><span class="s">"platform"</span><span class="p">:</span><span class="s">"kubernetes"</span><span class="p">,</span><span class="s">"platformVersion"</span><span class="p">:</span><span class="s">"v1.29.6+k3s1"</span><span class="p">,</span><span class="s">"plugin"</span><span class="p">:</span><span class="s">"solidfire-san"</span><span class="p">}</span>
<span class="n">Trident</span> <span class="n">key</span><span class="p">:</span> <span class="n">version</span>
<span class="n">Trident</span> <span class="n">value</span><span class="p">:</span> <span class="mf">24.06</span><span class="p">.</span><span class="mi">0</span>
<span class="n">Trident</span> <span class="n">key</span><span class="p">:</span> <span class="n">backendUUID</span>
<span class="n">Trident</span> <span class="n">value</span><span class="p">:</span> <span class="mi">65</span><span class="n">c2b43a</span><span class="o">-</span><span class="mf">5e1</span><span class="n">e</span><span class="o">-</span><span class="mi">489</span><span class="n">f</span><span class="o">-</span><span class="n">aa40</span><span class="o">-</span><span class="mf">3e1</span><span class="n">d190ad3b9</span>
<span class="n">Trident</span> <span class="n">key</span><span class="p">:</span> <span class="n">platform</span>
<span class="n">Trident</span> <span class="n">value</span><span class="p">:</span> <span class="n">kubernetes</span>
<span class="n">Trident</span> <span class="n">key</span><span class="p">:</span> <span class="n">platformVersion</span>
<span class="n">Trident</span> <span class="n">value</span><span class="p">:</span> <span class="n">v1</span><span class="p">.</span><span class="mf">29.6</span><span class="o">+</span><span class="n">k3s1</span>
<span class="n">Trident</span> <span class="n">key</span><span class="p">:</span> <span class="n">plugin</span>
<span class="n">Trident</span> <span class="n">value</span><span class="p">:</span> <span class="n">solidfire</span><span class="o">-</span><span class="n">san</span>
</code></pre></div></div>

<p><a href="https://github.com/scaleoutsean/sfc">SolidFire Collector</a> could store these attributes in Volumes measurement by adding half a dozen new columns, or maybe create a new measurement just for attributes.</p>

<p>I’ll probably experiment with the both approaches, and pick one that seems to work better. Either way, since SolidFire Collector is permissively licensed, once that sample code is out, it will be easier for others to modify and use it as they see fit.</p>

<h2 id="conclusion">Conclusion</h2>

<p>This year I’ve been working more on SolidFire-Kubernetes integration and so far this is my progress:</p>

<ul>
  <li>Wrote <a href="https://github.com/scaleoutsean/longhorny">Longhorny</a> which makes it easy to configure and report on volume replication between SolidFire clusters. and has some features related to Kubernetes environments (e.g. the ability to upsize the remote replica)</li>
  <li>Added volume replication-related collection to <a href="https://github.com/scaleoutsean/sfc">SFC</a> so that volume replication can be monitored in near real-time (60s delay)</li>
  <li>Wrote <a href="https://github.com/scaleoutsean/awesome-solidfire/blob/master/scripts/kubernetes-trident-solidfire-pvc-to-volume-mapping.py">Trident-to-SolidFire mapping script</a> which makes it easier to understand Kubernetes-to-SolidFire mapping for replicated clusters</li>
</ul>

<p>With volume attributes in SFC it should be possible to get a very good visibility into the status of Kubernetes provisioning on SolidFire on both single-site and replicated two-site SolidFire environments and feed that information to other applications such as Velero.</p>

<p>Another option is to output from Velero on one site to create SolidFire replication relationships using Longhorny.</p>


      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
      &nbsp; 
    
      <a href="
      /categories/#solidfire">solidfire</a>
      &nbsp; 
    
      <a href="
      /categories/#automation">automation</a>
      &nbsp; 
    
      <a href="
      /categories/#kubernetes">kubernetes</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2024/06/28/growing-solidfire-volumes-paired-for-replication.html">Increase size of SolidFire volumes paired for replication</a></li>
      
        <li><a href="/2021/03/20/kubernetes-solidfire-failover-failback.html">Kubernetes failover and failback with Trident CSI and SolidFire</a></li>
      
        <li><a href="/2022/05/04/trident-csi-api.html">Trident CSI REST API</a></li>
      
        <li><a href="/2024/05/04/netapp-solidfire-with-async-http.html">Access NetApp SolidFire API with Async IO</a></li>
      
        <li><a href="/2022/04/28/solidfire-operator-kubernetes.html">SolidFire Operator for Kubernetes</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-07-02 23:15 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
