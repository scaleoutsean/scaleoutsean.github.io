<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Quickly install NetApp Trident v24.02 on ARM64 Kubernetes | Acting Technologist
      
    </title>
    <meta name="description" content="
     Quick installation of NetApp Trident v24.02 for ARM64 from pre-built images
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Quickly install NetApp Trident v24.02 on ARM64 Kubernetes | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Quickly install NetApp Trident v24.02 on ARM64 Kubernetes" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Quick installation of NetApp Trident v24.02 for ARM64 from pre-built images" />
<meta property="og:description" content="Quick installation of NetApp Trident v24.02 for ARM64 from pre-built images" />
<link rel="canonical" href="https://scaleoutsean.github.io/2024/03/21/netapp-trident-v2402-arm64.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2024/03/21/netapp-trident-v2402-arm64.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-03-21T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Quickly install NetApp Trident v24.02 on ARM64 Kubernetes","dateModified":"2024-03-21T00:00:00+08:00","datePublished":"2024-03-21T00:00:00+08:00","author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2024/03/21/netapp-trident-v2402-arm64.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2024/03/21/netapp-trident-v2402-arm64.html"},"description":"Quick installation of NetApp Trident v24.02 for ARM64 from pre-built images","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Quickly install NetApp Trident v24.02 on ARM64 Kubernetes</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>21 Mar 2024</span> - <i class="far fa-clock"></i> 


  
  
    6 minute read
  

    </span>
  </div>
  
        <h2 id="here-we-go-again">Here we go again…</h2>

<p>I started building Trident for ARM64 <a href="/2021/02/24/netapp-trident-on-arm64.html">years ago</a>, before it was a thing.</p>

<p>Because it wasn’t convenient and I disliked the process (or the documentation - in any case, it wasn’t a good experience), I even started maintaining a patched no-brainer fork repository and published Trident container images for almost two years.</p>

<p>Then in v23.01 ARM64 became officially supported (yay!), so I archived <a href="https://github.com/scaleoutsean/trident">that repo</a>.</p>

<p>It didn’t take long to realize that ARM64 is still a 2nd class citizen, so here we go again…</p>

<p>If you’re looking for a newer release, it is recommended to check the official documentation because this post may be outdated by then.</p>

<h2 id="install-netapp-trident-on-arm64-nodes">Install NetApp Trident on ARM64 nodes</h2>

<p>These instructions are for a quick installation of NetApp Trident v24.02 on ARM64-only clusters. If you have a mixed cluster, refer to the official docs or see the README.md in my archived repo for ideas on how to deal with that.</p>

<p>Download and decompress <a href="https://github.com/NetApp/trident/releases/">trident-installer</a>.</p>

<p>In the past I’d post tridentctl for ARM64 to my Trident repo, but now the repo is archived (nothing can be posted) so I’m back to explaining this again:</p>

<ul>
  <li>If you want to build Trident on ARM64, get the Trident source code, from which you can build tridentctl for ARM64. Presumably you don’t want this and you’re reading this post because you want something done quickly. Read on..</li>
  <li>Since you want to do that quickly, you’d probably want a ready-made tridentctl for ARM64, which I now can’t post to that archived repo. For ARM64, extract it from my Docker Hub image for ARM64 or download here:
    <ul>
      <li><a href="https://pub-b36e83914b354d7d9986e006905799c0.r2.dev/tridentctl-v24.02">tridentctl v24.02 for ARM64</a> (SHA256: d4586b6af90511c789b519d90eac5427d1932c191b12b4f409385c0df289493f)</li>
      <li>tridentctl for x86_64 - it’s contained in trident-installer.tar.gz, if you want to generate YAML setup files on x86_64</li>
    </ul>
  </li>
</ul>

<p>In the decompressed directory trident-installer generate a custom set of YAML files:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>trident-installer
./tridentctl <span class="nb">install</span> <span class="nt">--generate-custom-yaml</span>
</code></pre></div></div>

<p>If you did that on x86_64, copy the entire trident-installer directory <code class="language-plaintext highlighter-rouge">setup</code> to your ARM64 system (“myarm”). If you’re on ARM64, skip this step.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ..
scp <span class="nt">-r</span> ./trident-installer myarm:/tmp/
</code></pre></div></div>

<p>Now SSH to your ARM64 box and first modify these two files as appropriate: setup/trident-daemonset.yml and setup/trident-deployment.yml.</p>

<p>See my archived repository above for the details, but it’s basically about the following:</p>

<ul>
  <li>Remove NetApp autosupport from your deployment</li>
  <li>Remove AMD64 mentions to avoid any screwups with AMD64</li>
  <li>Set Trident image(s) to your repo if you built Trident by yourself. Or use my images from Docker Hub (see YAML files below)</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /tmp/trident-installer
<span class="c"># vim setup/trident-daemonset.yml</span>
<span class="c"># vim setup/trident-deployment.yml</span>
</code></pre></div></div>

<p>If you wish you can copy these two files over the same files in your setup directory, and see if that works for you.</p>

<ul>
  <li>setup/trident-daemonset.yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">DaemonSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">trident-node-linux</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="s">kubectl.kubernetes.io/default-container</span><span class="pi">:</span> <span class="s">trident-main</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">node.csi.trident.netapp.io</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">node.csi.trident.netapp.io</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">node.csi.trident.netapp.io</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">serviceAccount</span><span class="pi">:</span> <span class="s">trident-node-linux</span>
      <span class="na">hostNetwork</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">hostIPC</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">hostPID</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">dnsPolicy</span><span class="pi">:</span> <span class="s">ClusterFirstWithHostNet</span>
      <span class="na">priorityClassName</span><span class="pi">:</span> <span class="s">system-node-critical</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">trident-main</span>
        <span class="na">securityContext</span><span class="pi">:</span>
          <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
          <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">true</span>
          <span class="na">capabilities</span><span class="pi">:</span>
            <span class="na">drop</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">all</span>
            <span class="na">add</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">SYS_ADMIN</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">scaleoutsean/trident-arm64:v24.02</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
        <span class="na">command</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">/trident_orchestrator</span>
        <span class="na">args</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--no_persistence"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--k8s_pod"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--rest=false"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi_node_name=$(KUBE_NODE_NAME)"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi_endpoint=$(CSI_ENDPOINT)"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi_role=node"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--log_format=text"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--log_level=info"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--log_workflows="</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--log_layers="</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--disable_audit_log=true"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--http_request_timeout=1m30s"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--https_rest"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--https_port=17546"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--enable_force_detach=false"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--iscsi_self_healing_interval=5m0s"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--iscsi_self_healing_wait_time=7m0s"</span>
        <span class="c1">#- -debug</span>
        <span class="na">startupProbe</span><span class="pi">:</span>
          <span class="na">httpGet</span><span class="pi">:</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/liveness</span>
            <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTPS</span>
            <span class="na">port</span><span class="pi">:</span> <span class="m">17546</span>
          <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">5</span>
          <span class="na">timeoutSeconds</span><span class="pi">:</span> <span class="m">1</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">5</span>
        <span class="na">livenessProbe</span><span class="pi">:</span>
          <span class="na">httpGet</span><span class="pi">:</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/liveness</span>
            <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTPS</span>
            <span class="na">port</span><span class="pi">:</span> <span class="m">17546</span>
          <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">3</span>
          <span class="na">timeoutSeconds</span><span class="pi">:</span> <span class="m">1</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
        <span class="na">readinessProbe</span><span class="pi">:</span>
          <span class="na">httpGet</span><span class="pi">:</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/readiness</span>
            <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTPS</span>
            <span class="na">port</span><span class="pi">:</span> <span class="m">17546</span>
          <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">5</span>
          <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">KUBE_NODE_NAME</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">fieldRef</span><span class="pi">:</span>
              <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
              <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">spec.nodeName</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">KUBELET_DIR</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">/var/lib/kubelet</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CSI_ENDPOINT</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">unix://plugin/csi.sock</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">PATH</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">/netapp:/bin</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">plugin-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/plugin</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">plugins-mount-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/lib/kubelet/plugins</span>
          <span class="na">mountPropagation</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Bidirectional"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">pods-mount-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/lib/kubelet/pods</span>
          <span class="na">mountPropagation</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Bidirectional"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">dev-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/dev</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">sys-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/sys</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">host-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/host</span>
          <span class="na">mountPropagation</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Bidirectional"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">trident-tracking-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/lib/trident/tracking</span>
          <span class="na">mountPropagation</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Bidirectional"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">certs</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/certs</span>
          <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">driver-registrar</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">registry.k8s.io/sig-storage/csi-node-driver-registrar:v2.10.0</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
        <span class="na">args</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--v=2"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi-address=$(ADDRESS)"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--kubelet-registration-path=$(REGISTRATION_PATH)"</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ADDRESS</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">/plugin/csi.sock</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">REGISTRATION_PATH</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/var/lib/kubelet/plugins/csi.trident.netapp.io/csi.sock"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">KUBE_NODE_NAME</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">fieldRef</span><span class="pi">:</span>
              <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">spec.nodeName</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">plugin-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/plugin</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registration-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/registration</span>
      <span class="na">affinity</span><span class="pi">:</span>
        <span class="na">nodeAffinity</span><span class="pi">:</span>
          <span class="na">requiredDuringSchedulingIgnoredDuringExecution</span><span class="pi">:</span>
            <span class="na">nodeSelectorTerms</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">matchExpressions</span><span class="pi">:</span>
                  <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">kubernetes.io/arch</span>
                    <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
                    <span class="na">values</span><span class="pi">:</span>
                    <span class="pi">-</span> <span class="s">arm64</span>
                  <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">kubernetes.io/os</span>
                    <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
                    <span class="na">values</span><span class="pi">:</span>
                    <span class="pi">-</span> <span class="s">linux</span>
        <span class="na">podAntiAffinity</span><span class="pi">:</span>
          <span class="na">requiredDuringSchedulingIgnoredDuringExecution</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">labelSelector</span><span class="pi">:</span>
                <span class="na">matchExpressions</span><span class="pi">:</span>
                  <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">app</span>
                    <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
                    <span class="na">values</span><span class="pi">:</span>
                      <span class="pi">-</span> <span class="s">node.csi.trident.netapp.io</span>
              <span class="na">topologyKey</span><span class="pi">:</span> <span class="s">kubernetes.io/hostname</span>
      <span class="na">tolerations</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s2">"</span><span class="s">NoExecute"</span>
        <span class="na">operator</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Exists"</span>
      <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s2">"</span><span class="s">NoSchedule"</span>
        <span class="na">operator</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Exists"</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">plugin-dir</span>
        <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/var/lib/kubelet/plugins/csi.trident.netapp.io/</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">DirectoryOrCreate</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registration-dir</span>
        <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/var/lib/kubelet/plugins_registry/</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">Directory</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">plugins-mount-dir</span>
        <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/var/lib/kubelet/plugins</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">DirectoryOrCreate</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">pods-mount-dir</span>
        <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/var/lib/kubelet/pods</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">DirectoryOrCreate</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">dev-dir</span>
        <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/dev</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">Directory</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">sys-dir</span>
        <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/sys</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">Directory</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">host-dir</span>
        <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">Directory</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">trident-tracking-dir</span>
        <span class="na">hostPath</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/var/lib/trident/tracking</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">DirectoryOrCreate</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">certs</span>
        <span class="na">projected</span><span class="pi">:</span>
          <span class="na">sources</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">secret</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">trident-csi</span>
          <span class="pi">-</span> <span class="na">secret</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">trident-encryption-keys</span>

</code></pre></div></div>

<ul>
  <li>setup/trident-deployment.yaml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">trident-controller</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">controller.csi.trident.netapp.io</span>
    <span class="s">kubectl.kubernetes.io/default-container</span><span class="pi">:</span> <span class="s">trident-main</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">Recreate</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">controller.csi.trident.netapp.io</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">controller.csi.trident.netapp.io</span>
        
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">serviceAccount</span><span class="pi">:</span> <span class="s">trident-controller</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">trident-main</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">scaleoutsean/trident-arm64:v24.02</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
        <span class="na">securityContext</span><span class="pi">:</span>
          <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="no">false</span>
          <span class="na">capabilities</span><span class="pi">:</span>
            <span class="na">drop</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">all</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8443</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8001</span>
        <span class="na">command</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">/trident_orchestrator</span>
        <span class="na">args</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--crd_persistence"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--k8s_pod"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--https_rest"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--https_port=8443"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi_node_name=$(KUBE_NODE_NAME)"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi_endpoint=$(CSI_ENDPOINT)"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi_role=controller"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--log_format=text"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--log_level=info"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--log_workflows="</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--log_layers="</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--disable_audit_log=true"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--address=127.0.0.1"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--http_request_timeout=1m30s"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--enable_force_detach=false"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--metrics"</span>
        
        <span class="c1">#- -debug</span>
        <span class="na">livenessProbe</span><span class="pi">:</span>
          <span class="na">exec</span><span class="pi">:</span>
            <span class="na">command</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">tridentctl</span>
            <span class="pi">-</span> <span class="s">-s</span>
            <span class="pi">-</span> <span class="s2">"</span><span class="s">127.0.0.1:8000"</span>
            <span class="pi">-</span> <span class="s">version</span>
          <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">2</span>
          <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">120</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">120</span>
          <span class="na">timeoutSeconds</span><span class="pi">:</span> <span class="m">90</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">KUBE_NODE_NAME</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">fieldRef</span><span class="pi">:</span>
              <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
              <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">spec.nodeName</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CSI_ENDPOINT</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">unix://plugin/csi.sock</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">TRIDENT_SERVER</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">127.0.0.1:8000"</span>
        
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">socket-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/plugin</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">certs</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/certs</span>
          <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
        
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">csi-provisioner</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">registry.k8s.io/sig-storage/csi-provisioner:v4.0.0</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
        <span class="na">securityContext</span><span class="pi">:</span>
          <span class="na">capabilities</span><span class="pi">:</span>
            <span class="na">drop</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">all</span>
        <span class="na">args</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--v=2"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--timeout=600s"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi-address=$(ADDRESS)"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--retry-interval-start=8s"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--retry-interval-max=30s"</span>
        
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ADDRESS</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">/var/lib/csi/sockets/pluginproxy/csi.sock</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">socket-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/lib/csi/sockets/pluginproxy/</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">csi-attacher</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">registry.k8s.io/sig-storage/csi-attacher:v4.5.0</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
        <span class="na">securityContext</span><span class="pi">:</span>
          <span class="na">capabilities</span><span class="pi">:</span>
            <span class="na">drop</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">all</span>
        <span class="na">args</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--v=2"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--timeout=60s"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--retry-interval-start=10s"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi-address=$(ADDRESS)"</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ADDRESS</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">/var/lib/csi/sockets/pluginproxy/csi.sock</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">socket-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/lib/csi/sockets/pluginproxy/</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">csi-resizer</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">registry.k8s.io/sig-storage/csi-resizer:v1.9.3</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
        <span class="na">args</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--v=2"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--timeout=300s"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi-address=$(ADDRESS)"</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ADDRESS</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">/var/lib/csi/sockets/pluginproxy/csi.sock</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">socket-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/lib/csi/sockets/pluginproxy/</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">csi-snapshotter</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">registry.k8s.io/sig-storage/csi-snapshotter:v6.3.3</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
        <span class="na">securityContext</span><span class="pi">:</span>
          <span class="na">capabilities</span><span class="pi">:</span>
            <span class="na">drop</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">all</span>
        <span class="na">args</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--v=2"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--timeout=300s"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">--csi-address=$(ADDRESS)"</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ADDRESS</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">/var/lib/csi/sockets/pluginproxy/csi.sock</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">socket-dir</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/lib/csi/sockets/pluginproxy/</span>
      
      <span class="na">affinity</span><span class="pi">:</span>
        <span class="na">nodeAffinity</span><span class="pi">:</span>
          <span class="na">requiredDuringSchedulingIgnoredDuringExecution</span><span class="pi">:</span>
            <span class="na">nodeSelectorTerms</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">matchExpressions</span><span class="pi">:</span>
                  <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">kubernetes.io/arch</span>
                    <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
                    <span class="na">values</span><span class="pi">:</span>
                    <span class="pi">-</span> <span class="s">arm64</span>
                  <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">kubernetes.io/os</span>
                    <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
                    <span class="na">values</span><span class="pi">:</span>
                    <span class="pi">-</span> <span class="s">linux</span>
      <span class="na">tolerations</span><span class="pi">:</span> <span class="pi">[]</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">socket-dir</span>
        <span class="na">emptyDir</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">certs</span>
        <span class="na">projected</span><span class="pi">:</span>
          <span class="na">sources</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">secret</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">trident-csi</span>
          <span class="pi">-</span> <span class="na">secret</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">trident-encryption-keys</span>

</code></pre></div></div>

<p>Finally, create the namespace <code class="language-plaintext highlighter-rouge">trident</code> in Kubernetes and install.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create ns trident
./tridentctl <span class="nb">install</span> <span class="nt">--use-custom-yaml</span> <span class="nt">-n</span> trident
</code></pre></div></div>

<h2 id="software-stack">Software stack</h2>

<p>Trident can work with any Kubernetes that supports CSI provisioners. See the Trident documentation for more.</p>

<p>My environment:</p>

<ul>
  <li>Ubuntu 22.04 LTS on ARM64</li>
  <li>Docker 24.0.7</li>
  <li>Kubernetes v1.28.3</li>
  <li>NetApp Astra Trident v24.02 for ARM64</li>
</ul>

<pre><code class="language-raw"># Pre-built Trident v24.02 for ARM64
docker image pull scaleoutsean/trident-arm64:v24.02
docker image pull scaleoutsean/trident-operator:v24.02
# Pre-built tridentctl v24.02 for ARM64
# SHA256: d4586b6af90511c789b519d90eac5427d1932c191b12b4f409385c0df289493f
wget https://pub-b36e83914b354d7d9986e006905799c0.r2.dev/tridentctl-v24.02

</code></pre>

<p>As always, you’re encouraged to build your own images from the upstream source.</p>

<p>I hope this saved you some time and frustration.</p>


      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
      &nbsp; 
    
      <a href="
      /categories/#kubernetes">kubernetes</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2023/08/02/netapp-trident-v2307.html">What's new in NetApp Trident v23.07</a></li>
      
        <li><a href="/2021/02/24/netapp-trident-on-arm64.html">NetApp Trident v21.01.1 on Linux/ARM64 with SolidFire iSCSI storage</a></li>
      
        <li><a href="/2023/04/15/cloudcasa-netapp-trident-solidfire.html">CloudCasa, Velero, NetApp Trident, and SolidFire</a></li>
      
        <li><a href="/2021/03/28/manage-netapp-trident-with-powershell.html">NetApp SolidFire and Trident CSI failover automation with Powershell</a></li>
      
        <li><a href="/2021/02/02/trident-21.01-install-with-helm-on-netapp-hci.html">Install NetApp Trident v21.01.01 with Helm v3 and configure a SolidFire back-end</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-07-26 22:22 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
