<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Use Telegraf to send NetApp SolidFire metrics to InfluxDB | Acting Technologist
      
    </title>
    <meta name="description" content="
     Use Telegraf exec plugin to send SolidFire metrics to InfluxDB
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Use Telegraf to send NetApp SolidFire metrics to InfluxDB | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Use Telegraf to send NetApp SolidFire metrics to InfluxDB" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Use Telegraf exec plugin to send SolidFire metrics to InfluxDB" />
<meta property="og:description" content="Use Telegraf exec plugin to send SolidFire metrics to InfluxDB" />
<link rel="canonical" href="https://scaleoutsean.github.io/2024/05/20/netapp-solidfire-input-for-telegraf.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2024/05/20/netapp-solidfire-input-for-telegraf.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:image" content="https://scaleoutsean.github.io/assets/images/solidfire_telegraf_monitor.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-05-20T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Use Telegraf to send NetApp SolidFire metrics to InfluxDB","dateModified":"2024-05-20T00:00:00+08:00","datePublished":"2024-05-20T00:00:00+08:00","author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2024/05/20/netapp-solidfire-input-for-telegraf.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2024/05/20/netapp-solidfire-input-for-telegraf.html"},"image":"https://scaleoutsean.github.io/assets/images/solidfire_telegraf_monitor.png","description":"Use Telegraf exec plugin to send SolidFire metrics to InfluxDB","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Use Telegraf to send NetApp SolidFire metrics to InfluxDB</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>20 May 2024</span> - <i class="far fa-clock"></i> 


  
  
    3 minute read
  

    </span>
  </div>
  
        <p>As I’m still thinking how to move ahead with <a href="/2024/05/03/netapp-solidfire-collector-next.html">SFC</a>, I’ve been checking out Telegraf again.</p>

<p>The idea is maybe I should just use Telegraf instead… I’m still thinking about it and today I was evaluating Telegraf again.</p>

<p><a href="/2021/08/13/solidfire-snmp-v3-grafana.html">This</a> post shows how to use SNMP input for Telegraf to collect SolidFire metrics, but SolidFire SNMP output is quite basic.</p>

<p>A better - but also time-consuming - approach is to use another input and gater SolidFire metrics from the API.</p>

<p>I used PowerShell to collect volume metrics. I probably shouldn’t have…</p>

<p>Thanks to a PowerShell bug I ended up collecting metrics <em>indirectly</em>. That is, instead of using <code class="language-plaintext highlighter-rouge">inputs.exec</code> with PowerShell script that sends output to InfluxDB, I had to run the script as root and spit data out to where Telegraf can read it.</p>

<p>I know that shouldn’t be /etc/telegraf/, but I ran out of patience. Anyways, this is how my config looks like after volume properties (Get-SFVolume) and stats (Get-SFVolumeStats) are saved to two files in the InfluxDB format.</p>

<pre><code class="language-raw">[agent]
  interval = "60s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "60s"
  flush_jitter = "5s"
  precision = "60s"
  omit_hostname = true
[global_tags]
[[inputs.file]]
  data_format = "influx"
  files = ["/etc/telegraf/telegraf01.out", "/etc/telegraf/telegraf02.out"]
[[outputs.influxdb]]
  urls = ["http://192.168.50.184:32290"]
  database = "solidgraf"
  skip_database_creation = false
  timeout = "5s"
  content_encoding = "gzip"
</code></pre>

<p>I just run a script from crontab and overwrite these two files every minute.</p>

<p>Then Telegraf picks them uip and sends them to InfluxDB (version 1, in my case - see <code class="language-plaintext highlighter-rouge">output.influxdb</code> above), and I get this:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">volumeStats</span>
<span class="n">name</span><span class="p">:</span> <span class="n">volumeStats</span>
<span class="nb">time</span>                 <span class="n">accountID</span> <span class="n">actualIOPS_final</span> <span class="n">averageIOpSize_final</span> <span class="k">host</span>         <span class="n">latencyUSec_final</span> <span class="n">readLatencyUSec_final</span> <span class="n">throttle_final</span> <span class="n">volUtilPct_final</span> <span class="n">volumeId</span> <span class="n">volumeName</span>                               <span class="n">volumeUtil_final</span> <span class="n">writeLatencyUSec_final</span> <span class="n">zeroBlocks_final</span>
<span class="c1">----                 --------- ---------------- -------------------- ----         ----------------- --------------------- -------------- ---------------- -------- ----------                               ---------------- ---------------------- ----------------</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">1</span>         <span class="mi">0</span>                <span class="mi">1920</span>                 <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">0</span>                     <span class="mi">0</span>              <span class="mi">0</span>                <span class="mi">1</span>        <span class="k">data</span>                                     <span class="mi">0</span>                <span class="mi">0</span>                      <span class="mi">486871</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">1</span>         <span class="mi">0</span>                <span class="mi">1964</span>                 <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">0</span>                     <span class="mi">0</span>              <span class="mi">0</span>                <span class="mi">2</span>        <span class="n">log</span>                                      <span class="mi">0</span>                <span class="mi">0</span>                      <span class="mi">260851</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">10</span>        <span class="mi">0</span>                <span class="mi">0</span>                    <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">0</span>                     <span class="mi">0</span>              <span class="mi">0</span>                <span class="mi">108</span>      <span class="n">win1101</span>                                  <span class="mi">0</span>                <span class="mi">0</span>                      <span class="mi">1220864</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">11</span>        <span class="mi">0</span>                <span class="mi">0</span>                    <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">0</span>                     <span class="mi">0</span>              <span class="mi">0</span>                <span class="mi">111</span>      <span class="n">pvc</span><span class="o">-</span><span class="mi">8</span><span class="n">d31e43b</span><span class="o">-</span><span class="n">f942</span><span class="o">-</span><span class="mi">4</span><span class="n">cf8</span><span class="o">-</span><span class="mi">94</span><span class="n">db</span><span class="o">-</span><span class="n">a08762c745ee</span> <span class="mi">0</span>                <span class="mi">0</span>                      <span class="mi">524288</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">11</span>        <span class="mi">0</span>                <span class="mi">0</span>                    <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">0</span>                     <span class="mi">0</span>              <span class="mi">0</span>                <span class="mi">112</span>      <span class="n">pvc</span><span class="o">-</span><span class="mi">14</span><span class="n">a51322</span><span class="o">-</span><span class="mi">16</span><span class="n">c8</span><span class="o">-</span><span class="mi">4</span><span class="n">b95</span><span class="o">-</span><span class="n">a7e4</span><span class="o">-</span><span class="mi">28</span><span class="n">d9963450b3</span> <span class="mi">0</span>                <span class="mi">0</span>                      <span class="mi">524288</span>

<span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">volumeProps</span>
<span class="n">name</span><span class="p">:</span> <span class="n">volumeProps</span>
<span class="nb">time</span>                 <span class="n">accountID</span> <span class="n">fifoSize_final</span> <span class="k">host</span>         <span class="n">minFifoSize_final</span> <span class="n">qosPolicyId_final</span> <span class="n">scsiNaaDeviceID</span>                  <span class="n">volumeBlockSize_final</span> <span class="n">volumeId</span> <span class="n">volumeName</span>                               <span class="n">volumeSize_final</span>
<span class="c1">----                 --------- -------------- ----         ----------------- ----------------- ---------------                  --------------------- -------- ----------                               ----------------</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">1</span>         <span class="mi">5</span>              <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">2</span>                 <span class="mi">6</span><span class="n">f47acc1000000007763776200000001</span> <span class="mi">4096</span>                  <span class="mi">1</span>        <span class="k">data</span>                                     <span class="mi">2000683008</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">1</span>         <span class="mi">5</span>              <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">1</span>                 <span class="mi">6</span><span class="n">f47acc1000000007763776200000002</span> <span class="mi">4096</span>                  <span class="mi">2</span>        <span class="n">log</span>                                      <span class="mi">1073741824</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">10</span>        <span class="mi">5</span>              <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">2</span>                 <span class="mi">6</span><span class="n">f47acc100000000776377620000006c</span> <span class="mi">4096</span>                  <span class="mi">108</span>      <span class="n">win1101</span>                                  <span class="mi">5000658944</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">11</span>        <span class="mi">5</span>              <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">0</span>                 <span class="mi">6</span><span class="n">f47acc100000000776377620000006f</span> <span class="mi">4096</span>                  <span class="mi">111</span>      <span class="n">pvc</span><span class="o">-</span><span class="mi">8</span><span class="n">d31e43b</span><span class="o">-</span><span class="n">f942</span><span class="o">-</span><span class="mi">4</span><span class="n">cf8</span><span class="o">-</span><span class="mi">94</span><span class="n">db</span><span class="o">-</span><span class="n">a08762c745ee</span> <span class="mi">2147483648</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">11</span>        <span class="mi">5</span>              <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">0</span>                 <span class="mi">6</span><span class="n">f47acc1000000007763776200000070</span> <span class="mi">4096</span>                  <span class="mi">112</span>      <span class="n">pvc</span><span class="o">-</span><span class="mi">14</span><span class="n">a51322</span><span class="o">-</span><span class="mi">16</span><span class="n">c8</span><span class="o">-</span><span class="mi">4</span><span class="n">b95</span><span class="o">-</span><span class="n">a7e4</span><span class="o">-</span><span class="mi">28</span><span class="n">d9963450b3</span> <span class="mi">2147483648</span>
<span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span><span class="n">T07</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span> <span class="mi">11</span>        <span class="mi">5</span>              <span class="n">scaleoutsean</span> <span class="mi">0</span>                 <span class="mi">0</span>                 <span class="mi">6</span><span class="n">f47acc1000000007763776200000071</span> <span class="mi">4096</span>                  <span class="mi">113</span>      <span class="n">pvc</span><span class="o">-</span><span class="mi">4</span><span class="n">fb5d7f5</span><span class="o">-</span><span class="mi">4</span><span class="n">d98</span><span class="o">-</span><span class="mi">429</span><span class="n">e</span><span class="o">-</span><span class="n">ab36</span><span class="o">-</span><span class="mi">1</span><span class="n">b2118b7e55c</span> <span class="mi">2147483648</span>
</code></pre></div></div>

<p>Known BS in this release:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">host</code> name of the system where Telegraf agent is running is sent to InfluxDB although agent configuration says not to</li>
  <li>InfluxDB v1 adds this stupid <code class="language-plaintext highlighter-rouge">_final</code> to some field names; I haven’t had the time to figure out what the hell that is</li>
</ul>

<p>Not <em>all</em> fields from Get-SFVolume and Get-SFVolumeStats responses are sent to InfluxDB - only about 50% of the more important stuff is. Feel free to adjust if necessary.</p>

<p>Volume stats and properties is probably the most intensive part of metrics collection as it’s usually collected most frequently and take up most space which is one of the reasons why the script doesn’t send all output to InfluxDB.</p>

<p>I suspect I would have been better off if I used Python, but it’s too late now.</p>

<p>You can find the code in the scripts directory of Awesome SolidFire.</p>


      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
      &nbsp; 
    
      <a href="
      /categories/#monitoring">monitoring</a>
      &nbsp; 
    
      <a href="
      /categories/#solidfire">solidfire</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2024/05/03/netapp-solidfire-collector-next.html">Towards next SolidFire Collector (SFC)</a></li>
      
        <li><a href="/2024/04/24/netapp-solidfire-monitor-backup-influx-grafana-11.html">Metrics for NetApp SolidFire backup-to-S3 in InfluxDB and Grafana</a></li>
      
        <li><a href="/2023/01/14/eseries-performance-analyzer-container-orchestrator-kubernetes.html">NetApp E-Series Performance Analyzer in orchestrated container environments</a></li>
      
        <li><a href="/2023/11/04/eseries-perf-analyzer-epa-330.html">E-Series Perf Analyzer (EPA) v3.3.0</a></li>
      
        <li><a href="/2022/10/26/eseries-performance-analyzer-e-series.html">Notes on NetApp E-Series Performance Analyzer</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-05-20 15:31 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
