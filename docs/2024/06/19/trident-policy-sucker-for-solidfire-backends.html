<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Trident QoS policy sucker for SolidFire backend | Acting Technologist
      
    </title>
    <meta name="description" content="
     Script stores SolidFire QoS policies into Trident config
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Trident QoS policy sucker for SolidFire backend | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Trident QoS policy sucker for SolidFire backend" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Script stores SolidFire QoS policies into Trident config" />
<meta property="og:description" content="Script stores SolidFire QoS policies into Trident config" />
<link rel="canonical" href="https://scaleoutsean.github.io/2024/06/19/trident-policy-sucker-for-solidfire-backends.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2024/06/19/trident-policy-sucker-for-solidfire-backends.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:image" content="https://scaleoutsean.github.io/assets/images/solidfire-qos-policy-sucker.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-06-19T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Trident QoS policy sucker for SolidFire backend","dateModified":"2024-06-19T00:00:00+08:00","datePublished":"2024-06-19T00:00:00+08:00","url":"https://scaleoutsean.github.io/2024/06/19/trident-policy-sucker-for-solidfire-backends.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2024/06/19/trident-policy-sucker-for-solidfire-backends.html"},"description":"Script stores SolidFire QoS policies into Trident config","author":{"@type":"Person","name":"scaleoutSean"},"image":"https://scaleoutsean.github.io/assets/images/solidfire-qos-policy-sucker.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Trident QoS policy sucker for SolidFire backend</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>19 Jun 2024</span> - <i class="far fa-clock"></i> 


  
  
    4 minute read
  

    </span>
  </div>
  
        <p>This isn’t some huge idea, but I just thought of it and quickly wrote a script that does it.</p>

<p>So, what is this about again?</p>

<p>Well, recently I’ve been looking at NetApp Trident and <a href="/2024/06/03/pvc-volume-relationships-in-solidfire-trident-part-2.html">musing about the ways to make use of SolidFire’s QoS policies within it</a>, rather than rely on what Trident does out of the box.</p>

<p>Then today I thought about the other direction as well.</p>

<p>The idea is to get from whatever you have, to (1).</p>

<p><img src="/assets/images/solidfire-qos-policy-sucker.png" alt="Translate SolidFire QoS policies into Trident types" /></p>

<p>In other words:</p>

<ul>
  <li>(1) Take your current back-end configuration file for SolidFire SAN back-end</li>
  <li>(2) Patch it to reflect your QoS policies on SolidFire</li>
  <li>(3) Profit, or maybe lose less money</li>
</ul>

<p>The benefit is that you can sort-of-transplant your SolidFire QoS policies into your Kubernetes environments.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./solidfire-qos-policy-id-to-trident-qos.py <span class="nt">-h</span>
usage: solidfire-qos-policy-id-to-trident-qos.py <span class="o">[</span><span class="nt">-h</span><span class="o">]</span> <span class="nt">-m</span> MVIP <span class="nt">-u</span> U <span class="o">[</span><span class="nt">-p</span> P] <span class="nt">-q</span>
                                                 QOS_POLICY_ID
                                                 <span class="o">[</span><span class="nt">-o</span> OUT_FILE_PATH_NAME]

Gather SolidFire QoS policies by IDs and save to trident.conf.

options:
  <span class="nt">-h</span>, <span class="nt">--help</span>            show this <span class="nb">help </span>message and <span class="nb">exit</span>
  <span class="nt">-m</span> MVIP, <span class="nt">--mvip</span> MVIP  MVIP of the SolidFire cluster.
  <span class="nt">-u</span> U                  Username <span class="k">for </span>the SolidFire API.
  <span class="nt">-p</span> P                  Password <span class="k">for </span>the SolidFire API.
  <span class="nt">-q</span> QOS_POLICY_ID, <span class="nt">--qos-policy-id</span> QOS_POLICY_ID
                        QoS policy ID to gather.
  <span class="nt">-o</span> OUT_FILE_PATH_NAME, <span class="nt">--out-file-path-name</span> OUT_FILE_PATH_NAME
                        Output file path and name.
</code></pre></div></div>

<p>Output:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">dir</span> <span class="nt">-lat</span> <span class="k">*</span>.new
<span class="nt">-rw-------</span> 1 sean sean 511 Jun 19 00:54 solidfire-backend.json.new
</code></pre></div></div>

<p>Now you may say “well, that’s a one-off thing, who cares”. That’s fine.</p>

<p>But it’s a necessary step towards what I discussed in that other post.</p>

<p>If I can <strong>retype</strong> volumes on SolidFire and update back-end JSON configuration <strong>and</strong> Trident doesn’t complain, what’s bad about it?</p>

<p>I can also occasionally “update” QoS policies or add new ones in my Trident configuration file and let the Kubernetes admins to use policies 11, 14 and 25 and I don’t have to email them what they are, and they don’t have to learn how to figure it out.</p>

<p><strong>NOTES</strong></p>

<ul>
  <li>I’m not suggesting you should just go ahead and create a cronjob that simply overwrites your Trident back-end configuration file. Test and like I said in that post, you’d have to test again every time before upgrading Trident. Trident currently still does <strong>not</strong> support volume retyping (<a href="https://github.com/NetApp/trident/issues/281">issue</a>). Of course, this script doesn’t retype volumes, it just sucks out the config so that it reflects some QoS Policy IDs. But it could be used in a retyping workflow (which is not supported).</li>
  <li>In my sample file you may notice that QoS policy ranges [Min, Max] do not overlap among QoS types. See <a href="https://github.com/NetApp/trident/issues/281">this</a>.</li>
</ul>

<p>If you have SolidFire but haven’t used Kubernetes, check out <a href="https://solidfire-kubernetes.pages.dev/">“Kubernetes with SolidFire”</a> to get started. (The TLD .dev is a free domain popular among spammers, so nobody knows about that site. Other than that, I’ve no reason to mention it as it has neither any meaningful analytics and it’s ads-free).</p>

<p>I’ve uploaded the script <a href="https://github.com/scaleoutsean/awesome-solidfire/">to Awesome SolidFire</a> (solidfire-qos-policy-id-to-trident-qos.py in scripts directory).</p>

<p>Now if we could also create Kubernetes Storage Classes from that… Sure. I’ve added that.</p>

<h2 id="appendix-a---sample-run">Appendix A - sample run</h2>

<p>I want to update my Trident Types to be in sync with my SolidFire QoS policies 1 and 2, so I run the script with <code class="language-plaintext highlighter-rouge">-q 1,2</code>.</p>

<p>Then I just copy-paste the config to my existing config.</p>

<p>The script is permissively licensed so you can easily modify it to run regularly and update your Trident config files… But that’s dangerous. I don’t plan to do this (yet), so I haven’t yet checked how Trident refreshes backend (maybe we need to kill some pod or something).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./solidfire-qos-policy-id-to-trident-qos.py <span class="nt">--mvip</span> <span class="s1">'192.168.1.30'</span> <span class="nt">-u</span> admin <span class="nt">-p</span> <span class="k">********</span> <span class="nt">-q</span> 1,2

TRIDENT SAMPLE CONFIG BEFORE:

<span class="o">{</span>
    <span class="s2">"version"</span>: 1,
    <span class="s2">"storageDriverName"</span>: <span class="s2">"solidfire-san"</span>,
    <span class="s2">"backendName"</span>: <span class="s2">"SF-PROD-192.168.1.34"</span>,
    <span class="s2">"limitVolumeSize"</span>: <span class="s2">"100000000000"</span>,
    <span class="s2">"Endpoint"</span>: <span class="s2">"https://trident:b00lsh33t@192.168.1.34/json-rpc/12.5"</span>,
    <span class="s2">"SVIP"</span>: <span class="s2">"192.168.103.34:3260"</span>,
    <span class="s2">"TenantName"</span>: <span class="s2">"demodemodemo"</span>,
    <span class="s2">"Types"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"Type"</span>: <span class="s2">"bronze"</span>,
            <span class="s2">"Qos"</span>: <span class="o">{</span>
                <span class="s2">"minIOPS"</span>: 200,
                <span class="s2">"maxIOPS"</span>: 400,
                <span class="s2">"burstIOPS"</span>: 600
            <span class="o">}</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"Type"</span>: <span class="s2">"silver"</span>,
            <span class="s2">"Qos"</span>: <span class="o">{</span>
                <span class="s2">"minIOPS"</span>: 401,
                <span class="s2">"maxIOPS"</span>: 600,
                <span class="s2">"burstIOPS"</span>: 1000
            <span class="o">}</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"Type"</span>: <span class="s2">"gold"</span>,
            <span class="s2">"Qos"</span>: <span class="o">{</span>
                <span class="s2">"minIOPS"</span>: 601,
                <span class="s2">"maxIOPS"</span>: 990,
                <span class="s2">"burstIOPS"</span>: 2000
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">]</span>,
    <span class="s2">"region"</span>: <span class="s2">"prod"</span>
<span class="o">}</span>


TRIDENT SAMPLE CONFIG AFTER:

<span class="o">{</span>
    <span class="s2">"version"</span>: 1,
    <span class="s2">"storageDriverName"</span>: <span class="s2">"solidfire-san"</span>,
    <span class="s2">"backendName"</span>: <span class="s2">"SF-PROD-192.168.1.34"</span>,
    <span class="s2">"limitVolumeSize"</span>: <span class="s2">"100000000000"</span>,
    <span class="s2">"Endpoint"</span>: <span class="s2">"https://trident:b00lsh33t@192.168.1.34/json-rpc/12.5"</span>,
    <span class="s2">"SVIP"</span>: <span class="s2">"192.168.103.34:3260"</span>,
    <span class="s2">"TenantName"</span>: <span class="s2">"demodemodemo"</span>,
    <span class="s2">"Types"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"Type"</span>: <span class="s2">"basic"</span>,
            <span class="s2">"Qos"</span>: <span class="o">{</span>
                <span class="s2">"minIOPS"</span>: 100,
                <span class="s2">"maxIOPS"</span>: 800,
                <span class="s2">"burstIOPS"</span>: 1000
            <span class="o">}</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"Type"</span>: <span class="s2">"backup"</span>,
            <span class="s2">"Qos"</span>: <span class="o">{</span>
                <span class="s2">"minIOPS"</span>: 100,
                <span class="s2">"maxIOPS"</span>: 1500,
                <span class="s2">"burstIOPS"</span>: 3000
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">]</span>,
    <span class="s2">"region"</span>: <span class="s2">"prod"</span>
<span class="o">}</span>

</code></pre></div></div>

<p>I’ve added some Storage Class samples as well.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SAMPLE KUBERNETES STORAGE CLASSES:

<span class="k">**</span>NOTE:<span class="k">**</span> the IOPS setting <span class="k">for </span>each sample class is <span class="nb">set </span>to <span class="k">in</span><span class="nt">-between</span> Min and Max IOPS <span class="k">for </span>given QoS Policy ID. Adjust <span class="k">if </span>necessary.

Creating sample SC: basic

apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: basic
  annotations:
    storageclass.kubernetes.io/is-default-class: <span class="s2">"true"</span>
provisioner: csi.trident.netapp.io
reclaimPolicy: Retain
parameters:
  allowVolumeExpansion: <span class="nb">true
  </span>backendType: <span class="s2">"solidfire-san"</span>
  clones: <span class="s2">"true"</span>
  fsType: <span class="s2">"xfs"</span>
  IOPS: <span class="s2">"450"</span>
  snapshots: <span class="s2">"true"</span>


<span class="k">**</span>NOTE:<span class="k">**</span> <span class="k">if </span>a QoS policy name is <span class="k">*</span>basic<span class="k">*</span>, sample config gets annotated as the default storage class.

Creating sample SC: backup

apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: backup
  annotations:
    storageclass.kubernetes.io/is-default-class: <span class="s2">"false"</span>
provisioner: csi.trident.netapp.io
reclaimPolicy: Retain
parameters:
  allowVolumeExpansion: <span class="nb">true
  </span>backendType: <span class="s2">"solidfire-san"</span>
  clones: <span class="s2">"true"</span>
  fsType: <span class="s2">"xfs"</span>
  IOPS: <span class="s2">"800"</span>
  snapshots: <span class="s2">"true"</span>

</code></pre></div></div>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#solidfire">solidfire</a>
      &nbsp; 
    
      <a href="
      /categories/#storage">storage</a>
      &nbsp; 
    
      <a href="
      /categories/#automation">automation</a>
      &nbsp; 
    
      <a href="
      /categories/#containers">containers</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2024/06/16/snapshot-schedules-in-solidfire.html">Snapshots and snapshot schedules in NetApp SolidFire</a></li>
      
        <li><a href="/2024/06/15/sfc-adds-volume-replication-monitoring.html">SFC v2 adds volume replication monitoring</a></li>
      
        <li><a href="/2024/06/14/netapp-solidfire-replication-monitoring.html">Monitoring volume replication in NetApp SolidFire</a></li>
      
        <li><a href="/2024/06/12/longhorny-cluster-volume-replication-report.html">Reporting SolidFire cluster and volume pairing relationships</a></li>
      
        <li><a href="/2024/06/11/introducing-project-longhorny.html">Project Longhorny</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-06-19 02:24 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
