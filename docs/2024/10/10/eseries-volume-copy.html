<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Using NetApp E-Series Volume Copy | Acting Technologist
      
    </title>
    <meta name="description" content="
     Clone NetApp E-Series volumes to physically separate disks and volume groups
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Using NetApp E-Series Volume Copy | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Using NetApp E-Series Volume Copy" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Clone NetApp E-Series volumes to physically separate disks and volume groups" />
<meta property="og:description" content="Clone NetApp E-Series volumes to physically separate disks and volume groups" />
<link rel="canonical" href="https://scaleoutsean.github.io/2024/10/10/eseries-volume-copy.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2024/10/10/eseries-volume-copy.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:image" content="https://scaleoutsean.github.io/assets/images/e-series-vi-volume-copy-01.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-10-10T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Using NetApp E-Series Volume Copy","dateModified":"2024-10-10T00:00:00+08:00","datePublished":"2024-10-10T00:00:00+08:00","author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2024/10/10/eseries-volume-copy.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2024/10/10/eseries-volume-copy.html"},"image":"https://scaleoutsean.github.io/assets/images/e-series-vi-volume-copy-01.png","description":"Clone NetApp E-Series volumes to physically separate disks and volume groups","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Using NetApp E-Series Volume Copy</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>10 Oct 2024</span> - <i class="far fa-clock"></i> 


  
  
    6 minute read
  

    </span>
  </div>
  
        <ul>
  <li><a href="#what-is-a-volume-created-by-volume-copy-operation">What is a volume created by Volume Copy operation</a></li>
  <li><a href="#how-does-it-work">How does it work?</a></li>
  <li><a href="#reserve-size">Reserve size</a></li>
  <li><a href="#reserve-location">Reserve location</a></li>
  <li><a href="#priority">Priority</a></li>
  <li><a href="#automating-volume-copy">Automating Volume Copy</a></li>
  <li><a href="#application-aware-snapshots">Application-aware snapshots</a></li>
  <li><a href="#consistency-groups">Consistency groups</a></li>
  <li><a href="#comparison-with-snapshot-based-clones">Comparison with snapshot-based clones</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<h2 id="what-is-a-volume-created-by-volume-copy-operation">What is a volume created by Volume Copy operation</h2>

<p>It’s an independent copy of a LUN.</p>

<p>Example:</p>

<ul>
  <li>Source: volume data01 on Volume Group 1 (RAID6 (8D2P) made of 10 disk drives)</li>
  <li>Destination: clone of data01 on Volume Group 2 (RAID5 (8D1P) made of 9 disk drives)</li>
</ul>

<p>Use cases:</p>

<ul>
  <li>Test copy of your data - clone a volume for testing</li>
  <li>Local DR copies - nightly full copy of your VMware data store on a volume group not visible to VMware hosts</li>
</ul>

<h2 id="how-does-it-work">How does it work?</h2>

<p>Volume Copy wizard asks you what volume you want to copy and where.</p>

<p>As per the example above, we pick data01 from VG1 as our Source, and pick VG2 (now without any volumes) as our Destination.</p>

<p>We also decide the size and location of the hidden “Reserve” volume</p>

<ul>
  <li>Size: the default reserve size is 40% of the Source volume, which is very generous. Use 40% unless you’re short on capacity</li>
  <li>Location: Reserve volume can be placed anywhere - e.g. on VG1 or VG2</li>
</ul>

<p>Another decision - which can be modified on the fly at a later time - is about job priority. Use a lower priority setting if the array and source VG are busy and a higher if they’re idle.</p>

<p>This drawing shows a mix of the two use cases above:</p>

<ul>
  <li>Production environment for virtual infrastructure with data01 on VG1</li>
  <li>Copy of data01 for test environment is made on VG2 and Reserve (<code class="language-plaintext highlighter-rouge">r</code>) is also on VG2</li>
</ul>

<p><img src="/assets/images/e-series-vi-volume-copy-01.png" alt="E-Series Volume Copy workflow" /></p>

<p>The Reserve volume (“r”) is located on VG2 (more on that below).</p>

<h2 id="reserve-size">Reserve size</h2>

<p>As I’ve mentioned, 40% is a lot. The purpose of Reserve volume is to hold <em>changes</em> to the Source volume while Volume Copy job is executing.</p>

<p>These “changes” are made on the Source volume, of course, but existing data (from the point-in-time we kicked off Volume Copy process) are evacuated and copied from the Source volume to Reserve so that Volume Copy can find all Source volume data as it was when copying started.</p>

<p>That is why the diagram above shows two copy processes:</p>

<ul>
  <li>From Source to Destination for data unchanged since Volume Copy started</li>
  <li>From Reserve to Destination for data changed on Source (and evacuated to Reserve via CoW) after Volume Copy started</li>
</ul>

<p>Priority setting:</p>

<ul>
  <li>If Source volume is huge, Volume Copy priority low, array busy and so on, it can take 1-2 weeks to copy it. That’s why Reserve is so large.</li>
  <li>If Source volume is small, Volume Copy priority maximum and array idle, it may take mere minutes. In this case a tiny reserve (5%) should be enough.</li>
</ul>

<h2 id="reserve-location">Reserve location</h2>

<p>There are no particular concerns about reserve volume location. Once copy is done, this volume is wiped until next run of Volume Copy.</p>

<p>If Reserve volume gets lost, Volume Copy would likely fail and need to be re-tried.</p>

<p>The diagram above shows the temporary reserve volume on the same VG as the destination/clone volume (data01’).</p>

<h2 id="priority">Priority</h2>

<p>This is easy.</p>

<p>There are 5 priority levels: 0 - slowest, 4 - maximum.</p>

<p>Say you have an array that’s mostly used during office hours, and during the night you want to use Volume Copy to make copies of five 2 TB volumes.</p>

<p>In this case you should be able to use the highest priority (4). Watch array logs to see when these finished and adjust if necessary.</p>

<p>This shows an idle EF570 copying a volume at the highest priority - CPU utilization (presumably on the owning controller) jumped some 10%. (When array is idle, CPU utilizatio is still around 40%.)</p>

<p><img src="/assets/images/e-series-vi-volume-copy-priority-02.png" alt="Controller utilization with maximum Volume Copy Priority" /></p>

<p>In other words, there’s no harm in running half a dozen on those at the highest priority as long as they can finish by 6-7 am.</p>

<p>Job priority can be changed while a job is running and fiddling with it should reflect immediately in time-to-completion indicators you can see in the Web UI or API. If you’re concerned about the impact you cn start with a lower priority and increase it as you watch job progress indicator and array performance.</p>

<h2 id="automating-volume-copy">Automating Volume Copy</h2>

<p>You can use SMCli, or the API.</p>

<p>Before we start looking at those choices, notice that a <strong>pair</strong> can be created in the SANtricity Web UI and once it’s created, it’s available for automation. I found that easier to deal with, as long as all admins know they mustn’t “clear” Volume Copy pairings (i.e. unpair the volumes) in the Web UI.</p>

<p>Once the pairs are available, you can simply start (and stop, although you probably wouldn’t use this much) copying.</p>

<p>SMCli seems to disallow less than 20% reserve size. Some examples:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smcli create volumeCopy <span class="nb">source</span><span class="o">=</span><span class="k">${</span><span class="nv">SOURCE_NAME</span><span class="k">}</span> <span class="nv">target</span><span class="o">=</span><span class="k">${</span><span class="nv">TARGET_NAME</span><span class="k">}</span> ...
smcli show volumeCopy allVolumes
</code></pre></div></div>

<p>Using the SANtricity API, I’d create pairs in the Web UI and then just start/stop and monitor via the API:</p>

<ul>
  <li>POST to “volume-copy-jobs-control” is used to start/stop jobs by their Volume Copy job ID.</li>
  <li>GET to the same path is used to get percentComplete and estimated timeToCompletion</li>
</ul>

<p>As you start jobs, make sure that call returns success because if another admin has deleted the pair ID that call will fail and SANtricity will log an error in MEL (log).</p>

<p>If we handle error responses we can send notifications to Slack, Splunk, etc. There are posts on E-Series monitoring and logging (see Archives).</p>

<h2 id="application-aware-snapshots">Application-aware snapshots</h2>

<p>You would have to offline Source volume for that, or synchronize the suspension of IO on host(s) with the start of Volume Copy operation.</p>

<p>Another way is to take an application consistent snapshot and then start volume copy, and on the clone first revert to the last snapshot.</p>

<h2 id="consistency-groups">Consistency groups</h2>

<p>SANtricity has “Consistency Group snapshots”. Read about them <a href="/2023/10/05/snapshots-and-consistency-groups-with-netapp-e-series.html">here</a>.</p>

<p>There’s no “Group Volume Copy” that would do the same thing.</p>

<p>You’d have to offline (or disconnect from) Source volumes and start multiple copy jobs for that. After jobs have been started, you could online your primary workload (because change delta would be Copy-on-Write-d to Reserve volumes).</p>

<h2 id="comparison-with-snapshot-based-clones">Comparison with snapshot-based clones</h2>

<p>How does this differ from SANtricity clones created from volume snapshots?</p>

<p>Those share the same base, so if you wipe the source, everything goes (snapshots, clones).</p>

<p>Clones created with Volume Copy are on physically separate media and wiping out the source does not wipe the copy.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Volume Copy feature creates clones that are located on physically independent disk drives. Such clones can remain unavailable to any hosts and therefore safe from accidental or deliberate deletion from hosts. They can also survive volume group failures.</p>

<p>On Hybrid arrays Destination can be located on a lower-cost volume group (e.g. R5 instead of R6 or R10 used for Source, or NL-SAS HDD instead of SAS SSD).</p>

<p>Automation is also relatively easy, especially if use Volume Copy wizard to create pairs from the SANtricity Web UI.</p>


      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2023/10/05/snapshots-and-consistency-groups-with-netapp-e-series.html">Stand-alone and Consistency Group snapshots on NetApp E-Series</a></li>
      
        <li><a href="/2024/04/26/swagger-files-netapp-eseries-arrays.html">Swagger files for NetApp E-Series</a></li>
      
        <li><a href="/2023/10/29/consistency-group-monitoring-in-eseries.html">Monitor Snapshot Consistency Groups of NetApp E-Series SANtricity OS</a></li>
      
        <li><a href="/2023/10/12/snapshot-clone-repository-monitoring-in-eseries.html">Monitor snapshot and clone repositories of NetApp E-Series SANtricity OS</a></li>
      
        <li><a href="/2024/01/24/netapp-eseries-as-veeam-hardened-repository.html">NetApp E-Series DAS or SAN storage as Veeam Hardened Repository</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-10-10 03:40 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
