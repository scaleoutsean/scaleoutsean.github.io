<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            On-prem Spot Instaclustr-managed clusters with NetApp E-Series storage | Acting Technologist
      
    </title>
    <meta name="description" content="
     Why use Instaclustr-managed applications with E-Series storage
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>On-prem Spot Instaclustr-managed clusters with NetApp E-Series storage | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="On-prem Spot Instaclustr-managed clusters with NetApp E-Series storage" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Why use Instaclustr-managed applications with E-Series storage" />
<meta property="og:description" content="Why use Instaclustr-managed applications with E-Series storage" />
<link rel="canonical" href="https://scaleoutsean.github.io/2022/11/11/netapp-spot-instaclustr-eseries.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2022/11/11/netapp-spot-instaclustr-eseries.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-11-11T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"On-prem Spot Instaclustr-managed clusters with NetApp E-Series storage","dateModified":"2022-11-11T00:00:00+08:00","datePublished":"2022-11-11T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2022/11/11/netapp-spot-instaclustr-eseries.html"},"author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2022/11/11/netapp-spot-instaclustr-eseries.html","description":"Why use Instaclustr-managed applications with E-Series storage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">On-prem Spot Instaclustr-managed clusters with NetApp E-Series storage</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>11 Nov 2022</span> - <i class="far fa-clock"></i> 


  
  
    8 minute read
  

    </span>
  </div>
  
        <ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#compute-layer-and-storage-interconnect">Compute layer and storage interconnect</a></li>
  <li><a href="#small-and-large-clusters">Small and large clusters</a></li>
  <li><a href="#hdds-ssds-raid-ddp">HDDs, SSDs, RAID, DDP…</a></li>
  <li><a href="#how-to-automate-e-series-volume-provisioning-to-hosts">How to automate E-Series volume provisioning to hosts</a></li>
  <li><a href="#data-protection-and-replication">Data protection and replication</a></li>
  <li><a href="#data-and-application-migration">Data and application migration</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>If you haven’t heard of <a href="http://instaclustr.com">Instaclustr</a>, please visit their Web site and read their blog to find out more.</p>

<p>In short, Instaclustr runs a SaaS platform for several popular open source technologies.</p>

<p><img src="/assets/images/instaclustr-2022.png" alt="Instaclustr services in late 2022" /></p>

<p>Great majority of Instaclustr users run in the cloud, but some run on-premises. Why? Cost, regulatory issues, etc.</p>

<p>Let’s take a look at currently available services:</p>

<ul>
  <li>Databases
    <ul>
      <li>PostgreSQL</li>
      <li>Apache Cassandra</li>
      <li>Redis</li>
    </ul>
  </li>
  <li>Data streaming
    <ul>
      <li>Apache Kafka</li>
      <li>Kafka Connect</li>
      <li>Apache Zookeeper</li>
    </ul>
  </li>
  <li>Analytics
    <ul>
      <li>Apache Spark</li>
    </ul>
  </li>
  <li>Search
    <ul>
      <li>OpenSearch (fork of Elasticsearch)</li>
    </ul>
  </li>
  <li>Orchestration
    <ul>
      <li>Cadence</li>
    </ul>
  </li>
</ul>

<p>What’s common to most - if not all - of these applications, as far as NetApp E-Series is concerned?</p>

<ul>
  <li>They require high throughput for both sequential and random IO patterns</li>
  <li>They have own tooling for HA, scale-out, tiering, backup and other data management</li>
  <li>They compress their data</li>
  <li>There’s little-to-no need for sophisticated data management features</li>
</ul>

<p>E-Series happens to perform well for both sequential and random workloads, it doesn’t have many data management features (and compression and deduplication either).</p>

<p>E-Series has a thin and lean data path and it doesn’t do more than absolutely necessary. Which means great value for your money, too.</p>

<p>I’ve blogged about several of these services so if you search this blog you can hopefully find finer and more detailed points on some of these applications.</p>

<h2 id="compute-layer-and-storage-interconnect">Compute layer and storage interconnect</h2>

<p>All of the Instaclustr services can run in VMs.</p>

<p>For most customers this means they download Instaclustr VMs and deploy them to vSphere clusters. Simple.</p>

<p>Most vSphere users connect to E-Series via FC, NVMeoF and iSCSI SAN. For larger clusters with two or more E-Series arrays it may be viable to use Direct Attach connection to E-Series controllers and avoid the cost of SAN if you don’t need SAN.</p>

<h2 id="small-and-large-clusters">Small and large clusters</h2>

<p>E-Series components are fully redundant and very reliable. Like with other enterprise storage, there’s no need to buy a bunch of arrays to get reliable storage service.</p>

<p>If you need to run services in one location and don’t need more performance than a single array can provide, there’s no need to go crazy on any hardware component. Even the servers could be consolidated down to N+2 or N+1 (e.g. four ESXi for a three-node Kafka cluster). Red volumes are “hot” and blue “cold” data, but if you have no reason to differentiate, one tier and RAID/DDP type will do.</p>

<p><img src="/assets/images/instaclustr-eseries-small-detailed.png" alt="Instaclustr services with E-Series" /></p>

<p>What kind of performance are we talking about? Mixed read-write workload below 500,000 (random) IOPS or 15 GB/s (sequential) can work fine with a single E-Series array.</p>

<p>If you run a multi-site cluster or consume a lot more performance, remember that earlier detail on HA and scale-out: these apps can do it on their own. Just buy N arrays for N locations.</p>

<p><img src="/assets/images/instaclustr-eseries-big-detailed.png" alt="Instaclustr services with E-Series running across several sites" /></p>

<h2 id="hdds-ssds-raid-ddp">HDDs, SSDs, RAID, DDP…</h2>

<p>If your application uses tiering, it’s possible to keep hot data and logs on SSDs, and cold data on NL-SAS (RAID 6 or DDP, for example).</p>

<p>Tiering is performed in application, so there’s nothing that needs to be done on storage.</p>

<p>SSDs are usually protected with RAID 10, but since mid 2022 it is possible to use DDP (traditionally and by default it protects data with 8D+2P stripes) and create RAID 1-like volumes along RAID 6-like volumes.</p>

<p>Before, even with all-flash E-Series, we’d create multiple (at least two) disk groups/pools for RAID 1-style volumes (usually for “logs”) and “classic” RAID 6-style volumes where the speed wasn’t critical. To illustrate this approach, here’s what we’d do if we needed two very fast volumes and one normal volume:</p>

<ul>
  <li>Two RAID 1 (or alternatively, one RAID 10) groups
    <ul>
      <li>One Hot Spare</li>
    </ul>
  </li>
  <li>One DDP (or RAID 6) pool
    <ul>
      <li>Data in RAID 6-like stripes (8D2P)</li>
      <li>No Hot Spare because capacity to reconstruct data is automatically reserved on each disk in DDP</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/images/eseries-raid1-ddp-hs.png" alt="Traditional mix of RAID 1 and DDP" /></p>

<p>While the above is still fine, now we can also do this on all-flash E-Series:</p>

<ul>
  <li>One DDP with &gt;=11 SSDs
    <ul>
      <li>RAID 10-style volumes for fast IO</li>
      <li>RAID 6-style volumes for regular IO</li>
      <li>No dedicated Hot Spare required (capacity for reconstruction is reserved within the pool)</li>
    </ul>
  </li>
</ul>

<p>You can’t see much here, but that’s because it’s a single DDP and only data chunks in it may be different: as noted earlier, RAID 6-like are 8 strips of data plus 2 strips of parity, while RAID 1-like volumes are 5 strips of data + 5 strips of parity. Every stripe uses a random selection of 10 disks.</p>

<p><img src="/assets/images/instaclustr-ddp.png.png" alt="New DDP" /></p>

<p>As you can see there’s less isolation and more consolidation in second approach. It also makes it possible to make reasonable configuration with any number of spindles rather than in (best practice) multiples of 2 or 10 (RAID 1 and RAID 6, respectively).</p>

<p>Which one is better for Instaclustr applications, RAID 6 or DDP? Both are OK, especially when you decide you have enough performance without RAID 1, then the question of 3 or 5 extra disks (RAID 1 + 1 Hot Spare or RAID 10 + 1 Hot Spare) goes away.</p>

<p>I have a post on the new DDP option <a href="/2022/09/12/new-ddp-and-e-series-santricity-web-restful-api.html">here</a> in the case you’re interested in the second approach.</p>

<h2 id="how-to-automate-e-series-volume-provisioning-to-hosts">How to automate E-Series volume provisioning to hosts</h2>

<p>In a vSphere environment create volumes and present them to vSphere. Then deploy VMs and disks on Datastores.</p>

<p>Instaclustr documentation for on-premises deployments probably has more details on this, but even without reading it it goes without saying that with sufficiently large clusters one should not create one monster sized DDP and put all data on it: multiple RAID/DDP groups and even multiple arrays for multiple application-created copies of data are recommended for performance and availability reasons.</p>

<p>If your application has many nodes and many volumes, use SANtricity API or Ansible to create and manage volumes.</p>

<ul>
  <li><a href="https://galaxy.ansible.com/netapp_eseries/santricity">https://galaxy.ansible.com/netapp_eseries/santricity</a> - configure storage (disk groups/pools, volumes, storage settings)</li>
  <li><a href="https://galaxy.ansible.com/netapp_eseries/santricity">https://galaxy.ansible.com/netapp_eseries/host</a> - configure host-to-storage connections</li>
</ul>

<p>Those looking for sample playbooks can reference NetApp’s Ansible playbooks for BeeGFS with E-Series. To save time, check <a href="https://github.com/netappeseries/beegfs/blob/ae038bb2f7617d18a36cc4df8ca9464bd5039b8b/getting_started/beegfs_ha_7_2/create_inventory_structure.yml#L1">this</a> link for a sample playbook that creates inventory (vars). With those ready, perform the rest of the steps described <a href="https://github.com/netappeseries/beegfs/blob/master/getting_started/beegfs_ha_7_2/README.md">here</a>. Remove BeeGFS-related steps to only execute storage-side automation tasks, obviously.</p>

<h2 id="data-protection-and-replication">Data protection and replication</h2>

<p>How does one create a backup? Usually by using built-in, standard backup utilities. Some are developed by Instaclustr, but still open source.</p>

<p>How does one replicate application data? Usually by using built-in replication or multi-replica clustering.</p>

<p>It works the same way that it works in the public cloud: <em>well</em>.</p>

<p>For example InstaClustr’s cloud default for Kafka is RF3. With E-Series we could use RF2 (because storage is already protected with RAID 10 or 6), but we could also use RF1 or RF3.</p>

<p>If we use RF3 in a three-AZ configuration that uses three E-Series arrays, E-Series volumes can use RAID 0 since we rely on the application to protect data, but in that case failed disks would necessitate volume recreation and data reconstruction over network which may or may not be desirable. Highly agile and automated users with good inter-AZ networking may not mind this, but those who don’t like “incidents” may prefer RF3 on RAID 10.</p>

<p>If you need enterprise-grade on-premises S3 storage for backup <strong>and/or application data tiering</strong>, consider NetApp StorageGRID which likely means three or more appliances per AZ (so at least three with one AZ, and at least six for two AZs). Application data tiering is more demanding and can impact data and service availability, which is why it’s highlighted.</p>

<p>If you need low-cost S3 storage for backup-to-S3, you can also consider the free MinIO connected to a HDD tier on existing array used by Instacluster, or pick a stand-alone NL-SAS-based mid-range E-Series such as E2800 or EF300. Singleton MinIO VM can write to E-Series at <a href="/2022/10/21/minio-performance-netapp-e-series.html">2 GB/s</a> which makes it possible backup over 100 TB in less than 24 hours and read 100 TB in less than seven hours (reading at 4.5 GB/s). Scale-out MinIO should perform faster than that, but I haven’t tested it yet.</p>

<h2 id="data-and-application-migration">Data and application migration</h2>

<p>How does one move Instaclustr application data from one location to another?</p>

<p>Usually by replicating data using application features or by taking a backup to S3-compatible storage and restoring from that backup.</p>

<p>If you want to move your cloud application data to on-prem (or in the opposite direction, or from one hyperscaler to another), Instaclustr can help.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Instaclustr services happen to work well with E-Series arrays because that’s exactly how they’re deployed in the cloud, too. Fast and low cost, potentially with multiple copies of data.</p>

<p>If you’re interested in deploying Instaclustr on-premises and aren’t sure you have the performance or capacity required, NetApp E-Series can be easily attached to existing compute nodes and provide unbeatable value without compromising on security, availability and stability.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#storage">storage</a>
      &nbsp; 
    
      <a href="
      /categories/#cloud">cloud</a>
       
    
  </span>
</div>
    

    
      <div class="related" data-pagefind-ignore>

    <h4>Possibly related - use live search at the top to find other content</h4>
    
    
    
    
    
    
    
        
        
    
        
    
        
          <div class = "related-posts">
          <h5><a href="/2024/03/22/velero-trident-backup-job-details.html">• Velero v1.13, backup job metadata and NetApp Trident v24.02</a></h5>
          </div>
          
          
        
    
      
    
        
        
    
        
    
        
          <div class = "related-posts">
          <h5><a href="/2024/03/21/netapp-trident-v2402-arm64.html">• Quickly install NetApp Trident v24.02 on ARM64 Kubernetes</a></h5>
          </div>
          
          
        
    
      
    
        
        
    
        
    
        
          <div class = "related-posts">
          <h5><a href="/2024/03/18/storagegrid-storage-node-filesystem-block-size.html">• Filesystem block size used by NetApp StorageGRID</a></h5>
          </div>
          
          
        
    
      
    
        
        
    
        
    
        
          <div class = "related-posts">
          <h5><a href="/2024/03/18/storagegrid-nlb-http-logs.html">• Analyze HTTP logs from NetApp StorageGRID gateway nodes</a></h5>
          </div>
          
          
        
    
      
    
        
        
    
        
    
        
          <div class = "related-posts">
          <h5><a href="/2024/03/17/monitoring-notifications-eseries-santricity-media-scan-progress.html">• Monitor progress and notify of E-Series media scan events</a></h5>
          </div>
          
          
            
    
    </div>

    

    
  </div><footer class= "footer">
    <p>2024-03-23 12:14 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
