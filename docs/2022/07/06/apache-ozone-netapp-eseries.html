<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Apache Ozone S3 and NetApp E-Series | Acting Technologist
      
    </title>
    <meta name="description" content="
     When to use Apache Ozone with E-Series
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Apache Ozone S3 and NetApp E-Series | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Apache Ozone S3 and NetApp E-Series" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="When to use Apache Ozone with E-Series" />
<meta property="og:description" content="When to use Apache Ozone with E-Series" />
<link rel="canonical" href="https://scaleoutsean.github.io/2022/07/06/apache-ozone-netapp-eseries.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2022/07/06/apache-ozone-netapp-eseries.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-07-06T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Apache Ozone S3 and NetApp E-Series","dateModified":"2022-07-06T00:00:00+08:00","datePublished":"2022-07-06T00:00:00+08:00","author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2022/07/06/apache-ozone-netapp-eseries.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2022/07/06/apache-ozone-netapp-eseries.html"},"description":"When to use Apache Ozone with E-Series","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Apache Ozone S3 and NetApp E-Series</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>06 Jul 2022</span> - <i class="far fa-clock"></i> 


  
  
    6 minute read
  

    </span>
  </div>
  
        <p>I’m supposed to be resting this week and that hasn’t been working out… Still, I’ll try to keep this one shorter than the previous two posts from this week.</p>

<ul>
  <li><a href="#wtf-is-apache-ozone">WTF is Apache Ozone</a></li>
  <li><a href="#why-should-we-use-apache-ozone">Why should we use Apache Ozone</a></li>
  <li><a href="#what-does-ozone-look-like">What does Ozone look like</a></li>
  <li><a href="#s3-gateway">S3 gateway</a></li>
  <li><a href="#ozone-with-e-series">Ozone with E-Series</a></li>
  <li><a href="#to-do-items">To-Do items</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<h2 id="wtf-is-apache-ozone">WTF is Apache Ozone</h2>

<p>Let me get creative and pilfer their <a href="https://ozone.apache.org/">own explanation</a>:</p>

<blockquote>
  <p>Apache Ozone is a highly scale-able, distributed storage for Analytics, Big data and Cloud Native applications. Ozone supports S3 compatible object APIs as well as a Hadoop Compatible File System implementation. It is optimized for both efficient object store and file system operations.</p>
</blockquote>

<h2 id="why-should-we-use-apache-ozone">Why should we use Apache Ozone</h2>

<p>Clearly - I mean based on the introduction above - some Hadoop fans love the fact that they can get a modernized HDFS-compatible storage with S3 gateway built right in. Ozone also features an HDFS-compatible OzoneFS and S3A.</p>

<p>If you’re one of such folks <em>and</em> at the same time realize converged HDFS and compute hasn’t worked that well for you, maybe you’d want to both dis-aggregate <em>and</em> modernize, which is what you can get from Ozone, but also from E-Series (I wrote about enhancing HDFS-compatible storage with E-Series in <a href="/2022/06/22/e-series-hdfs.html">this post</a>).</p>

<h2 id="what-does-ozone-look-like">What does Ozone look like</h2>

<p>Ozone runs on bare metal, VMs or in containers (Docker, K8s, Nomad, etc.). It seems there’s a CSI plugin as well.</p>

<p>There are several services involved, but I don’t want to rehash the official documentation (look it up if you’re interested) so I’ll just talk about it from a high-level practical perspective.</p>

<p>First, there’s a built-in Web UI which is nice and responsive. I built Ozone from the source and started it with Docker Compose.</p>

<p><img src="/assets/images/apache-ozone-s3-e-series-01.png" alt="Azure Ozone Web UI" /></p>

<p>Once you’re in and see that everything’s working, you can run some workloads to test it out. There are many different metrics exposed, but they can be scraped from outside of the cluster for centralized monitoring - you are not limited by what you can see in the Web UI (which is 20-30 metrics).</p>

<p><img src="/assets/images/apache-ozone-s3-e-series-02.png" alt="Azure Ozone metrics dashboard" /></p>

<p>RPC metrics are available on its own page, I suppose because that helps you see if you have any network-related issues. I’ve had no RPC failures, which was expected (given that I ran this cluster in Docker Compose).</p>

<p><img src="/assets/images/apache-ozone-s3-e-series-03.png" alt="Azure Ozone RPC metrics" /></p>

<h2 id="s3-gateway">S3 gateway</h2>

<p>Ozone’s S3 gateway aims for AWS S3-compatibility. I installed AWS CLI and was able to create a bucket using AWS S3API.</p>

<p>The way S3 on Ozone works is /s3v is the Ozone volume that’s available via S3 (if you enable Ozone S3 gateway). If you don’t want the Hadoop stuff but just want S3, that would be the only <em>volume</em> you’d create, and then buckets within it.</p>

<p>The second noteworthy detail is by default it’s HTTP-only. I expected at least a self-signed snake-oil TLS option, but nope… It seems they’re still working on it and meanwhile you could add a TLS-terminating reverse proxy in front of Ozone, to get around that.</p>

<p><img src="/assets/images/apache-ozone-s3-e-series-05.png" alt="Azure Ozone S3 gateway" /></p>

<h2 id="ozone-with-e-series">Ozone with E-Series</h2>

<p>In that <a href="/2022/06/22/e-series-hdfs.html">post</a> linked earlier I wrote why I think it makes sense to use Hadoop with external storage - basically the idea is no matter how fancy the software is, it’s always easier to manage and maintain storage by using RAID-protected building blocks. The same applies to Ozone so take a look at that link to see what I meant.</p>

<p>Here we see Ozone’s data protection schemes: RF1, RF2, RF3, and various EC schemes.</p>

<p><img src="/assets/images/apache-ozone-s3-e-series-06.png" alt="Azure Ozone settings" /></p>

<p>How would we use those with E-Series? Some examples:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Use case</th>
      <th style="text-align: center">Ozone S3</th>
      <th style="text-align: center">E-Series</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Value S3 buckets (bulk)</td>
      <td style="text-align: center">RF1</td>
      <td style="text-align: center">Wide DDP</td>
    </tr>
    <tr>
      <td style="text-align: left">Fast S3 Big Data/Analytics</td>
      <td style="text-align: center">RF2</td>
      <td style="text-align: center">RAID6 or DDP</td>
    </tr>
    <tr>
      <td style="text-align: left">Value S3 Big Data/Analytics</td>
      <td style="text-align: center">EC</td>
      <td style="text-align: center">Wide DDP</td>
    </tr>
    <tr>
      <td style="text-align: left">HDFS/S3 Big Data/Analytics</td>
      <td style="text-align: center">any</td>
      <td style="text-align: center">RAID6 or DDP</td>
    </tr>
  </tbody>
</table>

<p>Ozone RF1 makes sense only with protected storage, which is how you can get lowest cost with excellent durability due to E-Series’s HA architecture and Dynamic Disk Pools (see that Hadoop on E-Series post for more on that) Ozone data is protected from controller failures, dual concurrent disk failures, and even shelf failures (you need to have a handful of shelves) and protection overhead is very low (~10%).</p>

<p>If you need highest performance with Ozone and E-Series, Ozone should use RF2 on top of E-Series volumes protected with RAID6 (better for sequential performance, but higher overhead than DDP) or DDP (better for mixed workloads). As indicated in the post about Hadoop with E-Series, RF3 is unnecessary due to there already being enough redundancy in E-Series, and it doesn’t even help with the performance.</p>

<p>If you have enough capacity and performance to require several E-Series arrays, Ozone can use EC to stripe data across multiple E-Series arrays.</p>

<p>Now, what do we need to do to “tune” Ozone for E-Series? Ozone is already tuned for sequential workloads that one would expect to see in Big Data environments, and so is E-Series. You could surely fine-tune both further, but you’d need to know for what workload(s).</p>

<p>Ozone has a ton of settings that can impact performance and can be easily changed.</p>

<p><img src="/assets/images/apache-ozone-s3-e-series-04.png" alt="Azure Ozone settings" /></p>

<p>On E-Series it’s simpler - there’s just two-three things to consider - RAID segment size, RAID/DDP configuration, shelf/controller type and connectivity (FC, IB, etc.).</p>

<h2 id="to-do-items">To-Do items</h2>

<p>Some things that I might do with Ozone and E-Series later this year (if I find a reason):</p>

<ul>
  <li>I haven’t investigated how Ozone S3 scales <em>out</em> (that is, I haven’t checked if localhost:9878 service runs on all nodes, or just one) and whether S3 autoscaling is possible</li>
  <li>I’d like to evaluate HTTPS integration (with NGINX or something like that)</li>
  <li>I’d like to do basic performance testing with Ozone S3 and E-Series to see if Ozone S3 can effectively use storage performance that E-Series can deliver</li>
  <li>Understand how Ozone S3 ACLs compare to AWS S3 ACLs</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>There are many ways for S3 SDS to leverage E-Series. Many NetApp customers use StorageGRID because StorageGRID appliances minimize risk, work with a variety of workloads, and are validated for many enterprise applications.</p>

<p>Ozone S3 is a relative newcomer and still very young (current version 1.2.1) and focused on Big Data workloads, so it must be appealing to users with that background. It doesn’t provide fancy enterprise features and certifications, it requires more effort to plan, implement and maintain, but it should be very effective in use cases similar to those I outlined above. I wouldn’t use it for many small objects, or from S3 clients that make use of many S3 API features.</p>

<p>It seems some ISVs (at least Cloudera, maybe there are others) provide paid support for Ozone, so E-Series users looking for supported Ozone S3 could get support for Ozone from their Big Data or Kubernetes stack provider, and deploy it with E-Series by simply presenting E-Series volumes (or host-path (static) volumes in the case of Kubernetes) to their Ozone servers/VMs/containers.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#analytics">analytics</a>
      &nbsp; 
    
      <a href="
      /categories/#storage">storage</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2023/07/28/thanos-with-minio-eseries-or-ontap-s3.html">Thanos with different S3 backends - StorageGRID, ONTAP S3 and MinIO on E-Series</a></li>
      
        <li><a href="/2022/08/09/nomad-beegfs-minio-s3.html">Simple S3 service endpoint for BeeGFS using Hashicorp Nomad and stand-alone MinIO</a></li>
      
        <li><a href="/2023/11/30/elasticsearch-ilm-netapp-eseries.html">Snapshots and ILM with Elasticsearch 8</a></li>
      
        <li><a href="/2023/09/03/minio-erasure-coding-and-netapp-e-series.html">MinIO Erasure Coding with NetApp E-Series</a></li>
      
        <li><a href="/2022/10/21/minio-performance-netapp-e-series.html">Notes on MinIO performance with NetApp E-Series</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-08-04 13:23 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
