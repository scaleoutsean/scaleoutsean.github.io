<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.3 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Create SolidFire volumes and accounts with Terraform | Acting Technologist</title>
<meta name="description" content="How to create and maintain SolidFire volumes and accounts with Terraform">


  <meta name="author" content="scaleoutSean">
  
  <meta property="article:author" content="scaleoutSean">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Acting Technologist">
<meta property="og:title" content="Create SolidFire volumes and accounts with Terraform">
<meta property="og:url" content="https://scaleoutsean.github.io/2022/02/17/create-maintain-solidfire-volumes-accounts-with-terraform.html">


  <meta property="og:description" content="How to create and maintain SolidFire volumes and accounts with Terraform">





  <meta name="twitter:site" content="@scaleoutSean">
  <meta name="twitter:title" content="Create SolidFire volumes and accounts with Terraform">
  <meta name="twitter:description" content="How to create and maintain SolidFire volumes and accounts with Terraform">
  <meta name="twitter:url" content="https://scaleoutsean.github.io/2022/02/17/create-maintain-solidfire-volumes-accounts-with-terraform.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2022-02-17T00:00:00+08:00">






<link rel="canonical" href="https://scaleoutsean.github.io/2022/02/17/create-maintain-solidfire-volumes-accounts-with-terraform.html">







  <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />


  <meta name="msvalidate.01" content="7cf5b7d96a77410a8ad035f764dc81b3">





<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Acting Technologist Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic" rel="stylesheet" type="text/css">


  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/scaleoutsean-acting-technologist.png" alt="Acting Technologist"></a>
        
        <a class="site-title" href="/">
          Acting Technologist
          <span class="site-subtitle">human action through technology</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/archive/"
                
                
              >Archive</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/projects.html"
                
                
              >Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Create SolidFire volumes and accounts with Terraform">
    <meta itemprop="description" content="How to create and maintain SolidFire volumes and accounts with Terraform">
    <meta itemprop="datePublished" content="2022-02-17T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://scaleoutsean.github.io/2022/02/17/create-maintain-solidfire-volumes-accounts-with-terraform.html" itemprop="url">Create SolidFire volumes and accounts with Terraform
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-02-17T00:00:00+08:00">2022-02-17 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p><strong>NOTICE:</strong> all credentials and tokens on this page are samples, not leaked.</p>

<p>My <a href="/2021/09/18/using-terraform-1-with-solidfire-12.html">previous post</a> on Terraform with SolidFire used the updated example from the NetApp ElementSW Provider repo on Github.</p>

<p>This post is for folks who've tried (or at least reviewed) that approach, so that we can jump straight into action.</p>

<p>In this approach we still have one account, but several volumes with unique properties.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource "elementsw_account" k8s_account {
  provider         = netapp-elementsw
  username         = var.elementsw_tenant_name 
  target_secret    = "NetApp123$NetApp"
  initiator_secret = "NetApp123$NetApp"
}

locals {
  volumes = {
    "etcd1" = { size = 1073742000, sectorsize_512e="false", qos={min="100", max="200", burst="300"} },
    # "etcd2" = { size = 1073742000, sectorsize_512e="false", qos={min="100", max="200", burst="300"} },
    "etcd3" = { size = 1073742000, sectorsize_512e="false", qos={min="100", max="200", burst="300"} }
  }
}

resource "elementsw_volume" volume {
  for_each   = local.volumes
  provider   = netapp-elementsw
  name       = "${each.key}"
  account    = elementsw_account.k8s_account.id
  total_size = each.value.size
  enable512e = each.value.sectorsize_512e
  min_iops   = each.value.qos.min
  max_iops   = each.value.qos.max
  burst_iops = each.value.qos.burst
}

output "elementsw_volume" {
  value      = elementsw_volume.volume
}
</code></pre></div></div>

<p>Now we can plan, then apply, remove <code class="language-plaintext highlighter-rouge">#</code> to add etcd2, apply again, etc.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>elementsw_volume = {
  "etcd1" = {
    "account" = "9"
    "attributes" = tolist(null) /* of string */
    "burst_iops" = 300
    "enable512e" = false
    "id" = "24"
    "iqn" = "iqn.2010-01.com.solidfire:46z9.etcd1.24"
    "max_iops" = 200
    "min_iops" = 100
    "name" = "etcd1"
    "total_size" = 1073742000
  }
  "etcd2" = {
    "account" = "9"
    "attributes" = tolist(null) /* of string */
    "burst_iops" = 300
    "enable512e" = false
    "id" = "23"
    "iqn" = "iqn.2010-01.com.solidfire:46z9.etcd2.23"
    "max_iops" = 200
    "min_iops" = 100
    "name" = "etcd2"
    "total_size" = 1073742000
  }
  "etcd3" = {
    "account" = "9"
    "attributes" = tolist(null) /* of string */
    "burst_iops" = 300
    "enable512e" = false
    "id" = "22"
    "iqn" = "iqn.2010-01.com.solidfire:46z9.etcd3.22"
    "max_iops" = 200
    "min_iops" = 100
    "name" = "etcd3"
    "total_size" = 1073742000
  }
}
</code></pre></div></div>

<p>Destroy works the same way, i.e. you can remove just one of the volumes.</p>

<p>We can also change QoS settings and re-apply:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Terraform will perform the following actions:

  # elementsw_volume.volume["etcd2"] will be updated in-place
  ~ resource "elementsw_volume" "volume" {
        id         = "36"
      ~ max_iops   = 200 -&gt; 150
        name       = "etcd2"
        # (6 unchanged attributes hidden)
    }

  # elementsw_volume.volume["etcd3"] will be updated in-place
  ~ resource "elementsw_volume" "volume" {
        id         = "34"
      ~ max_iops   = 200 -&gt; 150
        name       = "etcd3"
        # (7 unchanged attributes hidden)
    }

Plan: 0 to add, 2 to change, 0 to destroy.

Changes to Outputs:
  ~ elementsw_volume = {
      ~ etcd2 = {
          ~ max_iops   = 200 -&gt; 150
            # (9 unchanged elements hidden)
        }
      ~ etcd3 = {
          ~ max_iops   = 200 -&gt; 150
            # (9 unchanged elements hidden)
        }
    }

</code></pre></div></div>

<p>List of volumes and their properties can be stored in variables.tf or volumes.tf or externally generated.</p>

<p>Multiple changes of volume properties, such as volume sizes and QoS, also work. As per the API, volumes can be extended but not shrunk.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Terraform will perform the following actions:

  # elementsw_volume.volume["etcd3"] will be updated in-place
  ~ resource "elementsw_volume" "volume" {
        id         = "39"
      ~ min_iops   = 100 -&gt; 150
        name       = "etcd3"
      ~ total_size = 1073742000 -&gt; 3073742000
        # (5 unchanged attributes hidden)
    }

Plan: 0 to add, 1 to change, 0 to destroy.

Changes to Outputs:
  ~ elementsw_volume = {
      ~ etcd3 = {
          ~ min_iops   = 100 -&gt; 150
          ~ total_size = 1073742000 -&gt; 3073742000
            # (8 unchanged elements hidden)
        }
        # (1 unchanged element hidden)
    }

</code></pre></div></div>

<p>In the current provider documentation (on the Terraform Web site) there's no mention of tenant (storage) account secrets, but I noticed those while preparing for today's post and they seem to work well so you don't have to rely on API-provided random passwords.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Terraform will perform the following actions:

  # elementsw_account.k8s_account will be updated in-place
  ~ resource "elementsw_account" "k8s_account" {
        id               = "18"
      ~ target_secret    = "NetApp123$NetApp" -&gt; "NetApp123$000"
        # (2 unchanged attributes hidden)
    }

Plan: 0 to add, 1 to change, 0 to destroy.
</code></pre></div></div>

<p>This makes it easy to update account details with passwords that fit your internal complexity rules (although, unfortunately, the SolidFire API v12.3 limits the length of CHAP secret to only 16 characters - it seems that's 16 is the maximum accepted by Windows iSCSI initiator).</p>

<p>Compared to the example from previous Terraform-related post, this approach is more suitable for creation and maintenance of volumes for a project that belongs to single account. It also doesn't use VAGs because SolidFire's CSI provider now relies exclusively on tenant accounts and CHAP (VAG was deprecated for NetApp Trident, although it's still used in VMware and other clusters).</p>

<h2 id="demo">Demo</h2>

<p>It's not very different from previous demos, so I recorded this as a simple 60 second (it loops so don't wait for it to finish) animated GIF. Open it in a new tab for easier viewing.</p>

<p><img src="/assets/images/terraform-solidfire-2022-02.gif" alt="Volume create, update, delete with Terraform and SolidFire" /></p>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/devops" class="page__taxonomy-item p-category" rel="tag">devops</a><span class="sep">, </span>
    
      <a href="/tags/gitops" class="page__taxonomy-item p-category" rel="tag">gitops</a><span class="sep">, </span>
    
      <a href="/tags/go" class="page__taxonomy-item p-category" rel="tag">go</a><span class="sep">, </span>
    
      <a href="/tags/netapp" class="page__taxonomy-item p-category" rel="tag">netapp</a><span class="sep">, </span>
    
      <a href="/tags/plugin" class="page__taxonomy-item p-category" rel="tag">plugin</a><span class="sep">, </span>
    
      <a href="/tags/provider" class="page__taxonomy-item p-category" rel="tag">provider</a><span class="sep">, </span>
    
      <a href="/tags/solidfire" class="page__taxonomy-item p-category" rel="tag">solidfire</a><span class="sep">, </span>
    
      <a href="/tags/terraform" class="page__taxonomy-item p-category" rel="tag">terraform</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/automation" class="page__taxonomy-item p-category" rel="tag">automation</a><span class="sep">, </span>
    
      <a href="/categories/solidfire" class="page__taxonomy-item p-category" rel="tag">solidfire</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2022-02-17T00:00:00+08:00">2022-02-17 00:00</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?via=scaleoutSean&text=Create+SolidFire+volumes+and+accounts+with+Terraform%20https%3A%2F%2Fscaleoutsean.github.io%2F2022%2F02%2F17%2Fcreate-maintain-solidfire-volumes-accounts-with-terraform.html" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://scaleoutsean.github.io/2022/02/17/create-maintain-solidfire-volumes-accounts-with-terraform.html" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

</section>


      
  <nav class="pagination">
    
      <a href="/2022/02/14/middle-class-rbac-solidfire-ansible.html" class="pagination--pager" title="SolidFire RBAC workflow with Ansible">Previous</a>
    
    
      <a href="/2022/02/22/openstack-solidfire.html" class="pagination--pager" title="Kubernetes with Cinder CSI on Openstack and SolidFire - Part 1">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/20/econfig-v2-updates.html" rel="permalink">E-Config v2 updated for QLC drives
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-20T00:00:00+08:00">2025-08-20 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I got carried away while making overdue updates to E-Config and added a new feature
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/11/epa-4-beta.html" rel="permalink">E-Series Performance Analyzer (EPA) v4 beta
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-11T00:00:00+08:00">2025-08-11 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">E-Series Performance Analyzer 4
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/11/bing-index-issue.html" rel="permalink">Got binged in July 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-11T00:00:00+08:00">2025-08-11 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">How I got binged out of Bing in July 2025
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/07/30/solidfire-windows-admin-center-extension.html" rel="permalink">SolidFire Extension for Windows Admin Center 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-07-30T00:00:00+08:00">2025-07-30 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          20 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">More on that extra pair of gloves…
</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2020-2025 scaleoutSean.github.io | <a href="https://scaleoutsean.github.io">Acting Technologist</a> | Terms: <a href="https://creativecommons.org/licenses/by/4.0/deed.en" target="_blank">CC BY 4.0</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
