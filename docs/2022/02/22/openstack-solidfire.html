<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Kubernetes with Cinder CSI Plugin on Openstack Yoga/Xena with SolidFire 12.3 - Part 1 | Acting Technologist
      
    </title>
    <meta name="description" content="
     Kubernetes Cinder CSI Plugin on Openstack Xena or Yoga with SolidFire - Part 1
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Kubernetes with Cinder CSI Plugin on Openstack Yoga/Xena with SolidFire 12.3 - Part 1 | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Kubernetes with Cinder CSI Plugin on Openstack Yoga/Xena with SolidFire 12.3 - Part 1" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Kubernetes Cinder CSI Plugin on Openstack Xena or Yoga with SolidFire - Part 1" />
<meta property="og:description" content="Kubernetes Cinder CSI Plugin on Openstack Xena or Yoga with SolidFire - Part 1" />
<link rel="canonical" href="https://scaleoutsean.github.io/2022/02/22/openstack-solidfire.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2022/02/22/openstack-solidfire.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-02-22T00:00:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2022/02/22/openstack-solidfire.html"},"author":{"@type":"Person","name":"scaleoutSean"},"description":"Kubernetes Cinder CSI Plugin on Openstack Xena or Yoga with SolidFire - Part 1","@type":"BlogPosting","url":"https://scaleoutsean.github.io/2022/02/22/openstack-solidfire.html","headline":"Kubernetes with Cinder CSI Plugin on Openstack Yoga/Xena with SolidFire 12.3 - Part 1","dateModified":"2022-02-22T00:00:00+08:00","datePublished":"2022-02-22T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Kubernetes with Cinder CSI Plugin on Openstack Yoga/Xena with SolidFire 12.3 - Part 1</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>22 Feb 2022</span> - <i class="far fa-clock"></i> 


  
  
    9 minute read
  

    </span>
  </div>
  
        <p><strong>NOTICE:</strong> all credentials and tokens on this page are samples, not leaked.</p>

<p><strong>Posts in “Kubernetes with Cinder CSI Plugin on Openstack Yoga/Xena with SolidFire 12.3” series</strong></p>

<ul>
  <li>(this post) Kubernetes with Cinder CSI Plugin on Openstack Yoga/Xena with SolidFire 12.3 - Part 1</li>
  <li><a href="/2022/03/02/openstack-solidfire-part-2.html">Kubernetes with Cinder CSI Plugin on Openstack Yoga/Xena with SolidFire 12.3 - Part 2</a></li>
</ul>

<p><strong>Table of Content for Part 1</strong></p>

<!-- TOC -->

<ul>
  <li><a href="#introduction">Introduction</a>
    <ul>
      <li><a href="#active-active">Active-Active</a></li>
      <li><a href="#protection-domains">Protection Domains</a></li>
      <li><a href="#backup-and-restore">Backup and restore</a></li>
      <li><a href="#comparison-with-netapp-astra-trident">Comparison with NetApp Astra Trident</a></li>
    </ul>
  </li>
  <li><a href="#deploy-openstack-with-solidfire">Deploy Openstack with SolidFire</a></li>
  <li><a href="#configure-cinder-with-solidfire-back-end">Configure Cinder with SolidFire back end</a></li>
  <li><a href="#appendix-a">Appendix A</a></li>
  <li><a href="#video-walk-through">Video walk-through</a></li>
</ul>

<!-- /TOC -->

<h2 id="introduction">Introduction</h2>

<p>What’s so special about Kubernetes on Openstack with SolidFire vs. Kubernetes on other stack with SolidFire?</p>

<p>The fact that we can use Cinder to manage storage provisioning. Not just for Openstack VMs, but <a href="https://github.com/kubernetes-sigs/kubespray/blob/release-2.18/docs/cinder-csi.md">also for Kubernetes</a>.</p>

<blockquote>
  <p>Cinder CSI driver allows you to provision volumes over an Openstack deployment.</p>
</blockquote>

<p>Why?</p>

<p>Because it’s an integrated approach and the driver (I mean Cinder) is stable, featured and has been around forever. According to SolidFire Cinder driver documentation for Xena release, here’s what it can do today:</p>

<ul>
  <li>Create, delete, attach, and detach volumes</li>
  <li>Create, list, and delete volume snapshots</li>
  <li>Create a volume from a snapshot</li>
  <li>Copy an image to a volume</li>
  <li>Copy a volume to an image</li>
  <li>Clone a volume</li>
  <li>Extend a volume</li>
  <li>Retype a volume</li>
  <li>Manage and unmanage a volume</li>
  <li>Consistency group snapshots</li>
</ul>

<p>QoS features are also richer than what you can get in Trident CSI today (same source):</p>

<ul>
  <li>minIOPS - The minimum number of IOPS guaranteed for this volume</li>
  <li>maxIOPS - The maximum number of IOPS allowed for this volume</li>
  <li>burstIOPS - The maximum number of IOPS allowed over a short period of time</li>
  <li>scaledIOPS - A flag indicating that the above IOPS should be scaled by the following scale values
    <ul>
      <li>scaleMin - The amount to scale the minIOPS by for every 1GB of additional volume size</li>
      <li>scaleMax - The amount to scale the maxIOPS by for every 1GB of additional volume size</li>
      <li>scaleBurst - The amount to scale the burstIOPS by for every 1GB of additional volume size</li>
    </ul>
  </li>
</ul>

<p>And finally, Cinder CSI supports Ephemeral volumes.</p>

<h3 id="active-active">Active-Active</h3>

<p>Since 2020 (Ussuri release), SolidFire Cinder driver supports <a href="https://netapp.io/2020/06/12/my-name-is-ussuri/">volume fail-over between clusters</a>.</p>

<blockquote>
  <p>The Ussuri release enables Active/Active (including replication) support for to the SolidFire driver. This allows users to configure SolidFire backends in clustered environments.</p>
</blockquote>

<p>You can see features of SolidFire Cinder driver from Ussuri release <a href="https://netapp-openstack-dev.github.io/openstack-docs/ussuri/netapp-storage/section_solidfire.html">here</a>.</p>

<h3 id="protection-domains">Protection Domains</h3>

<p>As illustrated and explained in <a href="/2021/07/06/solidfire-protection-domains-data-path.html">this</a> post, six or more SolidFire nodes can be deployed in three “protection domains” (similar to Availability Zones), so the ability to run Kubernetes on this mature and feature-rich platform looks appealing.</p>

<p>Note that when K8s is used with SolidFire Protection Domains, you can’t use AZ settings in OpenStack or Kubernetes Cinder CSI Plugin: Openstack “AZs” don’t map to SolidFire Protection Domains - SolidFire volumes can be scheduled (and move around) all Protection Domains so Nova instances may need to connect to iSCSI targets in any available Protection Domain. So AZ-related settings may not work. See the above link for the details.</p>

<h3 id="backup-and-restore">Backup and restore</h3>

<p>Additionally, this approach (see <a href="/2021/04/22/solidfire-kvm-duplicati-and-backup-to-s3.html">this post on KVM/QEMU backup</a>) may make it convenient to use Openstack’s built-in <a href="https://wiki.openstack.org/wiki/Freezer-backup-restore#Cinder_Backups">backup feature</a> to backup Cinder CSI volumes. Although we may be able to do that “natively” with Kubernetes-integrated Velero backup (CSI or non-CSI approach) as well.</p>

<p>Almost no one I’ve asked has heard about it, but a SolidFire developer demonstrated the concept of using Cinder for containers <a href="https://www.youtube.com/watch?v=vCDlQ0F4kik">half a decade ago</a>. I haven’t deep-dived into this because the details don’t interest me that much, but it looks like VMware vSphere CSI provider validated that approach.</p>

<p>In Part 1 we’ll just install Openstack with Cinder configured for SolidFire. I completed this and realized installing Kubernetes on top of that would require more hardware resources than I have at hand, so I’ll leave the Kubernetes and Cinder CSI for Part 2.</p>

<h3 id="comparison-with-netapp-astra-trident">Comparison with NetApp Astra Trident</h3>

<p>Currently (as of Trident v22.01) Cinder CSI has some advantages such as the ability to retype volumes (see demo video at the bottom), and perform SolidFire cluster failover (not required for Protection Domains, but required with two separate SolidFire clusters).</p>

<h2 id="deploy-openstack-with-solidfire">Deploy Openstack with SolidFire</h2>

<p>Openstack has always felt complex to install, but All-in-One approaches are reasonably well documented now, and I recommend those over installing a full blown Openstack - especially so if you don’t have a lot of hardware resources. There’s something called <a href="https://docs.openstack.org/devstack/xena/">DevStack</a> and there’s a set of Ansible scripts that does the same (or similar) with Ansible.</p>

<p>After reading the documentation for several full-stack enterprise Openstack distributions, I got turned off by the highly complex documentation with a bunch of workarounds for various bugs (in drivers, distros, etc) and used DevStack.</p>

<p>I won’t repeat what’s already in the upstream documents, but I do want to mention how my network was configured:</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Ext (VLAN 1)</th>
      <th>iSCSI (VLAN 103)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>VM</td>
      <td>192.168.1.119</td>
      <td>192.168.103.119</td>
    </tr>
    <tr>
      <td>SolidFire</td>
      <td>192.168.1.34</td>
      <td>192.168.103.34</td>
    </tr>
  </tbody>
</table>

<p>Public/Floating IPs were on External network, while iSCSI on Openstack Nova host was accessing SolidFire SVIP over iSCSI network.</p>

<p>This used two stand-alone NICs, but there are different versions (with one NIC, with one single and one bonded, etc.) so check the Openstack Xena documentation and pick an approach that doesn’t require you to make significant changes or invent a unique configuration that’s hard to get to work.</p>

<p>I used one VM for All-in-One Openstack Xena and another for SolidFire Demo VM 12.3. All-in-One Openstack had some issues with Keystone, but other parts seemed to work fine.</p>

<h2 id="configure-cinder-with-solidfire-back-end">Configure Cinder with SolidFire back end</h2>

<p>The SolidFire Cinder driver for Openstack is built-in. You can see the details <a href="https://docs.openstack.org/cinder/xena/configuration/block-storage/drivers/solidfire-volume-driver.html">here</a>.</p>

<p>Configure Cinder for SolidFire using minimal options (don’t forget to add “solidfire” to enabled_backends):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[DEFAULT]
default_volume_type = lvmdriver-1
scheduler_default_filters = DriverFilter
enabled_backends = lvmdriver-1,solidfire

[solidfire]
volume_driver  = cinder.volume.drivers.solidfire.SolidFireDriver
san_ip         = 192.168.1.34  # the address of my MVIP
san_login      = admin         # cluster admin login
san_password   = admin         # cluster admin password
sf_account_prefix = 'os'       # os=Openstack (will be prefixed to project ID in SF tenant account)
sf_emulate_512 = True          # on by default, required for KVM (and ESXi 7.0, IIRC)
</code></pre></div></div>

<p>In non-essential options there’s <code class="language-plaintext highlighter-rouge">sf_account_prefix</code> which is the prefix for SolidFire tenant (storage) accounts.</p>

<p>I found it interesting that these are created on-demand and in my case were equal to Openstack Project ID. I don’t (yet) know how that works with Cinder CSI, but in Trident CSI the default account is always called Trident unless manually overridden during installation. The Cinder approach may be better - we’ll see if we get to Cinder CSI in Part 2 -as it’d allow for better account segregation.</p>

<p>After Cinder is configured, restart Cinder-related services and configure Volume Type in Openstack. This can be done in the CLI or from Openstack dashboard.</p>

<p>Once done you should see something like this (in this case I did not make SolidFire my default Cinder driver):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@aio:/tmp# cinder extra-specs-list
+--------------------------------------+----------------+----------------------------------------+
| ID                                   | Name           | extra_specs                            |
+--------------------------------------+----------------+----------------------------------------+
| 453cbb71-9fe1-49e0-be40-c32733182f4d | solidfire      | <span class="o">{</span><span class="s1">'volume_backend_name'</span>: <span class="s1">'solidfire'</span><span class="o">}</span>   |
| 75745d2a-96db-4552-b325-57a5521194e5 | lvmdriver-1    | <span class="o">{</span><span class="s1">'volume_backend_name'</span>: <span class="s1">'lvmdriver-1'</span><span class="o">}</span> |
| 9f2a4a01-8421-44c7-aaf0-2fe101872b01 | solidfire-high | <span class="o">{</span><span class="s1">'volume_backend_name'</span>: <span class="s1">'solidfire'</span><span class="o">}</span>   |
| f73f0038-ac51-4cc4-96c5-a1d61c3c716d | __DEFAULT__    | <span class="o">{}</span>                                     |
+--------------------------------------+----------------+----------------------------------------+
</code></pre></div></div>

<p>For each SolidFire backend I created one QoS policy:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@aio:/tmp# cinder qos-list
+--------------------------------------+------+----------+------------------------------------------------------------+
| ID                                   | Name | Consumer | specs                                                      |
+--------------------------------------+------+----------+------------------------------------------------------------+
| 3c8bc92e-a281-4e2b-b822-9b25c42b2f3e | low  | back-end | <span class="o">{</span><span class="s1">'minIOPS'</span>: <span class="s1">'100'</span>, <span class="s1">'maxIOPS'</span>: <span class="s1">'500'</span>, <span class="s1">'burstIOPS'</span>: <span class="s1">'1500'</span><span class="o">}</span>  |
| a0028ce4-b9db-438e-a0f9-34072ab337a0 | high | back-end | <span class="o">{</span><span class="s1">'maxIOPS'</span>: <span class="s1">'1500'</span>, <span class="s1">'minIOPS'</span>: <span class="s1">'500'</span>, <span class="s1">'burstIOPS'</span>: <span class="s1">'2500'</span><span class="o">}</span> |
+--------------------------------------+------+----------+------------------------------------------------------------+
</code></pre></div></div>

<ul>
  <li>Setting SolidFire volume types and QoS specs in Openstack console</li>
</ul>

<p><img src="/assets/images/openstack-solidfire-volume-types.png" alt="SolidFire Cinder volume types" /></p>

<p>Create a VM and a SolidFire volume for it. In below output boot disk is in on internal storage and “data disk” (/dev/vdb) is on SolidFire.</p>

<ul>
  <li>Create SolidFire volume in a Project</li>
</ul>

<p><img src="/assets/images/openstack-solidfire-volume-options.png" alt="SolidFire Cinder volume options" /></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@aio:/tmp# cinder list
+--------------------------------------+-----------+-------------+------+----------------+-------------+----------+--------------------------------------+
| ID                                   | Status    | Name        | Size | Consumes Quota | Volume Type | Bootable | Attached to                          |
+--------------------------------------+-----------+-------------+------+----------------+-------------+----------+--------------------------------------+
| 6a0cd627-7ec1-4b83-ac68-891756d05d5c | <span class="k">in</span><span class="nt">-use</span>    |             | 1    | True           | lvmdriver-1 | <span class="nb">true</span>     | f5c5973c-4af9-4b06-a8d0-2c22d6f36a13 |
| e6e4c6e5-391f-43e0-bd5e-a20828ecd67e | available | cinder-test | 2    | True           | solidfire   | <span class="nb">false</span>    |                                      |
+--------------------------------------+-----------+-------------+------+----------------+-------------+----------+--------------------------------------+
</code></pre></div></div>

<p>Find the VM instance and attach <code class="language-plaintext highlighter-rouge">cinder-test</code> volume to it. Now the SolidFire volume is attached to the VM.</p>

<ul>
  <li>Attach SolidFire volume to a VM instance</li>
</ul>

<p><img src="/assets/images/openstack-solidfire-volume-attach-to-vm.png" alt="Attach SolidFire volume to VM" /></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@aio:/tmp# cinder list
+--------------------------------------+--------+-------------+------+----------------+-------------+----------+--------------------------------------+
| ID                                   | Status | Name        | Size | Consumes Quota | Volume Type | Bootable | Attached to                          |
+--------------------------------------+--------+-------------+------+----------------+-------------+----------+--------------------------------------+
| 6a0cd627-7ec1-4b83-ac68-891756d05d5c | <span class="k">in</span><span class="nt">-use</span> |             | 1    | True           | lvmdriver-1 | <span class="nb">true</span>     | f5c5973c-4af9-4b06-a8d0-2c22d6f36a13 |
| e6e4c6e5-391f-43e0-bd5e-a20828ecd67e | <span class="k">in</span><span class="nt">-use</span> | cinder-test | 2    | True           | solidfire   | <span class="nb">false</span>    | f5c5973c-4af9-4b06-a8d0-2c22d6f36a13 |
+--------------------------------------+--------+-------------+------+----------------+-------------+----------+--------------------------------------+
</code></pre></div></div>

<ul>
  <li>SolidFire volume attached to compute instance</li>
</ul>

<p><img src="/assets/images/openstack-solidfire-volume-in-vm.png" alt="SolidFire volume in VM" /></p>

<p>From the console we see that the 2GiB SolidFire volume attached as /dev/vdb.</p>

<ul>
  <li>Three volumes attached to the VM instance (one LVM boot volume and two SolidFire data volumes)</li>
</ul>

<p><img src="/assets/images/openstack-solidfire-volumes.png" alt="SolidFire volumes in Openstack" /></p>

<p>I chose to not use SolidFire for boot volumes because SolidFire Demo VM used for this PoC has limited IOPS. Many SolidFire users boot Openstack VMs from SolidFire because of its QoS, DR/BC features and built-in efficiencies (deduplication and compression) that do not impact QoS.</p>

<p>Next, we need to deploy Kubernetes with Cinder CSI. If I write that post, I’ll post a link to it here.</p>

<h2 id="appendix-a">Appendix A</h2>

<p>This script helps you quickly configure SolidFire Volume Type and QoS settings.</p>

<p>You need to be authenticated (apply the Openstack credentials) for this script to work. SolidFire Cinder driver must be up, running and working in order for volume types created this way to work. You can run this before or after Cinder is installed (if it’s installed before, types won’t work because volume driver isn’t usable).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>

<span class="c">###############################################################################</span>
<span class="c"># https://github.com/scaleoutSean                                             #</span>
<span class="c"># Adopted from solidfire-ai &amp; licensed under the Apache 2.0 License           #</span>
<span class="c"># https://github.com/scaleoutsean/solidfire-ai/blob/master/LICENSE            #</span>
<span class="c">###############################################################################</span>

<span class="k">function </span>get_field <span class="o">{</span>
    <span class="k">while </span><span class="nb">read </span>data<span class="p">;</span> <span class="k">do
        if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="nt">-lt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nv">field</span><span class="o">=</span><span class="s2">"(</span><span class="se">\$</span><span class="s2">(NF</span><span class="nv">$1</span><span class="s2">))"</span>
        <span class="k">else
            </span><span class="nv">field</span><span class="o">=</span><span class="s2">"</span><span class="se">\$</span><span class="k">$((</span><span class="nv">$1</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span><span class="s2">"</span>
        <span class="k">fi
        </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$data</span><span class="s2">"</span> | <span class="nb">awk</span> <span class="nt">-F</span><span class="s1">'[ \t]*\\|[ \t]*'</span> <span class="s2">"{print </span><span class="nv">$field</span><span class="s2">}"</span>
    <span class="k">done</span>
<span class="o">}</span>

<span class="c"># --- setup Volume Types ---</span>
<span class="c"># set VOLUME_BACKEND_NAME to the name of your SolidFire cluster</span>
<span class="nv">VOLUME_BACKEND_NAME</span><span class="o">=</span><span class="s2">"solidfire"</span>

cinder type-create solidfire
cinder type-key solidfire <span class="nb">set </span><span class="nv">volume_backend_name</span><span class="o">=</span><span class="nv">$VOLUME_BACKEND_NAME</span>

<span class="c"># Setup 4 arrays corresponding to your Volume types and QoS settings</span>
<span class="nv">VOL_TYPES</span><span class="o">=(</span> <span class="s2">"silver"</span> <span class="s2">"bronze"</span> <span class="s2">"gold"</span> <span class="s2">"webserver"</span> <span class="s2">"platinum"</span> <span class="o">)</span>
<span class="nv">DESCRIPTION</span><span class="o">=(</span> <span class="s1">'$[$1.12/GB/month]'</span> <span class="s1">'$[0.50/GB/month]'</span> <span class="s1">'[$2.10/GB/month]'</span> <span class="s1">'[$0.35/GB/month]'</span> <span class="s1">'[$3.00/GB/month]'</span> <span class="o">)</span>
<span class="nv">MIN</span><span class="o">=(</span>        500    100      1000   100       2000    <span class="o">)</span>
<span class="nv">MAX</span><span class="o">=(</span>        800    200      1500  1000       2000    <span class="o">)</span>
<span class="nv">BURST</span><span class="o">=(</span>      900    400      1700  1500       2500    <span class="o">)</span>

<span class="nv">INDEX</span><span class="o">=</span>0
<span class="k">for </span>VOL_TYPE <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">VOL_TYPES</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>
<span class="k">do
   </span><span class="nb">echo</span> <span class="s2">"Create Volume Type: </span><span class="k">${</span><span class="nv">VOL_TYPE</span><span class="k">}</span><span class="s2">"</span>
   <span class="nv">TYPE_DESC</span><span class="o">=</span><span class="s2">"IOPS=</span><span class="k">${</span><span class="nv">MIN</span><span class="p">[</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="p">]</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">MAX</span><span class="p">[</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="p">]</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">BURST</span><span class="p">[</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="p">]</span><span class="k">}</span><span class="s2"> </span><span class="k">${</span><span class="nv">DESCRIPTION</span><span class="p">[</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="p">]</span><span class="k">}</span><span class="s2">"</span>
   <span class="nv">TYPENAME_TYPEID</span><span class="o">=</span><span class="si">$(</span>cinder type-create <span class="nt">--description</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TYPE_DESC</span><span class="k">}</span><span class="s2">"</span> <span class="k">${</span><span class="nv">VOL_TYPE</span><span class="k">}</span> | <span class="nb">grep</span> <span class="k">${</span><span class="nv">VOL_TYPE</span><span class="k">}</span> | get_field 1<span class="si">)</span>
   <span class="nb">echo</span> <span class="s2">"Creating QoS Specs"</span>
   <span class="nv">QOS_ID</span><span class="o">=</span><span class="si">$(</span>cinder qos-create <span class="k">${</span><span class="nv">VOL_TYPE</span><span class="k">}</span><span class="nt">-qos</span> <span class="nv">minIOPS</span><span class="o">=</span><span class="k">${</span><span class="nv">MIN</span><span class="p">[</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="p">]</span><span class="k">}</span> <span class="nv">maxIOPS</span><span class="o">=</span><span class="k">${</span><span class="nv">MAX</span><span class="p">[</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="p">]</span><span class="k">}</span> <span class="nv">burstIOPS</span><span class="o">=</span><span class="k">${</span><span class="nv">BURST</span><span class="p">[</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="p">]</span><span class="k">}</span> | <span class="nb">grep id</span> | get_field 2<span class="si">)</span>
   <span class="nb">echo</span> <span class="s2">"Setting volume backend name ..."</span>
   cinder type-key <span class="k">${</span><span class="nv">TYPENAME_TYPEID</span><span class="k">}</span> <span class="nb">set </span><span class="nv">volume_backend_name</span><span class="o">=</span><span class="k">${</span><span class="nv">VOLUME_BACKEND_NAME</span><span class="k">}</span>
   <span class="nb">echo</span> <span class="s2">"Associating QoS specs with volume type .... "</span>
   cinder qos-associate <span class="k">${</span><span class="nv">QOS_ID</span><span class="k">}</span> <span class="k">${</span><span class="nv">TYPENAME_TYPEID</span><span class="k">}</span>
   <span class="o">((</span>INDEX++<span class="o">))</span>
<span class="k">done

</span><span class="nb">echo</span> <span class="s2">"Created Types and Extra-Specs:"</span>
cinder extra-specs-list
</code></pre></div></div>

<h2 id="video-walk-through">Video walk-through</h2>

<ul>
  <li><a href="https://rumble.com/vw4zdc-using-openstack-xena-with-cinder-and-solidfire-12.3.html">Openstack Xena with Cinder and SolidFire 12.3</a> - 8m04s</li>
</ul>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#virtualization">virtualization</a>
      &nbsp; 
    
      <a href="
      /categories/#kubernetes">kubernetes</a>
      &nbsp; 
    
      <a href="
      /categories/#solidfire">solidfire</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2023/08/21/trident-new-stateful-set-delete-feature.html">StatefulSet PVC Retention with Trident and SolidFire</a></li>
      
        <li><a href="/2024/07/02/solidfire-volume-attributes-from-trident-and-other-apps.html">Extract SolidFire volume attributes created by Trident or other apps</a></li>
      
        <li><a href="/2023/09/15/velero-csi-snapshot-data-movement-with-netapp-solidfire.html">Velero 1.12 and CSI Snapshot Data Movement with NetApp SolidFire</a></li>
      
        <li><a href="/2023/08/02/netapp-trident-v2307.html">What's new in NetApp Trident v23.07</a></li>
      
        <li><a href="/2023/04/15/cloudcasa-netapp-trident-solidfire.html">CloudCasa, Velero, NetApp Trident, and SolidFire</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2025-06-30 17:27 </p>
    <p>Copyright © 2025 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
