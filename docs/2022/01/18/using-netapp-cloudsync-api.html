<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Using NetApp Cloud Sync API | Acting Technologist
      
    </title>
    <meta name="description" content="
     Explore Cloud Sync API
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Using NetApp Cloud Sync API | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Using NetApp Cloud Sync API" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Explore Cloud Sync API" />
<meta property="og:description" content="Explore Cloud Sync API" />
<link rel="canonical" href="https://scaleoutsean.github.io/2022/01/18/using-netapp-cloudsync-api.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2022/01/18/using-netapp-cloudsync-api.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-18T00:00:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2022/01/18/using-netapp-cloudsync-api.html"},"author":{"@type":"Person","name":"scaleoutSean"},"description":"Explore Cloud Sync API","@type":"BlogPosting","url":"https://scaleoutsean.github.io/2022/01/18/using-netapp-cloudsync-api.html","headline":"Using NetApp Cloud Sync API","dateModified":"2022-01-18T00:00:00+08:00","datePublished":"2022-01-18T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Using NetApp Cloud Sync API</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>18 Jan 2022</span> - <i class="far fa-clock"></i> 


  
  
    9 minute read
  

    </span>
  </div>
  
        <p><strong>NOTICE:</strong> all credentials and tokens on this page are samples, not leaked.</p>

<!-- TOC -->

<ul>
  <li><a href="#start-using-cloud-sync">Start using Cloud Sync</a></li>
  <li><a href="#deploy-data-broker">Deploy Data Broker</a></li>
  <li><a href="#set-up-a-relationship-and-subscribe-to-cloud-sync-service">Set up a relationship and subscribe to Cloud Sync service</a></li>
  <li><a href="#sync">Sync</a></li>
  <li><a href="#reports">Reports</a></li>
  <li><a href="#unsubscribe">Unsubscribe</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<!-- /TOC -->

<p>This post is the second in a two-post series. The first post can be found <a href="/2022/01/17/using-netapp-cloudsync-api.html">here</a> and in it you can find how to auth and connect to the Cloud Sync API endpoint. Please note that various IDs have been changed or are results of different experiments, so IDs in JSON examples may be inconsistent.</p>

<h2 id="start-using-cloud-sync">Start using Cloud Sync</h2>

<p>We need to <a href="https://docs.netapp.com/us-en/occm/task_sync_installing_linux.html#installing-the-data-broker">install Cloud Sync Data Broker on Linux</a>. This takes minutes. It needs to be able to access both Source and Destination.</p>

<p>In this post I’ll replicate data from a local NFS server (LAN) to a StorageGRID bucket (WAN), so I will deploy Data Broker on LAN in order to have NFS client close to the source.</p>

<h2 id="deploy-data-broker">Deploy Data Broker</h2>

<p>To deploy one via the API you need to have a list of Data Broker groups. We get that with <code class="language-plaintext highlighter-rouge">GET /groups</code>. A butchered version of a longer JSON response can be seen below:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dataBrokers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-borker"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ONPREM"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"groupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6100000000000000000000003"</span><span class="p">,</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"relationships"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-01-18T02:50:31.605Z"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6000000000000000003"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>Once we have groupId, we use <code class="language-plaintext highlighter-rouge">POST /data-brokers</code> to create a new Data Broker. What exactly goes in there is a mystery. This is what I tried:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-borker-2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ONPREM"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"groupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6000000000000000003"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>There’s a port param which I haven’t been able to figure out and this didn’t work with or without it: in both cases I’d get “Data broker cant (sic!) be added to a group with listener data broker”.</p>

<p>But I created the first Data Broker from the Web UI and that was very easy and intuitive. I named it “data-borker” and used <code class="language-plaintext highlighter-rouge">GET /data-brokers</code> to see what properties it has (there’s no “port” among them, though).</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-borker"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ONPREM"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"groupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"60000000000000003"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"tasksQueueUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://sqs.us-east-1.amazonaws.com/16666666666666/TASKS_prod"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="mi">1642474246365</span><span class="p">,</span><span class="w">
        </span><span class="nl">"lastPing"</span><span class="p">:</span><span class="w"> </span><span class="mi">1642478517750</span><span class="p">,</span><span class="w">
        </span><span class="nl">"transferRate"</span><span class="p">:</span><span class="w"> </span><span class="mf">210.79297356754773</span><span class="p">,</span><span class="w">
        </span><span class="nl">"placement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"updateConfiguration"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"distribution"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ubuntu 20.04.3 LTS"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"privateIp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.1.112"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"updateNewVersion"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"hostname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vm-db"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"platform"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linux"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"os"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Linux"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"release"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5.4.0-58-generic"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"osTotalMem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"16792068096"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"node"</span><span class="p">:</span><span class="w"> </span><span class="s2">"14.18.2"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cpus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"processMaxMem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"117792768"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"scanner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"concurrency"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
                </span><span class="nl">"processes"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nl">"processesLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"transferrer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"concurrency"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
                </span><span class="nl">"processes"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nl">"processesLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.26.21053-379595f-production"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"vault"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.8.4"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61a1a1a1a1a1a1a1a1a1a1a1a"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPLETE"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"fileLink"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://cf.cloudsync.netapp.com/32f0516-b6fd-3719-c8129-3faef96d114_installer"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"latestVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.26.21053-379595f-production"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h2 id="set-up-a-relationship-and-subscribe-to-cloud-sync-service">Set up a relationship and subscribe to Cloud Sync service</h2>

<p>We may subscribe to Cloud Sync before or after a relationship has been configured. If you pay by hour, you can do it after (“just-in-time”).</p>

<p>Then we can setup a relationship according to our plan at the very top of this post.</p>

<p><img src="/assets/images/netapp-cloud-cloudsync-api-04.png" alt="Review a NetApp Cloud Sync relationship" /></p>

<p>We can choose to subscribe to Cloud Sync using Amazon Marketplace (or Azure), upload a bulk subscription license purchased from NetApp. I chose the former because the bulk license supports 20 relationships which isn’t necessary for this post.</p>

<p><code class="language-plaintext highlighter-rouge">POST /relationships-v2</code> can be used to create a relationship. This requires a <a href="https://api.cloudsync.netapp.com/docs/#/Relationships-v2/post_relationships_v2">ton of info</a> so rather than waste time here, I suggest to create one in the Web UI and then <code class="language-plaintext highlighter-rouge">GET /relationships-v2</code> it to see what goes in.</p>

<p>It’s self-explaining if you do it yourself in the Web UI, so I’ll only highlight several key points for those of you who don’t have time to do that:</p>

<ul>
  <li>I sync NFS export 192.168.1.3/data/s3/fake/bake to StorageGRID S3 bucket /fake</li>
  <li><code class="language-plaintext highlighter-rouge">tags</code> is something you can add to help you find this relationship</li>
  <li>Comparison is always done by at least name and size, but additionally we can enable mtime and other properties</li>
  <li>I chose to have Cloud Sync sync data according to a schedule set in <code class="language-plaintext highlighter-rouge">schedule</code> (every Tuesday 10pm local time which is 2pm UTC). Of course, this wouldn’t <em>always</em> be 10pm for those whose TZ’s offset changes from time to time, but when you use the browser Cloud Sync lets you pick local time</li>
  <li>There are other options that are present in JSON but in fact Cloud Sync defaults so you probably can get away with a shorter configuration JSON</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"account"</span><span class="p">:</span><span class="w"> </span><span class="s2">"44444444444444444444444"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"dataBroker"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61a1a1a1a1a1a1a1a1a1a1a6"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfs"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"nfs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.1.3"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"export"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/data/s3"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fake/bake"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfs"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"s3"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sgws"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storagegrid.netapp.com"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"443"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"bucket"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fake"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"prefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                </span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fake"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfs"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tgt"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storagegrid"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"logs"</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"gracePeriod"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w">
            </span><span class="nl">"deleteOnSource"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"deleteOnTarget"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"objectTagging"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"retries"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="nl">"copyAcl"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"files"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"excludeExtensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="nl">"maxSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">9007199254740991</span><span class="p">,</span><span class="w">
                </span><span class="nl">"minSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"minDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1970-01-01"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"maxDate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="nl">"minCreationDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1970-01-01"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"maxCreationDate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"fileTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"files"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nl">"directories"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nl">"symlinks"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"compareBy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nl">"gid"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nl">"mode"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nl">"mtime"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"schedule"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"syncInDays"</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w">
                </span><span class="nl">"syncInHours"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"syncInMinutes"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"nextTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-01-18T14:00:00.000Z"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"isEnabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nl">"syncWhenCreated"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"copyProperties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"isQstack"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"isCm"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"phase"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Initial Copy"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"611111111111111111111111"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NFS2SG"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="mi">1642476996677</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"611111111111111111111111"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"relationshipId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"611111111111111111111111"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"activity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Initial Copy"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PENDING"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"failureMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nl">"executionTime"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-01-18T04:05:49.435Z"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"bytesMarkedForCopy"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"filesMarkedForCopy"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dirsMarkedForCopy"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"filesCopied"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"bytesCopied"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dirsCopied"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"filesFailed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"bytesFailed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dirsFailed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"filesMarkedForRemove"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"bytesMarkedForRemove"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dirsMarkedForRemove"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"filesRemoved"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"bytesRemoved"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dirsRemoved"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"bytesRemovedFailed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"filesRemovedFailed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"filesMarkedForIgnore"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dirsScanned"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"filesScanned"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dirsFailedToScan"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"bytesScanned"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"progress"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"lastMessageTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-01-18T03:36:36.676Z"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"topFiveMostCommonRelationshipErrors"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>We’d use <code class="language-plaintext highlighter-rouge">PUT /relationships/{id}/sync</code> to configure a relationship.</p>

<p><code class="language-plaintext highlighter-rouge">GET /relationships-v2/</code> gets all the relationships, while <code class="language-plaintext highlighter-rouge">GET /relationships-v2/:id</code> gets you one defined by relationship ID.</p>

<h2 id="sync">Sync</h2>

<p>I couldn’t wait until 10pm but I wanted to see a report, so I manually executed a sync job.</p>

<p><img src="/assets/images/netapp-cloud-cloudsync-api-05.png" alt="Sync report" /></p>

<p>Using the API you’d use <code class="language-plaintext highlighter-rouge">PUT /relationships/:id/sync</code> and provide <code class="language-plaintext highlighter-rouge">id</code> obtained from <code class="language-plaintext highlighter-rouge">GET /relationships-v2</code>.</p>

<p>If any of the files failed to get scanned or copied I’d see them in Copy &gt; Failed or in a report obtained via the API.</p>

<h2 id="reports">Reports</h2>

<p>After scheduled synchronization job is supposed to finish, we can run a report to see what happened.</p>

<p>To create a new report we’d use the sample from Swagger’s <code class="language-plaintext highlighter-rouge">POST /accounts/{accountId}/reports</code>.</p>

<p>Report templates come with no examples and you need to be determined to find answers to questions such as what’s “accessPoint”, what API method to use to get Working Environment ID, and so on.</p>

<p>It seems <code class="language-plaintext highlighter-rouge">GET /relationships-v2</code> has 90% of the inputs required, but you’d need do some extra digging to find the rest. Because of this and other reasons I decided to use the Web UI instead.</p>

<p>In the Web UI it’s easy to create a report for both Source (here, NFS) and Destination (here, S3).</p>

<p>Status at Source:</p>

<p><img src="/assets/images/netapp-cloud-cloudsync-api-07.png" alt="Cloud Sync status at Source" /></p>

<p>Status at Destination:</p>

<p><img src="/assets/images/netapp-cloud-cloudsync-api-06.png" alt="Cloud Sync status at Destination" /></p>

<p>All right, 51 items and 29.47 MB on each side - mission accomplished!</p>

<p>You could now use the API to see how those reports need to be created. Even better, now that you <em>have</em> reports configured, you can get a report with <code class="language-plaintext highlighter-rouge">GET /accounts/:accountId/reports/:id</code> a report. Use <code class="language-plaintext highlighter-rouge">POST /accounts/:accountId/reports</code> to create a new one and <code class="language-plaintext highlighter-rouge">DELETE</code> to delete the ones you no longer need.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"account"</span><span class="p">:</span><span class="w"> </span><span class="s2">"500000000000000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dataBroker"</span><span class="p">:</span><span class="w"> </span><span class="s2">"699999999999999999999999"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"s3"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"bucket"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fake"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storagegrid.netapp.com"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"443"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"prefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nl">"provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sgws"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"statistics"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"totals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"objects"</span><span class="p">:</span><span class="w"> </span><span class="mi">51</span><span class="p">,</span><span class="w">
            </span><span class="nl">"emptyObjects"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">30896494</span><span class="p">,</span><span class="w">
            </span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="nl">"distributions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"modifiedTime"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"0hr-1hr"</span><span class="p">:</span><span class="w"> </span><span class="mi">51</span><span class="p">,</span><span class="w">
                </span><span class="nl">"1hr-1d"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"1d-1w"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"1w-1m"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"1m-1y"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"1y+"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"0mb-1mb"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
                </span><span class="nl">"1mb-10mb"</span><span class="p">:</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w">
                </span><span class="nl">"10mb-100mb"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"100mb-1gb"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"1gb-10gb"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"10gb-100gb"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"100gb-1tb"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"1tb+"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"storageClass"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"STANDARD"</span><span class="p">:</span><span class="w"> </span><span class="mi">51</span><span class="p">,</span><span class="w">
                </span><span class="nl">"REDUCED_REDUNDANCY"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"STANDARD_IA"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"ONEZONE_IA"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"INTELLIGENT_TIERING"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"GLACIER"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"GLACIER_IR"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"DEEP_ARCHIVE"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DONE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"startTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-01-18T04:53:09.998Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-01-18T04:53:13.223Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61e647b5c020161882fc6bbc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"duration"</span><span class="p">:</span><span class="w"> </span><span class="mi">3225</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This gives us the opportunity to do something after we compare this outcome with what we had expected. If everything checks out, we can consider automating follow-up actions such as:</p>

<ul>
  <li>shut down Data Broker if it’s running in public cloud</li>
  <li>unsubscribe from Cloud Sync</li>
  <li>send email notification</li>
</ul>

<h2 id="unsubscribe">Unsubscribe</h2>

<p>If you sync once a week, you can subscribe <em>and unsubscribe</em> just in time. Look at the green rectangle in the screenshot above. That’s when I’m subscribed.</p>

<p>But if I sync once a week, once I see a successful report I can unsubscribe until before next job is due.</p>

<p>As mentioned at the very top I used pay-as-you-go subscription for this post, so I went to <a href="https://console.aws.amazon.com/marketplace/home#/subscriptions">AWS Marketplace to unsubscribe</a>. It took two clicks to find and and one click to Unsubscribe.</p>

<p>If you check your Cloud Sync dashboard after that, you’ll see a red rectangle telling you your relationship cannot be used (but that’s OK, we can subscribe next week before 2pm UTC time.)</p>

<p><img src="/assets/images/netapp-cloud-cloudsync-api-08.png" alt="Get your NetApp Cloud client_id" /></p>

<p>This screenshot also shows that your relationship definition remains in place. You can also leave your Data Broker running, but you can also shut it down until 10-15 minutes before next run if sync jobs aren’t frequent.</p>

<p>There are ways to automate AWS and Azure subscriptions, but you also need to be able to access that API so please check their own documentation for more on that.</p>

<h2 id="conclusion">Conclusion</h2>

<p>The Cloud Sync API lets you do everything you can do in the Web console (dashboard) and more, but it can be time-consuming to figure out what parameters and required and where to get them.</p>

<p>First-time users may find it easier to use The Pelosi Method (<em>“We [need] to create a configuration in order to find out what [goes] in it</em>”). So set things up using the Web UI and then use <code class="language-plaintext highlighter-rouge">GET</code> or <code class="language-plaintext highlighter-rouge">LIST</code> to find out how you can do that with the API.</p>

<p>Reports offer an easy way to compare object/file count and size, although there’s no way to get a full list of all files replicated in a run (I assume that’s because it could amount to gigabytes of data; not in this case, but there are Cloud Sync who sync millions of files).</p>

<p>For users who sync infrequently one interesting addition to Cloud Sync automation scripts would be a Cloud Sync (un)subscription function that we could run against AWS or Azure API before and after Cloud Sync jobs run.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#automation">automation</a>
      &nbsp; 
    
      <a href="
      /categories/#cloud">cloud</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2021/04/29/storagegrid-cloudmirror-async-replication-to-remote-s3-bucket.html">Using StorageGRID CloudMirror to replicate objects to remote S3-compatible bucket</a></li>
      
        <li><a href="/2022/01/17/using-netapp-cloudsync-api.html">Getting started with NetApp Cloud Sync API</a></li>
      
        <li><a href="/2023/08/30/monitoring-solidfire-clone-and-backup-jobs.html">Use SolidFire API to monitor clone and backup jobs for profit and pleasure</a></li>
      
        <li><a href="/2024/07/02/solidfire-volume-attributes-from-trident-and-other-apps.html">Extract SolidFire volume attributes created by Trident or other apps</a></li>
      
        <li><a href="/2024/06/28/growing-solidfire-volumes-paired-for-replication.html">Increase size of SolidFire volumes paired for replication</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2025-06-05 03:16 </p>
    <p>Copyright © 2025 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
