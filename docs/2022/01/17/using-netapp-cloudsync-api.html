<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Getting started with NetApp Cloud Sync API | Acting Technologist
      
    </title>
    <meta name="description" content="
     You can do it!
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Getting started with NetApp Cloud Sync API | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Getting started with NetApp Cloud Sync API" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="You can do it!" />
<meta property="og:description" content="You can do it!" />
<link rel="canonical" href="https://scaleoutsean.github.io/2022/01/17/using-netapp-cloudsync-api.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2022/01/17/using-netapp-cloudsync-api.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-17T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Getting started with NetApp Cloud Sync API","dateModified":"2022-01-17T00:00:00+08:00","datePublished":"2022-01-17T00:00:00+08:00","author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2022/01/17/using-netapp-cloudsync-api.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2022/01/17/using-netapp-cloudsync-api.html"},"description":"You can do it!","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Getting started with NetApp Cloud Sync API</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>17 Jan 2022</span> - <i class="far fa-clock"></i> 


  
  
    5 minute read
  

    </span>
  </div>
  
        <p><strong>NOTICE:</strong> all credentials and tokens on this page are samples, not leaked.</p>

<!-- TOC -->

<ul>
  <li><a href="#getting-started">Getting started</a></li>
  <li><a href="#short-answer">Short answer</a></li>
  <li><a href="#long-answer">Long answer</a>
    <ul>
      <li><a href="#jwt-access-token-access_token-for-netapp-cloud-central">JWT access token (access_token) for NetApp Cloud Central</a></li>
      <li><a href="#cloud-sync-account-id-from-netapp-cloud-central">Cloud Sync Account ID from NetApp Cloud Central</a></li>
    </ul>
  </li>
  <li><a href="#random-swagger-postman-and-rest-rant">Random Swagger, Postman and REST rant</a></li>
  <li><a href="#next-steps">Next steps</a></li>
</ul>

<!-- /TOC -->

<p>This post is the first in a two-post series. The second post can be found <a href="/2022/01/18/using-netapp-cloudsync-api.html">here</a> and shows next steps (deploy Data Broker, configure a relationship, get reports, etc.).</p>

<h2 id="getting-started">Getting started</h2>

<p>Struggling to get started with the NetApp Cloud Sync API? Read on.</p>

<h2 id="short-answer">Short answer</h2>

<p>RTFM, it’s all <a href="https://docs.netapp.com/us-en/occm/api_sync.html#getting-started">here</a> and <a href="https://cloudsync.netapp.com/docs/#">here</a>.</p>

<h2 id="long-answer">Long answer</h2>

<p>Let’s just say those pages aren’t leading examples of great developer documentation out there.</p>

<p>You need complete these steps:</p>

<ul>
  <li>Get JWT Access Token (aka Bearer Token)</li>
  <li>Get the exact accountId you intend to use for Cloud Sync</li>
</ul>

<h3 id="jwt-access-token-access_token-for-netapp-cloud-central">JWT access token (access_token) for NetApp Cloud Central</h3>

<p>You get that using the creds you use at https://netapp-cloud-account.auth0.com/.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"grant_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"someguy@somewhere.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3kreT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"profile"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"audience"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.cloud.netapp.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"client_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABCO123...RANDOMSTUFF"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Where does one get <code class="language-plaintext highlighter-rouge">client_id</code>? This took me only 20 minutes to find out.</p>

<p><img src="/assets/images/netapp-cloud-cloudsync-api-01.png" alt="Get your NetApp Cloud client_id" /></p>

<p>No, I <em>don’t want</em> to “learn how to authenticate” (step (2))! I just want the stuff I need to start using the API!</p>

<p>But if you don’t want to learn you may need to spend the next 20 minutes using search engines. Even worse, there’s a video demo (which I also watched) that completely skips this step. It’s so easy, you just need to be willing to <em>learn</em> (wink, wink). (That’s a long way to say that <code class="language-plaintext highlighter-rouge">client_id</code> can be obtained in step (3) above, and refreshed in step (4).)</p>

<p>Once your BODY values are correct, send that BODY in a POST request to https://netapp-cloud-account.auth0.com/oauth/token (Header: <code class="language-plaintext highlighter-rouge">Content-Type: application/json</code>). The API will return your <code class="language-plaintext highlighter-rouge">access_token</code>.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJhb.........LONG....iS0raQ"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"profile cc:update-password"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span><span class="w">
    </span><span class="nl">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>From now on this thing needs to be add to API request headers as <code class="language-plaintext highlighter-rouge">Authorization: Bearer $TOKEN</code>. Refresh it after (or before) it expires.</p>

<h3 id="cloud-sync-account-id-from-netapp-cloud-central">Cloud Sync Account ID from NetApp Cloud Central</h3>

<p>The second thing we need is Account ID. Populate the header with that Bearer Token and <code class="language-plaintext highlighter-rouge">GET /accounts</code>.</p>

<p>For some reason Cloud Sync Swagger is has an incomplete URI (one can’t help but wonder are there many Cloud Sync API endpoints where these requests can be sent?), so if you use that JSON in Postman you must change <code class="language-plaintext highlighter-rouge">baseUrl</code> to https://api.cloudsync.netapp.com/api.</p>

<p>Use that Bearer Token in Authorization tab, and in Headers add <code class="language-plaintext highlighter-rouge">Content-Type</code> and set it to <code class="language-plaintext highlighter-rouge">application/json</code>.</p>

<p><img src="/assets/images/netapp-cloud-cloudsync-api-02.png" alt="Get your Cloud accountIds" /></p>

<p>You could as well use https://api.cloudsync.netapp.com/api/accounts?Content-Type=application/json to take are of the second setting.</p>

<p>This will return your accountId.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"accountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account-duCK8"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CS-duCK8"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"accountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account-chiKun1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Another"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>I haven’t tried to use these yet because I currently don’t have a Data Broker deployed and I’m too tired in my head to continue. I assume you need to pick one of accounts tied to workspace which can access your data (Cloud Sync source and destination).</p>

<p>In my case  “Another” is my “main” NetApp Cloud account. I have one Working Environment called CS-(something), so I suppose “CS-duCK8” is the accountId I would use to manage my Data Broker in that particular workspace. Otherwise I’d use the “main” account.</p>

<h2 id="random-swagger-postman-and-rest-rant">Random Swagger, Postman and REST rant</h2>

<p>You can add Cloud Sync API definition to Postman using the Import feature. Copy the JSON body from <a href="https://api.cloudsync.netapp.com/api-docs">Swagger</a> &gt; Raw Data.</p>

<p>As you import this JSON it may be helpful to try non-default import options. Otherwise Postman will helpfully insert a bunch of garbage as “example” API values and you’ll have to change this in <em>every single example</em>.</p>

<p><img src="/assets/images/netapp-cloud-cloudsync-api-03.png" alt="Override defaults" /></p>

<p>I don’t get this. How on earth is something like “<code class="language-plaintext highlighter-rouge">version: magna laborum Lorem</code>” supposed to help me???</p>

<p>It’d be more helpful if it was left empty (or if examples were provided in the Swagger JSON file). Like this it’s <em>worse</em> than useless!</p>

<p>And because that junk is hidden in Headers, every time you try an API method you have to read error messages like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Account with id magna laborum Lorem is not found on tenancy for current user"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>I know I should always check the headers, but let’s assume I used non-default import option and didn’t have that junk added by Postman:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Multiple tenancy accounts. Could not select specific tenancy account"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Much better! There’s less to read and it’s just as easy to tell where the problem is. But by now I’m fed up with this whole thing and won’t try to figure out which import option in Postman would lead to a better outcome.</p>

<p>One REST API annoyance unrelated to Cloud Sync or Postman I discovered while dealing with this Postman nonsense is that with multiple KV pairs in Headers you must always edit multiple fields by moving your mouse or hitting the TAB key after each KV pair, or else use Bulk Edit (Postman feature) which (a) takes two extra clicks and (b) is awkward. And if you want to add (or remove) KV pairs from Headers, it’s even more clicks.</p>

<p>I much prefer JSON-RPC (example: SolidFire API): get the Postman file (in it, all parameters in sample JSON files are present), find your method, go to Request Body, edit JSON variable(s), hit Send.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GetAccountEfficiency"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"accountID"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">},</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="next-steps">Next steps</h2>

<p>Now we can stand up a Data Broker VM and try to <a href="/2022/01/18/using-netapp-cloudsync-api.html">sync some data</a>.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#automation">automation</a>
      &nbsp; 
    
      <a href="
      /categories/#cloud">cloud</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2022/01/18/using-netapp-cloudsync-api.html">Using NetApp Cloud Sync API</a></li>
      
        <li><a href="/2021/04/29/storagegrid-cloudmirror-async-replication-to-remote-s3-bucket.html">Using StorageGRID CloudMirror to replicate objects to remote S3-compatible bucket</a></li>
      
        <li><a href="/2023/07/31/solidfire-web-management-api-behind-proxy.html">SolidFire management Web site and API endpoint behind a proxy</a></li>
      
        <li><a href="/2023/11/28/postgres-pgvector-instacluster-eseries.html">Postgres, pgvector, E-Series and Instaclustr</a></li>
      
        <li><a href="/2024/07/02/solidfire-volume-attributes-from-trident-and-other-apps.html">Extract SolidFire volume attributes created by Trident or other apps</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-10-16 17:19 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
