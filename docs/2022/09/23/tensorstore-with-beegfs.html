<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.3 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>TensorStore with BeeGFS | Acting Technologist</title>
<meta name="description" content="Use BeeGFS in file:// KvStore URL scheme for TensorStore">


  <meta name="author" content="scaleoutSean">
  
  <meta property="article:author" content="scaleoutSean">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Acting Technologist">
<meta property="og:title" content="TensorStore with BeeGFS">
<meta property="og:url" content="https://scaleoutsean.github.io/2022/09/23/tensorstore-with-beegfs.html">


  <meta property="og:description" content="Use BeeGFS in file:// KvStore URL scheme for TensorStore">





  <meta name="twitter:site" content="@scaleoutSean">
  <meta name="twitter:title" content="TensorStore with BeeGFS">
  <meta name="twitter:description" content="Use BeeGFS in file:// KvStore URL scheme for TensorStore">
  <meta name="twitter:url" content="https://scaleoutsean.github.io/2022/09/23/tensorstore-with-beegfs.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2022-09-23T00:00:00+08:00">






<link rel="canonical" href="https://scaleoutsean.github.io/2022/09/23/tensorstore-with-beegfs.html">







  <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />


  <meta name="msvalidate.01" content="7cf5b7d96a77410a8ad035f764dc81b3">





<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Acting Technologist Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic" rel="stylesheet" type="text/css">


  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/scaleoutsean-acting-technologist.png" alt="Acting Technologist"></a>
        
        <a class="site-title" href="/">
          Acting Technologist
          <span class="site-subtitle">human action through technology</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/archive/"
                
                
              >Archive</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/projects.html"
                
                
              >Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="TensorStore with BeeGFS">
    <meta itemprop="description" content="Use BeeGFS in file:// KvStore URL scheme for TensorStore">
    <meta itemprop="datePublished" content="2022-09-23T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://scaleoutsean.github.io/2022/09/23/tensorstore-with-beegfs.html" itemprop="url">TensorStore with BeeGFS
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-09-23T00:00:00+08:00">2022-09-23 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>TensorStore is a new C++ and Python library that provides a uniform API for reading and writing <em>n</em>-dimensional data.</p>

<p>Among its Kv store drivers of interest to BeeGFS users is the file driver which uses the filesystem as a key-value store. The key is filesystem path (directory) and the value(s) files themselves.</p>

<p>Using a BeeGFS 7.3 client, create a destination directory to store data (this example needs just around ~20 MB).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> /mnt/beegfs/tf/zarr
</code></pre></div></div>

<p>Install the stuff that needs to be imported, and use one of the official examples to try it out:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">import</span> <span class="n">tensorstore</span> <span class="k">as</span> <span class="n">ts</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="nf">open</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">driver</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">zarr</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">kvstore</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">file:///mnt/beegfs/tf/zarr</span><span class="sh">'</span><span class="p">},</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">ts</span><span class="p">.</span><span class="n">uint32</span><span class="p">,</span>
    <span class="n">chunk_layout</span><span class="o">=</span><span class="n">ts</span><span class="p">.</span><span class="nc">ChunkLayout</span><span class="p">(</span><span class="n">chunk_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
    <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">7000</span><span class="p">]).</span><span class="nf">result</span><span class="p">()</span>

<span class="c1"># two numpy arrays with example data
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="mi">200</span><span class="o">*</span><span class="mi">300</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">uint32</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">200</span><span class="o">*</span><span class="mi">300</span><span class="o">*</span><span class="mi">400</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">uint32</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>

<span class="c1"># asynchronous write
</span><span class="n">future_a</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">1000</span><span class="p">:</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">2000</span><span class="p">:</span><span class="mi">2200</span><span class="p">,</span> <span class="mi">3000</span><span class="p">:</span><span class="mi">3300</span><span class="p">].</span><span class="nf">write</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">future_b</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">3000</span><span class="p">:</span><span class="mi">3200</span><span class="p">,</span> <span class="mi">4000</span><span class="p">:</span><span class="mi">4300</span><span class="p">,</span> <span class="mi">5000</span><span class="p">:</span><span class="mi">5400</span><span class="p">].</span><span class="nf">write</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="c1"># wait for completion
</span><span class="n">future_a</span><span class="p">.</span><span class="nf">result</span><span class="p">()</span>
<span class="n">future_b</span><span class="p">.</span><span class="nf">result</span><span class="p">()</span>
</code></pre></div></div>

<p>As TensorStore starts writing we notice network activity on the BeeGFS client, as it's contacting BeeGFS Metadata server to create files, and sends data content to BeeGFS Data servers to store file data.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">----system----</span> <span class="nt">--total-cpu-usage--</span> <span class="nt">-net</span>/total-
     <span class="nb">time</span>     |usr sys idl wai stl| recv  send
23-09 05:13:14|  1   0  99   0   0| 186B  254B
23-09 05:13:15|  1   0  98   0   0|1453B 1926B
23-09 05:13:16| 21  22  57   0   0| 500k 1157k
23-09 05:13:17| 16  18  66   0   0|1301k 3733k
23-09 05:13:18| 20  18  62   0   0|1340k 4699k
23-09 05:13:19| 16  21  63   0   0|1373k 5411k
23-09 05:13:20| 10  10  81   0   0|1641k 7735k
23-09 05:13:21|  6   7  86   1   0| 765k 4186k
23-09 05:13:22|  0   1  99   0   0| 126B  254B
23-09 05:13:23|  1   1  98   0   0| 130B  254B
23-09 05:13:24|  3   2  95   0   0| 946B 1117B
</code></pre></div></div>

<p>The result is 2,800 files:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ll /mnt/beegfs/tf/zarr
total 18806
drwxrwxr-x 2 sean sean  2801 Sep 23 05:03 ./
drwxrwxr-x 3 sean sean     1 Sep 23 05:01 ../
<span class="nt">-rw-rw-r--</span> 1 sean sean   228 Sep 23 05:02 .zarray
<span class="nt">-rw-rw-r--</span> 1 sean sean  5873 Sep 23 05:02 11.15.5000
<span class="nt">-rw-rw-r--</span> 1 sean sean  6536 Sep 23 05:02 11.15.5001
<span class="nt">-rw-rw-r--</span> 1 sean sean  6536 Sep 23 05:02 11.15.5002
<span class="nt">-rw-rw-r--</span> 1 sean sean  6536 Sep 23 05:02 11.15.5003
<span class="nt">-rw-rw-r--</span> 1 sean sean  6536 Sep 23 05:02 11.15.5004
<span class="nt">-rw-rw-r--</span> 1 sean sean  6536 Sep 23 05:02 11.15.5005
...
</code></pre></div></div>

<p>If you're interested in performance with files small-ish like these, take a look at this <a href="https://docs.netapp.com/us-en/beegfs/beegfs-design-solution-verification.html#metadata-performance-test">Metadata performance test</a>.</p>

<p>Note that there's also a KV memory driver. For large data sets of tiny files we could keep results in RAM and later write it out to BeeGFS or S3 if we need it.</p>

<p>On my mini BeeGFS cluster the script took 6 seconds (this includes loading the modules, spitting out warnings about the lack of CUDA, computing and writing to BeeGFS) whereas on the same system using RAM driver it took around 2 seconds.</p>

<p>Data that needs repeated access (re-read pattern) by clients would benefit from system cache or BeeGFS cache, so we shouldn't take this write test to mean "memory KV store should be 300% faster". In some cases it may be very similar.</p>

<p>I don't know enough about Tensorflow to be able to say how viable it is to change driver options to create larger files.</p>

<p>TenstorStore uses locking provided by the BeeGFS filesystem, so it should work fine with native application-aware access from many containers with BeeGFS CSI or general BeeGFS clients.</p>

<blockquote>
  <p>Locking provided by the filesystem is used to safely allow concurrent access from multiple processes. (The locking protocol used does not block readers.) Provided that shared locking is supported, concurrent access from multiple machines to a network filesystem is also safe.</p>
</blockquote>

<p>TensorStore's File KV store driver is documented <a href="https://google.github.io/tensorstore/kvstore/file/index.html">here</a>.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/beegfs" class="page__taxonomy-item p-category" rel="tag">beegfs</a><span class="sep">, </span>
    
      <a href="/tags/e-series" class="page__taxonomy-item p-category" rel="tag">e-series</a><span class="sep">, </span>
    
      <a href="/tags/eseries" class="page__taxonomy-item p-category" rel="tag">eseries</a><span class="sep">, </span>
    
      <a href="/tags/netapp" class="page__taxonomy-item p-category" rel="tag">netapp</a><span class="sep">, </span>
    
      <a href="/tags/tensorstore" class="page__taxonomy-item p-category" rel="tag">tensorstore</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/analytics" class="page__taxonomy-item p-category" rel="tag">analytics</a><span class="sep">, </span>
    
      <a href="/categories/storage" class="page__taxonomy-item p-category" rel="tag">storage</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2022-09-23T00:00:00+08:00">2022-09-23 00:00</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?via=scaleoutSean&text=TensorStore+with+BeeGFS%20https%3A%2F%2Fscaleoutsean.github.io%2F2022%2F09%2F23%2Ftensorstore-with-beegfs.html" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://scaleoutsean.github.io/2022/09/23/tensorstore-with-beegfs.html" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

</section>


      
  <nav class="pagination">
    
      <a href="/2022/09/23/eoa-solidfire.html" class="pagination--pager" title="End of Availability for SolidFire">Previous</a>
    
    
      <a href="/2022/09/24/low-hanging-storage-efficiency-fruit-beegfs.html" class="pagination--pager" title="Low-hanging BeeGFS efficiency fruit">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2026/01/19/netapp-eseries-santricity-csi.html" rel="permalink">NetApp E-Series SANtricity CSI
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2026-01-19T00:00:00+08:00">2026-01-19 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          11 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Community CSI driver for NetApp E-Series arrays: what it is and what it does
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2026/01/16/santricity-eseries-datalake-storage.html" rel="permalink">Big Data &amp; analytics patterns for NetApp object &amp; block
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2026-01-16T00:00:00+08:00">2026-01-16 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2026/01/16/eseries-santricity-terraform-provider.html" rel="permalink">NetApp E-Series SANtricity Terraform Provider
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2026-01-16T00:00:00+08:00">2026-01-16 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          15 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Provision storage in seconds with Terraform and E-Series
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2026/01/15/santricity-go-language-library-cli.html" rel="permalink">E-Series SANtricity Go client for Day 1+ operations
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2026-01-15T00:00:00+08:00">2026-01-15 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Permissive OSS client Go library and CLI for E-Series SANtricity storage systems
</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2020-2026 scaleoutSean.github.io | <a href="https://scaleoutsean.github.io">Acting Technologist</a> | Terms: <a href="https://creativecommons.org/licenses/by/4.0/deed.en" target="_blank">CC BY 4.0</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
