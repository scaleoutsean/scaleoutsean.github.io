<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.3 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Low-hanging BeeGFS efficiency fruit | Acting Technologist</title>
<meta name="description" content="Identifying low-hanging fruit in BeeGFS storage efficiency">


  <meta name="author" content="scaleoutSean">
  
  <meta property="article:author" content="scaleoutSean">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Acting Technologist">
<meta property="og:title" content="Low-hanging BeeGFS efficiency fruit">
<meta property="og:url" content="https://scaleoutsean.github.io/2022/09/24/low-hanging-storage-efficiency-fruit-beegfs.html">


  <meta property="og:description" content="Identifying low-hanging fruit in BeeGFS storage efficiency">





  <meta name="twitter:site" content="@scaleoutSean">
  <meta name="twitter:title" content="Low-hanging BeeGFS efficiency fruit">
  <meta name="twitter:description" content="Identifying low-hanging fruit in BeeGFS storage efficiency">
  <meta name="twitter:url" content="https://scaleoutsean.github.io/2022/09/24/low-hanging-storage-efficiency-fruit-beegfs.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2022-09-24T00:00:00+08:00">






<link rel="canonical" href="https://scaleoutsean.github.io/2022/09/24/low-hanging-storage-efficiency-fruit-beegfs.html">







  <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />


  <meta name="msvalidate.01" content="7cf5b7d96a77410a8ad035f764dc81b3">





<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Acting Technologist Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic" rel="stylesheet" type="text/css">


  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/scaleoutsean-acting-technologist.png" alt="Acting Technologist"></a>
        
        <a class="site-title" href="/">
          Acting Technologist
          <span class="site-subtitle">human action through technology</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/archive/"
                
                
              >Archive</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/projects/"
                
                
              >Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://scaleoutsean.github.io/" itemprop="url">scaleoutSean</a>
    </h3>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Low-hanging BeeGFS efficiency fruit">
    <meta itemprop="description" content="Following my previous post on TensorStore with BeeGFS I thought I should revisit another item from my lengthy to-do list: filesystem compression.">
    <meta itemprop="datePublished" content="2022-09-24T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://scaleoutsean.github.io/2022/09/24/low-hanging-storage-efficiency-fruit-beegfs.html" itemprop="url">Low-hanging BeeGFS efficiency fruit
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-09-24T00:00:00+08:00">2022-09-24 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Following my previous post on TensorStore with BeeGFS I thought I should revisit another item from my lengthy to-do list: filesystem compression.</p>

<h2 id="e-series-and-storage-efficiency">E-Series and storage efficiency</h2>

<p>Even many NetApp customers aren't familiar with E-Series so I'll just say this quickly:</p>

<ul>
  <li>E-Series aims to have a lean data path and deliver ease of use, performance, reliability</li>
  <li>Hence, no compression or deduplication</li>
</ul>

<p>This works great in many use cases. Let's see:</p>

<ul>
  <li>Data that was compressed on creation (say, video recordings uploaded by artists)</li>
  <li>Data that is compressed by application or host connecting to E-Series (say, Kafka or Elasticsearch)</li>
  <li>Data is compressed by host filesystem (say, btrfs)</li>
</ul>

<p>The first two cases don't matter here (data doesn't need to be additionally compressed) and BeeGFS doesn't do compression on its own, but an old trick related to the third bullet is we can create and mount single-host filesystems on top of BeeGFS and mount the btrfs images as loop devices.</p>

<h2 id="compressed-loopback-volumes">Compressed loopback volumes</h2>

<p>Create two files, vo1 and vol2, on BeeGFS. Format them with a Linux filesystem of your choosing.</p>

<p>I picked btrfs. I mounted vol1 as compressed (zstd, level 2), while vol2 was not.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ll /mnt/beegfs/btrfs
total 907581
drwxrwxr-x  2 sean sean         2 Sep 23 16:12 ./
drwxrwxrwx 18 sean sean           18 Sep 23 17:00 ../
<span class="nt">-rw-rw-r--</span>  1 sean sean 524288000 Sep 23 16:11 vol1.img
<span class="nt">-rw-rw-r--</span>  1 sean sean 524288000 Sep 23 16:31 vol2.img
</code></pre></div></div>

<p>Then I created the same files that I generated in the TensorStore post - basically compressible content - on each btrfs file(system) mounted as loop device.</p>

<p>This didn't work too well - loopback slowed down performance  even in the scenario with compression disabled. How about the savings?</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>compsize vol1 vol2
Processed 5602 files, 3770 regular extents <span class="o">(</span>5000 refs<span class="o">)</span>, 602 inline.
Type       Perc     Disk Usage   Uncompressed Referenced  
TOTAL       71%       26M          37M          44M       
none       100%       15M          15M          22M       
zstd        51%       11M          22M          22M       

<span class="nv">$ </span><span class="nb">du</span> <span class="nt">-sh</span> vol1
23M   vol1

<span class="nv">$ </span><span class="nb">du</span> <span class="nt">-sh</span> vol2
23M   vol2
</code></pre></div></div>

<p>Compression did provide 50% savings on the compressed volume (vol1), so if we can save a lot of capacity by compressing and don't need it to be fast, this may be useful.</p>

<p>In summary, with this approach we lose multi-client access (as btrfs should be concurrently mounted on only one BeeGFS client) and the overhead of writing many small files to a loopback filesystem seems more significant than writing them directly to BeeGFS.</p>

<p>Additionally, the "over-provisioning" of btrfs images results in wasted space on BeeGFS, so even though internally data may be compressed, externally (on BeeGFS) the image file occupies whatever size was used to create it. At the same time, the constant right-sizing would be very cumbersome.</p>

<p>A better way for BeeGFS to use btrfs would be to allow btrfs-formatted devices to be used for the underlying Data disks. That would let us create compressed pools (in BeeGFS filesystems where Data resides on both XFS and btrfs), but BeeGFS would have to be patched to allow the use of btrfs for Data volumes.</p>

<h2 id="s3-compression-with-minio">S3 compression with MinIO</h2>

<p>I wrote about MinIO on BeeGFS before. At the time I didn't have time or reason to try the new compression feature.</p>

<p>Deploy MinIO and enable compression. It's based on file extensions (and the common ones are already pre-defined for you) but TensorStore files have random numeric extensions like .5831 so that was out of question (which is interesting in itself).</p>

<p>I haven't tried to find out if MinIO "probes" objects with unregistered extensions to check if they're compressible - I simply uploaded some other junk I had at hand, about 60 MB of it.</p>

<p><img src="/assets/images/beegfs-compression-loopback-s3-01.png" alt="Bucket with compressible objects" /></p>

<p>On BeeGFS, the bucket directory:</p>

<p><img src="/assets/images/beegfs-compression-loopback-s3-02.png" alt="Filesystem data was compressed and 70% smaller" /></p>

<p>70% saving is in line with expectations and what one would expect from such data (and by the way, MinIO currently uses a modified Snappy algorithm - check their documentation to find out more).</p>

<p>Because buckets data is compressed by MinIO, one must access it over the S3 API and not from the filesystem because they'd see something like this:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">head </span>compressed/sgac.json 
�S2sTwO�e�Xϻ��@�<span class="o">{</span><span class="s2">"Timestamp"</span>: <span class="s2">"2020-10-30T07:48:57.285547"</span>, <span class="s2">"RSLT&amp;
VRGN&lt;AVER"</span>: 10, <span class="s2">"ATIM 604044137	7�YP6 L116692895320033498}
...
</span></code></pre></div></div>

<p>We see that MinIO compression removes the main advantage of BeeGFS with MinIO - unified access to S3/BeeGFS data.</p>

<p>We should therefore consider if it is necessary to run MinIO on BeeGFS at all.  E-Series users could run MinIO off regular E-Series volumes (ext4, XFS). MinIO itself could run on a BeeGFS client which could serve as a "data mover" node. This sounds fine as well, although HA failover becomes harder (if it's not addressed by VM failover using hypervisor HA features, for example) and results in two separate storage namespaces to manage.</p>

<p>In summary, MinIO S3 compression is good, although it doesn't seem effective at all for my initial use case (TensorStore). But such situations are rare and it should work well for most other use cases where objects have predictable extensions - either running on BeeGFS or a dedicated XFS/ext4 volume(s).</p>

<h2 id="conclusion">Conclusion</h2>

<p>The loop device idea kind of failed (although it nominally works with TensorStore zarr content), but MinIO S3 with compression is viable - it's convenient, fast and doesn't interfere with data sharing (when data sharing with other users is necessary).</p>

<p>As I wrote in <a href="/2022/08/09/nomad-beegfs-minio-s3.html">this post on MinIO on BeeGFS</a> it's not convenient to access data by unnecessarily going through an S3 API endpoint when we can already see data on BeeGFS client, but when data is compressed by the application (MinIO) there's no other way.</p>

<p>And as I said in that post, individual users (such as researchers) could run a personal instance of MinIO (say, in shell, Docker or <a href="/2022/08/30/apptainer-beegfs-software-bom-sbom.html#build-data-app-container-and-check-its-inventory">Apptainer</a> and access it over local network interface) which is less inconvenient than mounting a filesystem image, and doesn't require special privileges.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/beegfs" class="page__taxonomy-item p-category" rel="tag">beegfs</a><span class="sep">, </span>
    
      <a href="/tags/compression" class="page__taxonomy-item p-category" rel="tag">compression</a><span class="sep">, </span>
    
      <a href="/tags/e-series" class="page__taxonomy-item p-category" rel="tag">e-series</a><span class="sep">, </span>
    
      <a href="/tags/efficiency" class="page__taxonomy-item p-category" rel="tag">efficiency</a><span class="sep">, </span>
    
      <a href="/tags/eseries" class="page__taxonomy-item p-category" rel="tag">eseries</a><span class="sep">, </span>
    
      <a href="/tags/netapp" class="page__taxonomy-item p-category" rel="tag">netapp</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/storage" class="page__taxonomy-item p-category" rel="tag">storage</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2022-09-24T00:00:00+08:00">2022-09-24 00:00</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?via=scaleoutSean&text=Low-hanging+BeeGFS+efficiency+fruit%20https%3A%2F%2Fscaleoutsean.github.io%2F2022%2F09%2F24%2Flow-hanging-storage-efficiency-fruit-beegfs.html" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://scaleoutsean.github.io/2022/09/24/low-hanging-storage-efficiency-fruit-beegfs.html" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

</section>


      
  <nav class="pagination">
    
      <a href="/2022/09/23/tensorstore-with-beegfs.html" class="pagination--pager" title="TensorStore with BeeGFS">Previous</a>
    
    
      <a href="/2022/09/25/unofficial-netapp-trident-for-arm64.html" class="pagination--pager" title="NetApp Trident v22.07.0 for ARM64">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/11/epa-4-beta.html" rel="permalink">E-Series Performance Analyzer (EPA) v4 beta
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-11T00:00:00+08:00">2025-08-11 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Introduction
  EPA 4
  EPA Collector-specific
  Details related to storage requirements
  What's next

</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/11/bing-index-issue.html" rel="permalink">Got binged in July 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-11T00:00:00+08:00">2025-08-11 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I don't track users (see Privacy page), don't have ads and don't care about "likes" or "followers", but generally I want my content to be in search engine in...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/07/30/solidfire-windows-admin-center-extension.html" rel="permalink">SolidFire Extension for Windows Admin Center 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-07-30T00:00:00+08:00">2025-07-30 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          19 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Introduction
  Walk-through
  And now…
  Conclusion
  Appendix A: demo
    
      Animated GIF (no playback control)
      Video demo with voice-over
    ...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/07/26/solidfire-windows-admin-center-gateway.html" rel="permalink">SolidFire Gateway for Windows Admin Center 2025
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-07-26T00:00:00+08:00">2025-07-26 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Introduction
  What it is
  What it does
  IIS Setup
  Why this matters
  What about it?
  Conclusion

</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2020-2025 scaleoutSean.github.io | <a href="https://scaleoutsean.github.io">Acting Technologist</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
