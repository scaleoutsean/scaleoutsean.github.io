<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Hybrid cloud scenarios with Cloudflare serverless | Acting Technologist
      
    </title>
    <meta name="description" content="
     Opportunities for a better hybrid cloud architecture with Cloudflare
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Hybrid cloud scenarios with Cloudflare serverless | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Hybrid cloud scenarios with Cloudflare serverless" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Opportunities for a better hybrid cloud architecture with Cloudflare" />
<meta property="og:description" content="Opportunities for a better hybrid cloud architecture with Cloudflare" />
<link rel="canonical" href="https://scaleoutsean.github.io/2022/09/29/cloudflare-serverless.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2022/09/29/cloudflare-serverless.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-09-29T00:00:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2022/09/29/cloudflare-serverless.html"},"author":{"@type":"Person","name":"scaleoutSean"},"description":"Opportunities for a better hybrid cloud architecture with Cloudflare","@type":"BlogPosting","url":"https://scaleoutsean.github.io/2022/09/29/cloudflare-serverless.html","headline":"Hybrid cloud scenarios with Cloudflare serverless","dateModified":"2022-09-29T00:00:00+08:00","datePublished":"2022-09-29T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Hybrid cloud scenarios with Cloudflare serverless</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>29 Sep 2022</span> - <i class="far fa-clock"></i> 


  
  
    6 minute read
  

    </span>
  </div>
  
        <ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#cloudflare-scenarios-for-hybrid-cloud-users">Cloudflare scenarios for Hybrid Cloud users</a></li>
  <li><a href="#experiment">Experiment</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>Cloudflare is building a better infrastructure for Hybrid Cloud:</p>

<ul>
  <li>Simpler (less cognitive overload)</li>
  <li>Lower cost</li>
  <li>Better-performing</li>
  <li>Architecturally sound (in my opinion)</li>
</ul>

<p>I wanted to illustrate and comment on currently or soon-to-be available options from a perspective of on-premises storage options.</p>

<h2 id="cloudflare-scenarios-for-hybrid-cloud-users">Cloudflare scenarios for Hybrid Cloud users</h2>

<p>What we can do with it today as far as <strong>hybrid</strong> cloud deployments are concerned?</p>

<p>Before we begin, we should understand Cloudflare Workers. If we don’t have time to do that, let’s just say those are stateless, short-lived Node.JS-like containers.</p>

<p>We can run Workers and use Cloudflare Zero Trust services (there’s Tunnel, etc.) to connect to on-premises infrastructure. There’s also Algo Smart Routing to optimize routing and latency.</p>

<p><img src="/assets/images/cloudflare-stateless-with-all-storage-on-prem.png" alt="Cloudflare Workers with on-prem data and applications" /></p>

<p>Note on SMB and NFS: these services would not be used from containers, but by external application users who need access to NFS or SMB when - for example - applications simply cannot be containerized. An example can be seen <a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/use_cases/smb/#connect-to-smb-server-with-warp-to-tunnel">here</a>. For example, something like this:</p>

<p><img src="/assets/images/cloudflare-stateless-with-all-storage-on-prem-mobile.png" alt="Cloudflare Workers with on-prem data and applications used by mobile users" /></p>

<p>Would this approach be too slow? I don’t think it would be too slow for small workloads. You wouldn’t be able to use Workers to run SAP HANA this way, but many applications (maybe 50%) consume just a few hundred IOPS.</p>

<p>I haven’t done any benchmarking of these use cases, but I have no doubt this is feasible for smaller applications. Last year I tested bandwidth and latency from my home lab to a nearby hyperscaler and it was 30 MB/s and just a few milliseconds, respectively. For database workloads that is as fast as small RAID array with 10K RPM SAS disks.</p>

<p>And, since Workers has recently been open-sourced, I think users will be able to run their Workers apps on-premises as well.</p>

<p>I think this approach is much simpler than with hyperscalers - Cloudflare takes care of all the network “magic” for you, and some additional services not mentioned here are competitively priced or even free.</p>

<p>Cloudflare object storage called R2 has GA’d recently. That opens up additional possibilities. Enterprises can keep their object data on-premises and replicate it to Cloudflare R2. Or just move all their object storage to R2.</p>

<p><img src="/assets/images/cloudflare-stateless-cloud-object-on-prem-file-r-w-db.png" alt="Cloudflare Workers with some data in Cloudflare object storage and database replicas" /></p>

<p>If object storage is updated and replicated to R2, this again makes it possible to run applications on-premises and in the cloud - just write and delete objects in the read-write location (whether that’s R2 or on-prem S3) and replicate to the read-only location.</p>

<p>I made a small variation on the on-prem DB type - if you prefer to use HTTPS to connect from workers, that’s also possible with RESTful plugins or native RESTful databases.</p>

<p>Workers with read-heavy workloads can take advantage of SQLite read-only replicas. Like with distributed objects, we can write to on-premises DB and replicate it to Cloudflare by pushing updates to D1, Cloudflare’s SQLite service. That could work in reverse, too - one could collect IoT data in D1 and use Workers to replicate data to SQLite or other databases on-premises.</p>

<p><img src="/assets/images/cloudflare-stateless-state-in-r2-and-ro-db.png" alt="Cloudflare Workers with some data in Cloudflare object storage" /></p>

<p>D1 is not GA yet, but it will lets users run distributed SQLite completely within Cloudflare, accessible to Workers in read-write fashion.</p>

<p>Like with R2 and Workers today, it will be possible to have applications and data only on Cloudflare, but this post has focused on hybrid use cases where for whatever reasons, some data and workloads live on-premises (or in any hyperscaler or other public cloud provider, for that matter). Storing data-at-rest on premises may be cheaper or not, but it has a different data sovereignty profile and egress is almost always cheaper compared to public cloud.</p>

<h2 id="experiment">Experiment</h2>

<p>I haven’t used Cloudflare Workers to build a hybrid cloud application which uses on-prem data.</p>

<p>At this time I have a light-weight worker application (an E-Series sizer) up and running in Workers but its data is self-contained and it could also run client-side (using client-side JavaScript rather than Worker-side), so it doesn’t showcase many unique features of CloudFlare serverless - for now all you get is a container that quickly starts on-demand and renders JS server-side.</p>

<p>With the ability to offload I/O to R2 and soon D1, I think this stack is very powerful and yet simple to understand and manage. I could make it hybrid by moving its small database to an on-prem S3 or PostgreSQL, but I haven’t done that because of maintenance burden.</p>

<p>Here’s how it could work:</p>

<ul>
  <li>JavaScript-powered application uploaded to on-premises S3 storage or running in Workers with server-side rendering (like my E-Series sizer)
    <ul>
      <li>For S3-based static apps with JS, use Cloudflare DNS and Web Proxy map external TLD to proxy on-premises S3 app - application is cached by Cloudflare and runs client-side in the browser</li>
      <li>For Workers-based apps, application runs in Cloudflare Workers and uses on-prem data (S3 or SQL)</li>
    </ul>
  </li>
  <li>Between Cloudflare Web Proxy and on-premises data set up Reverse Proxy for logging, authentication, security (this can be a Cloudflare service, or DIY on-prem)</li>
</ul>

<p><img src="/assets/images/cloudflare-proxy.png" alt="Cloudflare DNS with Web Proxy" /></p>

<ul>
  <li>On-premises PostgreSQL Docker container with RESTful API exposed to the Web via Cloudflare Zero Trust (Tunnel). Alternatively consider Cloudflare Argo to avoid exposing database to the Internet and/or your external clients.</li>
</ul>

<p><img src="/assets/images/cloudflare-restful-database.png" alt="Cloudflare DNS with Web Proxy" /></p>

<p>We could connect from the Web app directly to an on-prem database by opening on-prem firewall to authenticated and authorized users, but then we’d have to take care of network security by ourselves.</p>

<p>This approach above only exposes our S3 bucket (which is read-only) to Cloudflare Web Proxy, and the application can contain authentication and authorization code. PostgreSQL database is not directly exposed to the Internet (it’s RESTful HTTPS, proxied by Cloudflare, but can use Argo instead) and it allows access to only authenticated Web application users.</p>

<h2 id="conclusion">Conclusion</h2>

<p>I’m not a big fan of how applications are deployed to hyperscalers: it’s either lift &amp; shift, which usually doesn’t result in improvements, or highly proprietary. Even with Kubernetes, many staff “specialize” in individual hyperscaler’s flavor of managed Kubernetes service and can’t easily combine it with, or migrate to, another Kubernetes service elsewhere. And then there are all sorts of complex fees - FinOps, proprietary and non-portable network and identity management, etc.</p>

<p>Cloudflare focuses on Web-related services (no Big Data solutions for now) that are simple to understand, open, affordable and most importantly, done right. If I had all my applications in one hyperscaler, I’d look for opportunities to move some services to Cloudflare rather than another hyperscaler (although that is sometimes unavoidable due to the need to use hyperscaler-specific applications).</p>

<p>I look forward to increased awareness and adoption of Cloudflare services among hybrid and public cloud users.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#cloud">cloud</a>
      &nbsp; 
    
      <a href="
      /categories/#storage">storage</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2022/11/11/netapp-spot-instaclustr-eseries.html">On-prem Spot Instaclustr-managed clusters with NetApp E-Series storage</a></li>
      
        <li><a href="/2023/01/12/beegfs-eseries-hybrid-cloud-spot-ocean-spark.html">Burst on-prem GPU workloads from BeeGFS/E-Series clusters to Spot Ocean for Spark in the cloud</a></li>
      
        <li><a href="/2024/02/29/ubuntu-2404-lts-with-netapp-solidfire.html">Ubuntu 24.04 LTS with NetApp SolidFire</a></li>
      
        <li><a href="/2023/08/21/trident-new-stateful-set-delete-feature.html">StatefulSet PVC Retention with Trident and SolidFire</a></li>
      
        <li><a href="/2025/07/07/firemox.html">Firemox - an anti-plugin for Proxmox PVE with NetApp SolidFire</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2025-07-07 17:31 </p>
    <p>Copyright © 2025 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
