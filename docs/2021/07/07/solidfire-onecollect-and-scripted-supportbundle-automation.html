<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Improve SolidFire Support Bundle Log Generation and Upload with Automation and OneCollect | Acting Technologist
      
    </title>
    <meta name="description" content="
     Log collection: when you need it, you want to do it faster
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Improve SolidFire Support Bundle Log Generation and Upload with Automation and OneCollect | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Improve SolidFire Support Bundle Log Generation and Upload with Automation and OneCollect" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Log collection: when you need it, you want to do it faster" />
<meta property="og:description" content="Log collection: when you need it, you want to do it faster" />
<link rel="canonical" href="https://scaleoutsean.github.io/2021/07/07/solidfire-onecollect-and-scripted-supportbundle-automation.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2021/07/07/solidfire-onecollect-and-scripted-supportbundle-automation.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-07T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Improve SolidFire Support Bundle Log Generation and Upload with Automation and OneCollect","dateModified":"2021-07-07T00:00:00+08:00","datePublished":"2021-07-07T00:00:00+08:00","author":{"@type":"Person","name":"scaleoutSean"},"@type":"BlogPosting","url":"https://scaleoutsean.github.io/2021/07/07/solidfire-onecollect-and-scripted-supportbundle-automation.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2021/07/07/solidfire-onecollect-and-scripted-supportbundle-automation.html"},"description":"Log collection: when you need it, you want to do it faster","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Improve SolidFire Support Bundle Log Generation and Upload with Automation and OneCollect</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>07 Jul 2021</span> - <i class="far fa-clock"></i> 


  
  
    6 minute read
  

    </span>
  </div>
  
        <p><strong>NOTICE</strong>: any and all credentials and tokens on this page are samples, not leaked.</p>

<p>I don’t have any first hand information to say this is the case, but I believe that with the increased focus on container workloads and container-packaged SolidFire (NetApp eSDS), SolidFire management has slowly been increasingly containerized as well. NetApp Hybrid Cloud Control - a VM with a bunch of management-related containers - is the most prominent example that is familiar to NetApp HCI and SolidFire customers.</p>

<p>I once wrote about log collection on NetApp HCC (see <a href="/2020/12/08/get-bearer-token-for-netapp-hci-hybrid-cloud-control-logs">here</a>), but early this week I was working on something that prompted me to revisit log collection on SolidFire storage nodes.</p>

<p>To get the logs, find the nodes’ management IPs in the main SolidFire cluster GUI, click on each link, and you’ll see the node management interface (https://${node-management-ip}:442). Go to System Utilities, select Collect Node Logs, enter Utility Options (such as bundle name), click on Collect Node Logs, and wait a few minutes till the logs are ready at which point you’ll be prompted to download your log bundle.</p>

<p><img src="/assets/images/solidfire-onecollect-get-support-logs-00-hcc-download.png" alt="NetApp Hybrid Cloud Control - System Utilities" /></p>

<p>You need to do this for every node, and it’s usually a good idea to not run this thing across several nodes at the same time because they do collect what can amount to gigabytes of logs files that have to be packaged into a <code class="language-plaintext highlighter-rouge">tar</code> archive file as defined by the bundle name.</p>

<p>But spending 5-10 minutes per each of four or more nodes isn’t fun either. (Although that doesn’t mean this is <em>not</em> how customers are asked to do it - I’m not in Support, so I’m curious myself as I haven’t seen or heard of any better approaches. The manual approach seems excessively wasteful to me.)</p>

<p>Sometimes, if you can easily duplicate a problem, it makes sense to run Delete All Node Logs (see in screenshot above) before you Collect Node Logs, just so that you avoid collecting, downloading, and then uploading (to NetApp Support) logs unrelated to your issue. There are also options related to log collection - presumably Support can provide some parameters to limit log collection to certain services, but I have no knowledge of that detail.</p>

<p>In any case, as I was taking care of my debugging business, it didn’t take long to get annoyed by this manual approach. Again, I chose PowerShell because it works well on Windows and Linux and the only requirement is SolidFire PowerShell Tools (module) for PowerShell 5 or 7.</p>

<p>What I do in v1 is:</p>

<ul>
  <li>Prompt the user for SolidFire cluster Management VIP and cluster administrator credentials, and from this point continue unattended</li>
  <li>Get the list of active SolidFire nodes
    <ul>
      <li>Connect to one node, call the generate Support Bundle API method and wait until the bundle is ready (minutes)</li>
      <li>As soon as the archive is ready I create a download job and send it to background. You may need 20 GB per each SolidFire storage node, so run the script from where you have enough capacity!</li>
      <li>Connect to the next node to do the same until all Support Bundles have been generated and download jobs sent to background</li>
    </ul>
  </li>
</ul>

<p>This doesn’t gather logs in parallel, that is done sequentially. It only <em>downloads</em> them in parallel. With old logs <em>deleted</em> in Node Web Management UI prior to running this script, it takes me about 10 minutes to run this script on a SolidFire v12.3 cluster with five nodes. The first log is ready in little under 2 minutes, which means background downloads are almost free (time-wise).</p>

<p><img src="/assets/images/solidfire-onecollect-get-support-logs-01-scripted-download.png" alt="Collect SolidFire or eSDS logs with PowerShell" /></p>

<p>Free? Okay, that’s not entirely true, as at the very end I can usually see three download jobs still running in the background, so clearly not every job can finish before the next log is ready, but it’s very close to free… It may take longer on clusters where not all old node logs have been deleted, but if you run the script over a 10G network, maybe it wouldn’t be bandwidth-constrained (screenshot below).</p>

<p><img src="/assets/images/solidfire-onecollect-get-support-logs-02-download-speed.png" alt="Download SolidFire or eSDS logs with PowerShell" /></p>

<p>So this is pretty nice - it’s simple, safe and fast.</p>

<p>Of course, we don’t need gigabytes of logs for every single Support case. Usually you need just the output of a handful of diagnostic commands. NetApp has a tool called OneCollect (I recorded a video about running it in an unsupported manner - on HCC VM - you can find it on YouTube) which runs in a Docker container or on regular mainstream OS (x86-64 version of OS X, Linux or Windows). You execute it on your client and access its Web UI at http://localhost:8888 (default port).</p>

<p><img src="/assets/images/solidfire-onecollect-get-support-logs-03-one-collect-lightweight-collection.png" alt="Generate and download SolidFire or eSDS logs with NetApp ActiveIQ OneCollect tool" /></p>

<p>Because these logs tend to be much smaller, OneCollect is and convenient for that, and can also login to NetApp support and upload these logs for you.</p>

<p><img src="/assets/images/solidfire-onecollect-get-support-logs-04-onecollect-lightweight-collection-complete.png" alt="NetApp ActiveIQ OneCollect tool job summary" /></p>

<p>But it doesn’t do Support Bundles, as far as I can tell (I tried today). Should you need to collect those logs, you may still want to use a script to gather Support Bundle files, and <em>then</em> use OneCollect’s Data Files upload to upload them to NetApp Support servers.</p>

<p><img src="/assets/images/solidfire-onecollect-get-support-logs-05-onecollect-upload-support-bundle-files.png" alt="Upload SolidFire or eSDS logs with NetApp ActiveIQ OneCollect tool" /></p>

<p>As you may have noticed, Support Bundle files are not compressed after my script downloads them. We could compress them on the fly (interestingly, this isn’t so easy in PowerShell), or indeed after (compress each file immediately after download).</p>

<p>Because NetApp ActiveIQ OneCollect (or most browser upload utilities) can compress files on the fly, it’s probably okay to upload them uncompressed - upload times may not be considerably worse and it’s faster to unpack them when they’re not compressed. I don’t have a NetApp Support account so I can’t tell if my guess regarding upload time is about right, but if I hear otherwise I could change the script to compress the logs on the fly as I download them, or later.</p>

<p>Of course the script could do more, but over the next 12 months even this basic version should save me enough time to pay back for its development. I’ll put it on Github once I tidy up the code, add some logging and so on (I’m thinking about adding parameters to gather logs from only selected nodes, but I don’t know if that is how it works in real life - I’ll try to find out).</p>

<p>Edit (2022-02-20): I checked with the folks who know how people gather logs and unfortunately while it seems possible to it more conveniently than it’s done now (script with a menu could be created to automate log collection and upload), the workflow is complex. First, because all logs are huge, it’s always better to collect as few logs as possible. Second, depending on what seems to be broken, Support may ask for one or more logs, and those may need to be gathered with different options (“switches”). Third, there’s some variability depending on the severity of problem, software version involved, hardware platform, etc. So while this can be automated, it’s too complicated without knowing the process inside-out, so I’ve abandoned the idea to automate this on my own.</p>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#automation">automation</a>
      &nbsp; 
    
      <a href="
      /categories/#solidfire">solidfire</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2022/03/06/elastic-elk-stack-on-netapp.html">Elasticsearch 8 with NetApp storage</a></li>
      
        <li><a href="/2021/10/18/solidfire-syslog-filebeat-logstash-elk-stack.html">SolidFire monitoring with Elasticsearch</a></li>
      
        <li><a href="/2020/11/27/solidfire-mnode-hcc-log-forwarding.html">SolidFire mNode and HCC Log Fowarding</a></li>
      
        <li><a href="/2022/12/13/eseries-santricity-mel-forwarding.html">Gathering and forwarding E-Series SANtricity Major Event Log (MEL)</a></li>
      
        <li><a href="/2022/12/12/eseries-syslog-forwarding.html">Forward E-Series SANtricity logs to remote syslog server</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2024-06-02 16:26 </p>
    <p>Copyright © 2024 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
