<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.3 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Data Path in SolidFire clusters with Protection Domains | Acting Technologist</title>
<meta name="description" content="How does SolidFire with Protection Domains store data">


  <meta name="author" content="scaleoutSean">
  
  <meta property="article:author" content="scaleoutSean">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Acting Technologist">
<meta property="og:title" content="Data Path in SolidFire clusters with Protection Domains">
<meta property="og:url" content="https://scaleoutsean.github.io/2021/07/06/solidfire-protection-domains-data-path.html">


  <meta property="og:description" content="How does SolidFire with Protection Domains store data">





  <meta name="twitter:site" content="@scaleoutSean">
  <meta name="twitter:title" content="Data Path in SolidFire clusters with Protection Domains">
  <meta name="twitter:description" content="How does SolidFire with Protection Domains store data">
  <meta name="twitter:url" content="https://scaleoutsean.github.io/2021/07/06/solidfire-protection-domains-data-path.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2021-07-06T00:00:00+08:00">






<link rel="canonical" href="https://scaleoutsean.github.io/2021/07/06/solidfire-protection-domains-data-path.html">







  <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />


  <meta name="msvalidate.01" content="7cf5b7d96a77410a8ad035f764dc81b3">





<!-- end _includes/seo.html -->


<meta name="bingbot" content="noindex,noarchive,nofollow">


  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Acting Technologist Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic" rel="stylesheet" type="text/css">


  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/scaleoutsean-acting-technologist.png" alt="Acting Technologist"></a>
        
        <a class="site-title" href="/">
          Acting Technologist
          <span class="site-subtitle">human action through technology</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/archive/"
                
                
              >Archive</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/projects.html"
                
                
              >Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Data Path in SolidFire clusters with Protection Domains">
    <meta itemprop="description" content="Data Path in SolidFire clusters v12 with Protection Domains in words and pictures">
    <meta itemprop="datePublished" content="2021-07-06T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://scaleoutsean.github.io/2021/07/06/solidfire-protection-domains-data-path.html" itemprop="url">Data Path in SolidFire clusters with Protection Domains
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-07-06T00:00:00+08:00">2021-07-06 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>In the <a href="/2021/06/08/solidfire-availability-zones">post that compares SolidFire Protection Domains with Availability Zones</a> I had this illustration of network connectivity among SolidFire v12 cluster nodes and between SolidFire and iSCSI clients.</p>

<p><img src="/assets/images/solidfire-protection-domains-and-availability-zones.png" alt="SolidFire Protection Domains" /></p>

<p>Sometimes one wonders if it'd be better if clients had some intelligence about storage layout. In this post I explain why I don't think that would be beneficial to SolidFire.</p>

<p>Let's take a quick look at some examples of how data flows in a SolidFire v12 cluster with three Protection Domains (PD's).</p>

<p>First, when an iSCSI client (container, VM, physical server - it doesn't matter) connects to a volume, that volume can be running on "primary" SolidFire volume located in any Protection Domain. In this case, it's in another rack (or floor, or building), and client must make three hops (local Leaf, Spine, remote Leaf) to get to the volume. This applies to 66.66% of connections here - they'd be remote.</p>

<p><img src="/assets/images/sf-protection-domain-data-flow-01.png" alt="SolidFire nodes fetches blocks client connects to volume in another rack" /></p>

<p>If it's a read request the SolidFire storage node running "slice" (metadata) service for this volume must fetch data blocks on behalf of the client - each block from either copy (SolidFire Double Helix aims to maintain two copies of each block on different nodes and even in different PDs', as is the case here).</p>

<p>With three Protection Domains, 2/3rds of all requests have to make three hops to get to the block. One third needs just one hop or less (when the block that's being fetched is in the same PD, including on the node running slice service located in the same rack as the client).</p>

<p><img src="/assets/images/sf-protection-domain-data-flow-02.png" alt="SolidFire node fetches data to satisfy read request" /></p>

<p>As the storage node has to serve <em>all</em> requested blocks to satisfy that read request, getting 1/3rd of the requested blocks from nodes in local PD doesn't make much difference.</p>

<p>After all the blocks requested by the client have been gathered and decompressed, data is sent to the client via iSCSI.</p>

<p><img src="/assets/images/sf-protection-domain-data-flow-03.png" alt="SolidFire node returns data to iSCSI client in another rack" /></p>

<p>Now, one might wonder if it wouldn't be better if the iSCSI connection and all block fetching (or dispatching) could somehow happen within the same protection domain in order to minimize network hops.</p>

<p><img src="/assets/images/sf-protection-domain-data-flow-04.png" alt="iSCSI client connects to volume in same rack" /></p>

<p>This would be great, right?</p>

<p>But when we consider that each block written still has to be protected across two PD's, this doesn't buy us much. When we write a new block, in 2/3rds of all cases the SolidFire node running slice service (home node for the iSCSI volume) needs to make at least one three-hop trip to another storage node <em>in another protection domain</em> to save the second copy of the data.</p>

<p><img src="/assets/images/sf-protection-domain-data-flow-05.png" alt="SolidFire Double Helix protects written blocks" /></p>

<p>Another thing that instinctively comes to one's mind is how localizing iSCSI and intra-node (for SolidFire) traffic could save network resources and lower I/O latency. But you can also think of it this way:</p>

<ul>
  <li>Any write that lands in only one PD (even if there are redundant replicas in two different storage nodes) is not protected, so we must write at least one replica to another PD (sometimes both replicas have to be saved to other PDs, in order to keep capacity utilization evenly balanced among nodes and PDs)</li>
  <li>If your Spine &amp; Leaf network would benefit from decreasing cross-PD traffic by 1-2 GB/s, maybe you have a networking problem?</li>
</ul>

<p>There is just one scenario for which I think some built-in intelligence may be nice to have, and that is for reads that have a copy in the same PD - if SolidFire had a way to prefer reading replicas from local PD, it could eliminate some 3-hop reads. But:</p>

<ul>
  <li>Such cases are already a minority (only 1/3rd of all reads can be local in a cluster with 3 PD's)</li>
  <li>The risk of hotspotting nodes in local PD would increase</li>
  <li>We'd still have to wait for blocks that must be fetched from remote PD's</li>
  <li>Writes would still have to be sent out to other PDs to protect new or modified data</li>
</ul>

<p>So even this doesn't sound too useful. It'd have to be a very predictable and controlled workload, which is rarely the case outside of HPC or single application environments.</p>

<p>I've worked with HPC storage that could benefit from preferring local nodes or storage pools for reads, but that was before fast &amp; affordable Spine &amp; Leaf architectures, and it was meant for use cases that involved reading huge amounts of data (many TBs in one go), and the users had to be very careful about job placement (to avoid hotspotting local storage or network).</p>

<p>For SolidFire and workloads that run on it, the way PDs work looks fine to me. Traffic flows all over the place, but you don't have to pay attention to it.</p>

<p>Mellanox SN2700 and SN2100 (or SN2010) switches that many NetApp HCI customers have deployed are affordable and great building blocks for Spine &amp; Leaf networks serving iSCSI and application traffic. You can use other switches as well, of course (just stay away from stackable switch designs).</p>

<p>Once you get the networking right, Protection Domains just work. You don't have to mind them, you can schedule your containers or VMs anywhere, and you don't need a PhD in SolidFire cluster philosophy. Which is exactly how SolidFire is supposed to be - simple.</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/iscsi" class="page__taxonomy-item p-category" rel="tag">iscsi</a><span class="sep">, </span>
    
      <a href="/tags/netapp" class="page__taxonomy-item p-category" rel="tag">netapp</a><span class="sep">, </span>
    
      <a href="/tags/networking" class="page__taxonomy-item p-category" rel="tag">networking</a><span class="sep">, </span>
    
      <a href="/tags/solidfire" class="page__taxonomy-item p-category" rel="tag">solidfire</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/solidfire" class="page__taxonomy-item p-category" rel="tag">solidfire</a><span class="sep">, </span>
    
      <a href="/categories/storage" class="page__taxonomy-item p-category" rel="tag">storage</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2021-07-06T00:00:00+08:00">2021-07-06 00:00</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?via=scaleoutSean&text=Data+Path+in+SolidFire+clusters+with+Protection+Domains%20https%3A%2F%2Fscaleoutsean.github.io%2F2021%2F07%2F06%2Fsolidfire-protection-domains-data-path.html" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://scaleoutsean.github.io/2021/07/06/solidfire-protection-domains-data-path.html" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

</section>


      
  <nav class="pagination">
    
      <a href="/2021/07/06/e-series-ddp-expansion-and-rebalancing.html" class="pagination--pager" title="Faster initialization, rebalancing with DDP on NetApp E-Series">Previous</a>
    
    
      <a href="/2021/07/07/solidfire-onecollect-and-scripted-supportbundle-automation.html" class="pagination--pager" title="SolidFire Support Bundle Log with Automation, OneCollect">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/31/epa-version-3-dot-5.html" rel="permalink">EPA version 3.5.0
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-31T00:00:00+08:00">2025-08-31 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">What's new in EPA v3.5.0
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/27/epa-version-3-dot-4-dot-1.html" rel="permalink">EPA version 3.4.1
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-27T00:00:00+08:00">2025-08-27 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">What's new in EPA v3.4.1
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/24/epa-version-3-dot-4.html" rel="permalink">EPA version 3.4.0
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-24T00:00:00+08:00">2025-08-24 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">What's new in EPA v3.4.0
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/20/econfig-v2-updates.html" rel="permalink">E-Config v2 updated for QLC drives
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-20T00:00:00+08:00">2025-08-20 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I got carried away while making overdue updates to E-Config and added a new feature
</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2020-2025 scaleoutSean.github.io | <a href="https://scaleoutsean.github.io">Acting Technologist</a> | Terms: <a href="https://creativecommons.org/licenses/by/4.0/deed.en" target="_blank">CC BY 4.0</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
