<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.3 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Maximum parallelization of SolidFire Backup and Volume Copy/Clone jobs | Acting Technologist</title>
<meta name="description" content="Safely maximize the number of backup and copy jobs on your SolidFire cluster">


  <meta name="author" content="scaleoutSean">
  
  <meta property="article:author" content="scaleoutSean">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Acting Technologist">
<meta property="og:title" content="Maximum parallelization of SolidFire Backup and Volume Copy/Clone jobs">
<meta property="og:url" content="https://scaleoutsean.github.io/2021/06/22/solidfire-backup-and-cloning-with-per-storage-node-queues.html">


  <meta property="og:description" content="Safely maximize the number of backup and copy jobs on your SolidFire cluster">





  <meta name="twitter:site" content="@scaleoutSean">
  <meta name="twitter:title" content="Maximum parallelization of SolidFire Backup and Volume Copy/Clone jobs">
  <meta name="twitter:description" content="Safely maximize the number of backup and copy jobs on your SolidFire cluster">
  <meta name="twitter:url" content="https://scaleoutsean.github.io/2021/06/22/solidfire-backup-and-cloning-with-per-storage-node-queues.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2021-06-22T00:00:00+08:00">






<link rel="canonical" href="https://scaleoutsean.github.io/2021/06/22/solidfire-backup-and-cloning-with-per-storage-node-queues.html">







  <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />


  <meta name="msvalidate.01" content="7cf5b7d96a77410a8ad035f764dc81b3">





<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Acting Technologist Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic" rel="stylesheet" type="text/css">


  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/scaleoutsean-acting-technologist.png" alt="Acting Technologist"></a>
        
        <a class="site-title" href="/">
          Acting Technologist
          <span class="site-subtitle">human action through technology</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/archive/"
                
                
              >Archive</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/projects.html"
                
                
              >Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Maximum parallelization of SolidFire Backup and Volume Copy/Clone jobs">
    <meta itemprop="description" content="Safely maximize the number of backup and copy jobs on your SolidFire cluster">
    <meta itemprop="datePublished" content="2021-06-22T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://scaleoutsean.github.io/2021/06/22/solidfire-backup-and-cloning-with-per-storage-node-queues.html" itemprop="url">Maximum parallelization of SolidFire Backup and Volume Copy/Clone jobs
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-06-22T00:00:00+08:00">2021-06-22 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>SolidFire can backup volumes to S3-compatible Object Storage. How to do it in parallel, I wrote about <a href="/2021/04/21/solidfire-backup-to-s3.html">here</a>.</p>

<p>Volume cloning and copying is a similar type of background job, and those can also be executed in parallel. We get to use this in automation, for example when you need to clone a volume 100 times, or perhaps start with three "template" volumes (Windows, Ubuntu, Red Hat) and make 32 copies of each. I use volume copying in <a href="/2021/05/08/revisiting-solidbackup.html">SolidBackup</a> scripts.</p>

<p>What's common to both is there's the maximum number of jobs that can be scheduled on a SolidFire storage node at the same time (you can find the limits in the SolidFire Release Notes or with the API (with PowerShell, they get displayed immediately after you connect to the cluster).</p>

<p>If that number is 8, if there's 8 jobs running and you attempt to schedule another job that lands on that node, that job will immediately fail. It's not a big deal - jobs can be resubmitted - but you unnecessarily consume API resources, pollute your SolidFire logs, have to handle job failures in your scripts, and still prevent anyone else from submitting their jobs while you occupy all the job slots available.</p>

<p>As we saw in the linked posts, we can deal with this by parallelizing job submission to a "safe" per-cluster level (say, 16 jobs on a 4-node cluster) that makes it unlikely that we'd hit "node queue full" errors and have to retry if any single node hits the job limit.</p>

<p>A script that does that for Backup can be found in my Awesome SolidFire repo on Github.</p>

<h2 id="maximizing-volume-backup-and-clone-jobs-per-node">Maximizing volume backup and clone jobs-per-node</h2>

<p>An even better way would be to queue up to desired number of jobs per node, so that we can say "dispatch up to 7 jobs per node" so that we run the node at a high utilization, but still have one empty slot available for on-demand activities.</p>

<p>Trouble is, there's no API method to help you do that. Or even to easily find out where the jobs are running in the first place. Indirectly that is possible, but it's also quite complicated. I tried the indirect way and realized it would have taken me weeks of tinkering, with the poor scripting skills I have.</p>

<p>In the end I had to find a shortcut which came in the form of a non-public API method, <code class="language-plaintext highlighter-rouge">GetReport</code>, which lets us indirectly obtain a volume's location and tell us which SolidFire storage node hosts it.</p>

<p>This (being a non-public API method) can change in the next release, it may stop working etc., and it seems resource-intensive, so I run it just once, at the very beginning. If I had many jobs that run around the clock, I would run it every 60 minutes to get updates in the case SolidFire rebalances volumes. (A smarter way would be to watch the event log and only run it if/when such a rebalancing happens.)</p>

<p>Note that there are two separate limits - they happen to be 8 per node, but the way to query them is different - for bulk (backup) and volume (clone, copy) jobs. But that's just an implementation detail.</p>

<p>So far I've used <code class="language-plaintext highlighter-rouge">GetReports</code> to improve SolidFire Backup to S3 which, as explained above, has a "concurrent backup jobs per cluster" setting. I may add this approach to SolidSync (from SolidBackup) later, to apply it to volume copy jobs as well.</p>

<h2 id="findings">Findings</h2>

<p>So, is this approach much better?</p>

<p>Well, it's not that different. I kick off a bunch of jobs and instead of watching a "global" maximum, now I watch each node's queue and schedule new jobs only when there are jobs for that node, and if the node's queue is less full than the per-node limit I set in the script (e.g., 7).</p>

<p><img src="/assets/images/solidfire-backup-to-s3-v2-parallel-per-node.png" alt="Parallel SolidFire Backup to S3 with per-node queues" /></p>

<p>Whereas I used to run 20 parallel backup jobs on a 5 node cluster (that level seemed "safe"), here I can safely and easily hit 35 (5 nodes x 7 jobs per node) when I have enough volumes to fill all the nodes' queues.</p>

<p>SolidFire schedules volume placement based on a number of factors (not just "volumes per storage node"), so in the screenshot above you can see that despite a fairly large number of volumes (50-ish), I could not fill all the queues - at most I got 32 backup jobs running in parallel.</p>

<p>Once no jobs are left in the script's queue, it scans SolidFire Events for bulk job (i.e., backup) events and outputs a simple report. Because backup jobs can run for hours, it doesn't attempt to wait it out - users are advised to watch SolidFire Events from Elastic, Splunk, etc.</p>

<p><img src="/assets/images/solidfire-backup-to-s3-v2-parallel-per-node-summary.png" alt="Parallel SolidFire Backup to S3 with per-node queues" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>32 vs. 20 jobs is still a nice improvement which eliminates the risk of failed jobs and still leaves a free slot per each storage node for on-demand backup and restore jobs. If you know your environment you can set parallelism to 8-per-node and run up to 40 jobs in parallel (5 nodes x 8 jobs), effectively doubling the number of jobs compared to the earlier approach.</p>

<p>If you also incorporate QoS pre-post adjustments for each volume before and after backup to S3 (I wrote a script for that, too), you should be able to read SolidFire at &gt; 1GB/s. Unfortunately, the upload performance of Backup to S3 is slow, but we can't optimize that with a script (I think SolidBackup should be used by those who wish to improve that).</p>

<p>Backup jobs take longer to run, but clone jobs run faster and cutting a 10 minute mass cloning job down to less than 6 minutes would be nice, especially if your build job (or whatever you do after that) takes 15-20 minutes to complete - you could run up to 20% more build jobs per day.</p>

<h2 id="demo">Demo</h2>

<p>I demonstrated how Backup to S3 works in previous posts on this topic, so this one is very short and focuses on the difference in this approach vs the earlier parallel-jobs-per-cluster approach.</p>

<ul>
  <li><a href="https://youtu.be/5N62hhDrOO0">Parallel SolidFire Backup-to-S3 with per-node job queues</a> (1m40s)</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/backup" class="page__taxonomy-item p-category" rel="tag">backup</a><span class="sep">, </span>
    
      <a href="/tags/data-protection" class="page__taxonomy-item p-category" rel="tag">data protection</a><span class="sep">, </span>
    
      <a href="/tags/devops" class="page__taxonomy-item p-category" rel="tag">devops</a><span class="sep">, </span>
    
      <a href="/tags/netapp" class="page__taxonomy-item p-category" rel="tag">netapp</a><span class="sep">, </span>
    
      <a href="/tags/powershell" class="page__taxonomy-item p-category" rel="tag">powershell</a><span class="sep">, </span>
    
      <a href="/tags/restore" class="page__taxonomy-item p-category" rel="tag">restore</a><span class="sep">, </span>
    
      <a href="/tags/solidfire" class="page__taxonomy-item p-category" rel="tag">solidfire</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/automation" class="page__taxonomy-item p-category" rel="tag">automation</a><span class="sep">, </span>
    
      <a href="/categories/solidfire" class="page__taxonomy-item p-category" rel="tag">solidfire</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2021-06-22T00:00:00+08:00">2021-06-22 00:00</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?via=scaleoutSean&text=Maximum+parallelization+of+SolidFire+Backup+and+Volume+Copy%2FClone+jobs%20https%3A%2F%2Fscaleoutsean.github.io%2F2021%2F06%2F22%2Fsolidfire-backup-and-cloning-with-per-storage-node-queues.html" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://scaleoutsean.github.io/2021/06/22/solidfire-backup-and-cloning-with-per-storage-node-queues.html" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

</section>


      
  <nav class="pagination">
    
      <a href="/2021/06/18/solidbackup-with-alternative-backup-clients.html" class="pagination--pager" title="SolidBackup with alternative backup clients">Previous</a>
    
    
      <a href="/2021/07/06/e-series-ddp-expansion-and-rebalancing.html" class="pagination--pager" title="Faster initialization, rebalancing with DDP on NetApp E-Series">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2026/01/21/eseries-performance-analyzer-v353.html" rel="permalink">NetApp E-Series Performance Analyzer v3.5.3
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2026-01-21T00:00:00+08:00">2026-01-21 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">About new Prometheus metrics and PiT volume performance
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2026/01/20/kubernetes-netapp-eseries-santricity-csi.html" rel="permalink">Kubernetes with NetApp E-Series SANtricity
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2026-01-20T00:00:00+08:00">2026-01-20 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">CSI drivers you can use with NetApp E-Series arrays
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2026/01/19/netapp-eseries-santricity-csi.html" rel="permalink">NetApp E-Series SANtricity CSI
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2026-01-19T00:00:00+08:00">2026-01-19 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          12 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Community CSI driver for NetApp E-Series arrays: what it is and what it does
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2026/01/16/santricity-eseries-datalake-storage.html" rel="permalink">Big Data &amp; analytics patterns for NetApp object &amp; block
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2026-01-16T00:00:00+08:00">2026-01-16 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2020-2026 scaleoutSean.github.io | <a href="https://scaleoutsean.github.io">Acting Technologist</a> | Terms: <a href="https://creativecommons.org/licenses/by/4.0/deed.en" target="_blank">CC BY 4.0</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
