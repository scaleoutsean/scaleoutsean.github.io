<!doctype html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="googlebot" content="noarchive">
    <meta name="googlebot" content="max-snippet:60">
    <meta name="googlebot" content="max-image-preview:small">
    <meta name="bingbot" content="noarchive">
    <meta name="bingbot" content="max-snippet:60">
    <meta name="bingbot" content="max-image-preview:small">
    <meta name="robots" content="noarchive">
    <meta name="robots" content="max-snippet:60">
    <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />
    <title>
        
            Mirantis Kubernetes Engine 3.4 with NetApp SolidFire 12.2 | Acting Technologist
      
    </title>
    <meta name="description" content="
     Mirantis Kubernetes Engine 3.4 with NetApp SolidFire
     ">

    <!-- LINK TO ATOM FEED FOR SEO -->
    <link rel="alternate" type="application/atom+xml" href="https://scaleoutsean.github.io/feed.xml" />

    <!-- FAVICON -->
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
    <div id="search"></div>
    <script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search" });
        });
    </script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Mirantis Kubernetes Engine 3.4 with NetApp SolidFire 12.2 | Acting Technologist</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Mirantis Kubernetes Engine 3.4 with NetApp SolidFire 12.2" />
<meta name="author" content="scaleoutSean" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Mirantis Kubernetes Engine 3.4 with NetApp SolidFire" />
<meta property="og:description" content="Mirantis Kubernetes Engine 3.4 with NetApp SolidFire" />
<link rel="canonical" href="https://scaleoutsean.github.io/2021/05/02/mirantis-mke-netapp-trident-solidfire.html" />
<meta property="og:url" content="https://scaleoutsean.github.io/2021/05/02/mirantis-mke-netapp-trident-solidfire.html" />
<meta property="og:site_name" content="Acting Technologist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-02T00:00:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://scaleoutsean.github.io/2021/05/02/mirantis-mke-netapp-trident-solidfire.html"},"author":{"@type":"Person","name":"scaleoutSean"},"description":"Mirantis Kubernetes Engine 3.4 with NetApp SolidFire","@type":"BlogPosting","url":"https://scaleoutsean.github.io/2021/05/02/mirantis-mke-netapp-trident-solidfire.html","headline":"Mirantis Kubernetes Engine 3.4 with NetApp SolidFire 12.2","dateModified":"2021-05-02T00:00:00+08:00","datePublished":"2021-05-02T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://scaleoutsean.github.io/">
			<h2 style="font-size:1.8em;">Acting Technologist</h2>
		</a>
		
		<h3>
			civilizations are created by individuals
		</h3>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>

<a href="/categories/">Categories</a>

<a href="/projects.html">Projects</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/scaleoutsean" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/scaleoutsean" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>


    <div class="post-container">
      <article id = "post">
        <h1 id = "post-title">Mirantis Kubernetes Engine 3.4 with NetApp SolidFire 12.2</h1>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>02 May 2021</span> - <i class="far fa-clock"></i> 


  
  
    13 minute read
  

    </span>
  </div>
  
        <p><strong>NOTICE</strong>: any and all credentials and tokens on this page are samples, not leaked.</p>

<p><a href="/2021/05/01/netapp-trident-21.04-released">Yesterday I realized</a> that NetApp Trident v21.04 introduced support for Mirantis Kubernetes Engine (MKE). In the past NetApp Trident and SolidFire couldn’t work with Docker EE so I was curious if this change that would give additional choices to SolidFire users, some of whom may have used Mirantis &amp; SolidFire with OpenStack.</p>

<ul>
  <li><a href="#deploy-nodes-and-mirantis-kubernetes-engine">Deploy nodes and Mirantis Kubernetes Engine</a>
    <ul>
      <li><a href="#success">Success</a></li>
      <li><a href="#mke-wrap-up">MKE wrap-up</a></li>
    </ul>
  </li>
  <li><a href="#install-and-configure-netapp-trident-with-solidfire-back-end">Install and configure NetApp Trident with SolidFire back-end</a></li>
  <li><a href="#summary">Summary</a></li>
  <li><a href="#reference">Reference</a></li>
  <li><a href="#demo">Demo</a></li>
</ul>

<h2 id="deploy-nodes-and-mirantis-kubernetes-engine">Deploy nodes and Mirantis Kubernetes Engine</h2>

<p>Create a storage account on SolidFire and create one test volume to test your iSCSI configuration on worker(s).</p>

<p>Deploy two Linux VMs (master1, worker1) with at least 4 GiB RAM and 25 GiB of OS disk space and connect the worker node to iSCSI network. Make sure it can access the test volume, and then log out. Enable passwordless access for root for easier installation. Configure fixed IPv4 IPs and give the nodes some hostnames. I used Ubuntu 18.04 with the following network configuration:</p>

<ul>
  <li>ens192 - “external” network (192.168.1.0/24)</li>
  <li>ens224 - iSCSI network (192.168.103.0/24)</li>
  <li>ens256 - it was just there, configured but not used (192.168.104.0/24)</li>
</ul>

<p>Get the installer (launchpad) from <a href="https://github.com/Mirantis/launchpad/releases">here</a> and use it to generate a template file as per launchpad instructions. For this post I used launchpad 1.3.0 beta 3, currently the newest available.</p>

<p>My first attempt failed. I had to specify privateInterface, perhaps because I had 3 NICs on each VM (one of them was for iSCSI).</p>

<p>My second attempt failed:</p>

<blockquote>
  <p>INFO [ssh] 192.168.1.197:22: time=”2021-05-02T04:53:52Z” level=fatal msg=”unable to validate system resource requirements: unable to verify memory requirements: Your system does not have enough memory. UCP suggests a minimum of 4.00 GB, but you only have 3.00 GB. You may have unexpected errors.”</p>
</blockquote>

<p>My third attempt failed:</p>

<blockquote>
  <p>INFO [ssh] 192.168.1.197:22: time=”2021-05-02T05:17:11Z” level=fatal msg=”unable to validate system resource requirements: unable to verify storage requirements: Your system does not have available disk space. UCP requires a minimum of 25.00 GB, but you only have 23.43 GB</p>
</blockquote>

<p>My fourth attempt worked with this launchpad.yaml:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">launchpad.mirantis.com/mke/v1.4</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">mke</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mke3</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">ssh</span><span class="pi">:</span>
      <span class="na">address</span><span class="pi">:</span> <span class="s">192.168.1.197</span>
      <span class="na">user</span><span class="pi">:</span> <span class="s">root</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">22</span>
      <span class="na">keyPath</span><span class="pi">:</span> <span class="s">~/.ssh/id_rsa</span>
    <span class="na">role</span><span class="pi">:</span> <span class="s">manager</span>
    <span class="na">privateInterface</span><span class="pi">:</span> <span class="s">ens192</span>
  <span class="pi">-</span> <span class="na">ssh</span><span class="pi">:</span>
      <span class="na">address</span><span class="pi">:</span> <span class="s">192.168.1.130</span>
      <span class="na">user</span><span class="pi">:</span> <span class="s">root</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">22</span>
      <span class="na">keyPath</span><span class="pi">:</span> <span class="s">~/.ssh/id_rsa</span>
    <span class="na">privateInterface</span><span class="pi">:</span> <span class="s">ens192</span>
    <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
  <span class="na">mke</span><span class="pi">:</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">3.4.0</span>
    <span class="na">installFlags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">--default-node-orchestrator=kubernetes</span>
    <span class="na">installFlags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">--pod-cidr="192.169.200.0/22"</span>
    <span class="pi">-</span> <span class="s">--admin-username=admin</span>
    <span class="pi">-</span> <span class="s">--admin-password=NetApp123$</span>
    <span class="pi">-</span> <span class="s">--force-minimums</span>
  <span class="na">mcr</span><span class="pi">:</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">20.10.0</span>
  <span class="na">cluster</span><span class="pi">:</span>
    <span class="na">prune</span><span class="pi">:</span> <span class="kc">false</span>
<span class="s">root@master1:~#</span> 

</code></pre></div></div>

<p>But it worked only up to this point:</p>

<blockquote>
  <p>INFO [ssh] 192.168.1.197:22: time=”2021-05-02T05:52:31Z” level=fatal msg=”unable to verify that no UCP components already exist: the following containers appear to be from an existing UCP installation and must be removed before proceeding with a new installation: ucp-auth-api.uskyyh8canpeuhqo89q0y9jou.lhmnrymq4pncbmv6fp7oif7yg ucp-auth-worker.uskyyh8canpeuhqo89q0y9jou.s07t6ebpcoeuycaheb51qxdp8 ucp-auth-api.uskyyh8canpeuhqo89q0y9jou.v3n5ykdyb947gum9crtuqduux ucp-auth-worker.uskyyh8canpeuhqo89q0y9jou.0an9610cewsltdwjqqcxswj63 ucp-auth-api.uskyyh8canpeuhqo89q0y9jou.zy6z9griqxsdnkgpl4zu1uasw ucp-auth-worker.uskyyh8canpeuhqo89q0y9jou.e0oesa2d80m5cg1s5bnjexvwm ucp-auth-api.uskyyh8canpeuhqo89q0y9jou.rihn5erd47qyi33ej3qibb8t2 ucp-auth-worker.uskyyh8canpeuhqo89q0y9jou.ukembo9xk5hpzk110nstx6hue ucp-auth-api.uskyyh8canpeuhqo89q0y9jou.5heko0emuc5lfl55wgqygddpc ucp-auth-worker.uskyyh8canpeuhqo89q0y9jou.hjmy0pmmgxen78kax1o36db3x”</p>
</blockquote>

<p>Removing all containers with <code class="language-plaintext highlighter-rouge">launchpad reset</code> and even manually did not help.</p>

<p>Even after several retries I couldn’t get past that error.</p>

<p>At this point I cleaned up everything including Docker volumes, rebooted both nodes and switched to MKE 3.4.0 (YAML file above already accounts for that change). Initially <code class="language-plaintext highlighter-rouge">launchpad</code> set version to 3.3.7. I don’t know why - I used the latest launchpad and the Mirantis Web site <a href="https://docs.mirantis.com/containers/v3.1/mke-deployment-guide/install-offline.html">currently mentions</a> version 3.4.0 as available.</p>

<h3 id="success">Success</h3>

<p>Despite warnings about possible conflicts between this and that range, the next try worked.</p>

<pre><code class="language-raw">INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:29Z" level=info msg="Your engine version 20.10.0, build 1e08f21 (4.15.0-142-generic) is compatible with UCP 3.4.0 (4486503)" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:29Z" level=info msg="Bootsrapper image org: mirantis" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:29Z" level=info msg="Bootsrapper image version: 3.4.0" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:29Z" level=info msg="Your Docker daemon version 20.10.0, build 1e08f21 (4.15.0-142-generic) is compatible with UCP 3.4.0 (4486503)" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:29Z" level=warning msg="Your system does not have available disk space. UCP requires a minimum of 25.00 GB, but you only have 20.01 GB" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:32Z" level=warning msg="None of the Subject Alternative Names we'll be using in the UCP certificates [\"192.168.1.197\" \"master1\"] contain a domain component. Your generated certs may fail TLS validation unless you only use one of these shortnames or IP addresses to connect. You can use the --san flag to add more aliases" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:32Z" level=info msg="Checking required ports for connectivity" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:38Z" level=info msg="Checking required container images" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:38Z" level=warning msg="Possible conflict between Kubernetes pod CIDR range 192.168.200.0/22 and default address pool for Docker Engine interface and bridge networks 192.168.0.0/16" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:38Z" level=warning msg="Possible conflict between Kubernetes service CIDR range 10.96.0.0/16 and default address pool for Swarm overlay networks 10.0.0.0/8" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:38Z" level=info msg="disabling checks which rely on detecting which (if any) cloud provider the cluster is currently running on" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:38Z" level=info msg="Running install agent container ..." 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:39Z" level=info msg="Loading install configuration" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:39Z" level=info msg="Running Installation Steps" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:39Z" level=info msg="Step 1 of 39: [Setup Internal Cluster CA]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:42Z" level=info msg="Step 2 of 39: [Setup Internal Client CA]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:42Z" level=info msg="Step 3 of 39: [Initialize etcd Cluster]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:46Z" level=info msg="Step 4 of 39: [Set Initial Config in etcd]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:46Z" level=info msg="Step 5 of 39: [Deploy RethinkDB Server]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:48Z" level=info msg="Step 6 of 39: [Initialize RethinkDB Tables]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:53Z" level=info msg="Step 7 of 39: [Create Auth Service Encryption Key Secret]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:53Z" level=info msg="Step 8 of 39: [Deploy Auth API Server]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:59Z" level=info msg="Step 9 of 39: [Setup Auth Configuration]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:18:59Z" level=info msg="Step 10 of 39: [Deploy Auth Worker Server]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:19:03Z" level=info msg="Step 11 of 39: [Deploy MKE Proxy Server]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:19:04Z" level=info msg="Step 12 of 39: [Initialize Swarm v1 Node Inventory]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:19:04Z" level=info msg="Step 13 of 39: [Deploy Swarm v1 Manager Server]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:19:06Z" level=info msg="Step 14 of 39: [Deploy Internal Cluster CA Server]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:19:07Z" level=info msg="Step 15 of 39: [Deploy Internal Client CA Server]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:19:08Z" level=info msg="Step 16 of 39: [Deploy MKE Controller Server]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:19:11Z" level=info msg="Step 17 of 39: [Deploy Kubernetes API Server]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:19:19Z" level=info msg="Step 18 of 39: [Deploy Kubernetes Controller Manager]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:19:23Z" level=info msg="Step 19 of 39: [Deploy Kubernetes Scheduler]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:19:27Z" level=info msg="Step 20 of 39: [Deploy Kubelet]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:06Z" level=info msg="Step 21 of 39: [Deploy Kubernetes Proxy]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:06Z" level=info msg="Step 22 of 39: [Wait for Healthy MKE Controller and Kubernetes API]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:06Z" level=info msg="Step 23 of 39: [Create Kubernetes Pod Security Policies]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:11Z" level=info msg="Step 24 of 39: [Install default storage class based on cloudprovider (for deprecated InTree providers)]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:11Z" level=info msg="Step 25 of 39: [Install Kubernetes CNI Plugin]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:25Z" level=info msg="Step 26 of 39: [Install CoreDNS]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:32Z" level=info msg="Step 27 of 39: [Install Cloud Controller Manager based on cloudprovider]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:32Z" level=info msg="Step 28 of 39: [Install Container Storage Interface Driver based on cloudprovider]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:32Z" level=info msg="Step 29 of 39: [Install Istio Ingress]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:52Z" level=info msg="Step 30 of 39: [Create MKE Controller Kubernetes Service Endpoints]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:54Z" level=info msg="Step 31 of 39: [Install Metrics Plugin]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:20:56Z" level=info msg="Step 32 of 39: [Install Kubernetes Compose Plugin]" 
INFO [ssh] 192.168.1.197:22: W0502 06:20:56.650591       1 warnings.go:70] apiextensions.k8s.io/v1beta1 CustomResourceDefinition is deprecated in v1.16+, unavailable in v1.22+; use apiextensions.k8s.io/v1 CustomResourceDefinition 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:21:03Z" level=info msg="Step 33 of 39: [Deploy Manager Node Agent Service]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:21:03Z" level=info msg="Step 34 of 39: [Deploy Worker Node Agent Service]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:21:03Z" level=info msg="Step 35 of 39: [Deploy Windows Worker Node Agent Service]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:21:03Z" level=info msg="Step 36 of 39: [Deploy Cluster Agent Service]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:21:03Z" level=info msg="Step 37 of 39: [Set License]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:21:03Z" level=info msg="Step 38 of 39: [Set Registry CA Certificates]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:21:03Z" level=info msg="Step 39 of 39: [Wait for All Nodes to be Ready]" 
INFO [ssh] 192.168.1.197:22: time="2021-05-02T06:21:09Z" level=info msg="All Installation Steps Completed" 
INFO ==&gt; Running phase: Upgrade MKE components 
INFO [ssh] 192.168.1.197:22: cluster already at version 3.4.0, not running upgrade 
INFO ==&gt; Running phase: Join managers to swarm 
INFO [ssh] 192.168.1.197:22: already a swarm node 
INFO ==&gt; Running phase: Join workers     
INFO [ssh] 192.168.1.130:22: joined succesfully   
INFO ==&gt; Running phase: Validating MKE Health 
INFO [ssh] 192.168.1.197:22: waiting for MKE to become healthy 
INFO ==&gt; Running phase: Label nodes      
INFO [ssh] 192.168.1.197:22: labeling node        
INFO [ssh] 192.168.1.130:22: labeling node        
INFO ==&gt; Running phase: Close Connection 
INFO [ssh] 192.168.1.130:22: disconnected         
INFO [ssh] 192.168.1.197:22: disconnected         
INFO ==&gt; Running phase: MKE cluster info 
INFO Cluster is now configured.                   
INFO MKE cluster admin UI: https://192.168.1.197/ 
INFO You can download the admin client bundle with the command 'launchpad client-config' 
</code></pre>

<p><img src="/assets/images/mirantis-mke-install-01.png" alt="Installing MKE with launchpad" /></p>

<h3 id="mke-wrap-up">MKE wrap-up</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># launchpad client-config
# ls -lat /root/.mirantis-launchpad/cluster/mke3/bundle/admin/
total 48
drwxr-xr-x 3 root root 4096 May  2 06:28 .
drwxr-xr-x 3 root root 4096 May  2 06:28 ..
-rw-r--r-- 1 root root 1129 May  2 06:28 ca.pem
-rw-r--r-- 1 root root  741 May  2 06:28 cert.pem
-rw-r--r-- 1 root root  177 May  2 06:28 cert.pub
-rw-r--r-- 1 root root 1105 May  2 06:28 env.cmd
-rw-r--r-- 1 root root 1270 May  2 06:28 env.ps1
-rw-r--r-- 1 root root 1089 May  2 06:28 env.sh
-rw------- 1 root root  227 May  2 06:28 key.pem
-rw-r--r-- 1 root root 3263 May  2 06:28 kube.yml
-rw-r--r-- 1 root root  285 May  2 06:28 meta.json
drwx------ 4 root root 4096 May  2 06:28 tls
</code></pre></div></div>

<p>Now, this is probably not how it should be done, but I didn’t want to RTFM:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@master1:~# snap <span class="nb">install </span>kubectl <span class="nt">--classic</span><span class="p">;</span> <span class="nb">cd</span> .mirantis-launchpad/cluster/mke3/bundle/admin
root@master1:~/.mirantis-launchpad/cluster/mke3/bundle/admin# <span class="nb">.</span> env.sh
Cluster <span class="s2">"ucp_192.168.1.197:6443_admin"</span> set.
User <span class="s2">"ucp_192.168.1.197:6443_admin"</span> set.
Context <span class="s2">"ucp_192.168.1.197:6443_admin"</span> modified.
root@master1:~/.mirantis-launchpad/cluster/mke3/bundle/admin# kubectl get nodes
NAME      STATUS   ROLES    AGE     VERSION
master1   Ready    master   12m     v1.20.1-mirantis-1-3-g71afa0ba032bfd
worker1   Ready    &lt;none&gt;   9m33s   v1.20.1-mirantis-1-3-g71afa0ba032bfd
</code></pre></div></div>

<p>This will do (unless it doesn’t).</p>

<p>MKE dashboard was easy to access: visit management IP from the YAML and log in using the admin creds. Check out that Swarm menu item!</p>

<p><img src="/assets/images/mirantis-mke-install-02.png" alt="One master, one worker, one beer and MKE 3.4.0" /></p>

<p>One master, one worker, one beer (reward for the hard work; not shown in screenshot)…</p>

<p><img src="/assets/images/mirantis-mke-install-03.png" alt="One master, one worker, one beer and MKE 3.4.0" /></p>

<h2 id="install-and-configure-netapp-trident-with-solidfire-back-end">Install and configure NetApp Trident with SolidFire back-end</h2>

<p>Get NetApp Trident v21.04 and install it. Create a SolidFire back-end and one or more Storage Classes.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@master1:~# ./trident-installer/tridentctl <span class="nb">install</span> <span class="nt">-n</span> trident
INFO Starting Trident installation.                <span class="nv">namespace</span><span class="o">=</span>trident
INFO Created namespace.                            <span class="nv">namespace</span><span class="o">=</span>trident
INFO Created service account.                     
INFO Created cluster role.                        
INFO Created cluster role binding.                
INFO Installer will create a fresh tridentvolumes.trident.netapp.io CRD. 
INFO Created custom resource definitions tridentvolumes.trident.netapp.io.  <span class="nv">namespace</span><span class="o">=</span>trident
INFO Installer will create a fresh tridentnodes.trident.netapp.io CRD. 
INFO Created custom resource definitions tridentnodes.trident.netapp.io.  <span class="nv">namespace</span><span class="o">=</span>trident
INFO Installer will create a fresh tridenttransactions.trident.netapp.io CRD. 
INFO Created custom resource definitions tridenttransactions.trident.netapp.io.  <span class="nv">namespace</span><span class="o">=</span>trident
INFO Installer will create a fresh tridentsnapshots.trident.netapp.io CRD. 
INFO Created custom resource definitions tridentsnapshots.trident.netapp.io.  <span class="nv">namespace</span><span class="o">=</span>trident
INFO Installer will create a fresh tridentversions.trident.netapp.io CRD. 
INFO Created custom resource definitions tridentversions.trident.netapp.io.  <span class="nv">namespace</span><span class="o">=</span>trident
INFO Installer will create a fresh tridentbackends.trident.netapp.io CRD. 
INFO Created custom resource definitions tridentbackends.trident.netapp.io.  <span class="nv">namespace</span><span class="o">=</span>trident
INFO Installer will create a fresh tridentbackendconfigs.trident.netapp.io CRD. 
INFO Created custom resource definitions tridentbackendconfigs.trident.netapp.io.  <span class="nv">namespace</span><span class="o">=</span>trident
INFO Installer will create a fresh tridentstorageclasses.trident.netapp.io CRD. 
INFO Created custom resource definitions tridentstorageclasses.trident.netapp.io.  <span class="nv">namespace</span><span class="o">=</span>trident
INFO Created custom resource definitions.         
INFO Created Trident pod security policy.         
INFO Added finalizers to custom resource definitions. 
INFO Created Trident service.                     
INFO Created Trident secret.                      
INFO Created Trident deployment.                  
INFO Created Trident daemonset.                   
INFO Waiting <span class="k">for </span>Trident pod to start.            
INFO Trident pod started.                          <span class="nv">namespace</span><span class="o">=</span>trident <span class="nv">pod</span><span class="o">=</span>trident-csi-bbdd8b965-4q796
INFO Waiting <span class="k">for </span>Trident REST interface.          
INFO Trident REST interface is up.                 <span class="nv">version</span><span class="o">=</span>21.04.0
INFO Trident installation succeeded.              
</code></pre></div></div>

<p>Now that we’ve survived this step, we can appreciate the view in the Web UI:</p>

<p><img src="/assets/images/mirantis-mke-install-04.png" alt="Trident v21.04 on MKE 3.4.0" /></p>

<p>Trident v21.04 containers:</p>

<p><img src="/assets/images/mirantis-mke-install-05.png" alt="Trident v21.04 containers on MKE 3.4.0" /></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@master1:~# ./trident-installer/tridentctl create backend <span class="nt">-n</span> trident <span class="nt">-f</span> back-end.json 
+--------------------------+----------------+--------------------------------------+--------+---------+
|           NAME           | STORAGE DRIVER |                 UUID                 | STATE  | VOLUMES |
+--------------------------+----------------+--------------------------------------+--------+---------+
| solidfire_192.168.103.30 | solidfire-san  | d1127f2c-964c-448c-a284-e2ca2666fa3b | online |       0 |
+--------------------------+----------------+--------------------------------------+--------+---------+

root@master1:~# kubectl create <span class="nt">-f</span> sc-bronze.yaml 
storageclass.storage.k8s.io/solidfire-bronze created

root@master1:~# kubectl create <span class="nt">-f</span> sc-silver.yaml 
storageclass.storage.k8s.io/solidfire-silver created

root@master1:~# kubectl get sc
NAME                         PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
solidfire-bronze             csi.trident.netapp.io   Delete          Immediate           <span class="nb">false                  </span>5m16s
solidfire-silver <span class="o">(</span>default<span class="o">)</span>   csi.trident.netapp.io   Retain          Immediate           <span class="nb">false                  </span>5m12s
</code></pre></div></div>

<p>Create a PVC to use one of Trident storage classes that use SolidFire:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@master1:~# kubectl create <span class="nt">-f</span> pvc.yaml 
persistentvolumeclaim/logs created

root@master1:~# kubectl get pvc
NAME   STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS       AGE
logs   Bound    pvc-b9fce918-e48d-4239-8209-2cf9a86e580b   1Gi        RWO            solidfire-silver   6s
root@master1:~# kubectl get pv
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM          STORAGECLASS       REASON   AGE
pvc-b9fce918-e48d-4239-8209-2cf9a86e580b   1Gi        RWO            Retain           Bound    default/logs   solidfire-silver            8s
</code></pre></div></div>

<p>Seen from the Mirantis Kubernetes Engine Web interface, this is my storage configuration:</p>

<p><img src="/assets/images/mirantis-mke-install-06.png" alt="MKE storage view with Trident 21.04 and PV on SolidFire 12.2" /></p>

<p>It’s a bit unusual to see storage classes, PVCs and PVs in the same pane. But to be honest the “classic” K8s Web UI which has (had?) them all over the place wasn’t much better.</p>

<p>New PV on SolidFire:</p>

<p><img src="/assets/images/mirantis-mke-install-07.png" alt="MKE PV view of volume on Trident 21.04 and SolidFire 12.2" /></p>

<p>Using the SolidFire Web UI in this volume’s attributes we can observe that platform version is <code class="language-plaintext highlighter-rouge">v1.20.1-mirantis-1-3-g71afa0ba032bfd</code>. Version 1.3 is coming from launchpad.</p>

<p><img src="/assets/images/mirantis-mke-install-08.png" alt="MKE volume on SolidFire Demo VM 12.2" /></p>

<h2 id="summary">Summary</h2>

<p>I can’t say I know a whole lot about MKE, but I was able to install it with minimal effort and the Web UI is frustration-free.</p>

<p>NetApp Trident v21.04 and SolidFire 12.2 didn’t require any unusual steps to deploy or use (to the extent I tried - create, delete).</p>

<p>I was surprised to see Swarm in the MKE management interface (and also in launchpad install log). This deserves some follow up and RTFM, but remember that Swarm and Docker EE don’t work with Trident’s <code class="language-plaintext highlighter-rouge">solidfire-san</code> driver, so MKE users with NetApp HCI or SolidFire will probably want to ensure to not use Swarm with Trident 21.04 and SolidFire 12. Based on my touch tests it did not appear that Swarm was involved.</p>

<p>MKE supports Hyper-V workers and has other <a href="https://www.mirantis.com/software/mirantis-kubernetes-engine/">interesting features</a> which deserve further exploration.</p>

<p>Note that both Trident and MKE may (or may not) have each other - or maybe not these exact versions - in their compatibility charts. Please verify this information before making decisions for production use.</p>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="https://docs.mirantis.com/containers/v3.1/dockeree-products/deployment-tools/launchpad/lp-system-requirements.html">MKE 3.1 and launchpad system requirements</a></li>
  <li><a href="https://www.mirantis.com/download/mirantis-cloud-native-platform/mirantis-kubernetes-engine/">MKE install guide</a></li>
</ul>

<h2 id="demo">Demo</h2>

<ul>
  <li>Touch-test with quick walk-through: <a href="https://youtu.be/F_fpzJLfmNQ">Mirantis MKE 3.4.0 with NetApp Trident v21.04 and SolidFire 12.2</a> - 1m39s</li>
</ul>

      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#kubernetes">kubernetes</a>
      &nbsp; 
    
      <a href="
      /categories/#solidfire">solidfire</a>
       
    
  </span>
</div>
    

  
    <div>
      <h3>Related Posts</h3>
      <ul>
      
        <li><a href="/2021/03/20/kubernetes-solidfire-failover-failback.html">Kubernetes failover and failback with Trident CSI and SolidFire</a></li>
      
        <li><a href="/2023/08/21/trident-new-stateful-set-delete-feature.html">StatefulSet PVC Retention with Trident and SolidFire</a></li>
      
        <li><a href="/2024/07/05/kubefire-for-failover-failback-of-kubernetes-with-solidfire-backend.html">Kubefire - tools and recipes for Kubernetes failover/failback with SolidFire</a></li>
      
        <li><a href="/2024/07/02/solidfire-volume-attributes-from-trident-and-other-apps.html">Extract SolidFire volume attributes created by Trident or other apps</a></li>
      
        <li><a href="/2024/04/09/solidbackup-velero-backup-non-k8s-volumes-netapp-solidfire-to-s3.html">Backup NetApp SolidFire's non-Kubernetes volumes with Velero</a></li>
      
      </ul>
    </div>
  

    
  </div><footer class= "footer">
    <p>2025-05-18 03:51 </p>
    <p>Copyright © 2025 scaleoutSean. Content is released under the CC BY license. Design: Alessio Franceschi</p>
</footer>

</body>
</html>
