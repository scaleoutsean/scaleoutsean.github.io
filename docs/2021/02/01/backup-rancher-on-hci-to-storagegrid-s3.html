<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.3 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Backup Rancher cluster configuration to NetApp StorageGRID | Acting Technologist</title>
<meta name="description" content="Backup and restore Kubernetes cluster configuration of Rancher on NetApp HCI">


  <meta name="author" content="scaleoutSean">
  
  <meta property="article:author" content="scaleoutSean">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Acting Technologist">
<meta property="og:title" content="Backup Rancher cluster configuration to NetApp StorageGRID">
<meta property="og:url" content="https://scaleoutsean.github.io/2021/02/01/backup-rancher-on-hci-to-storagegrid-s3.html">


  <meta property="og:description" content="Backup and restore Kubernetes cluster configuration of Rancher on NetApp HCI">





  <meta name="twitter:site" content="@scaleoutSean">
  <meta name="twitter:title" content="Backup Rancher cluster configuration to NetApp StorageGRID">
  <meta name="twitter:description" content="Backup and restore Kubernetes cluster configuration of Rancher on NetApp HCI">
  <meta name="twitter:url" content="https://scaleoutsean.github.io/2021/02/01/backup-rancher-on-hci-to-storagegrid-s3.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2021-02-01T00:00:00+08:00">






<link rel="canonical" href="https://scaleoutsean.github.io/2021/02/01/backup-rancher-on-hci-to-storagegrid-s3.html">







  <meta name="google-site-verification" content="F6q7vIwQ2G0j8tk-KL9rAXOMLXMDMMUkEz4fRs1Nnnc" />


  <meta name="msvalidate.01" content="7cf5b7d96a77410a8ad035f764dc81b3">





<!-- end _includes/seo.html -->


<meta name="bingbot" content="noindex,noarchive,nofollow">


  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Acting Technologist Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<script src="https://cdn.counter.dev/script.js" data-id="83dc700a-b821-4e57-9425-02b8336a9456" data-utcoffset="0"></script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic" rel="stylesheet" type="text/css">


  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/scaleoutsean-acting-technologist.png" alt="Acting Technologist"></a>
        
        <a class="site-title" href="/">
          Acting Technologist
          <span class="site-subtitle">human action through technology</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/archive/"
                
                
              >Archive</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/projects.html"
                
                
              >Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Backup Rancher cluster configuration to NetApp StorageGRID">
    <meta itemprop="description" content="Backup and restore Rancher configuration to/from NetApp StorageGRID">
    <meta itemprop="datePublished" content="2021-02-01T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://scaleoutsean.github.io/2021/02/01/backup-rancher-on-hci-to-storagegrid-s3.html" itemprop="url">Backup Rancher cluster configuration to NetApp StorageGRID
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-02-01T00:00:00+08:00">2021-02-01 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p><strong>NOTICE</strong>: any and all credentials and tokens on this page are samples, not leaked.</p>

<ul>
  <li><a href="#summary">Summary</a></li>
  <li><a href="#backup-and-restore-etcd-configuration-in-rancher-on-netapp-hci">Backup and restore etcd configuration in Rancher on NetApp HCI</a>
    <ul>
      <li><a href="#prepare-a-bucket">Prepare a bucket</a></li>
      <li><a href="#use-it-when-deploying-a-cluster">Use it when deploying a cluster</a></li>
      <li><a href="#view-your-backups-with-an-s3-browser">View your backups with an S3 browser</a></li>
      <li><a href="#restore-a-cluster-configuration-backup">Restore a cluster configuration backup</a></li>
    </ul>
  </li>
  <li><a href="#object-storage-organization">Object storage organization</a></li>
  <li><a href="#what-about-apps-and-pvs">What about apps and PVs</a>
    <ul>
      <li><a href="#can-we-just-automate-everything">Can we just automate everything</a></li>
    </ul>
  </li>
  <li><a href="#video-demo">Video demo</a></li>
</ul>

<h2 id="summary">Summary</h2>

<ul>
  <li>Protect etcd and cluster configuration with scheduled and on-demand Rancher snapshots</li>
  <li>Store snapshots outside, on S3-compatible storage such as NetApp StorageGRID</li>
  <li>To backup apps and persistent data, consider one of enterprise solutions that support Trident CSI, such as CommVault or Kasten K10 by Veeam (see that post <a href="/2020/12/21/kasten-rancher-netapp-hci-solidfire-k8s-backup">here</a> if interested)
    <ul>
      <li>NOTE: NetApp Trident v21.01 (just released) uses a newer CRD so the post I wrote before is slightly outdated; but because I knew the Snapshot API was outdated I didn't focus on the details as I knew very soon that would be out of date. I have not yet tried the new K8s Snapshot API in Trident v21.01.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/images/rancher-backup-restore-storagegrid-05.png" alt="Tenant prepares S3 bucket and ACLs" /></p>

<h2 id="backup-and-restore-etcd-configuration-in-rancher-on-netapp-hci">Backup and restore etcd configuration in Rancher on NetApp HCI</h2>

<p>Rancher actually calls those "snapshots", not backups, but a copy is made outside of the cluster - if you choose S3 instead of "local" - so they are in effect backups.</p>

<p>But you still need a cluster to restore one. I assume that by following the exact same deployment from scratch, you could restore a cluster backup this way, but this assumes you don't make random choices when deploying clusters.</p>

<h3 id="prepare-a-bucket">Prepare a bucket</h3>

<p>I created a dedicated bucket <code class="language-plaintext highlighter-rouge">rancher-backup</code>, and for my cluster(s) I prefix them with <code class="language-plaintext highlighter-rouge">scaleoutsean</code>, meaning <em>assuming</em> ACLs let me LIST/PUT/GET the content of <code class="language-plaintext highlighter-rouge">${S3-API-ENDPOINT}/rancher-backup/scaleoutsean/*</code>, only I would be able to create, view and download my backups, while other users may be able to access backups from other prefixes in this bucket.</p>

<p><img src="/assets/images/rancher-backup-restore-storagegrid-01.png" alt="Tenant prepares S3 bucket and ACLs" /></p>

<h3 id="use-it-when-deploying-a-cluster">Use it when deploying a cluster</h3>

<p>There are settings you can fiddle with, such as the frequency and retention.</p>

<p><img src="/assets/images/rancher-backup-restore-storagegrid-02.png" alt="Rancher admin uses StorageGRID configuration" /></p>

<h3 id="view-your-backups-with-an-s3-browser">View your backups with an S3 browser</h3>

<p><img src="/assets/images/rancher-backup-restore-storagegrid-03.png" alt="Rancher backups in StorageGRID bucket" /></p>

<p>Makes you wonder what happens with passwords (secrets). Check the Rancher docs and options.</p>

<h3 id="restore-a-cluster-configuration-backup">Restore a cluster configuration backup</h3>

<p>As you can see from this screenshot you can restore both etcd and cluster configuration. If you use something else to restore application configuration, you'd have to decide how you want to protect your configs - maybe do everything from here, or just etcd + cluster version here and the rest there, etc.</p>

<p><img src="/assets/images/rancher-backup-restore-storagegrid-04.png" alt="Rancher backups in Rancher Web UI" /></p>

<h2 id="object-storage-organization">Object storage organization</h2>

<p>Whatever works for you:</p>

<ul>
  <li>If you're the only guy running the show (managing Rancher on NetApp HCI), you can create one S3 bucket and store all Rancher cluster backups to it. This would be less secure as all clusters would be able to access all backups.</li>
  <li>You can spend a bit more effort to create "subdirectories" ("by cluster", or "by team"), and apply appropriate ACLs, so that each cluster owner can access only their backups.</li>
  <li>You can also let users create their own buckets and do it on their own - a hands-off approach (which kind of assumes they know what they're doing).</li>
</ul>

<p>There's no "best way", there are just trade-offs.</p>

<h2 id="what-about-apps-and-pvs">What about apps and PVs</h2>

<p>If you don't have a shedload of PVs you may be able to get away with SolidFire snapshots and the volume import feature from NetApp Trident. That works. You schedule snapshots with SolidFire, and you either restore them (stop your workload first) or clone them to create a new volume.</p>

<p>If you don't want to do an in-place restore, make a clone from a SolidFire snapshot and use the Trident volume import feature to bring it under the control of K8s.</p>

<p>If your data is valuable and you also want to protect application configuration, I would recommend to use a non-free backup and restore application that supports Trident CSI. At this time I know of two: CommVault and Kasten K10 by Veeam.</p>

<p>If your cluster is small but you prefer convenience, consider the free Kasten K10 edition. You may (or may not, as Trident v21.01 released couple of hours ago could make that easier compared to older versions) need to break a sweat to get them K8s snapshot CRDs deployed and configured to Kasten's liking. See <a href="/2020/12/21/kasten-rancher-netapp-hci-solidfire-k8s-backup">this</a> for a Persistent Volume snapshot &amp; restore demo with Kasten.</p>

<h3 id="can-we-just-automate-everything">Can we just automate everything</h3>

<p>Yes, you can, but I wouldn't recommend it. In the StorageGRID screenshot at the top you can see one of the non-pixelated buckets is named <code class="language-plaintext highlighter-rouge">solidbackup</code>, which is a poor man's backup for Trident I scripted in Python.</p>

<ul>
  <li>Stand up a Linux VM and make it connect to SolidFire iSCSI</li>
  <li>Create a schedule to clone selected Trident VMs and present them to this VM</li>
  <li>Run S3 backup software (any you like) to backup volumes to StorageGRID</li>
  <li>Restore individual files from K8s containers by copying them from this VM, or restore data from S3 to this VM, and then clone it into the container/PV that you want to restore</li>
</ul>

<p>As far as free DIY backups go this isn't too bad (and doesn't have require any fiddling with K8s), but if you can get Kasten K10 to work, there's no need to write your own. If you're interested in the process, there's a <a href="https://youtu.be/bvI7pgXKh6w">23 minute video</a> of the process done manually, and a prototype made the whole process take seconds (I have recorded just some of the steps):</p>

<p><img src="/assets/images/solid-backup-prototype.gif" alt="solid-backup prototype" /></p>

<p>If you use stand-alone Docker, or have a small and static Kubernetes environment, a DIY approach like this may be useful (and can always work independently of whatever you use, whether it's Kasten or CommVault), otherwise keep it simple - just create a rotating snapshot schedule on SolidFire, and use Kasten or CommVault to backup apps and PVs. In the case your backup software fails, you can still clone the PV(s) in SolidFire and import them to Kubernetes with the Trident import feature.</p>

<h2 id="video-demo">Video demo</h2>

<ul>
  <li>Take a snapshot of a Kubernetes cluster configuration and restore it to the same cluster: <a href="https://youtu.be/H9TXXexb7Sk">https://youtu.be/H9TXXexb7Sk</a></li>
  <li>Key components:
    <ul>
      <li>Rancher 2.5.5</li>
      <li>VMware vSphere 7.0U1</li>
      <li>NetApp SolidFire 12.2 (NetApp HCI storage cluster)</li>
      <li>NetApp StorageGRID 11.4</li>
    </ul>
  </li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/backup" class="page__taxonomy-item p-category" rel="tag">backup</a><span class="sep">, </span>
    
      <a href="/tags/data-protection" class="page__taxonomy-item p-category" rel="tag">data protection</a><span class="sep">, </span>
    
      <a href="/tags/kubernetes" class="page__taxonomy-item p-category" rel="tag">kubernetes</a><span class="sep">, </span>
    
      <a href="/tags/rancher" class="page__taxonomy-item p-category" rel="tag">rancher</a><span class="sep">, </span>
    
      <a href="/tags/s3" class="page__taxonomy-item p-category" rel="tag">s3</a><span class="sep">, </span>
    
      <a href="/tags/storagegrid" class="page__taxonomy-item p-category" rel="tag">storagegrid</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/kubernetes" class="page__taxonomy-item p-category" rel="tag">kubernetes</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2021-02-01T00:00:00+08:00">2021-02-01 00:00</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?via=scaleoutSean&text=Backup+Rancher+cluster+configuration+to+NetApp+StorageGRID%20https%3A%2F%2Fscaleoutsean.github.io%2F2021%2F02%2F01%2Fbackup-rancher-on-hci-to-storagegrid-s3.html" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://scaleoutsean.github.io/2021/02/01/backup-rancher-on-hci-to-storagegrid-s3.html" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

</section>


      
  <nav class="pagination">
    
      <a href="/2021/01/29/get-rancher-deployment-log-from-netapp-hci-hcc.html" class="pagination--pager" title="Get Rancher Kubernetes deployment log for on NetApp HCI mNode">Previous</a>
    
    
      <a href="/2021/02/02/trident-21.01-install-with-helm-on-netapp-hci.html" class="pagination--pager" title="Install NetApp Trident v21.01 with Helm v3, SolidFire">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/31/epa-version-3-dot-5.html" rel="permalink">EPA version 3.5.0
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-31T00:00:00+08:00">2025-08-31 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">What's new in EPA v3.5.0
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/27/epa-version-3-dot-4-dot-1.html" rel="permalink">EPA version 3.4.1
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-27T00:00:00+08:00">2025-08-27 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">What's new in EPA v3.4.1
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/24/epa-version-3-dot-4.html" rel="permalink">EPA version 3.4.0
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-24T00:00:00+08:00">2025-08-24 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">What's new in EPA v3.4.0
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/08/20/econfig-v2-updates.html" rel="permalink">E-Config v2 updated for QLC drives
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-08-20T00:00:00+08:00">2025-08-20 00:00</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I got carried away while making overdue updates to E-Config and added a new feature
</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/scaleoutsean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2020-2025 scaleoutSean.github.io | <a href="https://scaleoutsean.github.io">Acting Technologist</a> | Terms: <a href="https://creativecommons.org/licenses/by/4.0/deed.en" target="_blank">CC BY 4.0</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
